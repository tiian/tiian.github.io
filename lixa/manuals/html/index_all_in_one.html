<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>LIXA reference guide (version 1.5.2-rc2)</title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /></head><body><div class="book"><div class="titlepage"><div><div><h1 class="title"><a id="idp56892144"></a>LIXA reference guide (version 1.5.2-rc2)</h1></div><div><h2 class="subtitle">
    A libre, free, open source implementation of the XA and the TX 
    specifications
  </h2></div><div><div class="author"><h3 class="author"><span class="firstname">Christian</span> <span class="surname">Ferrari</span></h3></div></div><div><p class="copyright">Copyright © 2018 Christian Ferrari</p></div></div><hr /></div><div class="toc"><p><strong>Table of Contents</strong></p><dl class="toc"><dt><span class="preface"><a href="#idp49115600">Preface</a></span></dt><dt><span class="chapter"><a href="#idp57081600">1. Introduction</a></span></dt><dd><dl><dt><span class="section"><a href="#idp57082464">Why should I use LIXA project?</a></span></dt><dt><span class="section"><a href="#Transaction_Manager_and_Transaction_Monitor">Transaction Manager and Transaction Monitor</a></span></dt><dt><span class="section"><a href="#idp57108896">LIXA Architecture</a></span></dt><dt><span class="section"><a href="#idp57109888">LIXA and X/OPEN CAE specifications</a></span></dt></dl></dd><dt><span class="chapter"><a href="#Installation">2. Installation</a></span></dt><dd><dl><dt><span class="section"><a href="#idp67230480">System requirements</a></span></dt><dd><dl><dt><span class="section"><a href="#idp67235040">Pre-requisites</a></span></dt><dt><span class="section"><a href="#idp67263792">Co-requisites</a></span></dt><dt><span class="section"><a href="#idp67274816">Authorization</a></span></dt></dl></dd><dt><span class="section"><a href="#idp67287248">Certified and Tested configurations</a></span></dt><dt><span class="section"><a href="#idp67291184">Software download</a></span></dt><dt><span class="section"><a href="#idp67296592">Configure, build and install</a></span></dt><dd><dl><dt><span class="section"><a href="#idp67297664">Advanced configuration</a></span></dt><dt><span class="section"><a href="#Linking_third_party_resource_managers">Linking third party resource managers</a></span></dt><dt><span class="section"><a href="#idp67380368">Summary</a></span></dt></dl></dd><dt><span class="section"><a href="#idp67382080">Checking</a></span></dt><dd><dl><dt><span class="section"><a href="#idp67386448">Checking notes</a></span></dt><dt><span class="section"><a href="#idp67396176">Valgrind advanced checking (LIXA developers only)</a></span></dt><dt><span class="section"><a href="#idp67400368">GDB assisted checking (LIXA developers only)</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#Configuration">3. Configuration</a></span></dt><dd><dl><dt><span class="section"><a href="#idp67424736">Architectural elements</a></span></dt><dd><dl><dt><span class="section"><a href="#idp67430928">Deployment models</a></span></dt></dl></dd><dt><span class="section"><a href="#idp67458272">Configuring LIXA components</a></span></dt><dd><dl><dt><span class="section"><a href="#Configuring_the_server">Configuring the server</a></span></dt><dt><span class="section"><a href="#idp67504368">Configuring the client</a></span></dt></dl></dd><dt><span class="section"><a href="#Environment_variables">Environment variables</a></span></dt><dd><dl><dt><span class="section"><a href="#idp67567520">LIXA_CONFIG_FILE</a></span></dt><dt><span class="section"><a href="#idp67571248">LIXA_CRASH_COUNT</a></span></dt><dt><span class="section"><a href="#idp67573904">LIXA_CRASH_POINT</a></span></dt><dt><span class="section"><a href="#idp67576320">LIXA_JOB</a></span></dt><dt><span class="section"><a href="#idp67579808">LIXA_PROFILE</a></span></dt><dt><span class="section"><a href="#idp67582432">LIXA_TRACE_MASK</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#idp67590288">4. Execution</a></span></dt><dd><dl><dt><span class="section"><a href="#idp67593008">Starting the state server (<span class="command"><strong>lixad</strong></span>)</a></span></dt><dd><dl><dt><span class="section"><a href="#Background_execution">Background (<span class="emphasis"><em>daemon</em></span>) execution</a></span></dt><dt><span class="section"><a href="#Maintenance_mode_execution">Maintenance mode execution</a></span></dt><dt><span class="section"><a href="#lixad_dump_execution">Dump execution</a></span></dt><dt><span class="section"><a href="#idp67628560">Additional options</a></span></dt></dl></dd><dt><span class="section"><a href="#Starting_test_utility">Starting the test utility (<span class="command"><strong>lixat</strong></span>)</a></span></dt><dt><span class="section"><a href="#idp67647616">Starting the recovery utility (<span class="command"><strong>lixar</strong></span>)</a></span></dt><dt><span class="section"><a href="#idp67680576">Starting the transaction monitoring utility (<span class="command"><strong>lixatpm</strong></span>)</a></span></dt><dt><span class="section"><a href="#idp67686192">Starting the configuration utility (<span class="command"><strong>lixa-config</strong></span>)</a></span></dt></dl></dd><dt><span class="chapter"><a href="#Development">5. Developing C Application Programs</a></span></dt><dd><dl><dt><span class="section"><a href="#idp67698288">The TX (Transaction Demarcation) Specification</a></span></dt><dd><dl><dt><span class="section"><a href="#idp67714352">Access to the resource managers</a></span></dt></dl></dd><dt><span class="section"><a href="#linkage">LIXA library linkage</a></span></dt><dt><span class="section"><a href="#idp67728496">The first example</a></span></dt><dd><dl><dt><span class="section"><a href="#first_example_details">Some details about the example</a></span></dt></dl></dd><dt><span class="section"><a href="#Development_example2_ora">Examples with Oracle Database Server</a></span></dt><dd><dl><dt><span class="section"><a href="#idp67783776">Local configuration (Server) and OCI</a></span></dt><dt><span class="section"><a href="#idp67870224">Remote configuration (Instant Client) and OCI</a></span></dt><dt><span class="section"><a href="#idp67870544">Remote configuration (Instant Client) and Pro*C</a></span></dt></dl></dd><dt><span class="section"><a href="#Development_example3_db2">An example with IBM DB2 DBMS</a></span></dt><dd><dl><dt><span class="section"><a href="#Development_setup_DB2_environment">Set-up DB2 environment</a></span></dt><dt><span class="section"><a href="#idp67993104">Start the LIXA state server</a></span></dt><dt><span class="section"><a href="#idp67995104">Build the client program</a></span></dt><dt><span class="section"><a href="#idp68000896">Set-up LIXA environment</a></span></dt><dt><span class="section"><a href="#idp68004224">Some checks before program execution</a></span></dt><dt><span class="section"><a href="#idp68009920">Program execution (dynamic registration)</a></span></dt><dt><span class="section"><a href="#idp68029088">Program execution (static registration)</a></span></dt></dl></dd><dt><span class="section"><a href="#idp67960224">An example with Oracle and IBM DB2</a></span></dt><dd><dl><dt><span class="section"><a href="#idp68050144">Build the client program</a></span></dt><dt><span class="section"><a href="#idp68055920">Set-up LIXA environment</a></span></dt><dt><span class="section"><a href="#idp68065936">Some checks before program execution</a></span></dt><dt><span class="section"><a href="#idp68075792">Program execution (dynamic registration)</a></span></dt><dt><span class="section"><a href="#idp68076912">Program execution (mixed registration)</a></span></dt></dl></dd><dt><span class="section"><a href="#Development_example5_pql">An example with PostgreSQL</a></span></dt><dd><dl><dt><span class="section"><a href="#Development_setup_PostgreSQL_environment">Set-up PostgreSQL environment</a></span></dt><dt><span class="section"><a href="#idp68186576">Start the LIXA state server</a></span></dt><dt><span class="section"><a href="#idp68189872">Build the client program</a></span></dt><dt><span class="section"><a href="#idp68197904">Set-up LIXA environment</a></span></dt><dt><span class="section"><a href="#idp68206208">Some checks before program execution</a></span></dt><dt><span class="section"><a href="#idp68212800">Program execution</a></span></dt></dl></dd><dt><span class="section"><a href="#Development_example6_pql_ora">An example with PostgreSQL &amp; Oracle</a></span></dt><dd><dl><dt><span class="section"><a href="#idp68252096">Build the client program</a></span></dt><dt><span class="section"><a href="#idp68266880">Set-up LIXA environment</a></span></dt><dt><span class="section"><a href="#example5_some_checks">Some checks before program execution</a></span></dt><dt><span class="section"><a href="#idp68297856">Program execution (dynamic registration for Oracle)</a></span></dt></dl></dd><dt><span class="section"><a href="#Development_example7_pql_ora">An example with PostgreSQL &amp; IBM DB2</a></span></dt><dd><dl><dt><span class="section"><a href="#idp68355808">Build the client program</a></span></dt><dt><span class="section"><a href="#idp68366688">Set-up LIXA environment</a></span></dt><dt><span class="section"><a href="#idp68371488">Some checks before program execution</a></span></dt><dt><span class="section"><a href="#idp68381952">Program execution (dynamic registration)</a></span></dt></dl></dd><dt><span class="section"><a href="#Development_example8_mys">An example with MySQL/MariaDB</a></span></dt><dd><dl><dt><span class="section"><a href="#Development_setup_MySQL_environment">Set-up MySQL environment</a></span></dt><dt><span class="section"><a href="#idp68450640">Start the LIXA state server</a></span></dt><dt><span class="section"><a href="#idp68453952">Build the client program</a></span></dt><dt><span class="section"><a href="#idp68463552">Set-up LIXA environment</a></span></dt><dt><span class="section"><a href="#Development_setup_MySQL_xa_open_info">Some checks before program execution</a></span></dt><dt><span class="section"><a href="#idp68509904">Program execution</a></span></dt></dl></dd><dt><span class="section"><a href="#Development_example9_mys_pql">An example with MySQL &amp; PostgreSQL</a></span></dt><dd><dl><dt><span class="section"><a href="#idp68552848">Build the client program</a></span></dt><dt><span class="section"><a href="#idp68562976">Set-up LIXA environment</a></span></dt><dt><span class="section"><a href="#idp68567232">Some checks before program execution</a></span></dt><dt><span class="section"><a href="#idp68577376">Program execution</a></span></dt></dl></dd><dt><span class="section"><a href="#Development_example10_mys_pql_ora">An example with MySQL, PostgreSQL &amp; Oracle</a></span></dt><dd><dl><dt><span class="section"><a href="#idp68624320">Build the client program</a></span></dt><dt><span class="section"><a href="#idp68634560">Set-up LIXA environment</a></span></dt><dt><span class="section"><a href="#idp68648192">Some checks before program execution</a></span></dt><dt><span class="section"><a href="#idp68661392">Program execution (dynamic registration for Oracle)</a></span></dt></dl></dd><dt><span class="section"><a href="#Development_example11_mys_mys">An example with two MySQL servers</a></span></dt><dd><dl><dt><span class="section"><a href="#idp68750880">Build the client program</a></span></dt><dt><span class="section"><a href="#idp68761904">Set-up LIXA environment</a></span></dt><dt><span class="section"><a href="#idp68766160">Some checks before program execution</a></span></dt><dt><span class="section"><a href="#idp68773376">Program execution</a></span></dt></dl></dd><dt><span class="section"><a href="#Development_example12_wmq">An example with WebSphere MQ</a></span></dt><dd><dl><dt><span class="section"><a href="#idp68824320">Introduction</a></span></dt><dt><span class="section"><a href="#Development_setup_WebSphereMQ_environment">Set-up WebSphere MQ environment</a></span></dt><dt><span class="section"><a href="#idp68884192">Start the LIXA state server</a></span></dt><dt><span class="section"><a href="#idp68887088">Build the client program (SRV mode)</a></span></dt><dt><span class="section"><a href="#idp68896832">Set-up LIXA environment (SRV mode)</a></span></dt><dt><span class="section"><a href="#idp68899408">Some checks before program execution (SRV mode)</a></span></dt><dt><span class="section"><a href="#idp68908048">Program execution (SRV mode)</a></span></dt><dt><span class="section"><a href="#idp68942048">Build the client program (ETC mode)</a></span></dt><dt><span class="section"><a href="#idp68950416">Set-up LIXA environment (ETC mode)</a></span></dt><dt><span class="section"><a href="#idp68954608">Some checks before program execution (ETC mode)</a></span></dt><dt><span class="section"><a href="#idp68959088">Program execution (ETC mode)</a></span></dt></dl></dd><dt><span class="section"><a href="#Development_example13_wmq_mys_pql">An example with WebSphere MQ, MySQL and PostgreSQL</a></span></dt><dd><dl><dt><span class="section"><a href="#idp68990320">Set-up WebSphere MQ, MySQL, PostgreSQL and LIXA environment</a></span></dt><dt><span class="section"><a href="#idp68997536">Build the client program (SRV mode)</a></span></dt><dt><span class="section"><a href="#idp69007408">Set-up LIXA environment (SRV mode)</a></span></dt><dt><span class="section"><a href="#idp69009984">Some checks before program execution (SRV mode)</a></span></dt><dt><span class="section"><a href="#idp69015952">Program execution (SRV mode)</a></span></dt><dt><span class="section"><a href="#idp69064064">Adapting the example to WebSphere MQ Extended Transactional Client (ETC)</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#Development_COBOL">6. Developing COBOL Application Programs</a></span></dt><dd><dl><dt><span class="section"><a href="#idp69080112">Supported COBOL environment</a></span></dt><dt><span class="section"><a href="#idp69085072">The TX (Transaction Demarcation) Specification</a></span></dt><dd><dl><dt><span class="section"><a href="#idp69103504">Access to the resource managers</a></span></dt><dt><span class="section"><a href="#idp69108064">Chapter organization</a></span></dt></dl></dd><dt><span class="section"><a href="#idp69113216">LIXA library linkage</a></span></dt><dt><span class="section"><a href="#idp69117392">The first example</a></span></dt><dt><span class="section"><a href="#Development_EXAMPLE5_PQL">An example with PostgreSQL</a></span></dt><dd><dl><dt><span class="section"><a href="#idp69153808">Build the client program</a></span></dt><dt><span class="section"><a href="#idp69164752">Set-up LIXA environment</a></span></dt><dt><span class="section"><a href="#idp69170048">Program execution</a></span></dt></dl></dd><dt><span class="section"><a href="#Development_EXAMPLE2_ORA">An example with Oracle Pro*COBOL</a></span></dt><dd><dl><dt><span class="section"><a href="#idp69203232">Set environment variables</a></span></dt><dt><span class="section"><a href="#idp69207168">Build the client program</a></span></dt><dt><span class="section"><a href="#idp69216784">Set-up LIXA environment</a></span></dt><dt><span class="section"><a href="#idp69222096">Program execution</a></span></dt></dl></dd><dt><span class="section"><a href="#Development_EXAMPLE6_PQL_ORA">An example with PostgreSQL &amp; Oracle</a></span></dt><dd><dl><dt><span class="section"><a href="#idp69262608"></a></span></dt><dt><span class="section"><a href="#idp69270720">Set environment variables</a></span></dt><dt><span class="section"><a href="#idp69274608">Build the client program</a></span></dt><dt><span class="section"><a href="#idp69275504">Set-up LIXA environment</a></span></dt><dt><span class="section"><a href="#idp69291840">Program execution</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#Development_TC">7. Developing C Application Programs with the Transaction Coupling (TC) TX extensions</a></span></dt><dd><dl><dt><span class="section"><a href="#idp69320592">Non-standard TX (Transaction Demarcation) Specification Extensions</a></span></dt><dd><dl><dt><span class="section"><a href="#idp69335584">LIXA library linkage</a></span></dt></dl></dd><dt><span class="section"><a href="#idp69337520">A TC TX usage example with Oracle</a></span></dt><dd><dl><dt><span class="section"><a href="#idp69357536">Set the environment variables</a></span></dt><dt><span class="section"><a href="#idp69363520">Build the client programs</a></span></dt><dt><span class="section"><a href="#idp69373088">Configure the LIXA environment</a></span></dt><dt><span class="section"><a href="#idp69379264">Test program execution</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#Recovery">8. Recovery</a></span></dt><dd><dl><dt><span class="section"><a href="#idp69395680">Automatic (warm) recovery</a></span></dt><dd><dl><dt><span class="section"><a href="#idp69396320">Scenario 1: autonoumos rollback</a></span></dt><dt><span class="section"><a href="#idp69405728">Scenario 2: a second Application Program triggers the recovery action</a></span></dt></dl></dd><dt><span class="section"><a href="#Automatic_recovery_concepts">Automatic recovery concepts</a></span></dt><dd><dl><dt><span class="section"><a href="#Application_Program_equivalence">Application Program equivalence</a></span></dt><dt><span class="section"><a href="#idp69452928">Automatic Recovery in a distributed environment</a></span></dt><dt><span class="section"><a href="#Forcing_automatic_recovery">Forcing automatic recovery</a></span></dt></dl></dd><dt><span class="section"><a href="#Manual_cold_recovery">Manual (cold) recovery</a></span></dt><dd><dl><dt><span class="section"><a href="#Recoverying_forgotten_transactions">Recoverying forgotten transactions</a></span></dt><dt><span class="section"><a href="#Recoverying_recovery_failed_transaction">Recoverying a <span class="quote">“<span class="quote">recovery failed</span>”</span> transaction</a></span></dt><dt><span class="section"><a href="#Recoverying_transaction_associated_different_job">Recoverying a transaction associated to a different job</a></span></dt><dt><span class="section"><a href="#idp69696112">Recoverying a transaction managed by a different Transaction Manager</a></span></dt><dt><span class="section"><a href="#idp69709840">Picking up the LIXA format id and branch qualifier</a></span></dt></dl></dd></dl></dd><dt><span class="chapter"><a href="#idp69725280">9. In Depth</a></span></dt><dd><dl><dt><span class="section"><a href="#idp69726624">Logging</a></span></dt><dt><span class="section"><a href="#Tracing">Tracing</a></span></dt><dd><dl><dt><span class="section"><a href="#Tracing_modules">Tracing modules</a></span></dt><dt><span class="section"><a href="#idp69830432">Improve troubleshooting with trace</a></span></dt><dt><span class="section"><a href="#idp69832736">Activating trace for <span class="command"><strong>lixad</strong></span> in 
	<span class="emphasis"><em>daemon</em></span> mode</a></span></dt><dt><span class="section"><a href="#idp69856320">Redirecting the trace messages</a></span></dt></dl></dd><dt><span class="section"><a href="#Non_root_installation">Non root installation</a></span></dt><dt><span class="section"><a href="#Workload_balanced_environments">Workload balanced environments</a></span></dt><dt><span class="section"><a href="#idp69885472">High Availability configuration</a></span></dt><dt><span class="section"><a href="#idp69916032">LIXA Very Stupid Robot (lixavsr)</a></span></dt></dl></dd><dt><span class="chapter"><a href="#Tuning">10. Tuning</a></span></dt><dd><dl><dt><span class="section"><a href="#idp69937264">Overview</a></span></dt><dd><dl><dt><span class="section"><a href="#idp69938736">State file disk assignment</a></span></dt><dt><span class="section"><a href="#idp69942448">Number of server threads</a></span></dt><dt><span class="section"><a href="#idp69945104">Minimum and maximum elapsed synchronization time</a></span></dt></dl></dd><dt><span class="section"><a href="#Tuning_example">A tuning example</a></span></dt><dd><dl><dt><span class="section"><a href="#idp69969888"><span class="command"><strong>lixat</strong></span> benchmark behavior</a></span></dt><dt><span class="section"><a href="#idp69980672">Tuning example hardware characteristics</a></span></dt><dt><span class="section"><a href="#idp69988368">Results obtained with <em class="parameter"><code>--open-close</code></em> parameter</a></span></dt><dt><span class="section"><a href="#idp69988656">Results obtained without <em class="parameter"><code>--open-close</code></em> parameter</a></span></dt></dl></dd></dl></dd><dt><span class="bibliography"><a href="#idp70051392">Bibliography</a></span></dt></dl></div><div class="list-of-figures"><p><strong>List of Figures</strong></p><dl><dt>3.1. <a href="#config1">Typical LIXA topology</a></dt><dt>3.2. <a href="#config2">Easiest non trivial deployment model</a></dt><dt>3.3. <a href="#config3">Trivial deployment model</a></dt><dt>3.4. <a href="#config4">Fully distributed deployment model</a></dt><dt>3.5. <a href="#config5">Complex distributed deployment model</a></dt><dt>3.6. <a href="#config6">The LIXA components and the necessary configuration files</a></dt><dt>3.7. <a href="#config7">The structure of lixad_conf.xml</a></dt><dt>3.8. <a href="#config8">The structure of lixac_conf.xml</a></dt><dt>3.9. <a href="#config9">A "real" environment</a></dt><dt>5.1. <a href="#develop1">Deploy model of an example with two dummy resource managers</a></dt><dt>5.2. <a href="#develop2">Deploy model of an example with Oracle Database Server</a></dt><dt>5.3. <a href="#develop3">Deploy model of an example with IBM DB2 DBMS</a></dt><dt>5.4. <a href="#develop4">Deploy model of an example showing a distributed transaction with Oracle and IBM DB2</a></dt><dt>5.5. <a href="#develop5">Deploy model of an example with PostgreSQL DBMS</a></dt><dt>5.6. <a href="#develop6">Deploy model of an example showing a distributed transaction with PostgreSQL and Oracle</a></dt><dt>5.7. <a href="#develop7">Deploy model of an example showing a distributed transaction with PostgreSQL and IBM DB2</a></dt><dt>5.8. <a href="#develop8">Deploy model of an example with MySQL/MariaDB DBMS</a></dt><dt>5.9. <a href="#develop9">Deploy model of an example showing a distributed transaction with
	MySQL and PostgreSQL</a></dt><dt>5.10. <a href="#develop10">Deploy model of an example showing a distributed transaction with
	MySQL, PostgreSQL and Oracle</a></dt><dt>5.11. <a href="#develop11">Deploy model of an example showing a distributed transaction with
	two MySQL servers</a></dt><dt>5.12. <a href="#develop12">Deploy model of an example with WebSphere MQ</a></dt><dt>5.13. <a href="#develop13">Deploy model of an example with WebSphere MQ, MySQL and PostgreSQL</a></dt><dt>6.1. <a href="#develop1_cobol">Deploy model of an example with two dummy resource managers</a></dt><dt>6.2. <a href="#develop5_cobol">Deploy model of an example with PostgreSQL DBMS</a></dt><dt>6.3. <a href="#develop6_cobol">Deploy model of an example with Oracle DBMS</a></dt><dt>6.4. <a href="#develop7_cobol">Deploy model of an example showing a distributed transaction with PostgreSQL and Oracle</a></dt><dt>7.1. <a href="#idp69338704">Deployment model of two example applications with Oracle DBMS</a></dt><dt>8.1. <a href="#recover1">The Application Program crashes before <code class="function">xa_prepare()</code></a></dt><dt>8.2. <a href="#recover2">The Application Program crashes after <code class="function">xa_prepare()</code></a></dt><dt>8.3. <a href="#recover3">Workload balanced Application Server</a></dt><dt>9.1. <a href="#high_availability_1">HA, step 1: the active node is on the left, 
	  the passive one is on the right</a></dt><dt>9.2. <a href="#high_availability_2">HA, step 2: the active node fails</a></dt><dt>9.3. <a href="#high_availability_3">HA, step 3: the passive node takes over the service</a></dt><dt>10.1. <a href="#tuning_01">Elapsed time of tx_open() when the Application Program 
	  uses a couple of tx_open()/tx_close() for every 
	  couple of tx_begin()/tx_commit()</a></dt><dt>10.2. <a href="#tuning_02">Elapsed time of tx_begin() when the Application Program 
	  uses a couple of tx_open()/tx_close() for every 
	  couple of tx_begin()/tx_commit()</a></dt><dt>10.3. <a href="#tuning_03">Elapsed time of tx_commit() when the Application Program 
	  uses a couple of tx_open()/tx_close() for every 
	  couple of tx_begin()/tx_commit()</a></dt><dt>10.4. <a href="#tuning_04">Elapsed time of tx_close() when the Application Program 
	  uses a couple of tx_open()/tx_close() for every 
	  couple of tx_begin()/tx_commit()</a></dt><dt>10.5. <a href="#tuning_05">Overall elapsed time when the Application Program 
	  uses a couple of tx_open()/tx_close() for every 
	  couple of tx_begin()/tx_commit()</a></dt><dt>10.6. <a href="#tuning_06">Elapsed time of tx_open() when the Application Program 
	  uses a couple of tx_open()/tx_close() for a 
	  batch of tx_begin()/tx_commit()</a></dt><dt>10.7. <a href="#tuning_07">Elapsed time of tx_begin() when the Application Program 
	  uses a couple of tx_open()/tx_close() for a 
	  batch of tx_begin()/tx_commit()</a></dt><dt>10.8. <a href="#tuning_08">Elapsed time of tx_commit() when the Application Program 
	  uses a couple of tx_open()/tx_close() for a 
	  batch of tx_begin()/tx_commit()</a></dt><dt>10.9. <a href="#tuning_09">Elapsed time of tx_close() when the Application Program 
	  uses a couple of tx_open()/tx_close() for a 
	  batch of tx_begin()/tx_commit()</a></dt><dt>10.10. <a href="#tuning_10">Overall elapsed time when the Application Program 
	  uses a couple of tx_open()/tx_close() for a 
	  batch of tx_begin()/tx_commit()</a></dt></dl></div><div class="preface"><div class="titlepage"><div><div><h1 class="title"><a id="idp49115600"></a>Preface</h1></div></div></div><p>
    LIXA is acronym of LIbre XA: it's a free, libre, open source
    implementation of two X/Open specifications: "Distributed Transaction
    Processing: The TX (Transaction Demarcation) Specification" 
    [<a class="citation" href="#idp70061648"><span class="citation">TXspec</span></a>]
    and "Distributed Transaction Processing: The XA Specification"
    [<a class="citation" href="#idp70066448"><span class="citation">XAspec</span></a>].
  </p><p>
    The main goals of the LIXA project are:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>implementing an XA compliant Transaction Manager</p></li><li class="listitem" style="list-style-type: disc"><p>supplying a TX compliant Application Programming Interface
	  (<acronym class="acronym">API</acronym>)
	</p></li><li class="listitem" style="list-style-type: disc"><p><span class="emphasis"><em>to be free</em></span></p></li><li class="listitem" style="list-style-type: disc"><p>to be compliant as much as possible with X/Open CAE 
	  specifications</p></li></ul></div><p>
  </p><p>
    From the following links you can buy and/or download for free the official
    X/Open documentation:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	  [<a class="citation" href="#idp70056768"><span class="citation">RefModel</span></a>]
	  <a class="ulink" href="https://www2.opengroup.org/ogsys/catalog/G504" target="_top">
	    <em class="citetitle">
	      Distributed Transaction Processing: Reference Model, Version 3
	    </em>
	  </a>
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	  [<a class="citation" href="#idp70061648"><span class="citation">TXspec</span></a>]
	  <a class="ulink" href="http://www.opengroup.org/pubs/catalog/c504.htm" target="_top">
	    <em class="citetitle">
	      Distributed Transaction Processing: The TX (Transaction 
	      Demarcation) Specification
	    </em>
	  </a>
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	  [<a class="citation" href="#idp70066448"><span class="citation">XAspec</span></a>]
	  <a class="ulink" href="http://www.opengroup.org/pubs/catalog/c193.htm" target="_top">
	    <em class="citetitle">
	      Distributed Transaction Processing: The XA Specification
	    </em>
	  </a>
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	  [<a class="citation" href="#idp70071168"><span class="citation">XA+spec</span></a>]
	  <a class="ulink" href="http://www.opengroup.org/pubs/catalog/s423.htm" target="_top">
	    <em class="citetitle">
	      Distributed Transaction Processing: The XA+ Specification
	      Version 2
	    </em>
	  </a>
	</p></li></ul></div><p>
    LIXA documentation tries to avoid duplication with the content of the
    above books.
  </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Intended audience</h3><p>
      This manual is maintained in the hope it can help:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>developers who want to use LIXA project to develop applications
	  </p></li><li class="listitem" style="list-style-type: disc"><p>system administrators that have to install, configure and
	    manage LIXA project instances
	  </p></li><li class="listitem" style="list-style-type: disc"><p>curious people that want to discover the features offered by
	    the LIXA project
	  </p></li></ul></div><p>
    </p></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Acknowledgements</h3><p>
    Supporting every author is an understanding family, or nothing would ever
    get produced! I am grateful to my family, Sara and Carola for their
    understanding everytime I am spending some time on this open source and
    free software project.
  </p><p>
    Numerous individuals provided me useful feedback, but one person deserves
    a special thank for his help: Pieter Janse van Rensburg. Pieter has
    added to the project an interesting extension and he continues to provide
    me interesting ideas for further improvements.
  </p></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Language</h3><p>
      Unfortunately English is not my mother tongue. This manual may contain
      a lot of language mistakes. If you sent me a revisioned versions of the
      Docbook sources (XML), I would accept your fixes promptly.
    </p></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="idp57081600"></a>Chapter 1. Introduction</h1></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp57082464"></a>Why should I use LIXA project?</h2></div></div></div><p>
      LIXA project allows you to develop an Application Program that performs
      two phase commit transactions against two ore more Resource Managers.
      Two phase commit is a transactional protocol designed to 
      <span class="quote">“<span class="quote">guarantee</span>”</span> <acronym class="acronym">ACID</acronym> (Atomicity, Consistency,
      Isolation, Durability) transactionality.
      XA specification is not the only two phase commit protocol implementation
      but it is probably the best known and widespread. For a detailed
      explanation please refer to [<a class="citation" href="#idp70056768"><span class="citation">RefModel</span></a>].
    </p></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>
      The reference model ([<a class="citation" href="#idp70056768"><span class="citation">RefModel</span></a>]) technical guide
      available on the <span class="trademark">Open Group</span>™ web site is more
      recent than the XA specification ([<a class="citation" href="#idp70066448"><span class="citation">XAspec</span></a>]); 
      after XA, the X/Open Company developed the XA+ specification and the 
      reference model was improved with the concepts necessary for XA+. 
      LIXA project does <span class="emphasis"><em>not</em></span> implement
      the XA+ specification, but only XA and the following concepts explained 
      in [<a class="citation" href="#idp70056768"><span class="citation">RefModel</span></a>] do not apply to the LIXA project:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>3.1: Superior Node</p></li><li class="listitem" style="list-style-type: disc"><p>3.1: Subordinate Node</p></li><li class="listitem" style="list-style-type: disc"><p>3.1: Communication Resource Manager (<acronym class="acronym">CRM</acronym>)</p></li><li class="listitem" style="list-style-type: disc"><p>3.5: Distributed Communication Facilities</p></li><li class="listitem" style="list-style-type: disc"><p>3.6: Activity between Functional Components Involving Two or More APs</p></li><li class="listitem" style="list-style-type: disc"><p>3.7: CRM Communication Paradigms with APs</p></li><li class="listitem" style="list-style-type: disc"><p>3.8: High-level TP Language</p></li></ul></div><p>
      XA specification was designed to implement the two phase commit protocol
      in the case there is only one Application Program running inside a
      Transaction Monitor and using a Transaction Manager to coordinate any
      number of Resource Managers. XA+ specification was designed to
      implement the two phase commit protocol in the case there are two or
      more Application Programs running inside distinct Transaction Monitors
      and using distinct Transaction Managers to coordinate any number of
      Resource Managers.
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Transaction_Manager_and_Transaction_Monitor"></a>Transaction Manager and Transaction Monitor</h2></div></div></div><p>
      As explained in Appendix A of [<a class="citation" href="#idp70056768"><span class="citation">RefModel</span></a>] a 
      Transaction Manager can be though as a subset of a Transaction Monitor.
      Most commercial products tend to merge the features
      in a single bundle; this is good if you need a Transaction Monitor,
      this may be bad if you only need a Transaction Manager.
    </p><p>
      IBM TXSeries<a href="#ftn.idp57098240" class="footnote" id="idp57098240"><sup class="footnote">[1]</sup></a> is a Transaction Monitor with an
      integrated Transaction Manager.
      Oracle (BEA) Tuxedo<a href="#ftn.idp57098960" class="footnote" id="idp57098960"><sup class="footnote">[2]</sup></a> is a Transaction Monitor with an
      integrated Transaction Manager.
      JBoss<a href="#ftn.idp57099616" class="footnote" id="idp57099616"><sup class="footnote">[3]</sup></a> is a <acronym class="acronym">JEE</acronym>
      (Java Enterprise Edition) application server; it is a Transaction
      Monitor with an integrated Transaction Manager for Java based
      applications.
    </p><p>
      <a class="ulink" href="http://jotm.ow2.org/xwiki/bin/view/Main/WebHome" target="_top">
	<em class="citetitle">JOTM (Java Open Transaction Manager)</em>
      </a>
      and
      <a class="ulink" href="https://github.com/bitronix/btm" target="_top">
	<em class="citetitle">BTM (Bitronix JTA Transaction Manager)</em>
      </a> 
      are Transaction Managers, but they are not Transaction Monitors and they
      can be used in conjunction with a
      <acronym class="acronym">JVM</acronym> (Java Virtual Machine) and 
      <span class="emphasis"><em>possibly</em></span> any
      Transaction Monitor. Unfortunately they are Java based technologies and 
      not native ones; in the Java arena there are a few stand-alone 
      Transaction
      Manager, while in the C language arena it is not easy to find out one.
    </p><p>
      The LIXA project implements a stand-alone Transaction Manager that your 
      Application Program can use in many different ways:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>from a C application launched from shell</p></li><li class="listitem" style="list-style-type: disc"><p>from a C application launched via CGI inside a web server</p></li><li class="listitem" style="list-style-type: disc"><p>from a scripting language application<a href="#ftn.idp57107600" class="footnote" id="idp57107600"><sup class="footnote">[4]</sup></a>.</p></li></ul></div><p>
      With the aid of the LIXA Transaction Manager potentially any web server 
      can be converted in an Application Server with two phase commit support.
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp57108896"></a>LIXA Architecture</h2></div></div></div><p>
      From an architectural point of view, the LIXA project adopts an original
      approach: an Application Program links the LIXA client library and
      embeds the Transaction Manager logic. Every Application Program instance
      runs its own Transaction Manager instance and every Transaction
      Manager instance uses the LIXA server daemon to save and retrieve the
      state of the managed transactions.
      LIXA project was designed to allow massive parallelism and embedding at
      the same time: the parallelism is necessary to support high volume
      workloads while the embeddable property is necessary to avoid conflicts
      with the process and thread management feature of any Transaction 
      Monitors.
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp57109888"></a>LIXA and X/OPEN CAE specifications</h2></div></div></div><p>
      The LIXA project tries to be as compliant as possible with the X/Open CAE
      specifications cited in bibliography. Below there are the features that
      are <span class="emphasis"><em>not</em></span> implemented and the features that are
      <span class="emphasis"><em>not</em></span> implementable.
    </p><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a id="idp57113424"></a>The commit_return Characteristic</h3></div></div></div><p>
	As explained in [<a class="citation" href="#idp70061648"><span class="citation">TXspec</span></a>] (3.4, 3.8.1) two values
	are available:
	</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p><code class="constant">TX_COMMIT_COMPLETED
	    </code></p></li><li class="listitem" style="list-style-type: disc"><p><code class="constant">TX_COMMIT_DECISION_LOGGED
	    </code></p></li></ul></div><p>
	LIXA TX API implementation supports only
	<code class="constant">TX_COMMIT_COMPLETED</code>
	this behavior is allowed by the specification.
      </p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a id="idp57118160"></a>The transaction state element</h3></div></div></div><p>
	As explained in [<a class="citation" href="#idp70061648"><span class="citation">TXspec</span></a>] (4.2, page 16)
	<code class="function">tx_info()</code> can return three values:
	</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p><code class="constant">TX_ACTIVE
	    </code></p></li><li class="listitem" style="list-style-type: disc"><p><code class="constant">TX_TIMEOUT_ROLLBACK_ONLY
	    </code></p></li><li class="listitem" style="list-style-type: disc"><p><code class="constant">TX_ROLLBACK_ONLY
	    </code></p></li></ul></div><p>
      </p>
      LIXA <code class="function">tx_info()</code> does not return
      <code class="constant">TX_ROLLBACK_ONLY</code>. This does not hurt the
      X/Open CAE specification.
    </div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a id="idp57124304"></a>XA -&gt; TX return code mappings</h3></div></div></div><p>
	In [<a class="citation" href="#idp70061648"><span class="citation">TXspec</span></a>] (Appendix B.4, page 64) it is suggested
	to return the value <code class="constant">TX_ERROR</code> when the Resource
	Manager returns <code class="constant">XA_RETRY</code>; this is explained in
	<span class="quote">“<span class="quote">note 1</span>”</span>. 
      </p><p>
	The LIXA implementation of 
	for <code class="function">tx_commit()</code> and
	<code class="function">tx_rollback()</code> returns 
	<code class="constant">TX_NO_BEGIN</code> instead of 
	<code class="constant">TX_ERROR</code> because it seems a more useful 
	information for the Application Program: the transaction has been
	successfully committed/rolled back, but a new transaction can not be
	started
	<a href="#ftn.idp57130064" class="footnote" id="idp57130064"><sup class="footnote">[5]</sup></a>.
      </p></div><div class="simplesect"><div class="titlepage"><div><div><h3 class="title"><a id="idp57131984"></a><code class="function">xa_rollback()</code> and 
	<code class="constant">XA_RETRY</code> return code</h3></div></div></div><p>
	In [<a class="citation" href="#idp70061648"><span class="citation">TXspec</span></a>] (Appendix B.5, page 69) it is 
	explained <code class="constant">XA_RETRY</code> is a valid return code for
	function <code class="function">xa_rollback()</code>. Unfortunately
	[<a class="citation" href="#idp70066448"><span class="citation">XAspec</span></a>] does not agree with this point of view: the
	<code class="constant">XA_RETRY</code> is not a valid return code for 
	function <code class="function">xa_rollback()</code>. It may be an error in
	[<a class="citation" href="#idp70061648"><span class="citation">TXspec</span></a>]: the same row could have been copied from 
	the previous table (page 68).
      </p><p>
	[<a class="citation" href="#idp70071168"><span class="citation">XA+spec</span></a>] does not list 
	<code class="constant">XA_RETRY</code> as a valid return code for 
	function <code class="function">xa_rollback()</code>; it lists
	<code class="constant">XA_RETRY_COMMFAIL</code> but it does not apply to LIXA
	implementation because it is related to the 
	<span class="emphasis"><em>Communication Resource Manager</em></span> concept that is
	not supported by LIXA implementation.
      </p><p>
	The LIXA implementation sticks to [<a class="citation" href="#idp70066448"><span class="citation">XAspec</span></a>]: if a
	resource manager returned <code class="constant">XA_RETRY</code> it would be
	considered a bug inside the resource manager.
      </p></div></div><div class="footnotes"><br /><hr style="width:100; text-align:left;margin-left: 0" /><div id="ftn.idp57098240" class="footnote"><p><a href="#idp57098240" class="para"><sup class="para">[1] </sup></a>TXSeries is a registered trademark of 
	  IBM corporation</p></div><div id="ftn.idp57098960" class="footnote"><p><a href="#idp57098960" class="para"><sup class="para">[2] </sup></a>Tuxedo is a registered trademark of
	  Oracle corporation</p></div><div id="ftn.idp57099616" class="footnote"><p><a href="#idp57099616" class="para"><sup class="para">[3] </sup></a>JBoss is a registered trademark of Red Hat
	  corporation</p></div><div id="ftn.idp57107600" class="footnote"><p><a href="#idp57107600" class="para"><sup class="para">[4] </sup></a>You must wrap the TX C API to be able to use it from Perl, PHP, Python, Ruby...</p></div><div id="ftn.idp57130064" class="footnote"><p><a href="#idp57130064" class="para"><sup class="para">[5] </sup></a>The X/Open CAE specification document
	    <span class="quote">“<span class="quote">suggests</span>”</span> the mapping and it seems there is some
	    flexibility in the suggestions. From a LIXA perspective all this
	    stuff is academic because <code class="constant">TMNOWAIT</code> is not
	    used by LIXA implementation.</p></div></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="Installation"></a>Chapter 2. Installation</h1></div></div></div><p>
    This chapter explains how to download, install and verify the software
    released by LIXA project.
  </p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp67230480"></a>System requirements</h2></div></div></div><p>
      LIXA project is developed on an x86-64 based 
      <a class="ulink" href="http://www.ubuntu.com/" target="_top">
	<em class="citetitle">Ubuntu 14.04 system</em>
      </a>. 
      LIXA project is ported on different Linux versions for x86-64: major
      stable releases are tested using some different configurations, please
      refer to file 
      <a class="ulink" href="https://github.com/tiian/lixa/blob/master/TestLog" target="_top">
	<em class="citetitle">TestLog</em>
      </a>
      for an update.
      Installation on a different Linux distribution should be quite 
      straightforward; installation on a different
      <span class="trademark">UNIX</span>™ like system would probably need some work.
    </p><p>
      If you successfully installed LIXA on a different system, you might
      publish your experience on the public forum hosted on SourceForge.net 
      and share your results with other users. 
    </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp67235040"></a>Pre-requisites</h3></div></div></div><p>
	To compile LIXA software the GNU tools are needed: gcc, gmake, libtool.
	Autoconf and automake are used, but they should not be necessary if 
	you install from the original tarball.
      </p><p>
	If you are interested in COBOL, LIXA supports only Gnu COBOL 1.1 or
	upper; COBOL development and testing is currently performed on
	Ubuntu 14.04 with default COBOL version: 1.1
      </p><p>
	Some <span class="emphasis"><em>libraries (run time and development stuff)</em></span> 
	are necessary too:
	</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p><span class="application">libdl</span></p></li><li class="listitem" style="list-style-type: disc"><p><span class="application">libglib</span> (libglib2.0-dev on Ubuntu)</p></li><li class="listitem" style="list-style-type: disc"><p><span class="application">libgmodule</span></p></li><li class="listitem" style="list-style-type: disc"><p><span class="application">libgthread</span></p></li><li class="listitem" style="list-style-type: disc"><p><span class="application">libm</span></p></li><li class="listitem" style="list-style-type: disc"><p><span class="application">libpthread</span></p></li><li class="listitem" style="list-style-type: disc"><p><span class="application">libuuid</span> (uuid-dev on Ubuntu)</p></li><li class="listitem" style="list-style-type: disc"><p><span class="application">libxml2</span> (libxml2-dev on Ubuntu)</p></li></ul></div><p>
	<span class="application">libglib</span> (and others libg*) and 
	<span class="application">libxml2</span> are discovered with 
	<span class="command"><strong>pkg-config</strong></span> command, while the others must be in
	standard include <code class="envar">PATH</code>.
      </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp67245568"></a>Packages for Linux Ubuntu</h4></div></div></div><p>
	  <span class="application">xsltproc</span>,
	  <span class="application">docbook-xsl</span> and
	  <span class="application">docbook-xml</span> are necessary
	  to produce this manual.
	</p><p>
	  <span class="application">automake</span> and 
	  <span class="application">autoconf</span> are 
	  necessary to run the test suite (<span class="command"><strong>make check</strong></span>).
	</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp67249408"></a>Packages for Linux CentOS (7.x)</h4></div></div></div><p>
	  This packages are necessary to create a build environment:
 	  <span class="application">glib2-devel.i686</span>,
 	  <span class="application">libuuid-devel.i686</span>,
 	  <span class="application">libxml2-devel.i686</span>,
 	  <span class="application">gcc.i686</span>,
 	  <span class="application">libtool.i686</span> and
 	  <span class="application">make.i686</span>.
	</p><p>
	  <span class="application">docbook5-style-xsl.noarch</span> is necessary
	  to produce this manual.
	</p><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idp67253552"></a>CentOS, RHEL and derivative notes</h5></div></div></div><p>
	    Version 6 of CentOS, RHEL and derivative linux distributions ships
	    a very old glib version and can't be used to compile LIXA source
	    code since LIXA 1.3.2
	  </p></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp67255024"></a>Low level software pre-requisites</h4></div></div></div><p>
	  If you are trying to install LIXA software on a different operating
	  system, these are some fundamental requirements:
	  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p><code class="function">poll</code>: 
		LIXA daemon uses this function for high parallelism network
		operations
	    </p></li><li class="listitem" style="list-style-type: disc"><p><code class="function">mmap</code>:
		LIXA daemon uses this function for high performance disk
		access
	    </p></li><li class="listitem" style="list-style-type: disc"><p><code class="function">dlopen</code>:
		LIXA transaction manager uses this function to dynamically load
		resource managers XA switch structures 
	    </p></li><li class="listitem" style="list-style-type: disc"><p><code class="function">uuid_generate</code>:
		LIXA transaction manager uses this function to generate unique
		transaction identifiers (xid)
	    </p></li></ul></div><p>
	  Without the above functions, a specific porting process is necessary
	  to adapt LIXA to your system.
	</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp67260896"></a>Hardware requirements</h4></div></div></div><p>
	  There's no specific hardware requirement for the client part of LIXA
	  (libraries and utilities): the type of hardware you are using for
	  your application will be sufficient to run your application even if
	  you start to use LIXA libraries for TX or XTA.
	</p><p>
	  LIXA state server, <span class="command"><strong>lixad</strong></span>, requires low latency
	  disks to perform at its best: the lower the latency of the disks that
	  hosts the state files, tipically <code class="filename">/opt/lixa/var</code>,
	  the better. The best performance should be expected by a storage
	  array with battery-backed cache or a technology with equivalent
	  speed.
	</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp67263792"></a>Co-requisites</h3></div></div></div><p>
	An XA transaction manager is used to coordinate one or more XA
	resource managers. From a LIXA perspective there are basically 3 type
	of resource managers:
	</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
	      <span class="emphasis"><em>LIXA:</em></span> Resource Managers
	      provided by the project that are useful only for testing and as 
	      sample implementations
	  </p></li><li class="listitem"><p>
	      <span class="emphasis"><em>F/OSS:</em></span> Resource Managers provided by
	      Free/Open Source Software projects like PostgreSQL and MySQL
	  </p></li><li class="listitem"><p>
	      <span class="emphasis"><em>Proprietary:</em></span> Resource Managers
	      provided by business corporations using commercial licensing.
	  </p></li></ol></div><p>
	There is not a list of <span class="emphasis"><em>supported</em></span> third party
	resource managers, because LIXA is a project and not a product; this
	is the list of third party resource managers that have been tested in
	conjuction with LIXA transaction manager:
	</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p><span class="productname">
		IBM DB2 Express-C 9.7 (32 bit) / IBS DB2 Express0C 11.1 (64 bit)
	  </span></p></li><li class="listitem" style="list-style-type: disc"><p><span class="productname">
		MySQL 5.0 (32 bit) / MySQL 5.1 (64 bit) / MySQL 5.6.34 (64 bit)
		<a href="#ftn.idp67271040" class="footnote" id="idp67271040"><sup class="footnote">[6]</sup></a>
	  </span></p></li><li class="listitem" style="list-style-type: disc"><p><span class="productname">
		Oracle XE 10.2 (32 bit) / Oracle XE 11.2 (64 bit)
	  </span></p></li><li class="listitem" style="list-style-type: disc"><p><span class="productname">
		Oracle SE 12.1 (64 bit) Instant Client
	  </span></p></li><li class="listitem" style="list-style-type: disc"><p><span class="productname">
		PostgreSQL 8.3 (32 bit) / PostgreSQL 8.4 (64 bit) / PostgreSQL 9.2 (64 bit)
	  </span></p></li><li class="listitem" style="list-style-type: disc"><p><span class="productname">
		WebSphere MQ 7.1 (32 bit)
	  </span></p></li></ul></div><p>
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp67274816"></a>Authorization</h3></div></div></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
	The software produced by the LIXA project 
	<span class="emphasis"><em>does</em></span> not require any
	special authorization to run.
      </p></div><p>
	You can run the processes with the desired UNIX user you prefer but
	in this manual specific user and group will be used as a suggestion.
	</p><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idp67276768"></a>Create <code class="systemitem">lixa</code>
	    user with Ubuntu</h5></div></div></div>
	  Use this commands in an Ubuntu based Linux system to create the
	  <code class="systemitem">lixa</code> user and the
	  <code class="systemitem">lixa</code> group:
	  <pre class="screen">
tiian@ubuntu:~$ sudo su -
root@ubuntu:~# id
uid=0(root) gid=0(root) groups=0(root)
root@ubuntu:~# addgroup --system lixa
Adding group `lixa' (GID 113) ...
Done.
root@ubuntu:~# adduser --system --ingroup lixa --shell /bin/bash lixa
Adding system user `lixa' (UID 106) ...
Adding new user `lixa' (UID 106) with group `lixa' ...
Creating home directory `/home/lixa' ...
root@ubuntu:~# su -c id lixa
uid=106(lixa) gid=113(lixa) groups=113(lixa)
root@ubuntu:~# exit
logout
	  </pre></div><p>
	</p><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idp67277536"></a>Create <code class="systemitem">lixa</code>
	    user with CentOS</h5></div></div></div>
	  Use this commands in an Ubuntu based Linux system to create the
	  <code class="systemitem">lixa</code> user and the
	  <code class="systemitem">lixa</code> group:
	  <pre class="screen">
[tiian@centos ~]$ su -
Password:
[root@centos ~]# id
uid=0(root) gid=0(root) groups=0(root),1(bin),2(daemon),3(sys),4(adm),6(disk),10(wheel)
[root@centos ~]# groupadd --system lixa
[root@centos ~]# useradd --system --no-user-group --gid lixa --home /home/lixa --create-home --shell /bin/bash lixa
[root@centos ~]# su -c id lixa
uid=496(lixa) gid=490(lixa) groups=490(lixa)
[root@centos ~]# exit
logout
	  </pre></div><p>
	Refer to the man page of your Linux distribution if the above
	commands fail; on some distributions you must use
	<span class="quote">“<span class="quote"><span class="command"><strong>su -</strong></span></span>”</span> instead of 
	<span class="quote">“<span class="quote"><span class="command"><strong>sudo su -</strong></span></span>”</span>.
      </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	  LIXA client communicates to LIXA server (daemon) throught TCP/IP and
	  the client processes do not access the status files located in
	  <code class="filename">/opt/lixa/var/</code>, only the 
	  <span class="command"><strong>lixad</strong></span> has to access the files.
	  The LIXA client can be considered <span class="emphasis"><em>stateless</em></span>
	  because all the state information is persisted by the LIXA server.
      </p></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp67287248"></a>Certified and Tested configurations</h2></div></div></div><p>
      A certified configuration is a configuration that passed all the 
      relevant test cases. The list of the certified configurations is
      described inside the file <code class="filename">TestLog</code> that's
      distributed along with LIXA tarball.
      </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	A certified configuration should build and install flawlessly on
	any system with the same configuration.
      </p></div><p>
    </p><p>
      A tested configuration is a configuration that was tested in the past
      and should reasonably work with similar configurations: tested
      configurations are proposed in 
      <a class="xref" href="#Development" title="Chapter 5. Developing C Application Programs">Chapter 5, <em>Developing C Application Programs</em></a>.
      They can be used as a starting point for non trivial configurations with
      one or more commercial Resource Managers.
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp67291184"></a>Software download</h2></div></div></div><p>
      The LIXA project is hosted both on 
      <a class="ulink" href="https://github.com/tiian/lixa" target="_top">
	<em class="citetitle">GitHub.com</em>
      </a>
      and
      <a class="ulink" href="http://sourceforge.net/projects/lixa/" target="_top">
	<em class="citetitle">SourceForge.net</em>
      </a>
      portals. GitHub.com is mainly intended for system software developers
      that need to access, change and share the source code with the
      project. SourceForge.net is mainly intended for system engineers that
      need to download and install the software.
    </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
      The source code that can be fetched using <span class="emphasis"><em>git</em></span>
      typically contains the last commit: there's no guarantee
      that every commit contains stable software, sometimes it can be
      intermediate work that does not compile. Every release is explicitly
      tagged.
    </p></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>
      The tarball that can be downloaded by SourceForge.net is a release
      that has passed some sort of test and should compile and run
      flawlessly. Even releases are associated to stable releases and
      odd releases are associated to testing releases with new features.
    </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp67296592"></a>Configure, build and install</h2></div></div></div><p>
      LIXA project tries to adhere to the GNU <span class="emphasis"><em>de facto</em></span>
      standard. Supposing you downloaded the package 
      <code class="filename">lixa-X.Y.Z.tar.gz</code>, the basic sequence is:
      </p><pre class="screen">
tar xvzf lixa-X.Y.Z.tar.gz
cd lixa-X.Y.Z
./configure
make
      </pre><p>
      </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
        If build issues are experienced with a system that has a newer version 
        of autotools installed, the build files can be regenerated with the 
	following command:
	</p><pre class="screen">
	  touch configure.ac aclocal.m4 configure Makefile.am Makefile.in
	</pre><p>
	or, in the event that the previous one failed, with the following one:
        </p><pre class="screen">
          autoreconf -v -f -i
        </pre><p>
      </p></div><p>
      To install the software you need 
      <code class="systemitem">root</code> 
      access. With some distributions, 
      like Ubuntu, 
      <code class="systemitem">root</code> 
      access is available with the 
      <span class="command"><strong>sudo</strong></span> command and your own password:
      </p><pre class="screen">
sudo make install
      </pre><p>
      If the previous command does not work,
      <code class="systemitem">root</code> 
      access is available with the
      <span class="command"><strong>su</strong></span> command and the
      <code class="systemitem">root</code> 
      password: 
      </p><pre class="screen">
su -c "make install"
      </pre><p>
      If nothing goes wrong, the above commands install the LIXA software
      artifacts in <code class="filename">/opt/lixa</code> default directory.
      After the installation you should change the authorization
      assigned to some directories. Use <span class="command"><strong>sudo su -c</strong></span> 
      (Ubuntu) or
      <span class="command"><strong>su -c</strong></span> (CentOS) to gain root privileges and execute
      <span class="command"><strong>chown</strong></span>:
      </p><pre class="screen">
tiian@ubuntu:~$ sudo su -c "chown -R lixa:lixa /opt/lixa/etc/ /opt/lixa/var/"
tiian@ubuntu:~$ ls -la /opt/lixa/etc/ /opt/lixa/var/
/opt/lixa/etc/:
total 16
drwxr-xr-x 2 lixa lixa 4096 2011-03-30 23:13 .
drwxr-xr-x 9 lixa root 4096 2011-03-30 23:14 ..
-rw-r--r-- 1 lixa lixa 3542 2011-03-30 23:13 lixac_conf.xml
-rw-r--r-- 1 lixa lixa  447 2011-03-30 23:13 lixad_conf.xml

/opt/lixa/var/:
total 12
drwxr-xr-x 2 lixa lixa 4096 2011-03-30 23:14 .
drwxr-xr-x 9 lixa root 4096 2011-03-30 23:14 ..
-rw-r--r-- 1 lixa lixa  178 2011-03-30 23:14 README
      </pre><p>
      The succesful execution of the above commands guarantees that the
      configuration and the state files can be managed using the
      LIXA administrative account (
      user=<code class="systemitem">lixa</code>,
      group=<code class="systemitem">lixa</code>).
      </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	  The <span class="command"><strong>chown</strong></span> command must be executed after every
	  <span class="command"><strong>make install</strong></span> execution.
      </p></div><p>
    </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp67297664"></a>Advanced configuration</h3></div></div></div><p>
	There are many options you can pass to the <span class="command"><strong>configure</strong></span>
	command to meet your needs (see below). Skip this section and
	jump directly to
	<a class="xref" href="#Linking_third_party_resource_managers" title="Linking third party resource managers">the section called “Linking third party resource managers”</a>
	if you are not expert in LIXA configuration.
      </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
	  It is strongly suggested you issue the 
	  <span class="command"><strong>make clean</strong></span> command every time you re-configure
	  the package. If you didn't clean the previous build, you might
	  catch some strange undebuggable errors related to not aligned
	  libraries.
	</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp67313760"></a>Choosing a different installation <code class="envar">PATH</code></h4></div></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	    The commands explained in the previous section should be
	    adapted to different paths, if you choosed a non standard
	    installation path.
	</p></div><p>
	  to perform the very first installation <code class="filename">/tmp</code> 
	  could be a good destination:
	  </p><pre class="screen">
./configure --prefix=/tmp/lixa
	  </pre><p>
	</p><p>
	  After some testing, you might prefer your home directory:
	  </p><pre class="screen">
./configure --prefix=$HOME/lixa
	  </pre><p>
	  and you will get a layout like this:
	  </p><pre class="screen">
$HOME/lixa/bin
$HOME/lixa/etc
$HOME/lixa/include
$HOME/lixa/lib
$HOME/lixa/sbin
$HOME/lixa/var
	  </pre><p>
	</p><p>
	  You can split code and data with something like this:
	  </p><pre class="screen">
./configure --prefix=/ --exec-prefix=/usr/local
	  </pre><p>
	</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp67319088"></a>Producing this manual too</h4></div></div></div><p>
	  To produce LIXA manual in HTML format you need 
	  <span class="command"><strong>xsltproc</strong></span> installed in your current search
	  path and <code class="filename">chunk.xsl docbook.xsl</code> stylesheet 
	  files. Use
	  </p><pre class="screen">
./configure --with-docbook
	  </pre><p>
	  to enable manual build and search for stylesheets in a subdir of
	  <code class="filename">/usr/share</code>. You may specify a different path
	  using:
	  </p><pre class="screen">
./configure --with-docbook=/path/to/father/of/xhtml/dir
	  </pre><p>
	</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp67322944"></a>Locating pre-requisites libraries</h4></div></div></div><p>
	  If any of the pre-requisite library include files are not in the
	  standard search <code class="envar">PATH</code>, you can export 
	  <code class="envar">CPPFLAGS</code> before the configure process to add 
	  your custom path:
	  </p><pre class="screen">
export CPPFLAGS=-I/path/to/libuuid
./configure
make
	  </pre><p>
	  to see the list of environment variables that can affect the build 
	  process
	  use the command
	  </p><pre class="screen">
./configure --help
	  </pre><p>
	</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp67326480"></a>Optional features</h4></div></div></div><p>
	  The supplied defaults are generally good enought to start 
	  working with LIXA, but if you want to perform some hacking 
	  you might be interested
	  in activating/deactivating some optional features.
	</p><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idp67328128"></a>Tracing</h5></div></div></div><p>
	    The tracing feature is enabled by default: the binary objects
	    produced by the build procedure contains a lot of messages that can
	    be displayed turning on tracing at run time.
	  </p><p>
	    Removing the tracing feature can save RAM (smaller binary objects)
	    and CPU (every trace message is tested against run time 
	    configuration).
	  </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
	      Disabling tracing seems a good way to increase the performance of
	      the software, but unfortunately without a trace it is quite 
	      impossible to debug some issues. Only rock stable software can
	      be compiled without tracing, and this is not the case of LIXA.
	    </p></div><p>
	    To disable tracing, use <code class="option">--disable-trace</code> on
	    <span class="command"><strong>./configure</strong></span> command line:
	    </p><pre class="screen">
./configure --disable-trace
	    </pre><p>
	  </p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idp67333152"></a>Extra debug code</h5></div></div></div><p>
	    To enable extra debug code, that's basically some redundant check
	    code use <code class="option">--enable-debug</code> on
	    <span class="command"><strong>./configure</strong></span> command line:
	    </p><pre class="screen">
./configure --enable-debug
	    </pre><p>
	    This feature could be interesting when porting the LIXA project
	    software to a different platform; for normal use, the extra
	    debugging code is useless.
	  </p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idp67336064"></a>Crash simulation</h5></div></div></div><p>
	    This feature is useful when testing the software: with crash
	    simulation the software can be tested against simulated software
	    crashes and, on some extents, power outages.
	    To enable crash simulation use <code class="option">--enable-crash</code> on
	    <span class="command"><strong>./configure</strong></span> command line:
	    </p><pre class="screen">
./configure --enable-crash
	    </pre><p>
	  </p></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Linking_third_party_resource_managers"></a>Linking third party resource managers</h3></div></div></div><p>
	To link an already tested third party resource manager you can use
	a specific option on <span class="command"><strong>./configure</strong></span> command; to
	link a new resource manager, you have to hack the Makefiles and
	put all you need in place or you can perform a manual link.
      </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp67341392"></a>IBM DB2 Express-C 9.7, 11.1<a href="#ftn.idp67342000" class="footnote" id="idp67342000"><sup class="footnote">[7]</sup></a></h4></div></div></div><p>
	  This step is useful if you want to use IBM DB2 as a Resource
	  Manager coordinated by LIXA; only versions Express-C 9.7 and 11.1 
      have been tested, but there should not be relevant differences with a
	  different version. Use something like this:
	  </p><pre class="screen">
./configure --with-ibmdb2=/opt/ibm/db2/V9.7
	  </pre><p>
      Or the following for V11.1
      </p><pre class="screen">
        ./configure --with-ibmdb2=/opt/ibm/db2/V11.1
      </pre><p>
	  to create a loadable module containing the switch structure.
	</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp67344992"></a>MySQL 5.0, 5.1, 5.5, 5.6<a href="#ftn.idp67345584" class="footnote" id="idp67345584"><sup class="footnote">[8]</sup></a>
	</h4></div></div></div><p>
	  This step is useful if you want to use MySQL
	  <a href="#ftn.idp67347824" class="footnote" id="idp67347824"><sup class="footnote">[9]</sup></a>
	  as a Resource
	  Manager coordinated by LIXA; only versions 5.0, 5.1, 5.5 and 5.6 have been
	  tested, but there should not be relevant differences with a
	  different version. Use something like this:
	  </p><pre class="screen">
./configure --with-mysql
	  </pre><p>
	  or something like this if you need to point a specific installation:
	  </p><pre class="screen">
./configure --with-mysql=/path/to/mysql_config
	  </pre><p>
	  to create a loadable module containing the switch structure. It's
	  not necessary to specify the MySQL installation directory because
	  the <span class="command"><strong>mysql_config</strong></span> utility command is used.
	</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	    MySQL does not supply an XA standard switch structure, but
	    only some SQL non standard statements (
	    <code class="code">XA START, XA END, XA PREPARE, XA COMMIT, XA ROLLBACK, 
	      XA RECOVER</code>
	    ) that can be used to implement some XA features.
	    This is good enough to build a loadable module that can be
	    used by the LIXA transaction manager, but some XA standard features
	    - like dynamic registration - can not be implemented.
	</p></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>
	  Some old versions of the software are affected by a
	    <a class="ulink" href="http://bugs.mysql.com/bug.php?id=12161" target="_top">
	      serious documented bug (# 12161)</a>
	    related to the XA implementation of MySQL. The symptoms perceived
	    while developing LIXA are described below:
	    </p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
		  a MySQL client application invokes XA START
	      </p></li><li class="listitem"><p>
		  it updates some data in the database
	      </p></li><li class="listitem"><p>
		  it invokes XA END and XA PREPARE
	      </p></li><li class="listitem"><p>
		  it crashes and disconnects from the MySQL server 
	      </p></li><li class="listitem"><p>
		  MySQL server rollbacks the transaction and there's no way to
		  see it again using XA RECOVER
	      </p></li></ol></div><p>
	    This behavior violates the XA specification: below there is an 
	    excerpt for <code class="function">xa_prepare</code> from man page (
	    [<a class="citation" href="#idp70066448"><span class="citation">XAspec</span></a>], page 44)
	    <span class="quote">“<span class="quote">Once this function successfully returns, 
	      the resource manager 
	      must guarantee that the transaction branch may be either 
	      committed or rolled back regardless of failures. A resource 
	      manager cannot erase its knowledge of a branch until the 
	      transaction manager calls either xa_commit() or xa_rollback () 
	      to complete the branch
	    </span>”</span>.
	  </p><p>
	    The impact of this bug is quite severe and seriously compromises
	    the ACID properties of the resulting system (application program
	    + MySQL resource manager + LIXA transaction manager).
	  </p></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp67359984"></a>Oracle XE 10.2/11.2 (server)<a href="#ftn.idp67360496" class="footnote" id="idp67360496"><sup class="footnote">[10]</sup></a></h4></div></div></div><p>
	  This step is useful if you want to use Oracle Database as a Resource
	  Manager coordinated by LIXA; only version XE 10.2/11.2 has been
	  tested, but there should not be relevant differences with a
	  different version. Use something like this for Oracle 10.2
	  (32 bit architecture):
	  </p><pre class="screen">
./configure --with-oracle=/usr/lib/oracle/xe/app/oracle/product/10.2.0/server
	  </pre><p>
	  and something like this for Oracle 11.2 (64 bit architecture):
	  </p><pre class="screen">
./configure --with-oracle=/u01/app/oracle/product/11.2.0/xe
	  </pre><p>
	  to create a loadable module containing the switch structure.
	</p><p>
	  Extra configuration is needed in order to use Oracle DBMS; the
	  necessary steps are documented in the configuration chapter.
	</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp67364000"></a>Oracle SE 12.1 (Instant Client)<a href="#ftn.idp67364640" class="footnote" id="idp67364640"><sup class="footnote">[11]</sup></a></h4></div></div></div><p>
	  This step is useful if you want to use Oracle Database Instant
	  Client as a Resource Manager coordinated by LIXA; only version 
	  Standard Edition 12.1 has been tested, but there should not be 
	  relevant differences with a different version. Use something like 
	  this for Oracle 12.1 Instant Client (64 bit architecture):
	  </p><pre class="screen">
./configure --with-oracle-include=/opt/oracle/instantclient_12_1/sdk/include/ \
            --with-oracle-lib=/opt/oracle/instantclient_12_1/
	  </pre><p>
	  to create a loadable module containing the switch structure.
	</p><p>
	  Extra configuration is needed in order to use Oracle DBMS; the
	  necessary steps are documented in the configuration chapter.
	</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp67367664"></a>PostgreSQL 8.3, 8.4, 9.2, 9.3<a href="#ftn.idp67368352" class="footnote" id="idp67368352"><sup class="footnote">[12]</sup></a></h4></div></div></div><p>
	  This step is useful if you want to use PostgreSQL as a Resource
	  Manager coordinated by LIXA; only versions 8.3, 8.4 and 9.3 have been
	  tested, but there should not be relevant differences with a
	  different version. Use something like this (Ubuntu):
	  </p><pre class="screen">
./configure --with-postgresql-include=/usr/include/postgresql --with-postgresql-lib=/usr/lib
	  </pre><p>
	  or something like this (CentOS)
	  <a href="#ftn.idp67370880" class="footnote" id="idp67370880"><sup class="footnote">[13]</sup></a>:
	  </p><pre class="screen">
./configure --with-postgresql-include=/usr/include --with-postgresql-lib=/usr/lib
	  </pre><p>
	  to create a loadable module containing the switch structure.
	</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	    PostgreSQL does not supply an XA standard switch structure, but
	    only some SQL non standard statements (
	    <code class="code">PREPARE TRANSACTION, COMMIT PREPARED, ROLLBACK PREPARED</code>
	    ) that can be used to implement some XA features.
	    This is good enough to build a loadable module that can be
	    used by the LIXA transaction manager, but some XA standard features
	    - like dynamic registration - can not be implemented.
	</p></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp67372768"></a>WebSphere MQ 7.1<a href="#ftn.idp67374480" class="footnote" id="idp67374480"><sup class="footnote">[14]</sup></a></h4></div></div></div><p>
	  If you want to use WebSphere MQ with server/bind mode, you have to
	  use something like this when configuring LIXA:
	  </p><pre class="screen">
./configure --enable-wsmq --with-wsmq=/opt/mqm71
	  </pre><p>
	  If you want to use WebSphere MQ with Extended Transactional Client
	  mode, you have to use something like this when configuring LIXA:
	  </p><pre class="screen">
./configure --enable-wsmq=ETC --with-wsmq=/opt/mqm71
	  </pre><p>
	  There should be no reason you want both on the same host: if you
	  could use the server/bind mode, you should use it because it would
	  give you the best performance.
	  If you don't have the queue manager inside the host, you 
	  will have to use the Extended Transactional Client mode (ETC).
	</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp67377600"></a>Two or more resource managers</h4></div></div></div><p>
	  If you want to use two or more resource managers, and this is a
	  typical condition for the XA usage, you must concatenate two or more
	  <em class="parameter"><code>--with-</code></em> parameters.
	  This command, for instance, can be used to build IBM DB2, Oracle
	  and PostgreSQL loadable modules:
	  </p><pre class="screen">
./configure --with-ibmdb2=/opt/ibm/db2/V9.7 \
&gt; --with-oracle=/usr/lib/oracle/xe/app/oracle/product/10.2.0/server \
&gt; --with-postgresql-include=/usr/include/postgresql --with-postgresql-lib=/usr/lib \
&gt; --with-mysql
	  </pre><p>
	</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp67380368"></a>Summary</h3></div></div></div><p>
	The options illustrated above can be combined to obtain a specific
	configuration. This is an example of a IBM DB2 + Oracle enabled
	installation using an alternate installation path:
	</p><pre class="screen">
tar xvzf lixa-X.Y.Z.tar.gz
cd lixa-X.Y.Z
./configure --prefix=$HOME/lixa --with-ibmdb2=/opt/ibm/db2/V9.7 --with-oracle=/usr/lib/oracle/xe/app/oracle/product/10.2.0/server
make
sudo make install
	</pre><p>
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp67382080"></a>Checking</h2></div></div></div><p>
      Before using LIXA to manage your transactions you might be interested
      in checking the compiled software quality.
    </p><p>
      LIXA has its own test suite implemented with 
      <span class="application">Autotest</span>. A specific build configuration is
      <span class="emphasis"><em>necessary</em></span> to enable all the tests:
      </p><pre class="screen">
tar xvzf lixa-X.Y.Z.tar.gz
cd lixa-X.Y.Z
./configure --prefix=/tmp/lixa --enable-crash
make check
      </pre><p>
      If the binary code produced by the compiler is fine, and your system
      is fine too, all the test <span class="emphasis"><em>must</em></span> complete without
      errors.
    </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp67386448"></a>Checking notes</h3></div></div></div><p>
	Some case tests, specifically MT/1.0/* and MT/2.0/*, stress the
	LIXA software with a massive multithread workload.
	Sometimes the tests fail due to the configuration of your system
	and/or your user account. There are two well known issues:
	</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
	      max files: the case tests open approximately 1000 files
	      (TCP/IP sockets); command 
	      <span class="command"><strong>ulimit -n</strong></span> must return the value 1024 or
	      more
	  </p></li><li class="listitem"><p>
	      stack size: if the stack size is too large, 32 bit platform
	      can experience addressing limit errors; reduce the default 
	      stack size to 4096 if necessary with command
	      <span class="command"><strong>ulimit -s 4096</strong></span>
	  </p></li></ol></div><p>
      </p><p>
	Due to practical reasons, for some features there is not automatic
	testing: tests that requires too many configurations become very
	difficult to develop and to maintain. Here's a list of features that
	are not automatically tested and how you can manually test them if
	necessary:
	</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
	    Oracle Instant Client: it does not provide a
	    standard <code class="filename">oracle_env.sh</code> and a SqlNet
	    configuration should be done in advance. To test it, use sample 
	    programs provided and follow the reference manual for environment
	    set-up, program build and test
	  </p></li><li class="listitem"><p>
	    Oracle Pro*C: the "sys_include" statement of file
	    <code class="filename">pcscfg.cfg</code> requires a lot of hacking for
	    proper configuration, especially if the user installed the "zip"
	    package and/or the system is Ubuntu Linux. To test it, use sample 
	    programs provided and follow the reference manual for environment
	    set-up, program build and test
	  </p></li><li class="listitem"><p>
	    Oracle Pro*COBOL: not yet available.  To test it, use sample 
	    programs provided and follow the reference manual for environment
	    set-up, program build and test
	  </p></li></ol></div><p>
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp67396176"></a>Valgrind advanced checking (LIXA developers only)</h3></div></div></div><p>
	If you are interested in checking the internals of LIXA you can
	activate memory or thread check using 
	<a class="ulink" href="http://valgrind.org/" target="_top">Valgrind</a> (it's
	assumed you already have installed Valgrind).
	If you were insterested in memory usage analysis, this is the sequence
	of commands you would use:
	</p><pre class="screen">
export CLIENT_CHECK_TYPE=memory
export SERVER_CHECK_TYPE=memory
make check
	</pre><p>
	If you were interested in thread usage analysis, this is the sequence
	of commands you would use:
	</p><pre class="screen">
export CLIENT_CHECK_TYPE=thread
export SERVER_CHECK_TYPE=thread
make check
	</pre><p>
	Check type can be set independently: you may check memory behavior of 
	the client component without checking memory behavior of the server
	component and vice versa.
	</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	    Valgrind is a very good tool, but can not understand some
	    optimizations and detects some wrong memory leaks 
	    (false positives). Nevertheless if you were suspecting there is
	    a memory leak inside LIXA, this would be a good start point to
	    discover where the issue is.
	</p></div><p>
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp67400368"></a>GDB assisted checking (LIXA developers only)</h3></div></div></div><p>
	Sometimes it may be useful to execute the case tests under the
	supervision of <span class="command"><strong>gdb</strong></span> instead of running it directly
	from the shell.
	Both client and server can be executed inside <span class="command"><strong>gdb</strong></span>
	using these commands:
	</p><pre class="screen">
export CLIENT_CHECK_TYPE=debug
export SERVER_CHECK_TYPE=debug
make check
	</pre><p>
	</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	    Running a case test inside <span class="command"><strong>gdb</strong></span> may change
	    the exit code checked by <span class="command"><strong>automake</strong></span> tests.
	    You can not use this option as a default test option,
	    but it may be useful to inspect some strange problems because
	    <span class="command"><strong>gdb</strong></span> produce the stack trace related to the
	    issue.
	  </p></div><p>
      </p></div></div><div class="footnotes"><br /><hr style="width:100; text-align:left;margin-left: 0" /><div id="ftn.idp67271040" class="footnote"><p><a href="#idp67271040" class="para"><sup class="para">[6] </sup></a>
		    You must use InnoDB back-end to perform transactions with
		    MySQL; MyISAM back-end is not supported.
		</p></div><div id="ftn.idp67342000" class="footnote"><p><a href="#idp67342000" class="para"><sup class="para">[7] </sup></a>
	      IBM and DB2 are trademarks of <span class="trademark">IBM</span>™
	      corporation
	</p></div><div id="ftn.idp67345584" class="footnote"><p><a href="#idp67345584" class="para"><sup class="para">[8] </sup></a>
	      MySQL is a trademark of <span class="trademark">Oracle</span>™ 
	      corporation; details are available at this link:
	      <a class="ulink" href="http://www.mysql.com/about/legal/" target="_top">
		http://www.mysql.com/about/legal/</a>
	  </p></div><div id="ftn.idp67347824" class="footnote"><p><a href="#idp67347824" class="para"><sup class="para">[9] </sup></a>
	      These are the necessary packages on CentOS: 
	      mysql.i686 mysql-devel.i686 mysql-server.i686
	  </p></div><div id="ftn.idp67360496" class="footnote"><p><a href="#idp67360496" class="para"><sup class="para">[10] </sup></a>
	      Oracle is a trademark of <span class="trademark">Oracle</span>™
	      corporation
	</p></div><div id="ftn.idp67364640" class="footnote"><p><a href="#idp67364640" class="para"><sup class="para">[11] </sup></a>
	      Oracle is a trademark of <span class="trademark">Oracle</span>™
	      corporation
	</p></div><div id="ftn.idp67368352" class="footnote"><p><a href="#idp67368352" class="para"><sup class="para">[12] </sup></a>
	      The Trademark Policy of PostgreSQL is available at this link:
	      <a class="ulink" href="http://wiki.postgresql.org/wiki/Trademark_Policy" target="_top">
		http://wiki.postgresql.org/wiki/Trademark_Policy</a>
	</p></div><div id="ftn.idp67370880" class="footnote"><p><a href="#idp67370880" class="para"><sup class="para">[13] </sup></a>
	      These are the necessary packages on CentOS: 
	      postgresql-server.i686 postgresql.i686 postgresql-devel.i686
	  </p></div><div id="ftn.idp67374480" class="footnote"><p><a href="#idp67374480" class="para"><sup class="para">[14] </sup></a>
	      WebSphere and WebSphere MQ are trademarks of 
	      <span class="trademark">IBM</span>™ corporation
	</p></div></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="Configuration"></a>Chapter 3. Configuration</h1></div></div></div><p>
    A LIXA system is the assembling of two components: the client and 
    the server. The figure
    below shows a typical configuration with one Application
    Program and two Resource Managers.
  </p><div class="figure"><a id="config1"></a><p class="title"><strong>Figure 3.1. Typical LIXA topology</strong></p><div class="figure-contents"><div class="mediaobject"><img src="../images/LIXA_Configuration_1.png" alt="Typical LIXA topology" /></div></div></div><br class="figure-break" /><p>
    The model shows logical and "phisycal" blocks:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	  "Application Program code" is the code of your own application
      </p></li><li class="listitem" style="list-style-type: disc"><p>
	  "librm1" is the code of the library your application must use to
	  communicate with "RM1" (the first resource manager)
      </p></li><li class="listitem" style="list-style-type: disc"><p>
	  "librm2" is the code of the library your application must use to
	  communicate with "RM2" (the second resource manager)
      </p></li><li class="listitem" style="list-style-type: disc"><p>
	  "liblixac" is the code of the library your application must use to
	  invoke the TX verbs and send instruction to the Transaction Manager
      </p></li><li class="listitem" style="list-style-type: disc"><p>
	  "Application Program code" + "librm1" + "librm2" + "liblixac" must
	  be linked togheter to produce the Application Program; the
	  Application Program is an executable object
      </p></li><li class="listitem" style="list-style-type: disc"><p>
	  "RM1" is the first resource manager; it may be a relational database
	  (RDBMS)
      </p></li><li class="listitem" style="list-style-type: disc"><p>
	  "RM2" is the second resource manager; it may be an object oriented
	  database (OODBMS)
      </p></li><li class="listitem" style="list-style-type: disc"><p>
	  "lixad" is the <span class="emphasis"><em>daemon</em></span> used by "liblixac" to
	  store the states of the transactions
      </p></li></ul></div><p>
  </p><p>
    The model shows how the blocks communicate:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	  (A1): is the protocol supplied by the first resource manager; 
	  SQL/CLI is an example and is supplied by IBM DB2, 
	  SQL/OCI is another example and is supplied by Oracle Database Server
      </p></li><li class="listitem" style="list-style-type: disc"><p>
	  (B1): is the protocol supplied by the second resource manager; every
	  resource manager has its own protocol and its own API
      </p></li><li class="listitem" style="list-style-type: disc"><p>
	  (A2): is the internal protocol used by the client of RM1 to 
	  communicate with RM1 server process(es); it can be a cross memory
	  or a network protocol and it depends on RM1 configuration
      </p></li><li class="listitem" style="list-style-type: disc"><p>
	  (B2): is the internal protocol used by the client of RM2 to 
	  communicate with RM2 server process(es); it can be a cross memory
	  or a network protocol and it depends on RM2 configuration
      </p></li><li class="listitem" style="list-style-type: disc"><p>
	  (TX): is the protocol supplied by the LIXA project and is described
	  in [<a class="citation" href="#idp70061648"><span class="citation">TXspec</span></a>]; it's a standard protocol and API
      </p></li><li class="listitem" style="list-style-type: disc"><p>
	  (XA): is the standard protocol used by the LIXA project to 
	  communicate with the resource managers and is described
	  in [<a class="citation" href="#idp70066448"><span class="citation">XAspec</span></a>]; it's a standard protocol and API
      </p></li><li class="listitem" style="list-style-type: disc"><p>
	  (LX): is the internal protocol used by the client of LIXA to 
	  communicate with the LIXA server process (lixad); it is a network 
	  protocol
      </p></li></ul></div><p>
  </p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp67424736"></a>Architectural elements</h2></div></div></div><p>
      The <span class="command"><strong>lixad</strong></span> daemon process can be executed on any
      system: there is no need to execute it on the same system that's hosting
      the Application Programs. The communications between 
      the client and the server (<span class="command"><strong>lixad</strong></span>) uses TCP/IP sockets.
    </p><p>
      The <code class="systemitem">lixac</code> library is 
      embedded in the Application
      Programs; the communication between the Application Program and
      the <code class="systemitem">lixac</code> library uses 
      TX (Transaction Demarcation)
      API, see [<a class="citation" href="#idp70061648"><span class="citation">TXspec</span></a>]. 
      The <code class="systemitem">lixac</code> 
      library contains all the logic of the LIXA Transaction Manager.
    </p><p>
      The communication between the Application Program and the Resource
      Managers depends on Resource Managers type and configuration: 
      it may be cross memory, TCP/IP, System V IPC, etc...
      The communication between the 
      <code class="systemitem">lixac</code> library and the
      Resource Manager depends on Resource Manager configuration and must be
      of the same used by the Application Program.
    </p><p>
      The communication between 
      <code class="systemitem">lixac</code> library and 
      <span class="command"><strong>lixad</strong></span> is ever istantiated by the client: the
      server never calls the clients.
    </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp67430928"></a>Deployment models</h3></div></div></div><p>
	This section explains some different deployment models you can
	set up leveraging the LIXA project technology.
      </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp67434912"></a>The easiest non trivial model</h4></div></div></div><p>
	  The easiest non trivial deployment of a distributed transaction
	  processing system based on the LIXA project is showed below: a single
	  node hosts the Application Program, the Resource Managers and the
	  LIXA server.
	</p><div class="figure"><a id="config2"></a><p class="title"><strong>Figure 3.2. Easiest non trivial deployment model</strong></p><div class="figure-contents"><div class="mediaobject"><img src="../images/LIXA_Configuration_2.png" alt="Easiest non trivial deployment model" /></div></div></div><br class="figure-break" /></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp67436528"></a>A trivial model</h4></div></div></div><p>
	  A trivial deployment of a distributed transaction
	  processing system based on the LIXA project is showed below: a single
	  node hosts the Application Program, the Resource Manager and the
	  LIXA server. This configuration is obtained from the previous one
	  removing a Resource Manager.
	</p><p>
	  Using only one Resource Manager is supported by the LIXA project
	  technology, but it's quite useless because you don't need a
	  transaction manager to perform 
	  <span class="emphasis"><em>single phase commit</em></span> against 
	  <span class="emphasis"><em>one</em></span>
	  Resource Manager. This type of configuration will not be described
	  more deeply.
	</p><div class="figure"><a id="config3"></a><p class="title"><strong>Figure 3.3. Trivial deployment model</strong></p><div class="figure-contents"><div class="mediaobject"><img src="../images/LIXA_Configuration_3.png" alt="Trivial deployment model" /></div></div></div><br class="figure-break" /></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp67445552"></a>A fully distributed model</h4></div></div></div><p>
	  A fully distributed transaction processing system can be achieved
	  hosting every component in a different node.
	  The picture below shows 4 different nodes:
	  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
		an application server node hosting the Application Program
	    </p></li><li class="listitem" style="list-style-type: disc"><p>
		a Transaction Manager dedicated node hosting the 
		LIXA server
	    </p></li><li class="listitem" style="list-style-type: disc"><p>
		two Resource Manager dedicated nodes hosting the
		Reosurce Managers
	    </p></li></ul></div><p>
	</p><div class="figure"><a id="config4"></a><p class="title"><strong>Figure 3.4. Fully distributed deployment model</strong></p><div class="figure-contents"><div class="mediaobject"><img src="../images/LIXA_Configuration_4.png" alt="Fully distributed deployment model" /></div></div></div><br class="figure-break" /></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp67452144"></a>A more complex distributed model</h4></div></div></div><p>
	  A more complex distributed transaction processing system 
	  can be achieved introducing a second application server and a third
	  Resource Manager; in the picture below the third Resource Manager 
	  is hosted in the same node of the second Resource Manager.
	</p><p>
	  The two different Application Programs do not need to be hosted in
	  different application servers. They are different 
	  Application Programs because they use a different mix of
	  Resource Managers.
	</p><div class="figure"><a id="config5"></a><p class="title"><strong>Figure 3.5. Complex distributed deployment model</strong></p><div class="figure-contents"><div class="mediaobject"><img src="../images/LIXA_Configuration_5.png" alt="Complex distributed deployment model" /></div></div></div><br class="figure-break" /><p>
	  Further complexity can be reached introducing an Application
	  Program that uses three (or more) different Resource Managers,
	  but this document will not go on this path to preserve
	  understandability
	  <a href="#ftn.idp67457520" class="footnote" id="idp67457520"><sup class="footnote">[15]</sup></a>
	  .
	</p></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp67458272"></a>Configuring LIXA components</h2></div></div></div><p>
      The picture below emphasizes the LIXA components that must be configured
      in a simple scenario:
    </p><div class="figure"><a id="config6"></a><p class="title"><strong>Figure 3.6. The LIXA components and the necessary configuration files</strong></p><div class="figure-contents"><div class="mediaobject"><img src="../images/LIXA_Configuration_6.png" alt="The LIXA components and the necessary configuration files" /></div></div></div><br class="figure-break" /><p>
      The client component (<code class="systemitem">lixac</code>) 
      is configured using the
      <code class="filename">etc/lixac_conf.xml</code> file; the server component
      (<span class="command"><strong>lixad</strong></span>) is configured using the
      <code class="filename">etc/lixad_conf.xml</code> file
      <a href="#ftn.idp67464960" class="footnote" id="idp67464960"><sup class="footnote">[16]</sup></a>.
    </p><p>
      If a node hosts both the client and the server components, both the
      files must be configured. If a node hosts only one component, only
      one configuration file is necessary
      <a href="#ftn.idp67467392" class="footnote" id="idp67467392"><sup class="footnote">[17]</sup></a>.
    </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Configuring_the_server"></a>Configuring the server</h3></div></div></div><p>
	The default configuration file is 
	<code class="filename">etc/lixad_conf.xml</code>
	and is located at the root installation path (i.e.
	<code class="filename">/opt/lixa/etc/lixad_conf.xml</code>).
      </p><p>
	The file is composed of three sections:
	</p><div class="figure"><a id="config7"></a><p class="title"><strong>Figure 3.7. The structure of lixad_conf.xml</strong></p><div class="figure-contents"><div class="mediaobject"><img src="../images/LIXA_Configuration_7.png" alt="The structure of lixad_conf.xml" /></div></div></div><p><br class="figure-break" />
	</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	      the <span class="emphasis"><em>server</em></span> section contains the global
	      parameters of the server
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      the <span class="emphasis"><em>listeners</em></span> section specifies how many
	      TCP/IP addresses and ports must be listened to accept incoming
	      client connections
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      the <span class="emphasis"><em>managers</em></span> section specifies how many
	      parallel threads must be activated to serve the LIXA clients
	  </p></li></ul></div><p>
      </p><p>
	Below there is a sample configuration file:
	</p><pre class="screen">
&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
  &lt;server 
    pid_file="/opt/lixa/var/run.pid"
    min_elapsed_sync_time="0" max_elapsed_sync_time="0"&gt;
  &lt;listeners&gt;
    &lt;listener domain="AF_INET" address="127.0.0.1" port="3456"/&gt;
    &lt;listener domain="AF_INET" address="0.0.0.0" port="2345"/&gt;
  &lt;/listeners&gt;
  &lt;managers&gt;
    &lt;manager status_file="/opt/lixa/var/lixad_status1"/&gt;
    &lt;manager status_file="/opt/lixa/var/lixad_status2"/&gt;
    &lt;manager status_file="/opt/lixa/var/lixad_status3"/&gt;
  &lt;/managers&gt;
&lt;/server&gt;
      </pre><p>
	The tags and the
	properties of the XML file are described below:
	</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	      <em class="parameter"><code>pid_file</code></em>: it is the file used by the 
	      server 
	      to store the daemon <acronym class="acronym">PID</acronym>; the server creates
	      the file at start-up and destroys it at shutdown
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      <em class="parameter"><code>min_elapsed_sync_time</code></em>: minimum time
	      expressed in millisecond interleaving a state file 
	      synchronization request and the start of the synchronization
	      operation; every manager (thread) uses its own clock 
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      <em class="parameter"><code>max_elapsed_sync_time</code></em>: maximum time
	      expressed in millisecond interleaving a state file 
	      synchronization request and the start of the synchronization
	      operation; every manager (thread) uses its own clock.
	      <em class="parameter"><code>max_elapsed_sync_time</code></em> can not be less 
	      than <em class="parameter"><code>min_elapsed_sync_time</code></em>;
	      see <a class="xref" href="#Tuning" title="Chapter 10. Tuning">Chapter 10, <em>Tuning</em></a> for more information about these
	      parameters.
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      <em class="parameter"><code>listener</code></em>: the server can activate one 
	      or more
	      listeners; most of the times one listener is sufficient, but if
	      you want to use only a subset of the IP addresses defined at
	      the operating system level, you have to configure a dedicated
	      listener for every desired address
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      <em class="parameter"><code>domain</code></em>: the type of socket must be used to
	      listen for clients. The only allowed type is 
	      <code class="constant">AF_INET</code>; this may change in the future
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      <em class="parameter"><code>address</code></em>: the address that must be used 
	      to listen for
	      clients; the special value "<code class="constant">0.0.0.0</code>" means
	      <span class="emphasis"><em>any</em></span> address
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      <em class="parameter"><code>port</code></em>: the port that must be used to 
	      listen for
	      clients; it must be a free port (use command 
	      <span class="command"><strong>netstat</strong></span> to find out one)
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      <em class="parameter"><code>manager</code></em>: any configured 
	      <span class="emphasis"><em>manager</em></span> is a server worker and runs as
	      a dedicated thread. 
	      Refer to <a class="xref" href="#Tuning" title="Chapter 10. Tuning">Chapter 10, <em>Tuning</em></a> for a discussion about
	      configuration and performance results
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      <em class="parameter"><code>status_file</code></em>: the physical path that 
	      must be used to
	      create the status files (a couple) for a manager; 
	      this generally is
	      a persistent and reliable storage device like a RAID partition.
	      The string specified by the tag <em class="parameter"><code>status_file</code></em>
	      is used as a prefix: every manager (thread) creates two files
	      with the same prefix and different suffixes.
	  </p></li></ul></div><p>
      </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="Delayed_synchronization_effects"></a>Delayed synchronization effects</h4></div></div></div><p>
	  Parameters
	  <em class="parameter"><code>min_elapsed_sync_time</code></em> and
	  <em class="parameter"><code>max_elapsed_sync_time</code></em>
	  have a great relevance with the performance of the LIXA system
	  as explained in <a class="xref" href="#Tuning" title="Chapter 10. Tuning">Chapter 10, <em>Tuning</em></a> but they have a relevance
	  with system robustness as well:
	</p><p>
	  <span class="emphasis"><em>
	    the higher the delay between the time a client ask a disk
	    synchronization and the time the state server performs it
	    (<em class="parameter"><code>min_elapsed_sync_time</code></em>), the higher
	    the chance the disk status files will not contain the correct
	    state for some transactions if the state server crashes.
	  </em></span>
	</p><p>
	  The risk is not related to data corruption: data integrity is
	  guaranteed by the Resource Managers your Application Programs use.
	  The risk is some <span class="quote">“<span class="quote">prepared/recovery pending</span>”</span>
	  transactions will not automatically recovered
	  (see <a class="xref" href="#Automatic_recovery_concepts" title="Automatic recovery concepts">the section called “Automatic recovery concepts”</a>) by LIXA
	  infrastructure; those transactions will need
	  manual recovery (see <a class="xref" href="#Manual_cold_recovery" title="Manual (cold) recovery">the section called “Manual (cold) recovery”</a>).
	</p><p>
	  <span class="emphasis"><em>
	    During the interval between state server crash and
	    manual recovery your Resource Managers will keep some locks on
	    data: this could be the real damage for your application.
	  </em></span>
	</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp67504368"></a>Configuring the client</h3></div></div></div><p>
	The default configuration file is 
	<code class="filename">etc/lixac_conf.xml</code>
	and is located at the root installation path (i.e.
	<code class="filename">/opt/lixa/etc/lixac_conf.xml</code>). 
      </p><p>
	The file is composed of three sections:
	</p><div class="figure"><a id="config8"></a><p class="title"><strong>Figure 3.8. The structure of lixac_conf.xml</strong></p><div class="figure-contents"><div class="mediaobject"><img src="../images/LIXA_Configuration_8.png" alt="The structure of lixac_conf.xml" /></div></div></div><p><br class="figure-break" />
	</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	      the <span class="emphasis"><em>state servers</em></span> section 
	      contains a list of the available LIXA state servers and how they
	      can be contacted
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      the <span class="emphasis"><em>resource managers</em></span> section
	      contains a list of the available Resource Managers and how they
	      can be managed by LIXA using XA standard API and protocol
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      the <span class="emphasis"><em>profiles</em></span> section
	      contains a set of possibly different profiles: every
	      Application Program can use only one profile; if you had
	      different Application Programs with different requirements,
	      you should create different profiles. Every profile contains
	      a set of servers and a set of Resource Managers that must be
	      used to support the Application Program.
	  </p></li></ul></div><p>
      </p><p>
	Below there is a sample configuration file:
	</p><pre class="screen">
&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;client&gt;
  &lt;sttsrvs&gt;
    &lt;sttsrv name="local_1" domain="AF_INET" address="10.23.45.67" port="2345" /&gt;
    &lt;sttsrv name="local_2" domain="AF_INET" address="10.23.46.91" port="3456" /&gt;
  &lt;/sttsrvs&gt;
  &lt;rsrmgrs&gt;
    &lt;rsrmgr name="OracleXE_dynreg" switch_file="/opt/lixa/lib/switch_oracle_dynreg.so" xa_open_info="Oracle_XA+Acc=P/hr/hr+SesTm=30+LogDir=/tmp+threads=true+DbgFl=7+Loose_Coupling=true" xa_close_info="" /&gt;
    &lt;rsrmgr name="OracleXE_stareg" switch_file="/opt/lixa/lib/switch_oracle_stareg.so" xa_open_info="Oracle_XA+Acc=P/hr/hr+SesTm=30+LogDir=/tmp+threads=true+DbgFl=7+Loose_Coupling=true" xa_close_info="" /&gt;
    &lt;rsrmgr name="IBMDB2_dynreg" switch_file="/opt/lixa/lib/switch_ibmdb2_dynreg.so" xa_open_info="axlib=/opt/lixa/lib/liblixac.so,db=sample,tpm=lixa" xa_close_info="" /&gt;
    &lt;rsrmgr name="IBMDB2_stareg" switch_file="/opt/lixa/lib/switch_ibmdb2_stareg.so" xa_open_info="axlib=/opt/lixa/lib/liblixac.so,db=sample,tpm=lixa" xa_close_info="" /&gt;
  &lt;/rsrmgrs&gt;
  &lt;profiles&gt;
    &lt;profile name="GT71"&gt;
      &lt;sttsrvs&gt;
        &lt;sttsrv&gt;local_1&lt;/sttsrv&gt;
      &lt;/sttsrvs&gt;
      &lt;rsrmgrs&gt;
        &lt;rsrmgr&gt;OracleXE_stareg&lt;/rsrmgr&gt;
        &lt;rsrmgr&gt;IBMDB2_stareg&lt;/rsrmgr&gt;
      &lt;/rsrmgrs&gt;
    &lt;/profile&gt;
    &lt;profile name="VZ67"&gt;
      &lt;sttsrvs&gt;
        &lt;sttsrv&gt;local_1&lt;/sttsrv&gt;
      &lt;/sttsrvs&gt;
      &lt;rsrmgrs&gt;
        &lt;rsrmgr&gt;OracleXE_dynreg&lt;/rsrmgr&gt;
        &lt;rsrmgr&gt;IBMDB2_dynreg&lt;/rsrmgr&gt;
      &lt;/rsrmgrs&gt;
    &lt;/profile&gt;
    &lt;profile name="AG71"&gt;
      &lt;sttsrvs&gt;
        &lt;sttsrv&gt;local_2&lt;/sttsrv&gt;
      &lt;/sttsrvs&gt;
      &lt;rsrmgrs&gt;
        &lt;rsrmgr&gt;IBMDB2_dynreg&lt;/rsrmgr&gt;
      &lt;/rsrmgrs&gt;
    &lt;/profile&gt;
  &lt;/profiles&gt;
&lt;/client&gt;
	</pre><p>
	The tags and the
	properties of the XML file are described below:
	</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	      <code class="varname">sttsrv</code>: this section is used to describe a
	      state server (a LIXA server instance) that must be reached by any
	      client described below
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      <code class="varname">sttsrv/name</code>: a name associated to the 
	      state server; it is a logical name that is referenced by 
	      the profiles defined below
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      <code class="varname">domain</code>: it must be the same domain specified 
	      by the listener that must be reached; the listener is configured
	      in <code class="filename">lixad_conf.xml</code> (see above) and may be
	      local or remote
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      <code class="varname">address</code>: it must be the same same address 
	      specified by the listener that must be reached; the listener is
	      configured in <code class="filename">lixad_conf.xml</code> (see above)
	      and may be local or remote
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      <code class="varname">port</code>: it must be the same port specified
	      by the listener that must be reached; the listener is
	      configured in
	      <code class="filename">lixad_conf.xml</code> (see above)
	      and may be local or remote
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      <code class="varname">rsrmgr</code>: this section is used to describe 
	      a resource manager that will be used by the
	      Application Programs configured below (see profiles)
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      <code class="varname">rsrmgr/name</code>: a name associated to the 
	      Resource Manager; it is a logical name that is referenced by
	      the profile defined below
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      <code class="varname">switch_file</code>: name of the file that contains 
	      the XA switch structure; the file is produced by the installation
	      procedure
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      <code class="varname">xa_open_info</code>: it is the string of parameters
	      that must be passed to the Resource Manager by the xa_open() 
	      function call; the content
	      of the string depends on the Resource Manager, please refer to
	      the documentation distributed with the resource manager you
	      are using. The string can not exceed 255 characters
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      <code class="varname">xa_close_info</code>: it is the string of parameters
	      that must be passed to the Resource Manager by the xa_close() 
	      function call; the content
	      of the string depends on the Resource Manager, please refer to
	      the documentation distributed with the resource manager you
	      are using. The string can not exceed 255 characters
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      <code class="varname">profile</code>: it contains the description of the
	      LIXA every transactional profile must be
	      used by the Application Programs needs to be listed here
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      <code class="varname">profile/name</code>: the name associated to the
	      transaction profile; this name is used in different places and
	      it is suggested to avoid special characters, blanks and possibly
	      mixed case (these hints may help you in troubleshooting)
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      <code class="varname">profile/sttsrv</code>: the state server that
	      will be used to store
	      the transactional information associated to this profile; more
	      than one state servers can be specified but 
	      <span class="emphasis"><em>only</em></span> 
	      the first one is used with the current release software
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      <code class="varname">profile/rsrmgr</code>: every Resource Manager that
	      must be
	      used by the Application Programs associated to this transactional
	      profile needs to be listed here. There is no a limit: you can
	      specify 1, 2, 3, ... resource managers. Avoid useless resource
	      manager because xa_open() and xa_close() will be performed 
	      against all the listed resource managers. If you can choose 
	      between a "dynamic" and a "static" version of the same resource
	      manager, the "dynamic" one is more efficient	    
	  </p></li></ul></div><p>
      </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="Client_configuration_explanation"></a>Client configuration explanation</h4></div></div></div><p>
	  The client configuration file contains three sections:
	  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
		<code class="varname">sttsrvs</code>: is the list of the LIXA daemons 
		you are
		running inside your network and you will use to manage the
		persistent state of the clients that are using the
		configuration
		file; many times a single LIXA state server is sufficient, but
		sometimes you need more (development, test and production
		environment might use different LIXA servers)
	    </p></li><li class="listitem" style="list-style-type: disc"><p>
		<code class="varname">rsrmgrs</code>: the list of the Resource Managers
		necessary execute the Application Programs; there is no limit
		to the number of resource managers you can specify from a LIXA
		point of view, but you should avoid to list useless 
		Resource Managers to obtain the best performance
	    </p></li><li class="listitem" style="list-style-type: disc"><p>
		<code class="varname">profiles</code>: the list of the available
		transactional profiles for your Application Programs. This
		concept allows you a great configuration flexibility: the same
		configuration file can be used for completely different
		Application Programs and completely different environment.
		As an example, imagine you have 3 distinct applications and
		every application uses a different mix of resource managers; 
		then
		you manage 3 different environments (development, test and
		production): with 9 profiles you can model your
		transactional needs completely 
		(APP1DEV, APP2DEV, APP3DEV, APP1TEST,
		APP2TEST, APP3TEST, APP1PROD, APP2PROD, APP3PROD).
	    </p></li></ul></div><p>
	</p><p>
	  The picture below models an environment that's using the sample
	  <code class="filename">etc/lixac_conf.xml</code>
	  showed above:
	  </p><div class="figure"><a id="config9"></a><p class="title"><strong>Figure 3.9. A "real" environment</strong></p><div class="figure-contents"><div class="mediaobject"><img src="../images/LIXA_Configuration_9.png" alt="A &quot;real&quot; environment" /></div></div></div><p><br class="figure-break" />
	  The scenario is composed of three distinct applications:
	  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
		GT71: it's an application that uses both an Oracle and an
		IBM DB2 DBMS; most of the transactions need to perform
		distributed transaction processing and the profile specifies
		the static registration versions of the switch files.
	    </p></li><li class="listitem" style="list-style-type: disc"><p>
		AG71: it's an application that uses only an
		IBM DB2 DBMS; only few transactions need to perform
		distributed transaction processing and the profile specifies
		the dynamic registration versions of the switch files. This
		application does not need an XA Transaction Manager because
		it uses only one Resource Manager, but the development team
		decided to use LIXA because it will use a second Resource
		Manager in the next few months.
	    </p></li><li class="listitem" style="list-style-type: disc"><p>
		VZ67: it's an application that uses both an Oracle and an
		IBM DB2 DBMS; only few transactions need to perform
		distributed transaction processing and the profile specifies
		the dynamic registration versions of the switch files.
	    </p></li></ul></div><p>
	  The scenario uses two distinct LIXA state servers: this is an
	  unusual situation but it works.
	</p><p>
	  The <code class="varname">LIXA_PROFILE</code> environment variable must be used 
	  to specify the transactional profile associated to the Application 
	  Program.
	  If you do not specify a valid transactional profile, 
	  the first profile
	  of the list will be applied (in the above example it's
	  <code class="varname">GT71</code>).
	  </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	      There is not an alternate way to specify the 
	      transactional profile:
	      <code class="function">tx_open</code> does not allow parameters.
	  </p></div><p>
	  With reference to scenario showed above, Application Program GT71
	  must export <code class="varname">LIXA_PROFILE</code> before execution; if
	  you are using <span class="command"><strong>bash</strong></span> shell you must specifiy
	  something like this
	  </p><pre class="screen">
export LIXA_PROFILE=GT71
	  </pre><p>
	  before application execution. The same applies to Application Program
	  AG71 and VZ67:
	  </p><pre class="screen">
export LIXA_PROFILE=AG71
[...]
export LIXA_PROFILE=VZ67
	  </pre><p>
	</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="Client_configuration_caution"></a>Client configuration caution</h4></div></div></div><p>
	  If you change the content of <code class="filename">lixac_conf.xml</code>
	  you will change the signature associated to the configuration file
	  from LIXA Transaction Manager. The signature is very important
	  because LIXA Transaction Manager will not activate automatic
	  recovery of <span class="quote">“<span class="quote">prepared/recovery pending</span>”</span> transactions
	  if configuration file signatures do not match. In the case of
	  signature mismatch during automatic recovery, the LIXA system 
	  reacts with some log messages as below:
	  </p><pre class="screen">
Feb  8 21:38:51 ubuntu lixad[2517]: LXD011W a client is performing recovery but config file changed in the meantime for job 'a100c8728292168b21ba7239bffc137d/127.0.0.1      ' and transaction '1279875137.46d1df80428d4d6c85e6919b16b4a744.a100c8728292168b21ba7239bffc137d'
Feb  8 21:38:51 ubuntu lixat[2532]: LXC001E transaction '1279875137.46d1df80428d4d6c85e6919b16b4a744.a100c8728292168b21ba7239bffc137d' can NOT be recovered because current config digest 'a100c8728292168b21ba7239bffc137d' does NOT match server stored config digest '9e4c11057107c73366c9fc421eaa85ca'
	  </pre><p>
	  LIXA state server issues a warning (LXD011W) while LIXA Transaction
	  Manager (client) issues an error (LXC001E): this behavior is
	  necessary to protect the whole system against undesired recovery
	  operation that could damage your data inside the Resource Managers.
	</p><p>
	  This protection has a cost explained in 
	  <a class="xref" href="#Recoverying_transaction_associated_different_job" title="Recoverying a transaction associated to a different job">the section called “Recoverying a transaction associated to a different job”</a>.
	</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
	    Before editing (and saving) <code class="filename">lixac_conf.xml</code>,
	    be sure <span class="emphasis"><em>there are no</em></span>
	    <span class="quote">“<span class="quote">prepared/recovery pending</span>”</span> transactions
	    (you can use <code class="option">--dump</code> as explained in
	    <a class="xref" href="#lixad_dump_execution" title="Dump execution">the section called “Dump execution”</a> and in
	    <a class="xref" href="#Recoverying_recovery_failed_transaction" title="Recoverying a “recovery failed” transaction">the section called “Recoverying a <span class="quote">“<span class="quote">recovery failed</span>”</span> transaction”</a>
	    to verify the content of the state server).
	  </p><p>
	    Create a different config file and use 
	    <code class="varname">LIXA_CONFIG_FILE</code> environment variable
	    as explained in
	    <a class="xref" href="#Environment_variables" title="Environment variables">the section called “Environment variables”</a> until you are not sure 
	    about the changes you are performing.
	  </p></div></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Environment_variables"></a>Environment variables</h2></div></div></div><p>
      You can use some environment variables to tailor the LIXA configuration
      to your needs. Some environment variables applies only to one component,
      others apply to both client and server LIXA components.
    </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp67567520"></a>LIXA_CONFIG_FILE</h3></div></div></div><p>
	  This environment variable can be used to specify an alternate
	  configuration file for your application. 
	  Example: if you are trying a new configuration, but you 
	  wont to modify the default
	  <code class="filename">etc/lixac_conf.xml</code>
	  file, you can export the variable before program execution:
	  </p><pre class="screen">
export LIXA_CONFIG_FILE=/tmp/my_lixac
./myapp
	  </pre><p>
	  <span class="command"><strong>myapp</strong></span> will be executed using the configuration
	  stored inside
	  <code class="filename">/tmp/my_lixac</code>
	  instead of the configuration stored inside the default
	  <code class="filename">etc/lixac_conf.xml</code>
	  client configuration file.
	</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp67571248"></a>LIXA_CRASH_COUNT</h3></div></div></div><p>
	  This environment variable must be used only in a development
	  environment: after the program crossed the
	  <span class="emphasis"><em>crash point</em></span> as many times as the value of
	  this variable (default = 1), the process crashes. See
	  environemt variable
	  <code class="varname">LIXA_CRASH_POINT</code> too.
	</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp67573904"></a>LIXA_CRASH_POINT</h3></div></div></div><p>
	  This environment variable must be used only in a development
	  environment: it specifies the crash point inside the LIXA
	  code. The acceptable values for this variable are listed
	  inside the C header file
	  <code class="filename">src/common/lixa_crash.h</code>
	  LIXA project uses 
	  the <code class="function">abort()</code> function to simulate a soft crash.
	</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp67576320"></a>LIXA_JOB</h3></div></div></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>
	      This environment variable may be very useful to deal with some
	      specific requirements, but it changes how the automatic
	      recovery process works and the final result could be strange
	      or "unpredictable" if you didn't understand the whole picture.
	  </p></div><p>
	  Use this environment variable to associate a specific transactional
	  job identifier instead of the automatically assigned one. 
	  See <a class="xref" href="#Automatic_recovery_concepts" title="Automatic recovery concepts">the section called “Automatic recovery concepts”</a> and
	  <a class="xref" href="#Workload_balanced_environments" title="Workload balanced environments">the section called “Workload balanced environments”</a> 
	  for more information.
	</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp67579808"></a>LIXA_PROFILE</h3></div></div></div><p>
	  This environment variable must be used 
	  to specify the transactional profile associated to the Application 
	  Program.
	  If you do not specify a valid transactional profile, the first
	  profile listed inside 
	  <code class="filename">etc/lixac_conf.xml</code>
	  will be applied.
	  See <a class="xref" href="#Client_configuration_explanation" title="Client configuration explanation">the section called “Client configuration explanation”</a> too.
	</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp67582432"></a>LIXA_TRACE_MASK</h3></div></div></div><p>
	  This environment variable specifies which internal modules must
	  be traced at run-time. 
	  The C header file
	  <code class="filename">src/common/lixa_trace.h</code>
	  contains the exadecimal value of every internal module; if you 
	  want to trace two or more modules you have make the logical OR
	  among all the desired values.
	</p><p>
	  Supposing you are interested in tracing what happens inside 
	  <span class="emphasis"><em>"server listener"</em></span>,
	  <span class="emphasis"><em>"server manager"</em></span> and
	  <span class="emphasis"><em>"server status"</em></span> modules.
	  Looking at file
	  <code class="filename">src/common/lixa_trace.h</code>:
	  </p><pre class="screen">
#define LIXA_TRACE_MOD_SERVER_LISTENER    0x00000004
#define LIXA_TRACE_MOD_SERVER_MANAGER     0x00000008
#define LIXA_TRACE_MOD_SERVER_STATUS      0x00000010
	  </pre><p>
	  the resulting value is 0x0000001C:
	  </p><pre class="screen">
export LIXA_TRACE_MASK=0x00000010
	  </pre><p>
	  The <span class="emphasis"><em>"trace all"</em></span> value is 0xffffffff:
	  </p><pre class="screen">
export LIXA_TRACE_MASK=0xffffffff
	  </pre><p>
	  </p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>
	      Too much tracing is dangerous: it slows down your system and
	      possibly fills-up your filesystems.
	  </p></div><p>
	  Establishing the internal modules that must be traced is a typical
	  troubleshooting task you can acquire working with LIXA project.
	  In <a class="xref" href="#Tracing" title="Tracing">the section called “Tracing”</a> you can discover some useful information
	  related to the usage of this environment variable.
	</p></div></div><div class="footnotes"><br /><hr style="width:100; text-align:left;margin-left: 0" /><div id="ftn.idp67457520" class="footnote"><p><a href="#idp67457520" class="para"><sup class="para">[15] </sup></a>
	      The dashed box named "Transaction Manager" was removed to
	      simplify the picture.
	  </p></div><div id="ftn.idp67464960" class="footnote"><p><a href="#idp67464960" class="para"><sup class="para">[16] </sup></a>
	  Both the files reside in <code class="filename">/opt/lixa/etc/</code>
	  directory and must be managed by
	  <code class="systemitem">lixa</code> user, the
	  LIXA administrative user
      </p></div><div id="ftn.idp67467392" class="footnote"><p><a href="#idp67467392" class="para"><sup class="para">[17] </sup></a>
	  The standard installation procedure installs both the files with
	  default content; it's your responsability to customize the content
	  of the files.
      </p></div></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="idp67590288"></a>Chapter 4. Execution</h1></div></div></div><p>
    Once you have installed (see <a class="xref" href="#Installation" title="Chapter 2. Installation">Chapter 2, <em>Installation</em></a>)
    and configured (see <a class="xref" href="#Configuration" title="Chapter 3. Configuration">Chapter 3, <em>Configuration</em></a>)
    your environment, you are ready to run LIXA.
    </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	In this chapter it is assumed you installed the LIXA project
	software at the default path <code class="filename">/opt/lixa</code>; if you
	installed the software at a different path, you'd need to adjust
	the shown commands consequently.
    </p></div><p>
  </p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp67593008"></a>Starting the state server (<span class="command"><strong>lixad</strong></span>)</h2></div></div></div><p>
      The first step you must perform is starting the
      <span class="emphasis"><em>state server</em></span>; it's name is 
      <span class="command"><strong>lixad</strong></span> (LIXA daemon). The command
    </p><pre class="screen">
tiian@ubuntu:~$ /opt/lixa/sbin/lixad --help
Usage:
  lixad [OPTION...] - LIXA server

Help Options:
  -?, --help             Show help options

Application Options:
  -d, --daemon           Run the process as a daemon
  -m, --maintenance      Start the server in maintenance mode only
  -u, --dump             Dump the content of status files using order [ufs] (u=used, f=free, s=sequential)
  -c, --config-file      Specify an alternate configuration file
  -t, --trace-file       Specify trace file name
  -l, --clean-failed     Clean recovery failed transactions at start-up
  -v, --version          Print package info and exit
    </pre><p>
      displays the available command line options. 
    </p><p>
      If you tried to start the state server without the appropriate 
      privileges it should happen something like this:
      </p><pre class="screen">
tiian@ubuntu:~$ /opt/lixa/sbin/lixad
tiian@ubuntu:~$ sudo su -c "tail /var/log/daemon.log"
[...]
Mar 31 22:53:10 ubuntu lixad[5891]: LXD000N this process is starting a new LIXA server (lixa package version is 0.5.29)
Mar 31 22:53:10 ubuntu lixad[5891]: LXD015W unable to open pid file '/opt/lixa/var/run.pid'
Mar 31 22:53:10 ubuntu lixad[5891]: LXD004E error (ERROR: 'open' function returned an error condition) while starting manager(s), premature exit
      </pre><p>
      because the process is not able to update the content of the
      <code class="filename">/opt/lixa/var/</code> directory; use the administrative
      user and try again:
      </p><pre class="screen">
tiian@ubuntu:~$ sudo su - lixa
[sudo] password for tiian:
lixa@ubuntu:~$ /opt/lixa/sbin/lixad
      </pre><p>
      Running the command
      without options blocks your shell and runs the state server in
      foreground; this is not terribly useful but it may help you when
      you are debugging some issue. Use these commands, from a different
      terminal, to retrieve the PID
      (process id) and to stop the state server:
    </p><pre class="screen">
tiian@ubuntu:~$ sudo su - lixa
lixa@ubuntu:~$ ps -ef|grep lixad|grep -v grep
lixa      5909  5906  0 22:56 pts/1    00:00:00 /opt/lixa/sbin/lixad
lixa@ubuntu:~$ kill 5909
lixa@ubuntu:~$ exit
logout
    </pre><p>
      Alternatively you can strike ^C to break the foreground execution.
      A foreground execution is generally more useful if some 
      tracing is enabled:
    </p><pre class="screen">
lixa@ubuntu:~$ export LIXA_TRACE_MASK=0x00000001
lixa@ubuntu:~$ /opt/lixa/sbin/lixad 
2011-03-31 22:58:32.244333 [5920/3073509104] lixad/main: starting
2011-03-31 22:58:34.864062 [5920/3073509104] lixad/main: exiting
    </pre><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Background_execution"></a>Background (<span class="emphasis"><em>daemon</em></span>) execution</h3></div></div></div><p>
	The most useful command option is <code class="option">--daemon</code>: it
	allows you to run the state server as a <span class="emphasis"><em>daemon</em></span>
	detached from any terminal:
      </p><pre class="screen">
lixa@ubuntu:~$ /opt/lixa/sbin/lixad --daemon
lixa@ubuntu:~$ ps -ef|grep lixad|grep -v grep
lixa      5926     1  0 22:59 ?        00:00:00 /opt/lixa/sbin/lixad --daemon
      </pre><p>
	when running the state server as a daemon you need to perform some 
	special tasks to understand the process is up &amp; running.
	With <span class="command"><strong>ps -ef|grep lixad|grep -v grep</strong></span> you can
	verify the process is running.
	The state server registers its PID in a special file:
	<code class="filename">/opt/lixa/var/run.pid</code>; if the content of the file
	is different than the result retrieved with the <span class="command"><strong>grep</strong></span>
	command, something is not running well.
      </p><pre class="screen">
lixa@ubuntu:~$ cat /opt/lixa/var/run.pid 
5926
      </pre><p>
	To stop a daemonized state server you must use the
	<span class="command"><strong>kill</strong></span> command as shown below:
      </p><pre class="screen">
lixa@ubuntu:~$ kill $(cat /opt/lixa/var/run.pid)
lixa@ubuntu:~$ ps -ef|grep lixad|grep -v grep
      </pre><p>
	The <span class="command"><strong>grep</strong></span> command returns an empty result because
	the state server is not running. The state server publishes some
	messages using the <code class="function">syslog</code> facility; Ubuntu 8.04
	sends default messages to the file
	<code class="filename">/var/log/daemon.log</code>; below there are some standard
	messages:
      </p><pre class="screen">
tiian@ubuntu:~$ sudo su -c "cat /var/log/daemon.log|grep lixad|grep 5926"
Mar 31 22:59:11 ubuntu lixad[5926]: LXD014N LIXA server entered daemon status
Mar 31 23:00:48 ubuntu lixad[5926]: LXD019N received signal 15, server immediate shutdown in progress...
Mar 31 23:00:48 ubuntu lixad[5926]: LXD006N server terminated activities
      </pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Maintenance_mode_execution"></a>Maintenance mode execution</h3></div></div></div><p>
	The <code class="option">--maintenance</code> option allows you to start
	the state server to perform some special actions; only special
	clients can connect to the server when the server is operating
	in <span class="emphasis"><em>maintenance</em></span> mode: customer developed
	Application Programs can not perform distributed transactions.
	A special client is <span class="command"><strong>lixar</strong></span>: a command line
	utility designed for recovery purposes
	(see <a class="xref" href="#Recovery" title="Chapter 8. Recovery">Chapter 8, <em>Recovery</em></a> for more information).
      </p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3>
	A state server that's operating in maintenance mode is not
	serving the LIXA infrastructure and Distributed Transaction
	Processing can not be performed: use this option 
	<span class="emphasis"><em>only</em></span> if you really need it.
      </div><p>
	There's no way to turn a server operating in maintenance mode in
	a server operating in standard mode: you have to stop and start
	the LIXA state server again.
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="lixad_dump_execution"></a>Dump execution</h3></div></div></div><p>
	Use <code class="option">--dump</code> option to get a dump of the content
	of the state currently persisted in the status files. The option
	must specify one or more flags:
	</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	      "s": dump all the blocks, in sequential order
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      "u": dump all the <span class="emphasis"><em>used</em></span> blocks, 
	      travelling the used block chain
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      "f": dump all the <span class="emphasis"><em>free</em></span> blocks, 
	      travelling the free block chain
	  </p></li></ul></div><p>
	You may specify two or more flags on the same command line:
	the output will duplicate some blocks.
      </p><p>
	The example below shows the output produced when dumping the
	content of a single status file with no current transactions
	in progress (the free block chain contains all the blocks):
      </p><pre class="screen">
tiian@ubuntu:~$ sudo su - lixa
lixa@ubuntu:~$ /opt/lixa/sbin/lixad --dump f
========================================================================
First file ('/opt/lixa/var/lixad_status1_1') will be dumped
Magic number is: 24848 (24848)
Level is: 1 (1)
Last sync timestamp: 2011-03-31T23:00:48.829787+0200
Size: 10 blocks
Used block chain starts at: 0 (empty chain)
Free block chain starts at: 1
Dumping records following physical order: 0
Dumping records following free block chain: 1
Dumping records following used block chain: 0
------------------------------------------------------------------------
Block: 1, next block in chain: 2
Block type: unknown (0)
------------------------------------------------------------------------
Block: 2, next block in chain: 3
Block type: unknown (0)
------------------------------------------------------------------------
Block: 3, next block in chain: 4
Block type: unknown (0)
------------------------------------------------------------------------
Block: 4, next block in chain: 5
Block type: unknown (0)
------------------------------------------------------------------------
Block: 5, next block in chain: 6
Block type: unknown (0)
------------------------------------------------------------------------
Block: 6, next block in chain: 7
Block type: unknown (0)
------------------------------------------------------------------------
Block: 7, next block in chain: 8
Block type: unknown (0)
------------------------------------------------------------------------
Block: 8, next block in chain: 9
Block type: unknown (0)
------------------------------------------------------------------------
Block: 9, next block in chain: 0
Block type: unknown (0)
      </pre><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
	The dump can be performed while the state server is running:
	the dump will output the content of the currently sinchronized
	status file and you will not be able to see the last updates.
	Dumps performed at different times may produce different
	results if there is a running state server.
      </div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp67628560"></a>Additional options</h3></div></div></div><p>
	Some additional options are available: they don't radically change the 
	state server behavior, but supply some features.
      </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp67629904"></a>Specifying a different configuration file</h4></div></div></div><p>
	  With option <code class="option">--config-file</code> you can specify a
	  non default configuration file; this option can be useful if you
	  want to test a different configuration without damaging your
	  production config file. It can be used if you want to
	  run different instances of the state server in the same
	  operating system image, too.
	</p><p>
	  Below there is a sample invocation:
	</p><pre class="screen">
lixa@ubuntu:~$ /opt/lixa/sbin/lixad --config-file /tmp/lixad_conf.xml
	</pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp67632880"></a>Specifying a trace file</h4></div></div></div><p>
	  With option <code class="option">--trace-file</code> you can specify a
	  different trace file instead of the default 
	  <span class="emphasis"><em>stderr</em></span>
	  process stream; this option is especially useful when you are
	  running the state server as a daemon (see
	  <a class="xref" href="#Background_execution" title="Background (daemon) execution">the section called “Background (<span class="emphasis"><em>daemon</em></span>) execution”</a>).
	  Below there is a sample invocation:
	</p><pre class="screen">
lixa@ubuntu:~$ export LIXA_TRACE_MASK=0x01
lixa@ubuntu:~$ /opt/lixa/sbin/lixad --daemon --trace-file /tmp/lixad.trace
lixa@ubuntu:~$ ls -la /tmp/lixad.trace
-rw-r--r-- 1 lixa lixa 349 2011-03-18 16:14 /tmp/lixad.trace
	</pre><p>
	  Take a look to
	  <a class="xref" href="#Tracing" title="Tracing">the section called “Tracing”</a>
	  for additional details.
	</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp67637808"></a>Clean-up recovery failed transactions</h4></div></div></div><p>
	  Use option <code class="option">--clean-failed</code> to clean-up the
	  state of the transactions that LIXA was not able to recover
	  automatically: this option is useful to remove useless information
	  from the state file, but you must pay attention to these
	  <span class="emphasis"><em>warnings</em></span>.
	  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
		If your LIXA installation worked properly, you would not
		need to clean-up the state file.
	    </p></li><li class="listitem" style="list-style-type: disc"><p>
		Removing recovery failed transactions cleans-up the history
		of your issues: you should understand why your state file
		is accumulating recovery failed transaction records
		need to clean-up the state file.
	    </p></li></ul></div><p>
	  Don't use this option without a deep review of the content of
	  <a class="xref" href="#Recovery" title="Chapter 8. Recovery">Chapter 8, <em>Recovery</em></a>.	  
	</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp67643168"></a>Retrieving software version</h4></div></div></div><p>
	  Use option <code class="option">--version</code> to retrieve the 
	  version of the installed software as shown below:
	</p><pre class="screen">
lixa@ubuntu:~$ /opt/lixa/sbin/lixad --version
LIXA: a Libre XA implementation
Copyright (c) 2009-2012, Christian Ferrari; all rights reserved.
License: GPL (GNU Public License) version 2
Package name: lixa; package version: 0.5.29
Access http://sourceforge.net/projects/lixa/ to report bugs and partecipate to the project
	</pre><p>
	  The <span class="command"><strong>lixad</strong></span> command does not start a real state 
	  server: it prints version information on 
	  <span class="emphasis"><em>stdout</em></span> and exits.
	</p></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Starting_test_utility"></a>Starting the test utility (<span class="command"><strong>lixat</strong></span>)</h2></div></div></div><p>
      The LIXA project supplies a test utility you can use to 
      perform basic tests on your LIXA environment. 
      The command is named <span class="command"><strong>lixat</strong></span> and is
      located in the <code class="filename">bin</code> directory; use 
      <code class="option">--help</code> option to retrieve the list of 
      the available options:
    </p><pre class="screen">
tiian@ubuntu:~$ /opt/lixa/bin/lixat --help
Usage:
  lixat [OPTION...] - LIXA test utility

Help Options:
  -?, --help                  Show help options

Application Options:
  -c, --commit                Perform a commit transaction
  -r, --rollback              Perform a rollback transaction
  -v, --version               Print package info and exit
  -b, --benchmark             Perform benchmark execution
  -o, --open-close            Execute tx_open &amp; tx_close for every transaction [benchmark only]
  -s, --csv                   Send result to stdout using CSV format [benchmark only]
  -l, --clients               Number of clients (threads) will stress the state server [benchmark only]
  -d, --medium-delay          Medium (random) delay between TX functions [benchmark only]
  -D, --delta-delay           Delta (random) delay between TX functions [benchmark only]
  -p, --medium-processing     Medium (random) delay introduced by Resource Managers operations between tx_begin and tx_commit/tx_rollback [benchmark only]
  -P, --delta-processing      Delta (random) delay introduced by Resource Managers operations between tx_begin and tx_commit/tx_rollback [benchmark only]
    </pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
	The LIXA test utility is a LIXA client program and it 
	does <span class="emphasis"><em>not</em></span> need
	any special authorization to run because it does not need to write
	the content of <code class="filename">/opt/lixa/var/</code> directory.
    </p></div><p>
      The <span class="command"><strong>lixat</strong></span> command does nothing useful except trying 
      to contact the state server and optionally perform a commit and/or 
      rollback dummy distributed transaction
      <a href="#ftn.idp67654672" class="footnote" id="idp67654672"><sup class="footnote">[18]</sup></a>.
      Below there's the output of a trivial execution: the program connects
      to the state server, performs tx_open() against all the configured 
      resource managers and performs tx_close() against all the configured
      resource managers.
    </p><pre class="screen">
tiian@ubuntu:~$ /opt/lixa/bin/lixat
tx_open(): 0
tx_close(): 0
    </pre><p>
      With <code class="option">--commit</code> option the test program performs a
      dummy commit against all the configured resource managers too:
    </p><pre class="screen">
tiian@ubuntu:~$ /opt/lixa/bin/lixat --commit
tx_open(): 0
tx_begin(): 0
tx_info(): 1
        xid/formatID.gtrid.bqual = 1279875137.080f2b63a3804bfbbdd3347ca7607ba3.ef954655163edff9fee662b12f881c97
tx_commit(): 0
tx_close(): 0
    </pre><p>
      A <span class="emphasis"><em>dummy commit</em></span> does not damage your data because
      the program does not contains instructions that modify the content
      of the resource managers. A dummy rollback can be performed as well:
    </p><pre class="screen">
tiian@ubuntu:~$ /opt/lixa/bin/lixat --rollback
tx_open(): 0
tx_begin(): 0
tx_info(): 1
        xid/formatID.gtrid.bqual = 1279875137.c651f0f2efb249bd92f3f2b5a76741a5.ef954655163edff9fee6-62b12f881c97
tx_rollback(): 0
tx_close(): 0
    </pre><p>
      The test utility can be used to:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	    check the state server is up and running
	    </p><pre class="screen">
	      tiian@ubuntu:~$ /opt/lixa/bin/lixat
	      tx_open(): -7
	      tiian@ubuntu:~$ echo $?
	      1
	    </pre><p>
	    (the state server is not running)
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	    check the content of <code class="filename">etc/lixac_conf.xml</code>
	    is ok
	    </p><pre class="screen">
	      tiian@ubuntu:~$ export LIXA_PROFILE=XXXX
	      tiian@ubuntu:~$ /opt/lixa/bin/lixat
	      tx_open(): -7
	      tiian@ubuntu:~$ echo $?
	      1
	    </pre><p>
	    (the profile <span class="quote">“<span class="quote">XXXX</span>”</span> does not exist)
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	    try different profiles described inside
	    <code class="filename">etc/lixac_conf.xml</code>
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	    ...
	</p></li></ul></div><p>
      You can <span class="emphasis"><em>safely</em></span> experiment by yourself using 
      <span class="command"><strong>lixat</strong></span> command.
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp67647616"></a>Starting the recovery utility (<span class="command"><strong>lixar</strong></span>)</h2></div></div></div><p>
      The LIXA project supplies a recovery utility you must use to 
      perform some special tasks related to distributed transaction
      recovery. The command is named <span class="command"><strong>lixar</strong></span> and is
      located in the <code class="filename">bin</code> directory; use 
      <code class="option">--help</code> option to retrieve the list of 
      the available options:
    </p><pre class="screen">
tiian@ubuntu:~$ /opt/lixa/bin/lixar --help
Usage:
  lixar [OPTION...] - LIXA recovery utility

Help Options:
  -?, --help                      Show help options

Application Options:
  -p, --print                     Print a report of all the prepared and in-doubt transactions compatible with current configuration and profile
  -x, --xid                       Select specified transaction for rollback/commit
  -X, --xid-file                  Select specified file as a list of transaction to rollback/commit
  -c, --commit                    Commit prepared &amp; in-doubt transactions
  -r, --rollback                  Rollback prepared &amp; in-doubt transactions
  -v, --version                   Print package info and exit
  -b, --bypass-bqual-check        Bypass xid branch qualifier check
  -B, --bypass-formatid-check     Bypass xid format id check
  -e, --use-tmendrscan-flag       Use TMENDRSCAN flag for last xa_recover call
    </pre><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
	The LIXA test utility is a LIXA client program and it does 
	<span class="emphasis"><em>not</em></span> need
	any special authorization to run because it does not need to write
	the content of <code class="filename">/opt/lixa/var/</code> directory.
    </p></div><p>
      The usage of the <span class="command"><strong>lixar</strong></span> command is strictly related
      to <span class="emphasis"><em>recovery</em></span> tasks and is explained in
      <a class="xref" href="#Recovery" title="Chapter 8. Recovery">Chapter 8, <em>Recovery</em></a>.
    </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3>
      All the option except <code class="option">--commit</code> and 
      <code class="option">--rollback</code> are <span class="emphasis"><em>safe</em></span>; only
      specifying <span class="quote">“<span class="quote">commit</span>”</span> and <span class="quote">“<span class="quote">rollback</span>”</span> can
      damage the state of the data managed by your resource managers.
    </div><p>
      You must start the state server before you can start 
      <span class="command"><strong>lixar</strong></span>; if you don't start the state server, you
      will get something like shown below:
    </p><pre class="screen">
tiian@ubuntu:~$ /opt/lixa/bin/lixar
Execution options:
        - print report = no
        - transaction(s) will be committed = no
        - transaction(s) will be rolled back = no
        - bypass xid branch qualifier check = no
        - bypass xid format id check = no
        - use TMENDRSCAN flag for last xa_recover call = no

tx_open() returned TX_FAIL: unable to proceed
    </pre></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp67680576"></a>Starting the transaction monitoring utility (<span class="command"><strong>lixatpm</strong></span>)</h2></div></div></div><p>
      The LIXA project provides this utility to list all global transactions and their
      related branches. Once the xid is known, the <span class="command"><strong>lixar</strong></span> utility
      can be used to perform recovery operations.
      The command is named <span class="command"><strong>lixatpm</strong></span> and is located in the
      <code class="filename">bin</code> directory; use 
      <code class="option">--help</code> option to retrieve the list of 
      the available options:
    </p><pre class="screen">
tiian@ubuntu:~$ /opt/lixa/bin/lixatpm --help
Usage:
  lixatpm [OPTION...] - LIXA transaction process monitor client

Help Options:
  -h, --help       Show help options

Application Options:
  -r, --report     Report on all transactions linked to the current configuration and profile
    </pre><p>
      You must start the state server before you can start <span class="command"><strong>lixatpm</strong></span>.
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp67686192"></a>Starting the configuration utility (<span class="command"><strong>lixa-config</strong></span>)</h2></div></div></div><p>
      LIXA provides a configuration utility named 
      <span class="command"><strong>lixa-config</strong></span>. It can be used to retrieve some
      useful information necessary for other shell commands.
      Try it with <code class="option">--help</code> parameter:
      </p><pre class="screen">
[tiian@centos lixa]$ /opt/lixa/bin/lixa-config --help
Usage:
  lixa-config [OPTION...] - LIXA config utility

Help Options:
  -h, --help                       Show help options

Application Options:
  -c, --cflags                     [-Wall]
  -C, --config-dir                 [/opt/lixa/etc]
  -f, --cppflags                   [-I/opt/lixa/include]
  -i, --include-dir                [/opt/lixa/include]
  -d, --ldflags                    [-Wl,-rpath -Wl,/opt/lixa/lib]
  -L, --lib-dir                    [/opt/lixa/lib]
  -l, --libs                       [-L/opt/lixa/lib -llixac]
  -o, --include-dir-postgresql     [/usr/include]
  -p, --libs-postgresql            [-L/opt/lixa/lib -llixac -llixapq]
  -y, --include-dir-mysql          [/usr/include/mysql]
  -m, --libs-mysql                 [-L/opt/lixa/lib -llixac -llixamy]
  -P, --prefix                     [/opt/lixa]
  -s, --state-dir                  [/opt/lixa/var]
  -r, --rsrc-mngrs                 list of configured Resource Managers
      </pre><p>
      If you need to set a variable with the path containing LIXA libraries,
      simply use something like:
      </p><pre class="screen">
[tiian@centos lixa]$ export FOOBAR=$(/opt/lixa/bin/lixa-config --lib-dir)
[tiian@centos lixa]$ echo $FOOBAR
/opt/lixa/lib
      </pre><p>
      It may be useful when you installed two different version of LIXA
      inside the same host: pointing the right 
      <span class="command"><strong>lixa-config</strong></span> is sufficient to retrieve all the
      correlated info.
    </p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>
	The options related to PostgreSQL and MySQL would not appear if you
	didn't configure them at build time. This give you a simple way to
	determine if the LIXA is built with PostgreSQL/MySQL support:
	testing the return code (<span class="command"><strong>$?</strong></span>) of
	<span class="command"><strong>/opt/lixa/bin/lixa-config --libs-postgresql</strong></span> will
	return 0 or 1 (error, LIXA not configured for PostgreSQL).
      </p></div></div><div class="footnotes"><br /><hr style="width:100; text-align:left;margin-left: 0" /><div id="ftn.idp67654672" class="footnote"><p><a href="#idp67654672" class="para"><sup class="para">[18] </sup></a>
	  <span class="command"><strong>lixat</strong></span> can be used <span class="quote">“<span class="quote">in benchmark mode</span>”</span>
	  as well, but that usage is explained in
	  <a class="xref" href="#Tuning_example" title="A tuning example">the section called “A tuning example”</a>
      </p></div></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="Development"></a>Chapter 5. Developing C Application Programs</h1></div></div></div><p>
    This chapter explains how you can develop your own C application
    using the libraries and the tools supplied by LIXA project.
  </p><p>
    LIXA project ships some example C programs you can find in 
    directory
    <code class="filename">/opt/lixa/share/doc/lixa-X.Y.Z/examples/</code> after
    software installation (see <a class="xref" href="#Installation" title="Chapter 2. Installation">Chapter 2, <em>Installation</em></a>).
  </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
    This chapter is focused on the C programming language. The COBOL 
    programming language is addressed by another dedicated chapter.
  </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp67698288"></a>The TX (Transaction Demarcation) Specification</h2></div></div></div><p>
      LIXA project adopts the standard described in 
      [<a class="citation" href="#idp70061648"><span class="citation">TXspec</span></a>] as the API you should use when developing
      an Application Program.
    </p><p>
      The API is very easy, it supplies C functions and COBOL routines.
      The following C example can be briefly explained:
      </p><pre class="programlisting">
/* include this header: it's the header associated to The TX (Transaction
   Demarcation) Specification */
#include &lt;tx.h&gt;

/* your stuff */

int main(int argc, char *argv[])
{
        /* use an int variable to pick-up function return code */
        int rc;
        
        /* use tx_open() to open ALL the Resource Managers associated to
           the current LIXA_PROFILE */
        if (TX_OK != (rc = tx_open()))
                /* this is an error, manage it! */

        /* put your stuff here ... */

        /* this function delimits the transaction begin */
        if (TX_OK != (rc = tx_begin()))
                /* this is an error, manage it! */

        /* put your commands about the Resource Managers here ... */

        /* this function commits the modification operated by the
           Resource Managers */
        if (TX_OK != (rc = tx_commit()))
                /* this is an error, manage it! */
        /* you can use tx_rollback() instead of tx_commit() if you decide
           the work must be rolled back */

        /* put here other transactions if you need them (loops are possible
           too) */

        /* use tx_close() to close ALL the Resource Managers associated to
           the current LIXA_PROFILE */
}
      </pre><p>
      These are the available C functions (the descriptions come from
      [<a class="citation" href="#idp70061648"><span class="citation">TXspec</span></a>]):
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	    <code class="function">tx_begin</code>: begin a global transaction
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	    <code class="function">tx_close</code>: close a set of resource managers
 	</p></li><li class="listitem" style="list-style-type: disc"><p>
	    <code class="function">tx_commit</code>: commit a global transaction
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	    <code class="function">tx_info</code>: return global transaction information
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	    <code class="function">tx_open</code>: open a set of resource managers
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	    <code class="function">tx_rollback</code>: roll back a global transaction
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	    <code class="function">tx_set_commit_return</code>: set 
	    <em class="parameter"><code>commit_return</code></em> 
	    characteristic
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	    <code class="function">tx_set_transaction_control</code>: set
	    <em class="parameter"><code>transaction_control</code></em> 
	    characteristic
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	    <code class="function">tx_set_transaction_timeout</code>: set
	    <em class="parameter"><code>transaction_timeout</code></em> 
	    characteristic
	</p></li></ul></div><p>
      Refer to [<a class="citation" href="#idp70061648"><span class="citation">TXspec</span></a>] for the complete description.
    </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp67714352"></a>Access to the resource managers</h3></div></div></div><p>
	A program developed for TX (Transaction Demarcation) Specification
	<span class="emphasis"><em>must</em></span> access the resource managers coordinated by
	the transaction manager using specific functions.
	Unfortunately, the TX Specification does <span class="emphasis"><em>not</em></span>
	specify a standard unified method to access a coordinated resource
	manager. 
      </p><p>
	Tipically, every resource manager provides its own specific
	function(s) to retrieve one or more <span class="emphasis"><em>connection 
	  handler(s)</em></span>. Once you have got the right connection
	handler(s), you can use the resource manager as you use without a
	transaction manager.
      </p><p>
	The supplied examples (see <code class="filename">doc/examples</code> directory)
	show the functions that must be used to
	retrieve the connection handler(s) necessary to interact with
	the resource managers.
      </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	  Special attention must be payed to <span class="emphasis"><em>commit</em></span> and
	  <span class="emphasis"><em>rollback</em></span> operations: a well designed program
	  developed for TX (Transaction Demarcation) Specification must not
	  specify the resource manager native version of 
	  <span class="emphasis"><em>commit</em></span> and <span class="emphasis"><em>rollback</em></span> 
	  operations.
	  If your software violates this rule, your environment will
	  generate warning conditions related to euristically completed
	  transaction. If your software forces a resource manager to
	  <span class="emphasis"><em>commit</em></span> or <span class="emphasis"><em>rollback</em></span> 
	  outside the control of the transaction manager, the transaction
	  manager will not be able to perform the opposite operation if
	  asked to do it. These situations tend to generate inconsistencies.
      </p></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="linkage"></a>LIXA library linkage</h2></div></div></div><p>
      The examples showed in this chapter use these linkage options:
      <code class="option">-Wl,-rpath -Wl,/opt/lixa/lib</code>
      dynamically generated by 
      <span class="command"><strong>/opt/lixa/bin/lixa-config -d</strong></span>
      (<span class="command"><strong>/opt/lixa/bin/lixa-config --ldflags</strong></span>).
      The options are specific to <span class="command"><strong>gcc</strong></span> and 
      <span class="command"><strong>ld</strong></span> Linux linker.
      Alternatively you can avoid these options and set
      <code class="varname">LD_LIBRARY_PATH</code> environment variable.
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp67728496"></a>The first example</h2></div></div></div><div class="figure"><a id="develop1"></a><p class="title"><strong>Figure 5.1. Deploy model of an example with two dummy resource managers</strong></p><div class="figure-contents"><div class="mediaobject"><img src="../images/LIXA_Development_1.png" alt="Deploy model of an example with two dummy resource managers" /></div></div></div><br class="figure-break" /><p>
      Create a working directory in a place you are comfortable with:
      </p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~$ cd
tiian@ubuntu:~$ mkdir tmp
tiian@ubuntu:~$ cd tmp
tiian@ubuntu:~/tmp$
	</pre></td></tr></tbody></table></div><p>
    </p><p>
      Copy file <code class="filename">example1.c</code> in your working dir:
      </p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ cp /opt/lixa/share/doc/lixa-X.Y.Z/examples/example1.c .
	</pre></td></tr></tbody></table></div><p>
      Substitute <span class="quote">“<span class="quote">lixa-X.Y.Z</span>”</span> with the actual version of
      the software you installed.
    </p><p>
      Compile and link the C example program:
      </p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ gcc example1.c $(/opt/lixa/bin/lixa-config -c -f -l -d) -o example1
	</pre></td></tr></tbody></table></div><p>
      Check the output of the linker:
      </p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ ldd example1
        linux-gate.so.1 =&gt;  (0xb773f000)
        liblixac.so.0 =&gt; /opt/lixa/lib/liblixac.so.0 (0xb7724000)
        libc.so.6 =&gt; /lib/tls/i686/cmov/libc.so.6 (0xb75d0000)
        libgmodule-2.0.so.0 =&gt; /usr/lib/libgmodule-2.0.so.0 (0xb75cb000)
        libdl.so.2 =&gt; /lib/tls/i686/cmov/libdl.so.2 (0xb75c7000)
        libgthread-2.0.so.0 =&gt; /usr/lib/libgthread-2.0.so.0 (0xb75c2000)
        librt.so.1 =&gt; /lib/tls/i686/cmov/librt.so.1 (0xb75b9000)
        libglib-2.0.so.0 =&gt; /usr/lib/libglib-2.0.so.0 (0xb7508000)
        libxml2.so.2 =&gt; /usr/lib/libxml2.so.2 (0xb73e8000)
        liblixab.so.0 =&gt; /opt/lixa/lib/liblixab.so.0 (0xb73d4000)
        libpthread.so.0 =&gt; /lib/tls/i686/cmov/libpthread.so.0 (0xb73bc000)
        /lib/ld-linux.so.2 (0xb7740000)
        libpcre.so.3 =&gt; /usr/lib/libpcre.so.3 (0xb7395000)
        libz.so.1 =&gt; /usr/lib/libz.so.1 (0xb7380000)
        libm.so.6 =&gt; /lib/tls/i686/cmov/libm.so.6 (0xb735b000)
        libuuid.so.1 =&gt; /lib/libuuid.so.1 (0xb7356000)
	</pre></td></tr></tbody></table></div><p>
      Now you are ready to start your first application:
      </p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ ./example1
tx_open(): -7
	</pre></td></tr></tbody></table></div><p>
      The <code class="function">tx_open()</code> function returned the value 
      <span class="quote">“<span class="quote">-7</span>”</span> (<code class="constant">TX_FAIL</code>) 
      because the state server is not running.
      Start the state server (see <a class="xref" href="#Background_execution" title="Background (daemon) execution">the section called “Background (<span class="emphasis"><em>daemon</em></span>) execution”</a>)
      and try again:
      </p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session (Ubuntu)]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ sudo su - lixa
lixa@ubuntu:~$ /opt/lixa/sbin/lixad --daemon
lixa@ubuntu:~$ exit
logout
tiian@ubuntu:~/tmp$ ps -ef|grep lixad|grep -v grep
lixa     12866     1  0 21:35 ?        00:00:00 /opt/lixa/sbin/lixad --daemon
tiian@ubuntu:~/tmp$ ./example1
tx_open(): 0
tx_begin(): 0
tx_info(): 1
xid.formatID: 1279875137
xid.gtrid_length: 16
xid.bqual_length: 16
when_return: 0 (TX_COMMIT_COMPLETED)
transaction_control: 0 (TX_UNCHAINED)
transaction_timeout: 0 s
transaction_state: 0 (TX_ACTIVE)
tx_commit(): 0
tx_info(): 0
xid.formatID: -1
xid.gtrid_length: 0
xid.bqual_length: 0
when_return: 0 (TX_COMMIT_COMPLETED)
transaction_control: 0 (TX_UNCHAINED)
transaction_timeout: 0 s
transaction_state: 0 (TX_ACTIVE)
tx_set_commit_return(): 1
tx_set_transaction_timeout(): 0
tx_set_transaction_control(): 0
tx_info(): 0
xid.formatID: -1
xid.gtrid_length: 0
xid.bqual_length: 0
when_return: 0 (TX_COMMIT_COMPLETED)
transaction_control: 1 (TX_CHAINED)
transaction_timeout: 5 s
transaction_state: 0 (TX_ACTIVE)
tx_set_transaction_control(): 0
tx_info(): 0
xid.formatID: -1
xid.gtrid_length: 0
xid.bqual_length: 0
when_return: 0 (TX_COMMIT_COMPLETED)
transaction_control: 0 (TX_UNCHAINED)
transaction_timeout: 5 s
transaction_state: 0 (TX_ACTIVE)
tx_begin(): 0
tx_rollback(): 0
tx_close(): 0
	</pre></td></tr></tbody></table></div><p>
      Your first program has connected to the state server and has performed
      two dummy distributed transactions: <span class="emphasis"><em>commit</em></span> and 
      <span class="emphasis"><em>rollback</em></span>.
    </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="first_example_details"></a>Some details about the example</h3></div></div></div><p>
	You have not specified a specific profile:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ echo $LIXA_PROFILE
	  </pre></td></tr></tbody></table></div><p>
	The LIXA client library used the default one, the first listed in
	<code class="filename">etc/lixac_conf.xml</code>. If you inspected the 
	configuration file <code class="filename">/opt/lixa/etc/lixac_conf.xml</code> 
	you would see something like this:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ cat /opt/lixa/etc/lixac_conf.xml
&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;client&gt;
  &lt;sttsrvs&gt;
    &lt;sttsrv name="local_1" domain="AF_INET" address="127.0.0.1" port="2345" /&gt;
[...]
    &lt;rsrmgr name="LIXAdummyRM" switch_file="/opt/lixa/lib/switch_lixa_dummyrm.so" xa_open_info="dummy open string" xa_close_info="dummy close string" /&gt;
[...]
  &lt;profiles&gt;
    &lt;profile name="CF05"&gt;
      &lt;sttsrvs&gt;
        &lt;sttsrv&gt;local_1&lt;/sttsrv&gt;
      &lt;/sttsrvs&gt;
      &lt;rsrmgrs&gt;
        &lt;rsrmgr&gt;LIXAdummyRM&lt;/rsrmgr&gt;
        &lt;rsrmgr&gt;LIXAdummyRM&lt;/rsrmgr&gt;
      &lt;/rsrmgrs&gt;
    &lt;/profile&gt;
    &lt;profile name="GT71"&gt;
[...]
  &lt;/profiles&gt;
&lt;/client&gt;
	  </pre></td></tr></tbody></table></div><p>
	The default profile is named <span class="quote">“<span class="quote">CF05</span>”</span> and lists two
	resource managers of the same type: <span class="quote">“<span class="quote">LIXAdummyRM</span>”</span>;
	the related switch file is the file 
	<code class="filename">/opt/lixa/lib/switch_lixa_dummyrm.so</code>.
	The dummy resource managers supplied by the LIXA project is
	a special trivial resource managers: it ever returns
	<code class="constant">XA_OK</code>. If you are interested in LIXA dummy
	Resource Manager implementation, take a look to the source file
	<code class="filename">src/client/switch/lixa/lixa_dummyrm.c</code>.
	To verify that the program is using the dummy resource manager,
	execute it with <code class="varname">LIXA_TRACE_MASK</code> environment
	variable set to <code class="constant">0x00008000</code>:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ export LIXA_TRACE_MASK=0x00008000
tiian@ubuntu:~/tmp$ ./example1
[...]
2011-04-05 22:07:59.953844 [29359/3073444096] client_config_load_switch
2011-04-05 22:07:59.953875 [29359/3073444096] client_config_load_switch: resource manager # 0, name='LIXAdummyRM', switch_file='/opt/lixa/lib/switch_lixa_dummyrm.so'
2011-04-05 22:07:59.954220 [29359/3073444096] client_config_load_switch: module address 0x804e410, function lixa_get_xa_switch found at address 0xb76dd790
2011-04-05 22:07:59.954254 [29359/3073444096] client_config_load_switch: lixa_getxa_switch()-&gt;name = 'lixa_dummyrm', lixa_get_xa_switch()-&gt;flags = 0
2011-04-05 22:07:59.954279 [29359/3073444096] client_config_load_switch: resource manager dynamically registers: false
2011-04-05 22:07:59.954302 [29359/3073444096] client_config_load_switch: resource manager does not support association migration: false
2011-04-05 22:07:59.954325 [29359/3073444096] client_config_load_switch: resource manager supports asynchronous operations: false
2011-04-05 22:07:59.954348 [29359/3073444096] client_config_load_switch: resource manager # 1, name='LIXAdummyRM', switch_file='/opt/lixa/lib/switch_lixa_dummyrm.so'
2011-04-05 22:07:59.954379 [29359/3073444096] client_config_load_switch: module address 0x804e410, function lixa_get_xa_switch found at address 0xb76dd790
2011-04-05 22:07:59.954405 [29359/3073444096] client_config_load_switch: lixa_getxa_switch()-&gt;name = 'lixa_dummyrm', lixa_get_xa_switch()-&gt;flags = 0
2011-04-05 22:07:59.954429 [29359/3073444096] client_config_load_switch: resource manager dynamically registers: false
2011-04-05 22:07:59.954451 [29359/3073444096] client_config_load_switch: resource manager does not support association migration: false
2011-04-05 22:07:59.954474 [29359/3073444096] client_config_load_switch: resource manager supports asynchronous operations: false
[...]
tx_open(): 0
tx_begin(): 0
tx_commit(): 0
tx_begin(): 0
tx_rollback(): 0
2011-04-05 22:08:00.128531 [29359/3073444096] client_unconfig
2011-04-05 22:08:00.128883 [29359/3073444096] client_unconfig: acquiring exclusive mutex
2011-04-05 22:08:00.129174 [29359/3073444096] client_config_unload_switch
2011-04-05 22:08:00.129399 [29359/3073444096] client_config_unload_switch: resource manager # 0, defined in config as 'LIXAdummyRM', module address 0x804e410, xa_switch-&gt;name='lixa_dummyrm', xa_switch-&gt;flags=0
2011-04-05 22:08:00.129594 [29359/3073444096] client_config_unload_switch: resource manager # 1, defined in config as 'LIXAdummyRM', module address 0x804e410, xa_switch-&gt;name='lixa_dummyrm', xa_switch-&gt;flags=0
2011-04-05 22:08:00.129852 [29359/3073444096] client_config_unload_switch/excp=1/ret_cod=0/errno=0
2011-04-05 22:08:00.130024 [29359/3073444096] client_unconfig/xmlCleanupParser
2011-04-05 22:08:00.130215 [29359/3073444096] client_unconfig: releasing exclusive mutex
2011-04-05 22:08:00.130371 [29359/3073444096] client_unconfig/excp=2/ret_cod=0/errno=0
tx_close(): 0
	  </pre></td></tr></tbody></table></div><p>
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Development_example2_ora"></a>Examples with Oracle Database Server</h2></div></div></div><p>
      This section contains many examples related to different configurations:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	  the Application Program can be executed inside the same system that
	  hosts the Resource Manager (Oracle Database) or in a different
	  system. The first configuration is named "local" and necessitates
	  only the Oracle Database Server software. The second configuration
	  is named "remote" or "network" and necessitates both the Oracle
	  Database Server and the Oracle Instant Client software
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	  the C Application Program can be developed using Oracle Call 
	  Interface (OCI) or using embedded SQL that must precompiled using
	  the Oracle Pro*C precompiler. OCI, Pro*C and XA are not compatible.
	</p></li></ul></div><p>
      The following picture shows the overall architecture from the logical
      point of view, but it's not a deploy model.
    </p><div class="figure"><a id="develop2"></a><p class="title"><strong>Figure 5.2. Deploy model of an example with Oracle Database Server</strong></p><div class="figure-contents"><div class="mediaobject"><img src="../images/LIXA_Development_2.png" alt="Deploy model of an example with Oracle Database Server" /></div></div></div><br class="figure-break" /><p>
      Using a real Resource Manager, like a DBMS, requires some extra effort
      because you have to set-up the environment needed by the Resource
      Manager. The examples explained in this section was developed using
      different configurations: 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	  Oracle Database 10g Release 2 and 11g Release 2 Express Edition 
	  using a <span class="emphasis"><em>local</em></span> connection
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	  Oracle Database 12c Release 1 (12.1) Standard Edition using a
	  <span class="emphasis"><em>remote (SqlNet)</em></span> connection
	</p></li></ul></div><p>
      If you use a different configuration, you will need to fix some of the
      details shown by these examples.
      </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	  If you did not yet installed the software provided by Oracle,
	  please refer to the official Oracle site to download the
	  software and to pick-up the information necessary to install 
	  and configure
	  the database. This manual does not give you information related
	  to Oracle technology: it is assumed that you have already installed 
	  and configured the database.
      </p></div><p>
      </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
      The LIXA software must be configured, compiled and installed to support 
      the Oracle Database Server resource manager as explained in 
      <a class="xref" href="#Linking_third_party_resource_managers" title="Linking third party resource managers">the section called “Linking third party resource managers”</a>.
      </p></div><p>
    </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp67783776"></a>Local configuration (Server) and OCI</h3></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="Development_setup_Oracle_environment"></a>Set-up the Oracle environment (server side)</h4></div></div></div><p>
	  The following example is based on Oracle XE 10.2 and 11.2, but
	  there shouldn't be too much differences with other Oracle
	  versions.
	</p><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idp67786448"></a>Start-up the Oracle server</h5></div></div></div><p>
	    If the database server was not running, you can start it
	    with these commands
	    </p><pre class="screen">
tiian@ubuntu:~/tmp$ sudo /etc/init.d/oracle-xe enable
tiian@ubuntu:~/tmp$ sudo /etc/init.d/oracle-xe start
Starting Oracle Net Listener.
Starting Oracle Database 10g Express Edition Instance.
	    </pre><p>
	    on some systems, like Ubuntu 10.04, you use somethig like
	    this:
	    </p><pre class="screen">
tiian@ubuntu:~/tmp$ sudo service oracle-xe enable
tiian@ubuntu:~/tmp$ sudo service oracle-xe start
Starting Oracle Net Listener.
Starting Oracle Database 11g Express Edition Instance.
	    </pre><p>
	  </p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idp67788992"></a>Create the XA related views</h5></div></div></div><p>
	    First of all you must be able to connect as <span class="quote">“<span class="quote">SYSDBA</span>”</span>
	    from a terminal session; the commands below show what happens when
	    I connect to the Oracle server using the user 
	    <code class="systemitem">sys</code> with password
	    <span class="quote">“<span class="quote">oracle</span>”</span>
	    <a href="#ftn.idp67792512" class="footnote" id="idp67792512"><sup class="footnote">[19]</sup></a>
	    <a href="#ftn.idp67795536" class="footnote" id="idp67795536"><sup class="footnote">[20]</sup></a>:
	      </p><pre class="screen">
tiian@ubuntu:~$ sudo su - oracle
oracle@ubuntu:~$ echo $ORACLE_HOME
/usr/lib/oracle/xe/app/oracle/product/10.2.0/server
oracle@ubuntu:~$ sqlplus "sys/oracle as sysdba"

SQL*Plus: Release 10.2.0.1.0 - Production on Thu Apr 7 22:23:56 2011

Copyright (c) 1982, 2005, Oracle.  All rights reserved.


Connected to:
Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production

SQL&gt; exit
Disconnected from Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production
	      </pre><p>
	      You must check the file <code class="filename">xaview.sql</code>:
	      </p><pre class="screen">
oracle@ubuntu:~$ ls -la $ORACLE_HOME/rdbms/admin/xaview.sql
-rw-r--r-- 1 oracle dba 1754 2006-02-24 06:18 /usr/lib/oracle/xe/app/oracle/product/10.2.0/server/rdbms/admin/xaview.sql
	      </pre><p>
	      It contains the SQL instructions necessary to create two specific
	      system views that could be not defined in your database; the
	      following commands are related to a database that contains
	      the desired views:
	      </p><pre class="screen">
oracle@ubuntu:~$ sqlplus "sys/oracle as sysdba"

SQL*Plus: Release 10.2.0.1.0 - Production on Thu Apr 7 22:32:45 2011

Copyright (c) 1982, 2005, Oracle.  All rights reserved.


Connected to:
Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production

SQL&gt; select * from v$pending_xatrans$;

no rows selected

SQL&gt; select * from v$xatrans$;

no rows selected

SQL&gt; exit
Disconnected from Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production
	      </pre><p>
	      If the command failed the views would be not defined and you
	      would get something like this:
	      </p><pre class="screen">
oracle@ubuntu:~$ sqlplus "sys/oracle as sysdba"

SQL*Plus: Release 10.2.0.1.0 - Production on Fri Apr 29 22:20:01 2011

Copyright (c) 1982, 2005, Oracle.  All rights reserved.


Connected to:
Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production

SQL&gt; select * from v$pending_xatrans$;
select * from v$pending_xatrans$
              *
ERROR at line 1:
ORA-00942: table or view does not exist


SQL&gt; select * from v$xatrans$;
select * from v$xatrans$
              *
ERROR at line 1:
ORA-00942: table or view does not exist


SQL&gt; exit
Disconnected from Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production
	      </pre><p>
	      you can create them with a command like this:
	      </p><pre class="screen">
oracle@ubuntu:~$ cat $ORACLE_HOME/rdbms/admin/xaview.sql | sqlplus "sys/oracle as sysdba"

SQL*Plus: Release 10.2.0.1.0 - Production on Fri Apr 29 22:25:48 2011

Copyright (c) 1982, 2005, Oracle.  All rights reserved.


Connected to:
Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production

SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; DROP VIEW v$xatrans$
*
ERROR at line 1:
ORA-00942: table or view does not exist


SQL&gt; DROP VIEW v$pending_xatrans$
*
ERROR at line 1:
ORA-00942: table or view does not exist


SQL&gt; SQL&gt; SQL&gt;   2    3    4    5    6    7    8
View created.

SQL&gt; SQL&gt; SQL&gt; SQL&gt;   2    3    4    5    6    7    8    9   10   11
View created.

SQL&gt; SQL&gt; SQL&gt; Disconnected from Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production
	      </pre><p>
	    </p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idp67804176"></a>Authorize the XA related views</h5></div></div></div><p>
	      The example programs supplied by the LIXA project are designed
	      to use the 
	      <code class="systemitem">hr</code> user; you 
	      <span class="emphasis"><em>must</em></span> grant
	      the necessary privileges to all the users you want to use for
	      your Application Programs. The below commands show how to grant
	      the necessary privileges to
	      <code class="systemitem">hr</code>:
	      </p><pre class="screen">
oracle@ubuntu:~$ sqlplus "sys/oracle as sysdba"

SQL*Plus: Release 10.2.0.1.0 - Production on Thu Apr 7 22:44:44 2011

Copyright (c) 1982, 2005, Oracle.  All rights reserved.


Connected to:
Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production

SQL&gt; grant select on dba_pending_transactions to hr;

Grant succeeded.

SQL&gt; grant select on v$pending_xatrans$ to hr;

Grant succeeded.

SQL&gt; grant select on v$xatrans$ to hr;

Grant succeeded.

SQL&gt; exit
Disconnected from Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production
	      </pre><p>
	    </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	      If the user
	      <code class="systemitem">hr</code> did not exist and
	      the above commands failed,
	      you should read Oracle documentation and pick-up the necessary
	      information to create it.
	    </p></div></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idp67810496"></a>Unlock <span class="quote">“<span class="quote"><code class="systemitem">hr</code></span>”</span> Oracle user</h5></div></div></div><p>
	      The example programs supplied by the LIXA project are designed
	      to use the 
	      <code class="systemitem">hr</code> user; it might be 
	      <span class="emphasis"><em>locked</em></span> after Oracle software installation.
	      The below commands show how to unlock it:
	      </p><pre class="screen">
oracle@ubuntu:~$ sqlplus "sys/oracle as sysdba"

SQL*Plus: Release 10.2.0.1.0 - Production on Thu Apr 7 22:44:44 2011

Copyright (c) 1982, 2005, Oracle.  All rights reserved.


Connected to:
Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production

SQL&gt; ALTER USER hr ACCOUNT UNLOCK;

User altered.

SQL&gt; ALTER USER hr IDENTIFIED BY hr;

User altered.

SQL&gt; exit
Disconnected from Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production
	      </pre><p>
	      You may perform the same operation using the graphical (web 
	      based) interface.
	      </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
		Newer Oracle database versions set a default password limit: 
		after such a limit, Oracle will start to issue
		<span class="command"><strong>ORA-28002</strong></span> messages and XA functions will
		return with an error like below:
		</p><pre class="screen">
215229.2063.1888967424.1:
ORA-28002: the password will expire within 6 days

215229.2063.1888967424.1:
xaolgn: XAER_RMERR; logon failed. ORA-28002.

215229.2063.1888967424.1:
xaoopen: return -3
		</pre><p>
		To avoid this potential error, configure your users in the
		right way.
	      </p></div><p>
	    </p></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="Development_start_LIXA_server"></a>Start the LIXA state server</h4></div></div></div><p>
	    Start the state server as shown below:
	    </p><pre class="screen">
tiian@ubuntu:~$ sudo su - lixa
lixa@ubuntu:~$ /opt/lixa/sbin/lixad --daemon
lixa@ubuntu:~$ ps -ef|grep lixad|grep -v grep
lixa      6787     1  0 17:36 ?        00:00:00 /opt/lixa/sbin/lixad --daemon
lixa@ubuntu:~$ exit
logout
	    </pre><p>
	  </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp67819024"></a>Build the client program</h4></div></div></div><p>
	    Prepare the client (Application Program) using the below commands
	    (<span class="command"><strong>gcc</strong></span> command was splitted on several lines 
	    using <span class="command"><strong>\</strong></span> to help readability, but you may use
	    a single line):
	    </p><div class="table"><table frame="box"><thead><tr><td>System configuration details:</td></tr></thead><tbody><tr><td>
		Local connection, Ubuntu 8.04, Oracle XE 10.2 Database Server
		<pre class="screen">
tiian@ubuntu:~$ mkdir tmp
tiian@ubuntu:~$ cd tmp
tiian@ubuntu:~/tmp$ cp /opt/lixa/share/doc/lixa-X.Y.Z/examples/example2_ora.c .
tiian@ubuntu:~/tmp$ gcc example2_ora.c $(/opt/lixa/bin/lixa-config -c -f -l -d) \
&gt; -I/usr/lib/oracle/xe/app/oracle/product/10.2.0/server/rdbms/public \
&gt; -L/usr/lib/oracle/xe/app/oracle/product/10.2.0/server/lib -l clntsh -l nnz10 \
&gt; -o example2_ora
		</pre>
	      </td></tr></tbody></table></div><p>
	    </p><div class="table"><table frame="box"><thead><tr><td>System configuration details:</td></tr></thead><tbody><tr><td>
		Local connection, Ubuntu 10.04, Oracle XE 11.2 Database Server
		<pre class="screen">
tiian@ubuntu:~$ mkdir tmp
tiian@ubuntu:~$ cd tmp
tiian@ubuntu:~/tmp$ cp /opt/lixa/share/doc/lixa-X.Y.Z/examples/example2_ora.c .
tiian@ubuntu:~/tmp$ gcc example2_ora.c $(/opt/lixa/bin/lixa-config -c -f -l -d) \
&gt; -I/u01/app/oracle/product/11.2.0/xe/rdbms/public/ \
&gt; -L/u01/app/oracle/product/11.2.0/xe/lib/ -l clntsh -l nnz11 \
&gt; -o example2_ora
		</pre>
	      </td></tr></tbody></table></div><p>
	    Verify the executable produced by <span class="command"><strong>gcc</strong></span>:
	    </p><pre class="screen">
tiian@ubuntu:~/tmp$ ldd example2_ora
        linux-gate.so.1 =&gt;  (0xb7709000)
        liblixac.so.0 =&gt; /opt/lixa/lib/liblixac.so.0 (0xb76ee000)
        libclntsh.so.10.1 =&gt; not found
        libnnz10.so =&gt; not found
        libc.so.6 =&gt; /lib/tls/i686/cmov/libc.so.6 (0xb7590000)
        libgmodule-2.0.so.0 =&gt; /usr/lib/libgmodule-2.0.so.0 (0xb758c000)
        libdl.so.2 =&gt; /lib/tls/i686/cmov/libdl.so.2 (0xb7588000)
        libgthread-2.0.so.0 =&gt; /usr/lib/libgthread-2.0.so.0 (0xb7583000)
        librt.so.1 =&gt; /lib/tls/i686/cmov/librt.so.1 (0xb7579000)
        libglib-2.0.so.0 =&gt; /usr/lib/libglib-2.0.so.0 (0xb74c8000)
        libxml2.so.2 =&gt; /usr/lib/libxml2.so.2 (0xb73a8000)
        liblixab.so.0 =&gt; /opt/lixa/lib/liblixab.so.0 (0xb7393000)
        libm.so.6 =&gt; /lib/tls/i686/cmov/libm.so.6 (0xb736e000)
        libpthread.so.0 =&gt; /lib/tls/i686/cmov/libpthread.so.0 (0xb7356000)
        /lib/ld-linux.so.2 (0xb770a000)
        libpcre.so.3 =&gt; /usr/lib/libpcre.so.3 (0xb732e000)
        libz.so.1 =&gt; /usr/lib/libz.so.1 (0xb7319000)
        libuuid.so.1 =&gt; /lib/libuuid.so.1 (0xb7315000)
	    </pre><p>
	  </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp67829568"></a>Set-up LIXA environment</h4></div></div></div><p>
	    There are three unresolved references that can be fixed setting up
	    the environment properly:
	    </p><pre class="screen">
tiian@ubuntu:~/tmp$ echo $LD_LIBRARY_PATH

tiian@ubuntu:~/tmp$ export LD_LIBRARY_PATH=/usr/lib/oracle/xe/app/oracle/product/10.2.0/server/lib

tiian@ubuntu:~/tmp$ echo $LD_LIBRARY_PATH
/usr/lib/oracle/xe/app/oracle/product/10.2.0/server/lib
	    </pre><p>
	    Check again the executable:
	    </p><pre class="screen">
tiian@ubuntu:~/tmp$ ldd example2_ora
        linux-gate.so.1 =&gt;  (0xb76f9000)
        liblixac.so.0 =&gt; /opt/lixa/lib/liblixac.so.0 (0xb76de000)
        libclntsh.so.10.1 =&gt; /usr/lib/oracle/xe/app/oracle/product/10.2.0/server/lib/libclntsh.so.10.1 (0xb692a000)
        libnnz10.so =&gt; /usr/lib/oracle/xe/app/oracle/product/10.2.0/server/lib/libnnz10.so (0xb6724000)
        libc.so.6 =&gt; /lib/tls/i686/cmov/libc.so.6 (0xb65c7000)
        libgmodule-2.0.so.0 =&gt; /usr/lib/libgmodule-2.0.so.0 (0xb65c3000)
        libdl.so.2 =&gt; /lib/tls/i686/cmov/libdl.so.2 (0xb65bf000)
        libgthread-2.0.so.0 =&gt; /usr/lib/libgthread-2.0.so.0 (0xb65ba000)
        librt.so.1 =&gt; /lib/tls/i686/cmov/librt.so.1 (0xb65b0000)
        libglib-2.0.so.0 =&gt; /usr/lib/libglib-2.0.so.0 (0xb64ff000)
        libxml2.so.2 =&gt; /usr/lib/libxml2.so.2 (0xb63df000)
        liblixab.so.0 =&gt; /opt/lixa/lib/liblixab.so.0 (0xb63ca000)
        libm.so.6 =&gt; /lib/tls/i686/cmov/libm.so.6 (0xb63a5000)
        libpthread.so.0 =&gt; /lib/tls/i686/cmov/libpthread.so.0 (0xb638d000)
        libnsl.so.1 =&gt; /lib/tls/i686/cmov/libnsl.so.1 (0xb6374000)
        /lib/ld-linux.so.2 (0xb76fa000)
        libpcre.so.3 =&gt; /usr/lib/libpcre.so.3 (0xb634d000)
        libz.so.1 =&gt; /usr/lib/libz.so.1 (0xb6338000)
        libuuid.so.1 =&gt; /lib/libuuid.so.1 (0xb6334000)
	    </pre><p>
	    Set-up the necessary environment variables.
	    Here's an example for Oracle XE 10.2 using a local connection and 
	    the SID identifier:
	    </p><div class="table"><table frame="box"><thead><tr><td>System configuration details:</td></tr></thead><tbody><tr><td>
		Local connection, Ubuntu 8.04, Oracle XE 10.2 Database Server
		<pre class="screen">
tiian@ubuntu:~/tmp$ export PATH=$PATH:$ORACLE_HOME/bin
tiian@ubuntu:~/tmp$ echo $PATH
/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/lib/oracle/xe/app/oracle/product/10.2.0/server/bin
tiian@ubuntu:~/tmp$ export ORACLE_HOME=/usr/lib/oracle/xe/app/oracle/product/10.2.0/server
tiian@ubuntu:~/tmp$ echo $ORACLE_HOME
/usr/lib/oracle/xe/app/oracle/product/10.2.0/server
tiian@ubuntu:~/tmp$ export ORACLE_SID=XE
tiian@ubuntu:~/tmp$ echo $ORACLE_SID
XE
tiian@ubuntu:~/tmp$ export LIXA_PROFILE=ORA_DYN
tiian@ubuntu:~/tmp$ echo $LIXA_PROFILE
ORA_DYN
		</pre>
	      </td></tr></tbody></table></div><p>
	    It is suggested to set the necessary environment variables in your 
	    profile if you are going to execute the programs many times.
	    This is the list of the suggested variables:
	    <code class="varname">LD_LIBRARY_PATH</code>,
	    <code class="varname">LIXA_PROFILE</code>,
	    <code class="varname">ORACLE_HOME</code>,
	    <code class="varname">ORACLE_SID</code>.
	    </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
	      the third and fourth variables can be
	      set sourcing <code class="filename">oracle_env.sh</code> script: it's
	      installed in the Oracle's <code class="filename">bin</code> directory or
	      alternatively you have to edit your own as explained above.
	    </p></div><p>
	  </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp67840304"></a>Check the data table before execution</h4></div></div></div><p>
	    Execute the below commands to check the existence of table
	    <code class="filename">countries</code> and to create a new table with
	    name <code class="filename">authors</code>:
	    </p><pre class="screen">
tiian@ubuntu:~$ sqlplus "hr/hr"<a href="#ftn.idp67842608" class="footnote" id="idp67842608"><sup class="footnote">[21]</sup></a>

SQL*Plus: Release 10.2.0.1.0 - Production on Thu Apr 14 22:04:55 2011

Copyright (c) 1982, 2005, Oracle.  All rights reserved.


Connected to:
Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production

SQL&gt; select * from COUNTRIES where COUNTRY_ID = 'RS';

no rows selected

SQL&gt; CREATE TABLE hr.authors (
  2  id INTEGER NOT NULL,
  3  last_name VARCHAR2(20),
  4  first_name VARCHAR2(20));

Table created.

SQL&gt; exit
Disconnected from Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production
	    </pre><p>
	    That's OK because the table does not contain the row we 
	    are going to insert.
	  </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp67844832"></a>Some checks before program execution</h4></div></div></div><p>
	    We set <code class="varname">LIXA_PROFILE</code> to value
	    <span class="quote">“<span class="quote">ORA_DYN</span>”</span>, looking at
	    <code class="filename">/opt/lixa/etc/lixac_conf.xml</code>:
	    </p><pre class="screen">
    &lt;profile name="ORA_DYN"&gt;
      &lt;sttsrvs&gt;
        &lt;sttsrv&gt;local_1&lt;/sttsrv&gt;
      &lt;/sttsrvs&gt;
      &lt;rsrmgrs&gt;
        &lt;rsrmgr&gt;OracleXE_dynreg&lt;/rsrmgr&gt;
      &lt;/rsrmgrs&gt;
    &lt;/profile&gt;
	    </pre><p>
	    the profile references the Resource Manager named
	    <span class="quote">“<span class="quote">OracleXE_dynreg</span>”</span>, looking again at the config file:
	    </p><pre class="screen">
    &lt;rsrmgr name="OracleXE_dynreg" switch_file="/opt/lixa/lib/switch_oracle_dynreg.so" xa_open_info="Oracle_XA+Acc=P/hr/hr+SesTm=30+LogDir=/tmp+threads=true+DbgFl=7+Loose_Coupling=true" xa_close_info="" /&gt;
	    </pre><p>
	    we can discover that our application will access the Oracle
	    database using <code class="systemitem">hr</code>
	    user and writing the trace file to directory 
	    <code class="filename">/tmp</code> (see <code class="constant">LogDir</code>)
	    <a href="#ftn.idp67850960" class="footnote" id="idp67850960"><sup class="footnote">[22]</sup></a>. Verify no trace file exists:
	      </p><pre class="screen">
tiian@ubuntu:~/tmp$ ls -la /tmp/xa*
ls: cannot access /tmp/xa*: No such file or directory
	      </pre><p>
	  </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp67852848"></a>Program execution (dynamic registration)</h4></div></div></div><p>
	    Execute the client program as shown below:
	    </p><pre class="screen">
tiian@ubuntu:~/tmp$ ./example2_ora
INSERT statement executed!
First arg is not 'DELETE', bypassing DELETE statement...
	    </pre><p>
	    Check the table after program execution:
	    </p><pre class="screen">
tiian@ubuntu:~/tmp$ sqlplus "hr/hr"

SQL*Plus: Release 10.2.0.1.0 - Production on Sun Apr 10 10:34:23 2011

Copyright (c) 1982, 2005, Oracle.  All rights reserved.


Connected to:
Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production

SQL&gt; select * from COUNTRIES where COUNTRY_ID = 'RS';

CO COUNTRY_NAME                              REGION_ID
-- ---------------------------------------- ----------
RS Repubblica San Marino                             1

SQL&gt; exit
Disconnected from Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production
	    </pre><p>
	    The example program <code class="filename">example2_ora</code> inserted a
	    row in table <code class="constant">COUNTRIES</code>. Take a look to the
	    trace produced by the Oracle client library:
	    </p><pre class="screen">
tiian@ubuntu:~/tmp$ ls -la /tmp/xa*
-rw-r--r-- 1 tiian tiian 1723 2011-04-10 10:33 /tmp/xa_NULL04102011.trc
tiian@ubuntu:~/tmp$ cat /tmp/xa_NULL04102011.trc

ORACLE XA: Version 10.2.0.1.0. RM name = 'Oracle_XA'.

103352.5300.3057182448.0:
xaoopen: xa_info=Oracle_XA+Acc=P/hr/hr+SesTm=30+LogDir=/tmp+threads=true+DbgFl=7+Loose_Coupling=true,rmid=0,flags=0x0

103352.5300.3057182448.0:
xaolgn_help: version#: 169869568 banner: Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production

103352.5300.3057182448.0:
xaolgn: sqlxrc/sqlxss completed

103352.5300.3057182448.0:
xaolgn2: return XA_OK

103352.5300.3057182448.0:
xaoopen: xaolgn completed

103352.5300.3057182448.0:
xaoopen: return 0

103352.5300.3057182448.0:
ax_reg: xid=0x494c4158-8c6122ac9fd0477ebfe5f650e21a3539-a154ad9214d0544a3abbd33c8c2ba36f, rmid=0, flags=0x0

103352.5300.3057182448.0:
OCITransStart: Attempting

103352.5300.3057182448.0:
OCITransStart: Succeeded

103352.5300.3057182448.0:
xaodynpo 2: rmid=0, state=3

103352.5300.3057182448.0:
xaoend: xid=0x494c4158-8c6122ac9fd0477ebfe5f650e21a3539-a154ad9214d0544a3abbd33c8c2ba36f, rmid=0, flags=0x4000000

103352.5300.3057182448.0:
OCITransDetach: Attempting

103352.5300.3057182448.0:
OCITransDetach: Succeeded

103352.5300.3057182448.0:
xaoend: return 0

103352.5300.3057182448.0:
xaocommit: xid=0x494c4158-8c6122ac9fd0477ebfe5f650e21a3539-a154ad9214d0544a3abbd33c8c2ba36f, rmid=0, flags=0x40000000

103352.5300.3057182448.0:
OCITransCommit: Attempting

103352.5300.3057182448.0:
xaodynpo 2: rmid=0, state=1

103352.5300.3057182448.0:
OCITransCommit: Succeeded

103352.5300.3057182448.0:
xaocommit: rtn 0

103352.5300.3057182448.0:
xaoclose: xa_info=, rmid=0, flags=0x0

103352.5300.3057182448.0:
OCIServerDetach: Attempting

103352.5300.3057182448.0:
OCIServerDetach: Succeeded

103352.5300.3057182448.0:
xaoclose: rtn 0
	    </pre><p>
	    The <code class="function">ax_reg</code> function was called because the
	    dynamic registration configuration was used 
	    (<code class="constant">LIXA_PROFILE=ORA_DYN</code>). 
	    Now you can remove
	    the inserted record using the same program:
	    </p><pre class="screen">
tiian@ubuntu:~/tmp$ ./example2_ora delete
First arg is 'delete', bypassing INSERT statement...
DELETE statement executed!
	    </pre><p>
	    Check the content of the table again:
	    </p><pre class="screen">
tiian@ubuntu:~/tmp$ sqlplus "hr/hr"

SQL*Plus: Release 10.2.0.1.0 - Production on Sun Apr 10 10:40:25 2011

Copyright (c) 1982, 2005, Oracle.  All rights reserved.


Connected to:
Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production

SQL&gt; select * from COUNTRIES where COUNTRY_ID = 'RS';

no rows selected

SQL&gt; exit
Disconnected from Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production
	    </pre><p>
	    The row was deleted. Please remove the trace file before a new
	    execution:
	    </p><pre class="screen">
tiian@ubuntu:~/tmp$ rm /tmp/xa_NULL04102011.trc
	    </pre><p>
	  </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp67853776"></a>Program execution (static registration)</h4></div></div></div><p>
	    Switch from dynamic registration to static registration (local
	    connection):
	    </p><pre class="screen">
tiian@ubuntu:~/tmp$ echo $LIXA_PROFILE
ORA_DYN
tiian@ubuntu:~/tmp$ export LIXA_PROFILE=ORA_STA
tiian@ubuntu:~/tmp$ echo $LIXA_PROFILE
ORA_STA
	    </pre><p>
	    Here's the equivalent for the network connection using Oracle
	    Instant Client:
	    </p><pre class="screen">
tiian@ubuntu1404-64:/tmp$ echo $LIXA_PROFILE
ORAOCI_DYN
tiian@ubuntu1404-64:/tmp$ export LIXA_PROFILE=ORAOCI_STA
tiian@ubuntu1404-64:/tmp$ echo $LIXA_PROFILE
ORAOCI_STA	  
	    </pre><p>
	    Execute the program again:
	    </p><pre class="screen">
tiian@ubuntu:~/tmp$ ./example2_ora
INSERT statement executed!
First arg is not 'DELETE', bypassing DELETE statement...
tiian@ubuntu:~/tmp$ sqlplus "hr/hr"

SQL*Plus: Release 10.2.0.1.0 - Production on Sun Apr 10 10:53:05 2011

Copyright (c) 1982, 2005, Oracle.  All rights reserved.


Connected to:
Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production

SQL&gt; select * from COUNTRIES where COUNTRY_ID = 'RS';

CO COUNTRY_NAME                              REGION_ID
-- ---------------------------------------- ----------
RS Repubblica San Marino                             1

SQL&gt; exit
Disconnected from Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production
	    </pre><p>
	    Inspect the produced trace file:
	    </p><pre class="screen">
tiian@ubuntu:~/tmp$ ls -la /tmp/xa_*
-rw-r--r-- 1 tiian tiian 1661 2011-04-10 10:52 /tmp/xa_NULL04102011.trc
tiian@ubuntu:~/tmp$ cat /tmp/xa_NULL04102011.trc

ORACLE XA: Version 10.2.0.1.0. RM name = 'Oracle_XA'.

105236.5392.3057456880.0:
xaoopen: xa_info=Oracle_XA+Acc=P/hr/hr+SesTm=30+LogDir=/tmp+threads=true+DbgFl=7+Loose_Coupling=true,rmid=0,flags=0x0

105236.5392.3057456880.0:
xaolgn_help: version#: 169869568 banner: Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production

105236.5392.3057456880.0:
xaolgn: sqlxrc/sqlxss completed

105236.5392.3057456880.0:
xaolgn: return XA_OK

105236.5392.3057456880.0:
xaoopen: xaolgn completed

105236.5392.3057456880.0:
xaoopen: return 0

105236.5392.3057456880.0:
xaostart: xid=0x494c4158-6119154810784a87b0d0aa83ea497a72-55263ef9237e27f8ae34f46936ce295d, rmid=0, flags=0x0

105236.5392.3057456880.0:
OCITransStart: Attempting

105236.5392.3057456880.0:
OCITransStart: Succeeded

105236.5392.3057456880.0:
xaostart: return XA_OK

105236.5392.3057456880.0:
xaoend: xid=0x494c4158-6119154810784a87b0d0aa83ea497a72-55263ef9237e27f8ae34f46936ce295d, rmid=0, flags=0x4000000

105236.5392.3057456880.0:
OCITransDetach: Attempting

105236.5392.3057456880.0:
OCITransDetach: Succeeded

105236.5392.3057456880.0:
xaoend: return 0

105236.5392.3057456880.0:
xaocommit: xid=0x494c4158-6119154810784a87b0d0aa83ea497a72-55263ef9237e27f8ae34f46936ce295d, rmid=0, flags=0x40000000

105236.5392.3057456880.0:
OCITransCommit: Attempting

105236.5392.3057456880.0:
OCITransCommit: Succeeded

105236.5392.3057456880.0:
xaocommit: rtn 0

105236.5392.3057456880.0:
xaoclose: xa_info=, rmid=0, flags=0x0

105236.5392.3057456880.0:
OCIServerDetach: Attempting

105236.5392.3057456880.0:
OCIServerDetach: Succeeded

105236.5392.3057456880.0:
xaoclose: rtn 0
	    </pre><p>
	    The <code class="function">xa_start (xaostart)</code> function was called 
	    because the static registration configuration was used 
	    (<code class="constant">LIXA_PROFILE=ORA_STA</code>). 
	    Remove the inserted row again:
	    </p><pre class="screen">
tiian@ubuntu:~/tmp$ ./example2_ora delete
First arg is 'delete', bypassing INSERT statement...
DELETE statement executed!
tiian@ubuntu:~/tmp$ sqlplus "hr/hr"

SQL*Plus: Release 10.2.0.1.0 - Production on Sun Apr 10 11:01:32 2011

Copyright (c) 1982, 2005, Oracle.  All rights reserved.


Connected to:
Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production

SQL&gt; select * from COUNTRIES where COUNTRY_ID = 'RS';

no rows selected

SQL&gt; exit
Disconnected from Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production
	    </pre><p>
	    You have successfully executed an Application Program that uses
	    Oracle Database Server as a Resource Manager.
	  </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp67870224"></a>Remote configuration (Instant Client) and OCI</h3></div></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	  This example has been tested using Ubuntu Server LTS 14.04
	  and Oracle Instant Client 12.1
	</p></div><p>
	  Using a remote configuration instead of a local configuration
	  introduces two differences:
	  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	      the Oracle Database Server must be configured to be accessible
	      from another system: a <span class="emphasis"><em>listener</em></span> must be
	      configured
	    </p></li><li class="listitem" style="list-style-type: disc"><p>
	      the Oracle Instant Client software must be installed and 
	      configured in the system that will connect to the database
	    </p></li></ul></div><p>
	</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp67873280"></a>Set-up the Oracle environment (server side)</h4></div></div></div><p>
	    The first part of the Oracle Database Server is pretty the same
	    described in 
	    <a class="xref" href="#Development_setup_Oracle_environment" title="Set-up the Oracle environment (server side)">the section called “Set-up the Oracle environment (server side)”</a>.
	    All the statements remain valid for Oracle 12c Standard 
	    Edition with the exception of the paths. Here's a default path 
	    installation example:
	    </p><pre class="screen">
[oracle@centos7-oracle12 ~]$ ls -la $ORACLE_HOME/rdbms/admin/xaview.sql
-rw-r--r--. 1 oracle oinstall 1941 Apr 21  2011 /u01/app/oracle/product/12.1.0/dbhome_1/rdbms/admin/xaview.sql
	    </pre><p>	    
	  </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="Development_configure_Oracle_listener"></a>Configure Oracle Listener</h4></div></div></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>
	    Many recent Linux distributions, CentOS 7.x for example, 
	    automatically enable an internal firewall to prevent undesired 
	    accesses. If your firewall configuration does not allow Oracle 
	    traffic, you have no way to reach your database instance from 
	    a different system.
	  </p></div><p>
	    Here's a very basic example that accepts incoming connection from
	    any network interface (IP address 0.0.0.0):
	    </p><pre class="screen">
[oracle@centos7-oracle12 ~]$ cat $ORACLE_HOME/network/admin/listener.ora

LISTENER =
  (DESCRIPTION_LIST =
    (DESCRIPTION =
      (ADDRESS = (PROTOCOL = TCP)(HOST = 0.0.0.0)(PORT = 1521))
      (ADDRESS = (PROTOCOL = IPC)(KEY = EXTPROC1521))
    )
  )
	    </pre><p>
	    You can check that the listener is accepting connection with this
	    command:
	    </p><pre class="screen">
[oracle@centos7-oracle12 ~]$ netstat -unta | grep 1521 | grep LISTEN
tcp        0      0 0.0.0.0:1521            0.0.0.0:*               LISTEN     
	    </pre><p>
	    and you can check a connection from a different system with 
	    something	like this (adjust your IP address, port and Global 
	    Database Name):
	    </p><pre class="screen">
tiian@ubuntu1404-64:~$ sqlplus hr/hr@192.168.122.81:1521/orcl.brenta.org

SQL*Plus: Release 12.1.0.2.0 Production on Fri Jan 13 21:50:46 2017

Copyright (c) 1982, 2014, Oracle.  All rights reserved.

Last Successful login time: Fri Jan 13 2017 21:36:05 +01:00

Connected to:
Oracle Database 12c Standard Edition Release 12.1.0.2.0 - 64bit Production

SQL&gt; exit
Disconnected from Oracle Database 12c Standard Edition Release 12.1.0.2.0 - 64bit Production
	    </pre><p>
	  </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="Development_install_Oracle_Instant_Client"></a>Install and configure Oracle Instant Client</h4></div></div></div><p>
	    Oracle Instant Client must be retrieved from Oracle portal. 
	    These are the suggested packages for version 12.1 if you want 
	    to use LIXA:
	    </p><pre class="screen">
instantclient-basic-linux.x64-12.1.0.2.0.zip
instantclient-precomp-linux.x64-12.1.0.2.0.zip
instantclient-sdk-linux.x64-12.1.0.2.0.zip
instantclient-sqlplus-linux.x64-12.1.0.2.0.zip
	    </pre><p>
	    For the Linux operating system you can choose between ".rpm" 
	    packages and ".zip" archives: feel free to install the packages 
	    that you prefer.
	    Just as an example, here's the final layout of a tested 
	    configuration using <code class="filename">/opt/oracle</code> as a prefix:
	    </p><pre class="screen">
tiian@ubuntu1404-64:~/lixa$ find /opt/oracle/ | sort
/opt/oracle/
/opt/oracle/instantclient_12_1
/opt/oracle/instantclient_12_1/adrci
/opt/oracle/instantclient_12_1/BASIC_README
/opt/oracle/instantclient_12_1/cobsqlintf.o
/opt/oracle/instantclient_12_1/genezi
/opt/oracle/instantclient_12_1/glogin.sql
/opt/oracle/instantclient_12_1/libclntshcore.so.12.1
/opt/oracle/instantclient_12_1/libclntsh.so
/opt/oracle/instantclient_12_1/libclntsh.so.12.1
/opt/oracle/instantclient_12_1/libipc1.so
/opt/oracle/instantclient_12_1/libmql1.so
/opt/oracle/instantclient_12_1/libnnz12.so
/opt/oracle/instantclient_12_1/libocci.so
/opt/oracle/instantclient_12_1/libocci.so.12.1
/opt/oracle/instantclient_12_1/libociei.so
/opt/oracle/instantclient_12_1/libocijdbc12.so
/opt/oracle/instantclient_12_1/libons.so
/opt/oracle/instantclient_12_1/liboramysql12.so
/opt/oracle/instantclient_12_1/libsqlplusic.so
/opt/oracle/instantclient_12_1/libsqlplus.so
/opt/oracle/instantclient_12_1/network
/opt/oracle/instantclient_12_1/network/admin
/opt/oracle/instantclient_12_1/network/admin/tnsnames.ora
/opt/oracle/instantclient_12_1/ojdbc6.jar
/opt/oracle/instantclient_12_1/ojdbc7.jar
/opt/oracle/instantclient_12_1/precomp
/opt/oracle/instantclient_12_1/precomp/admin
/opt/oracle/instantclient_12_1/precomp/admin/pcbcfg.cfg
/opt/oracle/instantclient_12_1/precomp/admin/pcscfg.cfg
/opt/oracle/instantclient_12_1/PRECOMP_README
/opt/oracle/instantclient_12_1/sdk
/opt/oracle/instantclient_12_1/sdk/admin
/opt/oracle/instantclient_12_1/sdk/admin/oraaccess.xsd
/opt/oracle/instantclient_12_1/sdk/demo
/opt/oracle/instantclient_12_1/sdk/demo/cdemo81.c
/opt/oracle/instantclient_12_1/sdk/demo/demo.mk
/opt/oracle/instantclient_12_1/sdk/demo/demo_proc_ic.mk
/opt/oracle/instantclient_12_1/sdk/demo/demo_procob_ic.mk
/opt/oracle/instantclient_12_1/sdk/demo/occidemod.sql
/opt/oracle/instantclient_12_1/sdk/demo/occidemo.sql
/opt/oracle/instantclient_12_1/sdk/demo/occidml.cpp
/opt/oracle/instantclient_12_1/sdk/demo/occiobj.cpp
/opt/oracle/instantclient_12_1/sdk/demo/occiobj.typ
/opt/oracle/instantclient_12_1/sdk/demo/oraaccess.xml
/opt/oracle/instantclient_12_1/sdk/demo/procdemo.pc
/opt/oracle/instantclient_12_1/sdk/demo/procobdemo.pco
/opt/oracle/instantclient_12_1/sdk/demo/setuporamysql.sh
/opt/oracle/instantclient_12_1/sdk/include
/opt/oracle/instantclient_12_1/sdk/include/ldap.h
/opt/oracle/instantclient_12_1/sdk/include/nzerror.h
/opt/oracle/instantclient_12_1/sdk/include/nzt.h
/opt/oracle/instantclient_12_1/sdk/include/occiAQ.h
/opt/oracle/instantclient_12_1/sdk/include/occiCommon.h
/opt/oracle/instantclient_12_1/sdk/include/occiControl.h
/opt/oracle/instantclient_12_1/sdk/include/occiData.h
/opt/oracle/instantclient_12_1/sdk/include/occi.h
/opt/oracle/instantclient_12_1/sdk/include/occiObjects.h
/opt/oracle/instantclient_12_1/sdk/include/oci1.h
/opt/oracle/instantclient_12_1/sdk/include/oci8dp.h
/opt/oracle/instantclient_12_1/sdk/include/ociap.h
/opt/oracle/instantclient_12_1/sdk/include/ociapr.h
/opt/oracle/instantclient_12_1/sdk/include/ocidef.h
/opt/oracle/instantclient_12_1/sdk/include/ocidem.h
/opt/oracle/instantclient_12_1/sdk/include/ocidfn.h
/opt/oracle/instantclient_12_1/sdk/include/ociextp.h
/opt/oracle/instantclient_12_1/sdk/include/oci.h
/opt/oracle/instantclient_12_1/sdk/include/ocikpr.h
/opt/oracle/instantclient_12_1/sdk/include/ocixmldb.h
/opt/oracle/instantclient_12_1/sdk/include/ocixstream.h
/opt/oracle/instantclient_12_1/sdk/include/odci.h
/opt/oracle/instantclient_12_1/sdk/include/oraca.h
/opt/oracle/instantclient_12_1/sdk/include/oratypes.h
/opt/oracle/instantclient_12_1/sdk/include/orid.h
/opt/oracle/instantclient_12_1/sdk/include/ori.h
/opt/oracle/instantclient_12_1/sdk/include/orl.h
/opt/oracle/instantclient_12_1/sdk/include/oro.h
/opt/oracle/instantclient_12_1/sdk/include/ort.h
/opt/oracle/instantclient_12_1/sdk/include/sql2oci.h
/opt/oracle/instantclient_12_1/sdk/include/sqlapr.h
/opt/oracle/instantclient_12_1/sdk/include/sqlca.h
/opt/oracle/instantclient_12_1/sdk/include/sqlcpr.h
/opt/oracle/instantclient_12_1/sdk/include/sqlda.h
/opt/oracle/instantclient_12_1/sdk/include/sqlkpr.h
/opt/oracle/instantclient_12_1/sdk/include/sqlucs2.h
/opt/oracle/instantclient_12_1/sdk/include/xa.h
/opt/oracle/instantclient_12_1/sdk/ott
/opt/oracle/instantclient_12_1/sdk/ottclasses.zip
/opt/oracle/instantclient_12_1/sdk/proc
/opt/oracle/instantclient_12_1/sdk/procob
/opt/oracle/instantclient_12_1/sdk/rtsora
/opt/oracle/instantclient_12_1/sdk/SDK_README
/opt/oracle/instantclient_12_1/sqlplus
/opt/oracle/instantclient_12_1/SQLPLUS_README
/opt/oracle/instantclient_12_1/uidrvci
/opt/oracle/instantclient_12_1/xstreams.jar
            </pre><p>
	    If your installation layout is different, adjust the following 
	    steps as necessary.
	  </p><p>
	    Oracle Instant Client does not provide 
	    <code class="filename">oracle_env.sh</code>, but some
	    environment variables can be very handy and it is suggested you to
	    create your own <code class="filename">oracle_env.sh</code> as below:
	    </p><pre class="screen">
#!/bin/sh
export LD_LIBRARY_PATH=/opt/oracle/instantclient_12_1:$LD_LIBRARY_PATH
export PATH=/opt/oracle/instantclient_12_1:/opt/oracle/instantclient_12_1/sdk:$PATH
export ORACLE_HOME=/opt/oracle/instantclient_12_1
	    </pre><p>
	    and to put it inside Oracle Instant Client base directory
	    <a href="#ftn.idp67893504" class="footnote" id="idp67893504"><sup class="footnote">[23]</sup></a>:
	    </p><pre class="screen">
tiian@ubuntu1404-64:~/lixa$ ls -la /opt/oracle/instantclient_12_1/oracle_env.sh
-rwxr-xr-- 1 root root 216 mar 10 21:57 /opt/oracle/instantclient_12_1/oracle_env.sh
	    </pre><p>
	    Use it when it's needed with shell sourcing:
	    </p><pre class="screen">
tiian@ubuntu1404-64:~$ . /opt/oracle/instantclient_12_1/oracle_env.sh 
tiian@ubuntu1404-64:~$ echo $LD_LIBRARY_PATH
/opt/oracle/instantclient_12_1:
tiian@ubuntu1404-64:~$ echo $PATH
/opt/oracle/instantclient_12_1:/opt/oracle/instantclient_12_1/sdk:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games
tiian@ubuntu1404-64:~$ echo $ORACLE_HOME
/opt/oracle/instantclient_12_1
	    </pre><p>
	    A possible option to configure a remote database is based on the 
	    "tnsnames.ora" file. It should be put at path 
	    <code class="filename">$ORACLE_HOME/network/admin/tnsnames.ora</code>
	    Here's an example:
	    </p><pre class="screen">
lixa_ora_db=
  (DESCRIPTION=
     (ADDRESS=(PROTOCOL=tcp)(HOST=centos7-oracle12.brenta.org)(PORT=1521))
     (CONNECT_DATA=
        (SERVICE_NAME=orcl.brenta.org)))
	    </pre><p>
	    </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	      Configuring Oracle networking feature requires a little bit of
	      experience: be patient and consult official documentation and
	      user group forums to obtain a working configuration.
	    </p></div><p>
	    </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
	      This example configuration uses <code class="filename">lixa_ora_db</code>
	      as the name understood by the Instant Client to reach the
	      database server.
	    </p></div><p>
	  </p><p>
	    The final step is the configuration check. If everything is OK, you
	    should obtain something like this:
	    </p><pre class="screen">
tiian@ubuntu1404-64:~$ sqlplus hr/hr@lixa_ora_db

SQL*Plus: Release 12.1.0.2.0 Production on Fri Jan 13 21:36:05 2017

Copyright (c) 1982, 2014, Oracle.  All rights reserved.

Last Successful login time: Fri Jan 13 2017 21:35:16 +01:00

Connected to:
Oracle Database 12c Standard Edition Release 12.1.0.2.0 - 64bit Production

SQL&gt; select * from COUNTRIES where COUNTRY_ID = 'RS';

no rows selected

SQL&gt; exit
Disconnected from Oracle Database 12c Standard Edition Release 12.1.0.2.0 - 64bit Production
	    </pre><p>
	  </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp67900016"></a>Start the LIXA state server</h4></div></div></div><p>
	    The LIXA state server (daemon) must be started as explained in
	    <a class="xref" href="#Development_start_LIXA_server" title="Start the LIXA state server">the section called “Start the LIXA state server”</a>.
	  </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp67902720"></a>Build the client program</h4></div></div></div><p>
	    Prepare the client (Application Program) using the below commands
	    (<span class="command"><strong>gcc</strong></span> command was splitted on several lines 
	    using <span class="command"><strong>\</strong></span> to help readability, but you may use
	    a single line):
	    </p><div class="table"><table frame="box"><thead><tr><td>System configuration details:</td></tr></thead><tbody><tr><td>
		Remote connection, Ubuntu 14.04, Oracle 12.1 Instant Client
		<pre class="screen">
tiian@ubuntu1404-64:/tmp$ cp /opt/lixa/share/doc/lixa-X.Y.Z/examples/example2_ora.c .
tiian@ubuntu1404-64:/tmp$ gcc example2_ora.c \
&gt; $(/opt/lixa/bin/lixa-config -c -f -l -d) \
&gt; -I/opt/oracle/instantclient_12_1/sdk/include \
&gt; -L/opt/oracle/instantclient_12_1 \
&gt; -Wl,-rpath -Wl,/opt/oracle/instantclient_12_1 \
&gt; -l clntsh -l nnz12 -o example2_ora
		</pre>
	      </td></tr></tbody></table></div><p>
	    Verify the executable produced by <span class="command"><strong>gcc</strong></span>:
	    </p><pre class="screen">
tiian@ubuntu1404-64:/tmp$ ldd example2_ora
linux-vdso.so.1 =&gt;  (0x00007fff7649c000)
liblixac.so.0 =&gt; /opt/lixa/lib/liblixac.so.0 (0x00007f32ec40f000)
libclntsh.so.12.1 =&gt; /opt/oracle/instantclient_12_1/libclntsh.so.12.1 (0x00007f32e9452000)
libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007f32e9082000)
libgmodule-2.0.so.0 =&gt; /usr/lib/x86_64-linux-gnu/libgmodule-2.0.so.0 (0x00007f32e8e7e000)
libglib-2.0.so.0 =&gt; /lib/x86_64-linux-gnu/libglib-2.0.so.0 (0x00007f32e8b76000)
libxml2.so.2 =&gt; /usr/lib/x86_64-linux-gnu/libxml2.so.2 (0x00007f32e880e000)
liblixab.so.0 =&gt; /opt/lixa/lib/liblixab.so.0 (0x00007f32e85f5000)
libpthread.so.0 =&gt; /lib/x86_64-linux-gnu/libpthread.so.0 (0x00007f32e83d7000)
libmql1.so =&gt; /opt/oracle/instantclient_12_1/libmql1.so (0x00007f32e8160000)
libipc1.so =&gt; /opt/oracle/instantclient_12_1/libipc1.so (0x00007f32e7de2000)
libnnz12.so =&gt; /opt/oracle/instantclient_12_1/libnnz12.so (0x00007f32e76d8000)
libons.so =&gt; /opt/oracle/instantclient_12_1/libons.so (0x00007f32e7492000)
libdl.so.2 =&gt; /lib/x86_64-linux-gnu/libdl.so.2 (0x00007f32e728e000)
libm.so.6 =&gt; /lib/x86_64-linux-gnu/libm.so.6 (0x00007f32e6f88000)
libnsl.so.1 =&gt; /lib/x86_64-linux-gnu/libnsl.so.1 (0x00007f32e6d6d000)
librt.so.1 =&gt; /lib/x86_64-linux-gnu/librt.so.1 (0x00007f32e6b65000)
/lib64/ld-linux-x86-64.so.2 (0x00007f32ec62c000)
libaio.so.1 =&gt; /lib/x86_64-linux-gnu/libaio.so.1 (0x00007f32e6963000)
libclntshcore.so.12.1 =&gt; /opt/oracle/instantclient_12_1/libclntshcore.so.12.1 (0x00007f32e63f0000)
libpcre.so.3 =&gt; /lib/x86_64-linux-gnu/libpcre.so.3 (0x00007f32e61b2000)
libz.so.1 =&gt; /lib/x86_64-linux-gnu/libz.so.1 (0x00007f32e5f98000)
liblzma.so.5 =&gt; /lib/x86_64-linux-gnu/liblzma.so.5 (0x00007f32e5d76000)
libuuid.so.1 =&gt; /lib/x86_64-linux-gnu/libuuid.so.1 (0x00007f32e5b71000)
	    </pre><p>
	  </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp67910784"></a>Set-up LIXA environment</h4></div></div></div><p>
	    Set-up the necessary environment variable:
	    </p><pre class="screen">
tiian@ubuntu1404-64:/tmp$ export LIXA_PROFILE=ORA_DYN
tiian@ubuntu1404-64:/tmp$ echo $LIXA_PROFILE
ORAIC_DYN
	    </pre><p>
	  </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp67912768"></a>Some checks before program execution</h4></div></div></div><p>
	    We set <code class="varname">LIXA_PROFILE</code> to value
	    <span class="quote">“<span class="quote">ORA_DYN</span>”</span>, looking at
	    <code class="filename">/opt/lixa/etc/lixac_conf.xml</code>:
	    </p><pre class="screen">
    &lt;profile name="ORA_DYN"&gt;
      &lt;sttsrvs&gt;
        &lt;sttsrv&gt;local_1&lt;/sttsrv&gt;
      &lt;/sttsrvs&gt;
      &lt;rsrmgrs&gt;
        &lt;rsrmgr&gt;OracleIC_dynreg&lt;/rsrmgr&gt;
      &lt;/rsrmgrs&gt;
    &lt;/profile&gt;
	    </pre><p>
	    the profile references the Resource Manager named
	    <span class="quote">“<span class="quote">OracleIC_dynreg</span>”</span>, looking again at the config file:
	    </p><pre class="screen">
    &lt;rsrmgr name="OracleIC_dynreg" switch_file="/opt/lixa/lib/switch_oracle_dynreg.so" xa_open_info="Oracle_XA+Acc=P/hr/hr+SesTm=30+LogDir=/tmp+threads=true+DbgFl=7+SqlNet=lixa_ora_db+Loose_Coupling=true" xa_close_info="" /&gt;
	    </pre><p>
	    we can discover that our application will access the Oracle
	    database using <code class="systemitem">hr</code>
	    user and writing the trace file to directory 
	    <code class="filename">/tmp</code> (see <code class="constant">LogDir</code>)
	    <a href="#ftn.idp67917376" class="footnote" id="idp67917376"><sup class="footnote">[24]</sup></a>. 
	  </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp67920368"></a>Program execution (dynamic registration)</h4></div></div></div><p>
	    Execute the client program and check how the content table changes:
	    </p><pre class="screen">
tiian@ubuntu1404-64:/tmp$ ./example2_ora
INSERT statement executed!
First arg is not 'DELETE', bypassing DELETE statement...
tiian@ubuntu1404-64:/tmp$ sqlplus hr/hr@lixa_ora_db

SQL*Plus: Release 12.1.0.2.0 Production on Wed Jan 18 23:41:11 2017

Copyright (c) 1982, 2014, Oracle.  All rights reserved.

Last Successful login time: Wed Jan 18 2017 23:40:54 +01:00

Connected to:
Oracle Database 12c Standard Edition Release 12.1.0.2.0 - 64bit Production

SQL&gt; select * from COUNTRIES where COUNTRY_ID = 'RS';

	    CO COUNTRY_NAME      REGION_ID
-- ---------------------------------------- ----------
	    RS Repubblica San Marino     1

SQL&gt; exit
Disconnected from Oracle Database 12c Standard Edition Release 12.1.0.2.0 - 64bit Production
tiian@ubuntu1404-64:/tmp$ ./example2_ora DELETE
First arg is 'DELETE', bypassing INSERT statement...
DELETE statement executed!
tiian@ubuntu1404-64:/tmp$ sqlplus hr/hr@lixa_ora_db

SQL*Plus: Release 12.1.0.2.0 Production on Wed Jan 18 23:41:40 2017

Copyright (c) 1982, 2014, Oracle.  All rights reserved.

Last Successful login time: Wed Jan 18 2017 23:41:35 +01:00

Connected to:
Oracle Database 12c Standard Edition Release 12.1.0.2.0 - 64bit Production

SQL&gt; select * from COUNTRIES where COUNTRY_ID = 'RS';

no rows selected

SQL&gt; exit
Disconnected from Oracle Database 12c Standard Edition Release 12.1.0.2.0 - 64bit Production
	    </pre><p>
	    The example program <code class="filename">example2_ora</code> inserted a
	    row in table <code class="constant">COUNTRIES</code>. Take a look to the
	    trace produced by the Oracle client library for the first 
	    execution ("insert"):
	    </p><pre class="screen">
ORACLE XA: Version 12.1.0.2.0. RM name = 'Oracle_XA'.

234322.16513.1350203008.0:
xaoopen: xa_info=ORACLE_XA+Acc=P/hr/**+SesTm=30+LogDir=/tmp+threads=true+DbgFl=7+SqlNet=lixa_ora_db+Loose_Coupling=true,rmid=0,flags=0x0

234322.16513.1350203008.0:
xaolgn_help: version#: 185597952 banner: Oracle Database 11g Release 11.1.0.0.0 - Production

234322.16513.1350203008.0:
xaolgn: sqlxrc/sqlxss completed

234322.16513.1350203008.0:
xaolgn2: return XA_OK

234322.16513.1350203008.0:
xaoopen: xaolgn completed

234322.16513.1350203008.0:
xaoopen: return 0

234322.16513.1350203008.0:
ax_reg: xid=0x4c495841-d3c276e84a95421d95eb86c0563c5fa8-54bfbba0e21ccc50c05577130f0b2f6f, rmid=0, flags=0x0

234322.16513.1350203008.0:
OCITransStart: Attempting

234322.16513.1350203008.0:
OCITransStart: Succeeded

234322.16513.1350203008.0:
xaodynpo 2: rmid=0, state=131

234322.16513.1350203008.0:
xaoend: xid=0x4c495841-d3c276e84a95421d95eb86c0563c5fa8-54bfbba0e21ccc50c05577130f0b2f6f, rmid=0, flags=0x4000000

234322.16513.1350203008.0:
OCITransDetach: Attempting

234322.16513.1350203008.0:
OCITransDetach: Succeeded

234322.16513.1350203008.0:
xaoend: return 0

234322.16513.1350203008.0:
xaocommit: xid=0x4c495841-d3c276e84a95421d95eb86c0563c5fa8-54bfbba0e21ccc50c05577130f0b2f6f, rmid=0, flags=0x40000000

234322.16513.1350203008.0:
OCITransCommit: Attempting

234322.16513.1350203008.0:
xaodynpo 2: rmid=0, state=129

234322.16513.1350203008.0:
OCITransCommit: Succeeded

234322.16513.1350203008.0:
xaocommit: rtn 0

234322.16513.1350203008.0:
xaoclose: xa_info=, rmid=0, flags=0x0

234322.16513.1350203008.0:
OCIServerDetach: Attempting

234322.16513.1350203008.0:
OCIServerDetach: Succeeded

234322.16513.1350203008.0:
xaoclose: rtn 0
	    </pre><p>
	  </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp67870544"></a>Remote configuration (Instant Client) and Pro*C</h3></div></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	  This example has been tested using Red Hat Enterprise Linux 7.3
	  and Oracle Instant Client 12.1
	</p></div><p>
	  Using a remote configuration instead of a local configuration
	  introduces two differences:
	  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	      the Oracle Database Server must be configured to be accessible
	      from another system: a <span class="emphasis"><em>listener</em></span> must be
	      configured
	    </p></li><li class="listitem" style="list-style-type: disc"><p>
	      the Oracle Instant Client software must be installed and 
	      configured in the system that will connect to the database
	    </p></li></ul></div><p>
	</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp67931360"></a>Set-up the Oracle environment (server side)</h4></div></div></div><p>
	    The first part of the Oracle Database Server is pretty the same
	    described in 
	    <a class="xref" href="#Development_setup_Oracle_environment" title="Set-up the Oracle environment (server side)">the section called “Set-up the Oracle environment (server side)”</a>.
	    All the statements remain valid for Oracle 12c Standard 
	    Edition with the exception of the paths. Here's a default path 
	    installation example:
	    </p><pre class="screen">
[oracle@centos7-oracle12 ~]$ ls -la $ORACLE_HOME/rdbms/admin/xaview.sql
-rw-r--r--. 1 oracle oinstall 1941 Apr 21  2011 /u01/app/oracle/product/12.1.0/dbhome_1/rdbms/admin/xaview.sql
	    </pre><p>	    
	  </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp67932496"></a>Configure Oracle Listener</h4></div></div></div><p>
	    Configure at least one Oracle listener as explained in
	    <a class="xref" href="#Development_configure_Oracle_listener" title="Configure Oracle Listener">the section called “Configure Oracle Listener”</a>.
	  </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp67936160"></a>Install and configure Oracle Instant Client</h4></div></div></div><p>
	    Install and configure Oracle Instant Client as explained in
	    <a class="xref" href="#Development_install_Oracle_Instant_Client" title="Install and configure Oracle Instant Client">the section called “Install and configure Oracle Instant Client”</a>.
	  </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp67938272"></a>Configure Oracle Pro*C precompiler</h4></div></div></div><p>
	    If you don't like to use a lot of options on the command line,
	    you will have to configure the content of 
	    <code class="filename">pcscfg.cfg</code>.
	    Here's an example for Red Hat Enterprise Linux 7.3:
	    </p><pre class="screen">
[tiian@rhel73 admin]$ cat /opt/oracle/instantclient_12_1/precomp/admin/pcscfg.cfg 
sys_include=(/usr/include,/usr/lib/gcc/x86_64-redhat-linux/4.8.5/include,/usr/lib/gcc/x86_64-redhat-linux/4.8.2/include)
include=($ORACLE_HOME/sdk/include,/opt/lixa/include)
ltype=short
define=__x86_64__
	    </pre><p>
	    Especially "sys_include" and "include" need your attention.
	  </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp67940864"></a>Start the LIXA state server</h4></div></div></div><p>
	    The LIXA state server (daemon) must be started as explained in
	    <a class="xref" href="#Development_start_LIXA_server" title="Start the LIXA state server">the section called “Start the LIXA state server”</a>.
	  </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp67942976"></a>Build the client program</h4></div></div></div><p>
	    Prepare the client (Application Program) using the below commands
	    (<span class="command"><strong>gcc</strong></span> command was splitted on several lines 
	    using <span class="command"><strong>\</strong></span> to help readability, but you may use
	    a single line):
	    </p><div class="table"><table frame="box"><thead><tr><td>System configuration details:</td></tr></thead><tbody><tr><td>
		Remote connection, RHEL 7.3, Oracle 12.1 Instant Client
		<pre class="screen">
[tiian@rhel73 ~]$ export PATH=/opt/oracle/instantclient_12_1/sdk:/opt/oracle/instantclient_12_1:$PATH
[tiian@rhel73 ~]$ type proc
proc is /opt/oracle/instantclient_12_1/sdk/proc
[tiian@rhel73 tmp]$ export LD_LIBRARY_PATH=/opt/oracle/instantclient_12_1:$LD_LIBRARY_PATH
[tiian@rhel73 tmp]$ echo $LD_LIBRARY_PATH
/opt/oracle/instantclient_12_1:
[tiian@rhel73 tmp]$ cp /opt/lixa/share/doc/lixa-X.Y.Z/examples/example14_ora.pc .
[tiian@rhel73 tmp]$ proc code=ANSI_C example14_ora.pc
[tiian@rhel73 tmp]$ gcc example14_ora.c -Wno-unused-variable \
&gt; $(/opt/lixa/bin/lixa-config -c -f -l -d) \
&gt; -I/opt/oracle/instantclient_12_1/sdk/include \
&gt; -L/opt/oracle/instantclient_12_1 \
&gt; -Wl,-rpath -Wl,/opt/oracle/instantclient_12_1 \
&gt; -l clntsh -l nnz12 -o example14_ora
		</pre>
	      </td></tr></tbody></table></div><p>
	    Verify the executable produced by <span class="command"><strong>gcc</strong></span>:
	    </p><pre class="screen">
[tiian@rhel73 tmp]$ ldd example14_ora
    linux-vdso.so.1 =&gt;  (0x00007ffc78dc6000)
    liblixac.so.0 =&gt; /opt/lixa/lib/liblixac.so.0 (0x00007f115d077000)
    libclntsh.so.12.1 =&gt; /opt/oracle/instantclient_12_1/libclntsh.so.12.1 (0x00007f115a0b9000)
    libnnz12.so =&gt; /opt/oracle/instantclient_12_1/libnnz12.so (0x00007f11599af000)
    libc.so.6 =&gt; /lib64/libc.so.6 (0x00007f11595e7000)
    libgmodule-2.0.so.0 =&gt; /lib64/libgmodule-2.0.so.0 (0x00007f11593e2000)
    libgthread-2.0.so.0 =&gt; /lib64/libgthread-2.0.so.0 (0x00007f11591e0000)
    libglib-2.0.so.0 =&gt; /lib64/libglib-2.0.so.0 (0x00007f1158ea9000)
    libxml2.so.2 =&gt; /lib64/libxml2.so.2 (0x00007f1158b3e000)
    liblixab.so.0 =&gt; /opt/lixa/lib/liblixab.so.0 (0x00007f1158926000)
    libm.so.6 =&gt; /lib64/libm.so.6 (0x00007f1158624000)
    libpthread.so.0 =&gt; /lib64/libpthread.so.0 (0x00007f1158407000)
    libmql1.so =&gt; /opt/oracle/instantclient_12_1/libmql1.so (0x00007f1158191000)
    libipc1.so =&gt; /opt/oracle/instantclient_12_1/libipc1.so (0x00007f1157e13000)
    libons.so =&gt; /opt/oracle/instantclient_12_1/libons.so (0x00007f1157bcd000)
    libdl.so.2 =&gt; /lib64/libdl.so.2 (0x00007f11579c9000)
    libnsl.so.1 =&gt; /lib64/libnsl.so.1 (0x00007f11577b0000)
    librt.so.1 =&gt; /lib64/librt.so.1 (0x00007f11575a7000)
    /lib64/ld-linux-x86-64.so.2 (0x00007f115d292000)
    libaio.so.1 =&gt; /lib64/libaio.so.1 (0x00007f11573a5000)
    libclntshcore.so.12.1 =&gt; /opt/oracle/instantclient_12_1/libclntshcore.so.12.1 (0x00007f1156e33000)
    libz.so.1 =&gt; /lib64/libz.so.1 (0x00007f1156c1c000)
    liblzma.so.5 =&gt; /lib64/liblzma.so.5 (0x00007f11569f6000)
    libuuid.so.1 =&gt; /lib64/libuuid.so.1 (0x00007f11567f1000)
	    </pre><p>
	  </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp67951264"></a>Set-up LIXA environment</h4></div></div></div><p>
	    Set-up the necessary environment variable:
	    </p><pre class="screen">
tiian@ubuntu1404-64:/tmp$ export LIXA_PROFILE=ORA_STA
tiian@ubuntu1404-64:/tmp$ echo $LIXA_PROFILE
ORA_STA
	    </pre><p>
	    In the previous example we used the dynamic XA registration, this
	    time we are using the static one, but both can be used for 
	    OCI and Pro*C.
	  </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp67953360"></a>Program execution (static registration)</h4></div></div></div><p>
	    Execute the client program and check how the content table changes:
	    </p><pre class="screen">
[tiian@rhel73 tmp]$ ./example14_ora 
First arg is not 'DELETE', bypassing DELETE statement...
[tiian@rhel73 tmp]$ sqlplus hr/hr@lixa_ora_db

SQL*Plus: Release 12.1.0.2.0 Production on Thu Jan 19 00:30:27 2017

Copyright (c) 1982, 2014, Oracle.  All rights reserved.

Last Successful login time: Thu Jan 19 2017 00:30:11 +01:00

Connected to:
Oracle Database 12c Standard Edition Release 12.1.0.2.0 - 64bit Production

SQL&gt; select * from COUNTRIES where COUNTRY_ID = 'RS';

CO COUNTRY_NAME      REGION_ID
-- ---------------------------------------- ----------
RS Repubblica San Marino     1

SQL&gt; exit
Disconnected from Oracle Database 12c Standard Edition Release 12.1.0.2.0 - 64bit Production
[tiian@rhel73 tmp]$ ./example14_ora DELETE
First arg is 'DELETE', bypassing INSERT statement...
[tiian@rhel73 tmp]$ sqlplus hr/hr@lixa_ora_db

SQL*Plus: Release 12.1.0.2.0 Production on Thu Jan 19 00:30:46 2017

Copyright (c) 1982, 2014, Oracle.  All rights reserved.

Last Successful login time: Thu Jan 19 2017 00:30:45 +01:00

Connected to:
Oracle Database 12c Standard Edition Release 12.1.0.2.0 - 64bit Production

SQL&gt; select * from COUNTRIES where COUNTRY_ID = 'RS';

no rows selected

SQL&gt; exit
Disconnected from Oracle Database 12c Standard Edition Release 12.1.0.2.0 - 64bit Production
	    </pre><p>
	    The example program <code class="filename">example14_ora</code> inserted a
	    row in table <code class="constant">COUNTRIES</code>. Take a look to the
	    trace produced by the Oracle client library for the second
	    execution ("delete"):
	    </p><pre class="screen">
ORACLE XA: Version 12.1.0.2.0. RM name = 'Oracle_XA'.

003044.3009.2262976064.0:
xaoopen: xa_info=ORACLE_XA+Acc=P/hr/**+SesTm=30+LogDir=/tmp+threads=true+DbgFl=7+SqlNet=lixa_ora_db+Loose_Coupling=true,rmid=0,flags=0x0

003044.3009.2262976064.0:
xaolgn_help: version#: 185597952 banner: Oracle Database 11g Release 11.1.0.0.0 - Production

003044.3009.2262976064.0:
xaolgn: sqlxrc/sqlxss completed

003044.3009.2262976064.0:
xaolgn: return XA_OK

003044.3009.2262976064.0:
xaoopen: xaolgn completed

003044.3009.2262976064.0:
xaoopen: return 0

003044.3009.2262976064.0:
xaostart: xid=0x4c495841-a593cf11a3a24fcb945f6502b6f2210d-c220ba3a3bd0699d93a333c82bbac597, rmid=0, flags=0x0

003044.3009.2262976064.0:
OCITransStart: Attempting

003044.3009.2262976064.0:
OCITransStart: Succeeded

003044.3009.2262976064.0:
xaostart: return XA_OK

003044.3009.2262976064.0:
xaoend: xid=0x4c495841-a593cf11a3a24fcb945f6502b6f2210d-c220ba3a3bd0699d93a333c82bbac597, rmid=0, flags=0x4000000

003044.3009.2262976064.0:
OCITransDetach: Attempting

003044.3009.2262976064.0:
OCITransDetach: Succeeded

003044.3009.2262976064.0:
xaoend: return 0

003044.3009.2262976064.0:
xaocommit: xid=0x4c495841-a593cf11a3a24fcb945f6502b6f2210d-c220ba3a3bd0699d93a333c82bbac597, rmid=0, flags=0x40000000

003044.3009.2262976064.0:
OCITransCommit: Attempting

003044.3009.2262976064.0:
OCITransCommit: Succeeded

003044.3009.2262976064.0:
xaocommit: rtn 0

003044.3009.2262976064.0:
xaoclose: xa_info=, rmid=0, flags=0x0

003044.3009.2262976064.0:
OCIServerDetach: Attempting

003044.3009.2262976064.0:
OCIServerDetach: Succeeded

003044.3009.2262976064.0:
xaoclose: rtn 0
	    </pre><p>
	  </p></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Development_example3_db2"></a>An example with IBM DB2 DBMS</h2></div></div></div><div class="figure"><a id="develop3"></a><p class="title"><strong>Figure 5.3. Deploy model of an example with IBM DB2 DBMS</strong></p><div class="figure-contents"><div class="mediaobject"><img src="../images/LIXA_Development_3.png" alt="Deploy model of an example with IBM DB2 DBMS" /></div></div></div><br class="figure-break" /><p>
      This example was developed using DB2 Express-C 9.7 for Linux (Ubuntu).
      If you were using a different version you would need to adapt some
      commands to your environment.
    </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	If you did not yet installed the software provided by IBM,
	please refer to the official IBM site to download the
	software and to pick-up the information necessary to install 
	and configure
	the database. This manual does not give you information related
	to IBM DB2 technology: it is assumed you already installed and
	configured the database.
    </p></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
	The LIXA software must be configured to support the IBM DB2
	server resource manager as explained in 
	<a class="xref" href="#Linking_third_party_resource_managers" title="Linking third party resource managers">the section called “Linking third party resource managers”</a>.
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Development_setup_DB2_environment"></a>Set-up DB2 environment</h3></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp67967328"></a>Start-up the DB2 server</h4></div></div></div><p>
	  If your server didn't start-up automatically at boot time, you
	  could start it with the following commands:
	  </p><pre class="screen">
tiian@ubuntu:~$ ps -ef | grep db2 | grep -v grep
tiian@ubuntu:~$ sudo /etc/init.d/db2exc start
  * Starting DAS:                       done.
  * Instance db2inst1 ( db2c_db2inst1 ):        done.
  * Activating database SAMPLE          done.
tiian@ubuntu:~$ ps -ef | grep db2 | grep -v grep
dasusr1  22959     1  0 10:54 pts/2    00:00:00 /home/dasusr1/das/adm/db2dasrrm
root     23190     1  2 10:54 pts/2    00:00:00 db2wdog                         
db2inst1 23192 23190  4 10:54 pts/2    00:00:01 db2sysc                         
root     23193 23192  0 10:54 pts/2    00:00:00 db2ckpwd                        
root     23194 23192  0 10:54 pts/2    00:00:00 db2ckpwd                        
root     23195 23192  0 10:54 pts/2    00:00:00 db2ckpwd                        
db2inst1 23206 23190  2 10:54 pts/2    00:00:00 db2acd   ,0,0,0,1,0,0,0,1,0,8a6614,14,1e014,2,0,1,11fd0,0x12600000,0x12600000,1600000,740002,2,a0800d
	  </pre><p>
	  Switch to user <code class="systemitem">db2inst1</code>,
	  try to connect to database <span class="quote">“<span class="quote">SAMPLE</span>”</span>:
	  </p><pre class="screen">
tiian@ubuntu:~$ sudo su - db2inst1
db2inst1@ubuntu:~$ db2
(c) Copyright IBM Corporation 1993,2007
Command Line Processor for DB2 Client 9.7.1

You can issue database manager commands and SQL statements from the command
prompt. For example:
    db2 =&gt; connect to sample
    db2 =&gt; bind sample.bnd

For general help, type: ?.
For command help, type: ? command, where command can be
the first few keywords of a database manager command. For example:
 ? CATALOG DATABASE for help on the CATALOG DATABASE command
 ? CATALOG          for help on all of the CATALOG commands.

To exit db2 interactive mode, type QUIT at the command prompt. Outside
interactive mode, all commands must be prefixed with 'db2'.
To list the current command option settings, type LIST COMMAND OPTIONS.

For more detailed help, refer to the Online Reference Manual.

db2 =&gt; connect to sample

   Database Connection Information

 Database server        = DB2/LINUX 9.7.1
 SQL authorization ID   = DB2INST1
 Local database alias   = SAMPLE

	  </pre><p>
	  Check the tables <span class="quote">“<span class="quote">ORG</span>”</span> and <span class="quote">“<span class="quote">DEPT</span>”</span> exist
	  and contain some data:
	  </p><pre class="screen">
db2 =&gt; select * from ORG

DEPTNUMB DEPTNAME       MANAGER DIVISION   LOCATION
-------- -------------- ------- ---------- -------------
      10 Head Office        160 Corporate  New York
      15 New England         50 Eastern    Boston
      20 Mid Atlantic        10 Eastern    Washington
      38 South Atlantic      30 Eastern    Atlanta
      42 Great Lakes        100 Midwest    Chicago
      51 Plains             140 Midwest    Dallas
      66 Pacific            270 Western    San Francisco
      84 Mountain           290 Western    Denver

  8 record(s) selected.

db2 =&gt; select * from DEPT

DEPTNO DEPTNAME                             MGRNO  ADMRDEPT LOCATION
------ ------------------------------------ ------ -------- ----------------
A00    SPIFFY COMPUTER SERVICE DIV.         000010 A00      -
B01    PLANNING                             000020 A00      -
C01    INFORMATION CENTER                   000030 A00      -
D01    DEVELOPMENT CENTER                   -      A00      -
D11    MANUFACTURING SYSTEMS                000060 D01      -
D21    ADMINISTRATION SYSTEMS               000070 D01      -
E01    SUPPORT SERVICES                     000050 A00      -
E11    OPERATIONS                           000090 E01      -
E21    SOFTWARE SUPPORT                     000100 E01      -
F22    BRANCH OFFICE F2                     -      E01      -
G22    BRANCH OFFICE G2                     -      E01      -
H22    BRANCH OFFICE H2                     -      E01      -
I22    BRANCH OFFICE I2                     -      E01      -
J22    BRANCH OFFICE J2                     -      E01      -

  14 record(s) selected.

	  </pre><p>
	  OK, the <span class="quote">“<span class="quote">ORG</span>”</span> and <span class="quote">“<span class="quote">DEPT</span>”</span>
	  tables are populated. 
	  If something went wrong, you should refer to IBM DB2
	  documentation to fix the issue before the next step because
	  you would not be able to execute the sample program without a
	  basic running installation.
	</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="Development_setup_DB2_user_customization"></a>User customization</h4></div></div></div><p>
	  We want to execute our example program with a generic user,
	  not just using <code class="systemitem">db2inst1</code>
	  because that's the system user dedicated to the database
	  instance execution. The commands below explain as the generic
	  user <code class="systemitem">tiian</code> (my own 
	  user) can be used instead of 
	  <code class="systemitem">db2inst1</code>.
	</p><p>
	  Grant <code class="constant">DBADM</code> privilege to the user
	  <code class="systemitem">tiian</code>:
	  </p><pre class="screen">
db2 =&gt; grant DBADM on database to user tiian
DB20000I  The SQL command completed successfully.
	  </pre><p>
	  <code class="constant">DBADM</code> is not the lowest authorization
	  level necessary to execute our example, but for the sake of 
	  this example it's a <span class="quote">“<span class="quote">good enought</span>”</span> choice.
	</p><p>
	  Add something like the 4 lines below to your
	  <code class="filename">$HOME/.profile</code> or equivalent profile
	  configuration:
	  </p><pre class="screen">
# The following three lines have been added by IBM DB2 instance utilities.
if [ -f /home/db2inst1/sqllib/db2profile ]; then
    . /home/db2inst1/sqllib/db2profile
fi
	  </pre><p>
	  Then login again and check your environment:
	  </p><pre class="screen">
tiian@ubuntu:~$ env|grep -i db2
DB2INSTANCE=db2inst1
LD_LIBRARY_PATH=/home/db2inst1/sqllib/lib32
PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/home/db2inst1/sqllib/bin:/home/db2inst1/sqllib/adm:/home/db2inst1/sqllib/misc:/home/db2inst1/sqllib/db2tss/bin
CLASSPATH=/home/db2inst1/sqllib/java/db2java.zip:/home/db2inst1/sqllib/java/db2jcc.jar:/home/db2inst1/sqllib/java/sqlj.zip:/home/db2inst1/sqllib/function:/home/db2inst1/sqllib/java/db2jcc_license_cu.jar:.
	  </pre><p>
	  As shown above,
	  <code class="varname">DB2INSTANCE</code>, <code class="varname">LD_LIBRARY_PATH</code>,
	  <code class="varname">PATH</code> variables should refer to DB2 stuff too.
	  Connect to the database using your own user instead of
	  <code class="systemitem">db2inst1</code>:
	  </p><pre class="screen">
tiian@ubuntu:~$ db2
(c) Copyright IBM Corporation 1993,2007
Command Line Processor for DB2 Client 9.7.1

You can issue database manager commands and SQL statements from the command
prompt. For example:
    db2 =&gt; connect to sample
    db2 =&gt; bind sample.bnd

For general help, type: ?.
For command help, type: ? command, where command can be
the first few keywords of a database manager command. For example:
 ? CATALOG DATABASE for help on the CATALOG DATABASE command
 ? CATALOG          for help on all of the CATALOG commands.

To exit db2 interactive mode, type QUIT at the command prompt. Outside
interactive mode, all commands must be prefixed with 'db2'.
To list the current command option settings, type LIST COMMAND OPTIONS.

For more detailed help, refer to the Online Reference Manual.

db2 =&gt; connect to sample

   Database Connection Information

 Database server        = DB2/LINUX 9.7.1
 SQL authorization ID   = TIIAN
 Local database alias   = SAMPLE

db2 =&gt; select * from DB2INST1.ORG

DEPTNUMB DEPTNAME       MANAGER DIVISION   LOCATION
-------- -------------- ------- ---------- -------------
      10 Head Office        160 Corporate  New York
      15 New England         50 Eastern    Boston
      20 Mid Atlantic        10 Eastern    Washington
      38 South Atlantic      30 Eastern    Atlanta
      42 Great Lakes        100 Midwest    Chicago
      51 Plains             140 Midwest    Dallas
      66 Pacific            270 Western    San Francisco
      84 Mountain           290 Western    Denver

  8 record(s) selected.

db2 =&gt; select * from DB2INST1.DEPT

DEPTNO DEPTNAME                             MGRNO  ADMRDEPT LOCATION
------ ------------------------------------ ------ -------- ----------------
A00    SPIFFY COMPUTER SERVICE DIV.         000010 A00      -
B01    PLANNING                             000020 A00      -
C01    INFORMATION CENTER                   000030 A00      -
D01    DEVELOPMENT CENTER                   -      A00      -
D11    MANUFACTURING SYSTEMS                000060 D01      -
D21    ADMINISTRATION SYSTEMS               000070 D01      -
E01    SUPPORT SERVICES                     000050 A00      -
E11    OPERATIONS                           000090 E01      -
E21    SOFTWARE SUPPORT                     000100 E01      -
F22    BRANCH OFFICE F2                     -      E01      -
G22    BRANCH OFFICE G2                     -      E01      -
H22    BRANCH OFFICE H2                     -      E01      -
I22    BRANCH OFFICE I2                     -      E01      -
J22    BRANCH OFFICE J2                     -      E01      -

  14 record(s) selected.

db2 =&gt; quit
DB20000I  The QUIT command completed successfully.
	  </pre><p>
	  You have just verified that a generic user, like
	  <code class="systemitem">tiian</code>	
	  in the example above, can connect to the database and execute
	  some query.
	</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp67993104"></a>Start the LIXA state server</h3></div></div></div><p>
	Start the state server as shown below:
	</p><pre class="screen">
tiian@ubuntu:~$ sudo su - lixa
lixa@ubuntu:~$ /opt/lixa/sbin/lixad --daemon
lixa@ubuntu:~$ exit
logout
tiian@ubuntu:~$ ps -ef|grep lixad|grep -v grep
lixa     12866     1  0 21:35 ?        00:00:00 /opt/lixa/sbin/lixad --daemon
	</pre><p>
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp67995104"></a>Build the client program</h3></div></div></div><p>
	Prepare the client (Application Program) using the below commands
	(<span class="command"><strong>gcc</strong></span> command was splitted on several lines 
	using <span class="command"><strong>\</strong></span> to help readability, but you may use
	a single line):
	</p><pre class="screen">
tiian@ubuntu:~$ mkdir tmp
tiian@ubuntu:~$ cd tmp
tiian@ubuntu:~/tmp$ cp /opt/lixa/share/doc/lixa-X.Y.Z/examples/example3_db2.c .
tiian@ubuntu:~/tmp$ gcc example3_db2.c $(/opt/lixa/bin/lixa-config -c -f -l -d) \
&gt; -I/opt/ibm/db2/V9.7/include -L/opt/ibm/db2/V9.7/lib32/ -ldb2 -o example3_db2
	</pre><p>
	Verify the executable produced by <span class="command"><strong>gcc</strong></span>:
	</p><pre class="screen">
tiian@ubuntu:~/tmp$ ldd example3_db2
        linux-gate.so.1 =&gt;  (0xb775f000)
        liblixac.so.0 =&gt; /opt/lixa/lib/liblixac.so.0 (0xb7744000)
        libdb2.so.1 =&gt; /home/db2inst1/sqllib/lib32/libdb2.so.1 (0xb6212000)
        libc.so.6 =&gt; /lib/tls/i686/cmov/libc.so.6 (0xb60b4000)
        libgmodule-2.0.so.0 =&gt; /usr/lib/libgmodule-2.0.so.0 (0xb60b0000)
        libdl.so.2 =&gt; /lib/tls/i686/cmov/libdl.so.2 (0xb60ac000)
        libgthread-2.0.so.0 =&gt; /usr/lib/libgthread-2.0.so.0 (0xb60a7000)
        librt.so.1 =&gt; /lib/tls/i686/cmov/librt.so.1 (0xb609e000)
        libglib-2.0.so.0 =&gt; /usr/lib/libglib-2.0.so.0 (0xb5fed000)
        libxml2.so.2 =&gt; /usr/lib/libxml2.so.2 (0xb5ecc000)
        liblixab.so.0 =&gt; /opt/lixa/lib/liblixab.so.0 (0xb5eb9000)
        libpthread.so.0 =&gt; /lib/tls/i686/cmov/libpthread.so.0 (0xb5ea1000)
        libcrypt.so.1 =&gt; /lib/tls/i686/cmov/libcrypt.so.1 (0xb5e6e000)
        libpam.so.0 =&gt; /lib/libpam.so.0 (0xb5e64000)
        libm.so.6 =&gt; /lib/tls/i686/cmov/libm.so.6 (0xb5e3f000)
        libdb2dascmn.so.1 =&gt; /home/db2inst1/sqllib/lib32/libdb2dascmn.so.1 (0xb5e12000)
        libdb2g11n.so.1 =&gt; /home/db2inst1/sqllib/lib32/libdb2g11n.so.1 (0xb57a4000)
        libdb2genreg.so.1 =&gt; /home/db2inst1/sqllib/lib32/libdb2genreg.so.1 (0xb5763000)
        libdb2install.so.1 =&gt; /home/db2inst1/sqllib/lib32/libdb2install.so.1 (0xb5758000)
        libdb2locale.so.1 =&gt; /home/db2inst1/sqllib/lib32/libdb2locale.so.1 (0xb5745000)
        libdb2osse.so.1 =&gt; /home/db2inst1/sqllib/lib32/libdb2osse.so.1 (0xb5440000)
        libdb2osse_db2.so.1 =&gt; /home/db2inst1/sqllib/lib32/libdb2osse_db2.so.1 (0xb53d0000)
        libdb2trcapi.so.1 =&gt; /home/db2inst1/sqllib/lib32/libdb2trcapi.so.1 (0xb53bc000)
        libstdc++.so.6 =&gt; /usr/lib/libstdc++.so.6 (0xb52c9000)
        libgcc_s.so.1 =&gt; /lib/libgcc_s.so.1 (0xb52be000)
        /lib/ld-linux.so.2 (0xb7760000)
        libpcre.so.3 =&gt; /usr/lib/libpcre.so.3 (0xb5297000)
        libz.so.1 =&gt; /usr/lib/libz.so.1 (0xb5282000)
        libuuid.so.1 =&gt; /lib/libuuid.so.1 (0xb527d000)
	</pre><p>
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp68000896"></a>Set-up LIXA environment</h3></div></div></div><p>
	Set-up the <code class="varname">LIXA_PROFILE</code> environment variable:
	</p><pre class="screen">
tiian@ubuntu:~/tmp$ echo $LIXA_PROFILE

tiian@ubuntu:~/tmp$ export LIXA_PROFILE=DB2_DYN
tiian@ubuntu:~/tmp$ echo $LIXA_PROFILE
DB2_DYN
	</pre><p>
	No additional DB2 variables are needed because they are automatically
	set at login (see <a class="xref" href="#Development_setup_DB2_environment" title="Set-up DB2 environment">the section called “Set-up DB2 environment”</a>).
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp68004224"></a>Some checks before program execution</h3></div></div></div><p>
	We set <code class="varname">LIXA_PROFILE</code> to value
	<span class="quote">“<span class="quote">DB2_DYN</span>”</span>, looking at
	<code class="filename">/opt/lixa/etc/lixac_conf.xml</code>:
	</p><pre class="screen">
    &lt;profile name="DB2_DYN"&gt;
      &lt;sttsrvs&gt;
        &lt;sttsrv&gt;local_1&lt;/sttsrv&gt;
      &lt;/sttsrvs&gt;
      &lt;rsrmgrs&gt;
        &lt;rsrmgr&gt;IBMDB2_dynreg&lt;/rsrmgr&gt;
      &lt;/rsrmgrs&gt;
    &lt;/profile&gt;
	</pre><p>
	the profile references the Resource Manager named
	<span class="quote">“<span class="quote">IBMDB2_dynreg</span>”</span>, looking again at the config file:
	</p><pre class="screen">
    &lt;rsrmgr name="IBMDB2_dynreg" switch_file="/opt/lixa/lib/switch_ibmdb2_dynreg.so" xa_open_info="axlib=/opt/lixa/lib/liblixac.so,db=sample,tpm=lixa" xa_close_info="" /&gt;
	</pre><p>
	we can discover how the DB2 database is configured for XA
	<a href="#ftn.idp68008224" class="footnote" id="idp68008224"><sup class="footnote">[25]</sup></a>.
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp68009920"></a>Program execution (dynamic registration)</h3></div></div></div><p>
	It is suggested to open two different terminals: the first one
	connected to <span class="quote">“<span class="quote">SAMPLE</span>”</span> DB2 database and the second
	one pointing to the directory where the compiled program
	<code class="filename">example3_db2</code> lives.
	First teminal session:
	</p><pre class="screen">
tiian@ubuntu:~$ db2
(c) Copyright IBM Corporation 1993,2007
Command Line Processor for DB2 Client 9.7.1

You can issue database manager commands and SQL statements from the command
prompt. For example:
    db2 =&gt; connect to sample
    db2 =&gt; bind sample.bnd

For general help, type: ?.
For command help, type: ? command, where command can be
the first few keywords of a database manager command. For example:
 ? CATALOG DATABASE for help on the CATALOG DATABASE command
 ? CATALOG          for help on all of the CATALOG commands.

To exit db2 interactive mode, type QUIT at the command prompt. Outside
interactive mode, all commands must be prefixed with 'db2'.
To list the current command option settings, type LIST COMMAND OPTIONS.

For more detailed help, refer to the Online Reference Manual.

db2 =&gt; connect to SAMPLE

   Database Connection Information

 Database server        = DB2/LINUX 9.7.1
 SQL authorization ID   = TIIAN
 Local database alias   = SAMPLE

	</pre><p>
	Second teminal session:
	</p><pre class="screen">
tiian@ubuntu:~/tmp$ ls -la
total 28
drwxr-xr-x  2 tiian tiian  4096 2011-04-22 16:26 .
drwxr-xr-x 40 tiian tiian  4096 2011-04-18 22:55 ..
-rwxr-xr-x  1 tiian tiian 11030 2011-04-22 16:26 example3_db2
-rw-r--r--  1 tiian tiian  5898 2011-04-22 16:23 example3_db2.c
	</pre><p>
	Check the content of <span class="quote">“<span class="quote">DB2INST1.ORG</span>”</span> table before
	program execution:
	</p><pre class="screen">
db2 =&gt; select * from DB2INST1.ORG

DEPTNUMB DEPTNAME       MANAGER DIVISION   LOCATION
-------- -------------- ------- ---------- -------------
      10 Head Office        160 Corporate  New York
      15 New England         50 Eastern    Boston
      20 Mid Atlantic        10 Eastern    Washington
      38 South Atlantic      30 Eastern    Atlanta
      42 Great Lakes        100 Midwest    Chicago
      51 Plains             140 Midwest    Dallas
      66 Pacific            270 Western    San Francisco
      84 Mountain           290 Western    Denver

  8 record(s) selected.

	</pre><p>
	Execute the program:
	</p><pre class="screen">
tiian@ubuntu:~/tmp$ ./example3_db2 insert org
	</pre><p>
	Check the content of the table again:
	</p><pre class="screen">
db2 =&gt; select * from DB2INST1.ORG

DEPTNUMB DEPTNAME       MANAGER DIVISION   LOCATION
-------- -------------- ------- ---------- -------------
      10 Head Office        160 Corporate  New York
      15 New England         50 Eastern    Boston
      20 Mid Atlantic        10 Eastern    Washington
      38 South Atlantic      30 Eastern    Atlanta
      42 Great Lakes        100 Midwest    Chicago
      51 Plains             140 Midwest    Dallas
      66 Pacific            270 Western    San Francisco
      84 Mountain           290 Western    Denver
     150 Europe             231 R&amp;D        Mojan

  9 record(s) selected.

	</pre><p>
	The example program inserted the last row! You can execute it again
	</p><pre class="screen">
tiian@ubuntu:~/tmp$ ./example3_db2 insert org
	</pre><p>
	and it inserts another row:
	</p><pre class="screen">
db2 =&gt; select * from DB2INST1.ORG

DEPTNUMB DEPTNAME       MANAGER DIVISION   LOCATION
-------- -------------- ------- ---------- -------------
      10 Head Office        160 Corporate  New York
      15 New England         50 Eastern    Boston
      20 Mid Atlantic        10 Eastern    Washington
      38 South Atlantic      30 Eastern    Atlanta
      42 Great Lakes        100 Midwest    Chicago
      51 Plains             140 Midwest    Dallas
      66 Pacific            270 Western    San Francisco
      84 Mountain           290 Western    Denver
     150 Europe             231 R&amp;D        Mojan
     150 Europe             231 R&amp;D        Mojan

  10 record(s) selected.

	</pre><p>
	Because there is no an unique constraint on this table; if you
	want to check an error while inserting, use <span class="quote">“<span class="quote">DEPT</span>”</span>
	table instead.
	</p><pre class="screen">
db2 =&gt; select * from DB2INST1.DEPT

DEPTNO DEPTNAME                             MGRNO  ADMRDEPT LOCATION
------ ------------------------------------ ------ -------- ----------------
A00    SPIFFY COMPUTER SERVICE DIV.         000010 A00      -
B01    PLANNING                             000020 A00      -
C01    INFORMATION CENTER                   000030 A00      -
D01    DEVELOPMENT CENTER                   -      A00      -
D11    MANUFACTURING SYSTEMS                000060 D01      -
D21    ADMINISTRATION SYSTEMS               000070 D01      -
E01    SUPPORT SERVICES                     000050 A00      -
E11    OPERATIONS                           000090 E01      -
E21    SOFTWARE SUPPORT                     000100 E01      -
F22    BRANCH OFFICE F2                     -      E01      -
G22    BRANCH OFFICE G2                     -      E01      -
H22    BRANCH OFFICE H2                     -      E01      -
I22    BRANCH OFFICE I2                     -      E01      -
J22    BRANCH OFFICE J2                     -      E01      -

  14 record(s) selected.

	</pre><p>
	Try to insert the same row twice:
	</p><pre class="screen">
tiian@ubuntu:~/tmp$ ./example3_db2 insert dept
tiian@ubuntu:~/tmp$ ./example3_db2 insert dept
Unable to execute the SQL statement ('INSERT INTO DB2INST1.DEPT (DEPTNO, DEPTNAME, ADMRDEPT) VALUES('Z99', 'RESEARCH &amp; DEVELOPMENT', 'E01')'): -1
	</pre><p>
	Check the table content:
	</p><pre class="screen">
db2 =&gt; select * from DB2INST1.DEPT

DEPTNO DEPTNAME                             MGRNO  ADMRDEPT LOCATION
------ ------------------------------------ ------ -------- ----------------
A00    SPIFFY COMPUTER SERVICE DIV.         000010 A00      -
B01    PLANNING                             000020 A00      -
C01    INFORMATION CENTER                   000030 A00      -
D01    DEVELOPMENT CENTER                   -      A00      -
D11    MANUFACTURING SYSTEMS                000060 D01      -
D21    ADMINISTRATION SYSTEMS               000070 D01      -
E01    SUPPORT SERVICES                     000050 A00      -
E11    OPERATIONS                           000090 E01      -
E21    SOFTWARE SUPPORT                     000100 E01      -
F22    BRANCH OFFICE F2                     -      E01      -
G22    BRANCH OFFICE G2                     -      E01      -
H22    BRANCH OFFICE H2                     -      E01      -
I22    BRANCH OFFICE I2                     -      E01      -
J22    BRANCH OFFICE J2                     -      E01      -
Z99    RESEARCH &amp; DEVELOPMENT               -      E01      -

  15 record(s) selected.

	</pre><p>
	Only one record was inserted. As a final step, clean up both the
	tables:
	</p><pre class="screen">
tiian@ubuntu:~/tmp$ ./example3_db2 delete dept
tiian@ubuntu:~/tmp$ ./example3_db2 delete org
	</pre><p>
	and check the tables were cleaned-up:
	</p><pre class="screen">
db2 =&gt; select * from DB2INST1.DEPT

DEPTNO DEPTNAME                             MGRNO  ADMRDEPT LOCATION
------ ------------------------------------ ------ -------- ----------------
A00    SPIFFY COMPUTER SERVICE DIV.         000010 A00      -
B01    PLANNING                             000020 A00      -
C01    INFORMATION CENTER                   000030 A00      -
D01    DEVELOPMENT CENTER                   -      A00      -
D11    MANUFACTURING SYSTEMS                000060 D01      -
D21    ADMINISTRATION SYSTEMS               000070 D01      -
E01    SUPPORT SERVICES                     000050 A00      -
E11    OPERATIONS                           000090 E01      -
E21    SOFTWARE SUPPORT                     000100 E01      -
F22    BRANCH OFFICE F2                     -      E01      -
G22    BRANCH OFFICE G2                     -      E01      -
H22    BRANCH OFFICE H2                     -      E01      -
I22    BRANCH OFFICE I2                     -      E01      -
J22    BRANCH OFFICE J2                     -      E01      -

  14 record(s) selected.

db2 =&gt; select * from DB2INST1.ORG

DEPTNUMB DEPTNAME       MANAGER DIVISION   LOCATION
-------- -------------- ------- ---------- -------------
      10 Head Office        160 Corporate  New York
      15 New England         50 Eastern    Boston
      20 Mid Atlantic        10 Eastern    Washington
      38 South Atlantic      30 Eastern    Atlanta
      42 Great Lakes        100 Midwest    Chicago
      51 Plains             140 Midwest    Dallas
      66 Pacific            270 Western    San Francisco
      84 Mountain           290 Western    Denver

  8 record(s) selected.

	</pre><p>
	To verify the LIXA Transaction Manager and DB2 Resource Manager
	are using the dynamic transaction registration, you can inspect
	the trace produced by the LIXA client library:
	</p><pre class="screen">
tiian@ubuntu:~/tmp$ export LIXA_TRACE_MASK=0x00002000
tiian@ubuntu:~/tmp$ echo $LIXA_TRACE_MASK
0x00002000
tiian@ubuntu:~/tmp$ ./example3_db2 insert dept 2&gt;&amp;1 | grep ax_reg
2011-04-22 22:08:40.650458 [6654/3039381232] ax_reg: rmid=0, xid=0xbfcd65d0, flags=0x0
2011-04-22 22:08:40.650858 [6654/3039381232] ax_reg: the application program has started a transaction (TX states S3); this XID '1279875137.9a73b024b7ab4018915b54761d3dcd79.e41205820a9c722218578c0eeec6a27c' will be returned
2011-04-22 22:08:40.651156 [6654/3039381232] ax_reg: sending 153 bytes to the server for step 8
2011-04-22 22:08:40.651316 [6654/3039381232] ax_reg/excp=7/ret_cod=0/errno=2
	</pre><p>
	I don't know how you can retrieve the same information on the
	DB2 side, but there probably is a way to do it. Clean-up again
	the table...
	</p><pre class="screen">
tiian@ubuntu:~/tmp$ ./example3_db2 delete dept
	</pre><p>
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp68029088"></a>Program execution (static registration)</h3></div></div></div><p>
	If you desire static transaction registration instead of the
	dynamic one, you can switch the <code class="varname">LIXA_PROFILE</code>:
	</p><pre class="screen">
tiian@ubuntu:~/tmp$ export LIXA_PROFILE=DB2_STA
tiian@ubuntu:~/tmp$ echo $LIXA_PROFILE
DB2_STA
tiian@ubuntu:~/tmp$ export LIXA_TRACE_MASK=0x00002000
tiian@ubuntu:~/tmp$ echo $LIXA_TRACE_MASK
0x00002000
	</pre><p>
	you can verify in file
	<code class="filename">/opt/lixa/etc/lixac_conf.xml</code>
	that <span class="quote">“<span class="quote">DB2_STA</span>”</span> is associated to static registration.
	Execute the program:
	</p><pre class="screen">
tiian@ubuntu:~/tmp$ ./example3_db2 insert dept 2&gt;&amp;1 | grep xa_start
2011-04-22 22:19:45.717003 [6745/3038836464] lixa_xa_start
[...]
2011-04-22 22:19:45.758075 [6745/3038836464] lixa_xa_start: xa_start_entry(xid, 0, 0x0) = 0
2011-04-22 22:19:45.758321 [6745/3038836464] lixa_xa_start: sending 210 bytes to the server for step 24
2011-04-22 22:19:45.758681 [6745/3038836464] lixa_xa_start/excp=10/ret_cod=0/errno=2
	</pre><p>
	Check the content of the table:
	</p><pre class="screen">
db2 =&gt; select * from DB2INST1.DEPT

DEPTNO DEPTNAME                             MGRNO  ADMRDEPT LOCATION
------ ------------------------------------ ------ -------- ----------------
A00    SPIFFY COMPUTER SERVICE DIV.         000010 A00      -
B01    PLANNING                             000020 A00      -
C01    INFORMATION CENTER                   000030 A00      -
D01    DEVELOPMENT CENTER                   -      A00      -
D11    MANUFACTURING SYSTEMS                000060 D01      -
D21    ADMINISTRATION SYSTEMS               000070 D01      -
E01    SUPPORT SERVICES                     000050 A00      -
E11    OPERATIONS                           000090 E01      -
E21    SOFTWARE SUPPORT                     000100 E01      -
F22    BRANCH OFFICE F2                     -      E01      -
G22    BRANCH OFFICE G2                     -      E01      -
H22    BRANCH OFFICE H2                     -      E01      -
I22    BRANCH OFFICE I2                     -      E01      -
J22    BRANCH OFFICE J2                     -      E01      -
Z99    RESEARCH &amp; DEVELOPMENT               -      E01      -

  15 record(s) selected.

	</pre><p>
	And clean the table again:
	</p><pre class="screen">
tiian@ubuntu:~/tmp$ unset LIXA_TRACE_MASK
tiian@ubuntu:~/tmp$ ./example3_db2 delete dept
	</pre><p>
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp67960224"></a>An example with Oracle and IBM DB2</h2></div></div></div><div class="figure"><a id="develop4"></a><p class="title"><strong>Figure 5.4. Deploy model of an example showing a distributed transaction with Oracle and IBM DB2</strong></p><div class="figure-contents"><div class="mediaobject"><img src="../images/LIXA_Development_4.png" alt="Deploy model of an example showing a distributed transaction with Oracle and IBM DB2" /></div></div></div><br class="figure-break" /><p>
      This example should be considered a milestone because it shows as
      you can implement DTP (Distributed Transaction Processing) with two
      Resource Managers (Oracle Database Server and IBM DB2 DBMS)
      coordinated by the LIXA Transaction Manager.
      It's strongly suggested you have played with the
      examples previously shown in this chapter (see
      <a class="xref" href="#Development" title="Chapter 5. Developing C Application Programs">Chapter 5, <em>Developing C Application Programs</em></a>) before starting this more complex one.
    </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	If you did not yet installed the software provided by Oracle,
	please refer to the official Oracle site to download the
	software and to pick-up the information necessary to install 
	and configure
	the database. This manual does not give you information related
	to Oracle technology: it is assumed you already installed and
	configured the database.
      </p><p>
	If you did not yet installed the software provided by IBM,
	please refer to the official IBM site to download the
	software and to pick-up the information necessary to install 
	and configure
	the database. This manual does not give you information related
	to IBM DB2 technology: it is assumed you already installed and
	configured the database.
      </p></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
	The LIXA software must be configured to support the Oracle Database
	Server and the IBM DB2 resource managers as explained in 
	<a class="xref" href="#Linking_third_party_resource_managers" title="Linking third party resource managers">the section called “Linking third party resource managers”</a>.
	As a little hint, you should configure LIXA as below:
	</p><pre class="screen">
./configure --with-oracle=/usr/lib/oracle/xe/app/oracle/product/10.2.0/server --with-ibmdb2=/opt/ibm/db2/V9.7
	</pre><p>
	Please don't forget you must compile and install every time you
	re-configure.
      </p></div><p>
      Please follow the instructions explained 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	    in <a class="xref" href="#Development_setup_Oracle_environment" title="Set-up the Oracle environment (server side)">the section called “Set-up the Oracle environment (server side)”</a>
	    to set-up a running environment for Oracle Database Server
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	    in <a class="xref" href="#Development_setup_DB2_environment" title="Set-up DB2 environment">the section called “Set-up DB2 environment”</a>
	    to set-up a running environment for IBM DB2 server
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	    in <a class="xref" href="#Development_start_LIXA_server" title="Start the LIXA state server">the section called “Start the LIXA state server”</a>
	    to start up the LIXA state server
	</p></li></ul></div><p>
    </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp68050144"></a>Build the client program</h3></div></div></div><p>
	Prepare the client (Application Program) using the below commands
	(<span class="command"><strong>gcc</strong></span> command was splitted on several lines 
	using <span class="command"><strong>\</strong></span> to help readability, but you may use
	a single line):
	</p><pre class="screen">
tiian@ubuntu:~$ mkdir tmp
tiian@ubuntu:~$ cd tmp
tiian@ubuntu:~/tmp$ cp /opt/lixa/share/doc/lixa-X.Y.Z/examples/example4_ora_db2.c .
tiian@ubuntu:~/tmp$ gcc example4_ora_db2.c $(/opt/lixa/bin/lixa-config -c -f -l -d) \
&gt; -I/usr/lib/oracle/xe/app/oracle/product/10.2.0/server/rdbms/public \
&gt; -L/usr/lib/oracle/xe/app/oracle/product/10.2.0/server/lib -l clntsh -l nnz10 \
&gt; -I/opt/ibm/db2/V9.7/include -L/opt/ibm/db2/V9.7/lib32/ -ldb2 -o example4_ora_db2
	</pre><p>
	Verify the executable produced by <span class="command"><strong>gcc</strong></span>:
	</p><pre class="screen">
tiian@ubuntu:~/tmp$ ldd example4_ora_db2
        linux-gate.so.1 =&gt;  (0xb770e000)
        liblixac.so.0 =&gt; /opt/lixa/lib/liblixac.so.0 (0xb76f3000)
        libclntsh.so.10.1 =&gt; not found
        libnnz10.so =&gt; not found
        libdb2.so.1 =&gt; /usr/lib/libdb2.so.1 (0xb61b2000)
        libc.so.6 =&gt; /lib/tls/i686/cmov/libc.so.6 (0xb6063000)
        libgmodule-2.0.so.0 =&gt; /usr/lib/libgmodule-2.0.so.0 (0xb605f000)
        libdl.so.2 =&gt; /lib/tls/i686/cmov/libdl.so.2 (0xb605b000)
        libgthread-2.0.so.0 =&gt; /usr/lib/libgthread-2.0.so.0 (0xb6055000)
        librt.so.1 =&gt; /lib/tls/i686/cmov/librt.so.1 (0xb604c000)
        libglib-2.0.so.0 =&gt; /usr/lib/libglib-2.0.so.0 (0xb5f9b000)
        libxml2.so.2 =&gt; /usr/lib/libxml2.so.2 (0xb5e7b000)
        liblixab.so.0 =&gt; /opt/lixa/lib/liblixab.so.0 (0xb5e66000)
        libm.so.6 =&gt; /lib/tls/i686/cmov/libm.so.6 (0xb5e41000)
        libpthread.so.0 =&gt; /lib/tls/i686/cmov/libpthread.so.0 (0xb5e28000)
        libcrypt.so.1 =&gt; /lib/tls/i686/cmov/libcrypt.so.1 (0xb5df6000)
        libpam.so.0 =&gt; /lib/libpam.so.0 (0xb5dec000)
        libdb2dascmn.so.1 =&gt; /opt/ibm/db2/V9.7/lib32/libdb2dascmn.so.1 (0xb5dbe000)
        libdb2g11n.so.1 =&gt; /opt/ibm/db2/V9.7/lib32/libdb2g11n.so.1 (0xb5750000)
        libdb2genreg.so.1 =&gt; /opt/ibm/db2/V9.7/lib32/libdb2genreg.so.1 (0xb5710000)
        libdb2install.so.1 =&gt; /opt/ibm/db2/V9.7/lib32/libdb2install.so.1 (0xb5705000)
        libdb2locale.so.1 =&gt; /opt/ibm/db2/V9.7/lib32/libdb2locale.so.1 (0xb56f2000)
        libdb2osse.so.1 =&gt; /opt/ibm/db2/V9.7/lib32/libdb2osse.so.1 (0xb53ec000)
        libdb2osse_db2.so.1 =&gt; /opt/ibm/db2/V9.7/lib32/libdb2osse_db2.so.1 (0xb537c000)
        libdb2trcapi.so.1 =&gt; /opt/ibm/db2/V9.7/lib32/libdb2trcapi.so.1 (0xb5369000)
        libstdc++.so.6 =&gt; /usr/lib/libstdc++.so.6 (0xb5276000)
        libgcc_s.so.1 =&gt; /lib/libgcc_s.so.1 (0xb526b000)
        /lib/ld-linux.so.2 (0xb770f000)
        libpcre.so.3 =&gt; /usr/lib/libpcre.so.3 (0xb5243000)
        libz.so.1 =&gt; /usr/lib/libz.so.1 (0xb522e000)
        libuuid.so.1 =&gt; /lib/libuuid.so.1 (0xb522a000)
	</pre><p>
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp68055920"></a>Set-up LIXA environment</h3></div></div></div><p>
	There are three unresolved references that can be fixed setting up
	the environment properly; you can fix the environment manually or
	using these scripts supplied by Oracle and IBM:
	<code class="filename">/home/db2inst1/sqllib/db2profile</code> and
	<code class="filename">/usr/lib/oracle/xe/app/oracle/product/10.2.0/server/bin/oracle_env.sh</code>
	</p><pre class="screen">
tiian@ubuntu:~$ echo $LD_LIBRARY_PATH

tiian@ubuntu:~$ . /home/db2inst1/sqllib/db2profile
tiian@ubuntu:~$ . /usr/lib/oracle/xe/app/oracle/product/10.2.0/server/bin/oracle_env.sh
tiian@ubuntu:~$ echo $LD_LIBRARY_PATH
/usr/lib/oracle/xe/app/oracle/product/10.2.0/server/lib:/home/db2inst1/sqllib/lib32
	</pre><p>
	Check again the executable:
	</p><pre class="screen">
tiian@ubuntu:~/tmp$ ldd example4_ora_db2
        linux-gate.so.1 =&gt;  (0xb777f000)
        liblixac.so.0 =&gt; /opt/lixa/lib/liblixac.so.0 (0xb7764000)
        libclntsh.so.10.1 =&gt; /usr/lib/oracle/xe/app/oracle/product/10.2.0/server/lib/libclntsh.so.10.1 (0xb69b0000)
        libnnz10.so =&gt; /usr/lib/oracle/xe/app/oracle/product/10.2.0/server/lib/libnnz10.so (0xb67aa000)
        libdb2.so.1 =&gt; /home/db2inst1/sqllib/lib32/libdb2.so.1 (0xb5278000)
        libc.so.6 =&gt; /lib/tls/i686/cmov/libc.so.6 (0xb511b000)
        libgmodule-2.0.so.0 =&gt; /usr/lib/libgmodule-2.0.so.0 (0xb5117000)
        libdl.so.2 =&gt; /lib/tls/i686/cmov/libdl.so.2 (0xb5113000)
        libgthread-2.0.so.0 =&gt; /usr/lib/libgthread-2.0.so.0 (0xb510d000)
        librt.so.1 =&gt; /lib/tls/i686/cmov/librt.so.1 (0xb5104000)
        libglib-2.0.so.0 =&gt; /usr/lib/libglib-2.0.so.0 (0xb5053000)
        libxml2.so.2 =&gt; /usr/lib/libxml2.so.2 (0xb4f33000)
        liblixab.so.0 =&gt; /opt/lixa/lib/liblixab.so.0 (0xb4f1e000)
        libm.so.6 =&gt; /lib/tls/i686/cmov/libm.so.6 (0xb4ef9000)
        libpthread.so.0 =&gt; /lib/tls/i686/cmov/libpthread.so.0 (0xb4ee0000)
        libnsl.so.1 =&gt; /lib/tls/i686/cmov/libnsl.so.1 (0xb4ec8000)
        libcrypt.so.1 =&gt; /lib/tls/i686/cmov/libcrypt.so.1 (0xb4e95000)
        libpam.so.0 =&gt; /lib/libpam.so.0 (0xb4e8b000)
        libdb2dascmn.so.1 =&gt; /home/db2inst1/sqllib/lib32/libdb2dascmn.so.1 (0xb4e5e000)
        libdb2g11n.so.1 =&gt; /home/db2inst1/sqllib/lib32/libdb2g11n.so.1 (0xb47f0000)
        libdb2genreg.so.1 =&gt; /home/db2inst1/sqllib/lib32/libdb2genreg.so.1 (0xb47b0000)
        libdb2install.so.1 =&gt; /home/db2inst1/sqllib/lib32/libdb2install.so.1 (0xb47a4000)
        libdb2locale.so.1 =&gt; /home/db2inst1/sqllib/lib32/libdb2locale.so.1 (0xb4791000)
        libdb2osse.so.1 =&gt; /home/db2inst1/sqllib/lib32/libdb2osse.so.1 (0xb448c000)
        libdb2osse_db2.so.1 =&gt; /home/db2inst1/sqllib/lib32/libdb2osse_db2.so.1 (0xb441c000)
        libdb2trcapi.so.1 =&gt; /home/db2inst1/sqllib/lib32/libdb2trcapi.so.1 (0xb4409000)
        libstdc++.so.6 =&gt; /usr/lib/libstdc++.so.6 (0xb4315000)
        libgcc_s.so.1 =&gt; /lib/libgcc_s.so.1 (0xb430a000)
        /lib/ld-linux.so.2 (0xb7780000)
        libpcre.so.3 =&gt; /usr/lib/libpcre.so.3 (0xb42e3000)
        libz.so.1 =&gt; /usr/lib/libz.so.1 (0xb42ce000)
        libuuid.so.1 =&gt; /lib/libuuid.so.1 (0xb42ca000)
	</pre><p>
	Set-up the necessary environment variables:
	</p><pre class="screen">
tiian@ubuntu:~/tmp$ echo $LIXA_PROFILE

tiian@ubuntu:~/tmp$ export LIXA_PROFILE=ORA_DYN_DB2_DYN
tiian@ubuntu:~/tmp$ echo $LIXA_PROFILE
ORA_DYN_DB2_SYN
	</pre><p>
	The below environment variables were set by the previous sourced
	script; take a look to them:
	</p><pre class="screen">
tiian@ubuntu:~/tmp$ echo $ORACLE_HOME
/usr/lib/oracle/xe/app/oracle/product/10.2.0/server
tiian@ubuntu:~/tmp$ echo $PATH
/usr/lib/oracle/xe/app/oracle/product/10.2.0/server/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/home/db2inst1/sqllib/bin:/home/db2inst1/sqllib/adm:/home/db2inst1/sqllib/misc:/home/db2inst1/sqllib/db2tss/bin
tiian@ubuntu:~/tmp$ echo $ORACLE_SID
XE
	</pre><p>
	It is suggested to set the necessary environment variables in your 
	profile if you are going to execute the programs many times.
	This is the list of the suggested variables:
	<code class="varname">LD_LIBRARY_PATH</code>,
	<code class="varname">LIXA_PROFILE</code>,
	<code class="varname">ORACLE_HOME</code>,
	<code class="varname">ORACLE_SID</code>,
	<code class="varname">PATH</code>.
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp68065936"></a>Some checks before program execution</h3></div></div></div><p>
	We set <code class="varname">LIXA_PROFILE</code> to value
	<span class="quote">“<span class="quote">ORA_DYN_DB2_DYN</span>”</span>, looking at
	<code class="filename">/opt/lixa/etc/lixac_conf.xml</code>:
	</p><pre class="screen">
    &lt;profile name="ORA_DYN_DB2_DYN"&gt;
      &lt;sttsrvs&gt;
        &lt;sttsrv&gt;local_1&lt;/sttsrv&gt;
      &lt;/sttsrvs&gt;
      &lt;rsrmgrs&gt;
        &lt;rsrmgr&gt;OracleXE_dynreg&lt;/rsrmgr&gt;
        &lt;rsrmgr&gt;IBMDB2_stareg&lt;/rsrmgr&gt;
      &lt;/rsrmgrs&gt;
    &lt;/profile&gt;
	</pre><p>
	the profile references two Resource Managers:
	<span class="quote">“<span class="quote">OracleXE_dynreg</span>”</span> and <span class="quote">“<span class="quote">IBMDB2_stareg</span>”</span>, 
	looking again at the config file:
	</p><pre class="screen">
    &lt;rsrmgr name="OracleXE_dynreg" switch_file="/opt/lixa/lib/switch_oracle_dynreg.so" xa_open_info="Oracle_XA+Acc=P/hr/hr+SesTm=30+LogDir=/tmp+threads=true+DbgFl=7+Loose_Coupling=true" xa_close_info="" /&gt;
    &lt;rsrmgr name="IBMDB2_dynreg" switch_file="/opt/lixa/lib/switch_ibmdb2_dynreg.so" xa_open_info="axlib=/opt/lixa/lib/liblixac.so,db=sample,tpm=lixa" xa_close_info="" /&gt;
	</pre><p>
	we can discover how our application will access the resource
	managers
	<a href="#ftn.idp68070480" class="footnote" id="idp68070480"><sup class="footnote">[26]</sup></a>. 
	Verify no (Oracle) trace file exists:
	</p><pre class="screen">
tiian@ubuntu:~/tmp$ ls -la /tmp/xa*
ls: cannot access /tmp/xa*: No such file or directory
	</pre><p>
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp68075792"></a>Program execution (dynamic registration)</h3></div></div></div><p>
	It is suggested to open three different terminals: 
	the first one connected to <span class="quote">“<span class="quote">SAMPLE</span>”</span> DB2 database,
	the second one connected to Oracle database and the
	third one pointing to the directory where the compiled program 
	example4_ora_db2 lives.
	</p><div class="table"><table frame="box"><thead><tr><td>[IBM DB2 terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~$ . /home/db2inst1/sqllib/db2profile
tiian@ubuntu:~$ db2
(c) Copyright IBM Corporation 1993,2007
Command Line Processor for DB2 Client 9.7.1

You can issue database manager commands and SQL statements from the command
prompt. For example:
    db2 =&gt; connect to sample
    db2 =&gt; bind sample.bnd

For general help, type: ?.
For command help, type: ? command, where command can be
the first few keywords of a database manager command. For example:
 ? CATALOG DATABASE for help on the CATALOG DATABASE command
 ? CATALOG          for help on all of the CATALOG commands.

To exit db2 interactive mode, type QUIT at the command prompt. Outside
interactive mode, all commands must be prefixed with 'db2'.
To list the current command option settings, type LIST COMMAND OPTIONS.

For more detailed help, refer to the Online Reference Manual.

db2 =&gt; connect to SAMPLE

   Database Connection Information

 Database server        = DB2/LINUX 9.7.1
 SQL authorization ID   = TIIAN
 Local database alias   = SAMPLE

db2 =&gt;
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[Oracle terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~$ . /usr/lib/oracle/xe/app/oracle/product/10.2.0/server/bin/oracle_env.sh
tiian@ubuntu:~$ sqlplus "hr/hr"                                                 
SQL*Plus: Release 10.2.0.1.0 - Production on Tue May 3 21:52:06 2011

Copyright (c) 1982, 2005, Oracle.  All rights reserved.


Connected to:
Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production

SQL&gt;
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ ls -la
total 36
drwxr-xr-x  2 tiian tiian  4096 2011-05-03 21:53 .
drwxr-xr-x 40 tiian tiian  4096 2011-05-03 21:04 ..
-rwxr-xr-x  1 tiian tiian 14422 2011-05-02 21:53 example4_ora_db2
-rw-r--r--  1 tiian tiian 11892 2011-05-02 21:52 example4_ora_db2.c
	  </pre></td></tr></tbody></table></div><p>
	Check the content of the Oracle table (<span class="quote">“<span class="quote">COUNTRIES</span>”</span>):
	</p><div class="table"><table frame="box"><thead><tr><td>[Oracle terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
SQL&gt; select * from COUNTRIES where COUNTRY_ID = 'RS';

no rows selected
	  </pre></td></tr></tbody></table></div><p>
	Check the content of the DB2 tables (<span class="quote">“<span class="quote">DB2INST1.ORG</span>”</span> and
	<span class="quote">“<span class="quote">DB2INST1.DEPT</span>”</span>):
	</p><div class="table"><table frame="box"><thead><tr><td>[IBM DB2 terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
db2 =&gt; select * from DB2INST1.ORG where DEPTNUMB = 150

DEPTNUMB DEPTNAME       MANAGER DIVISION   LOCATION
-------- -------------- ------- ---------- -------------

  0 record(s) selected.

db2 =&gt; select * from DB2INST1.DEPT where DEPTNO='Z99'

DEPTNO DEPTNAME                             MGRNO  ADMRDEPT LOCATION
------ ------------------------------------ ------ -------- ----------------

  0 record(s) selected.
	  </pre></td></tr></tbody></table></div><p>
	<span class="command"><strong>example4_ora_db2</strong></span> program accepts some arguments
	you can tune to experiment different transactions:
	</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	      <code class="option">iorg</code>: insert a row into 
	      <span class="quote">“<span class="quote">DB2INST1.ORG</span>”</span> table
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      <code class="option">dorg</code>: delete rows from 
	      <span class="quote">“<span class="quote">DB2INST1.ORG</span>”</span> table
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      <code class="option">idept</code>: insert a row into 
	      <span class="quote">“<span class="quote">DB2INST1.DEPT</span>”</span> table
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      <code class="option">ddept</code>: delete rows from 
	      <span class="quote">“<span class="quote">DB2INST1.DEPT</span>”</span> table
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      <code class="option">icountries</code>: insert a row into 
	      <span class="quote">“<span class="quote">COUNTRIES</span>”</span> table
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      <code class="option">dcountries</code>: delete rows from 
	      <span class="quote">“<span class="quote">COUNTRIES</span>”</span> table
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      <code class="option">rollback</code>: force a transaction rollback (the
	      default behavior is commit)
	  </p></li></ul></div><p>
	Insert a row in all the tables and check the contents of the tables
	after the transaction execution:
	</p><div class="table"><table frame="box"><thead><tr><td>[Third terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ ./example4_ora_db2 iorg icountries idept
INSERT INTO DB2INST1.ORG executed!
INSERT INTO COUNTRIES executed!
INSERT INTO DB2INST1.DEPT executed!
COMMIT performed!
	  </pre></td></tr></tbody></table></div><p>
	Now you can verify the content of the tables after the transaction:
	</p><div class="table"><table frame="box"><thead><tr><td>[Oracle terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
SQL&gt; select * from COUNTRIES where COUNTRY_ID = 'RS';

CO COUNTRY_NAME                              REGION_ID
-- ---------------------------------------- ----------
RS Repubblica San Marino                             1
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[IBM DB2 terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
db2 =&gt; select * from DB2INST1.ORG where DEPTNUMB = 150

DEPTNUMB DEPTNAME       MANAGER DIVISION   LOCATION
-------- -------------- ------- ---------- -------------
     150 Europe             231 R&amp;D        Mojan

  1 record(s) selected.

db2 =&gt;  select * from DB2INST1.DEPT where DEPTNO='Z99'

DEPTNO DEPTNAME                             MGRNO  ADMRDEPT LOCATION
------ ------------------------------------ ------ -------- ----------------
Z99    RESEARCH &amp; DEVELOPMENT               -      E01      -

  1 record(s) selected.
	  </pre></td></tr></tbody></table></div><p>
	With the opposite command you can remove the rows from the tables:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ ./example4_ora_db2 dorg dcountries ddept
DELETE FROM DB2INST1.ORG executed!
DELETE FROM COUNTRIES executed!
DELETE FROM DB2INST1.DEPT executed!
COMMIT performed!
	  </pre></td></tr></tbody></table></div><p>
	and check the content of the tables again:
	</p><div class="table"><table frame="box"><thead><tr><td>[Oracle terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
SQL&gt; select * from COUNTRIES where COUNTRY_ID = 'RS';

no rows selected
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[IBM DB2 terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
db2 =&gt; select * from DB2INST1.ORG where DEPTNUMB = 150

DEPTNUMB DEPTNAME       MANAGER DIVISION   LOCATION
-------- -------------- ------- ---------- -------------

  0 record(s) selected.

db2 =&gt; select * from DB2INST1.DEPT where DEPTNO='Z99'

DEPTNO DEPTNAME                             MGRNO  ADMRDEPT LOCATION
------ ------------------------------------ ------ -------- ----------------

  0 record(s) selected.
	  </pre></td></tr></tbody></table></div><p>
	This sequence shows what happens trying to insert a duplicated row
	in a table that does not allow duplicates:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ ./example4_ora_db2 iorg icountries idept
INSERT INTO DB2INST1.ORG executed!
INSERT INTO COUNTRIES executed!
INSERT INTO DB2INST1.DEPT executed!
COMMIT performed!
tiian@ubuntu:~/tmp$ ./example4_ora_db2 iorg icountries idept
INSERT INTO DB2INST1.ORG executed!
OCIStmtExecute/Error while executing INSERT statement; ocirc = -1
ROLLBACK performed!
	  </pre></td></tr></tbody></table></div><p>
	Verify that table <span class="quote">“<span class="quote">DB2INST1.ORG</span>”</span> contains only one row
	because the second transaction was rolled back after the error
	occurred while inserting a duplicated row in <span class="quote">“<span class="quote">COUNTRIES</span>”</span>
	table:
	</p><div class="table"><table frame="box"><thead><tr><td>[IBM DB2 terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
db2 =&gt; select * from DB2INST1.ORG where DEPTNUMB = 150

DEPTNUMB DEPTNAME       MANAGER DIVISION   LOCATION
-------- -------------- ------- ---------- -------------
     150 Europe             231 R&amp;D        Mojan

  1 record(s) selected.
	  </pre></td></tr></tbody></table></div><p>
	Remove the rows from the tables:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ ./example4_ora_db2 dorg dcountries ddept
DELETE FROM DB2INST1.ORG executed!
DELETE FROM COUNTRIES executed!
DELETE FROM DB2INST1.DEPT executed!
COMMIT performed!
	  </pre></td></tr></tbody></table></div><p>
	We can introduce the usage of the <code class="option">rollback</code> option 
	to check dynamic registration behavior:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ export LIXA_TRACE_MASK=0x00002000
tiian@ubuntu:~/tmp$ echo $LIXA_TRACE_MASK
0x00002000
tiian@ubuntu:~/tmp$ ./example4_ora_db2 iorg icountries idept rollback 2&gt;&amp;1 | grep ax_reg
2011-05-04 22:35:07.919522 [8962/3023124208] ax_reg: rmid=1, xid=0xbfe8d1f0, flags=0x0
2011-05-04 22:35:07.920026 [8962/3023124208] ax_reg: the application program has started a transaction (TX states S3); this XID '1279875137.47b3b61569764774bfc1e5f79ef725ae.818e85f29a0c09e22f0c75f89ca17658' will be returned
2011-05-04 22:35:07.920276 [8962/3023124208] ax_reg: sending 153 bytes to the server for step 8
2011-05-04 22:35:07.920527 [8962/3023124208] ax_reg/excp=7/ret_cod=0/errno=2
2011-05-04 22:35:07.921592 [8962/3023124208] ax_reg: rmid=0, xid=0xbfe8b09c, flags=0x0
2011-05-04 22:35:07.921812 [8962/3023124208] ax_reg: the application program has started a transaction (TX states S3); this XID '1279875137.47b3b61569764774bfc1e5f79ef725ae.818e85f29a0c09e22f0c75f89ca17658' will be returned
2011-05-04 22:35:07.921979 [8962/3023124208] ax_reg: sending 153 bytes to the server for step 8
2011-05-04 22:35:07.922128 [8962/3023124208] ax_reg/excp=7/ret_cod=0/errno=2
	  </pre></td></tr></tbody></table></div><p>
	The second resource manager for profile
	<span class="quote">“<span class="quote">ORA_DYN_DB2_DYN</span>”</span> is <span class="quote">“<span class="quote">IBMDB2_dynreg</span>”</span>
	and it calls <code class="function">ax_reg</code> with 
	<em class="parameter"><code>rmid=1</code></em> before the first resource manager
	that's <span class="quote">“<span class="quote">OracleXE_dynreg</span>”</span> and calls
	<code class="function">ax_reg</code> with <em class="parameter"><code>rmid=0</code></em>
	later.
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp68076912"></a>Program execution (mixed registration)</h3></div></div></div><p>
	Switching to a different registration type is quite easy; we can start
	with dynamic registration for Oracle and static registration for
	IBM DB2:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ export LIXA_TRACE_MASK=0x00002000
tiian@ubuntu:~/tmp$ echo $LIXA_TRACE_MASK
0x00002000
tiian@ubuntu:~/tmp$ export LIXA_PROFILE=ORA_DYN_DB2_STA
tiian@ubuntu:~/tmp$ echo $LIXA_PROFILE
ORA_DYN_DB2_STA
tiian@ubuntu:~/tmp$ ./example4_ora_db2 iorg icountries idept rollback 2&gt;&amp;1 | grep ax_reg
2011-05-04 22:47:11.812256 [9122/3022382832] ax_reg: rmid=0, xid=0xbfc0f59c, flags=0x0
2011-05-04 22:47:11.813114 [9122/3022382832] ax_reg: the application program has started a transaction (TX states S3); this XID '1279875137.a74508954f774509a939ad9580bca2b8.03460325a8fe89a8c8134b6dea4b782e' will be returned
2011-05-04 22:47:11.813631 [9122/3022382832] ax_reg: sending 153 bytes to the server for step 8
2011-05-04 22:47:11.814037 [9122/3022382832] ax_reg/excp=7/ret_cod=0/errno=2
tiian@ubuntu:~/tmp$ ./example4_ora_db2 iorg icountries idept rollback 2&gt;&amp;1 | grep xa_start
2011-05-04 22:47:38.081183 [9126/3022632688] lixa_xa_start
[...]
2011-05-04 22:47:38.124749 [9126/3022632688] lixa_xa_start: resource manager # 0 registers dynamically, skipping...
2011-05-04 22:47:38.125154 [9126/3022632688] lixa_xa_start: xa_start_entry(xid, 1, 0x0) = 0
2011-05-04 22:47:38.125330 [9126/3022632688] lixa_xa_start: sending 210 bytes to the server for step 24
2011-05-04 22:47:38.125654 [9126/3022632688] lixa_xa_start/excp=10/ret_cod=0/errno=2
	  </pre></td></tr></tbody></table></div><p>
	Oracle is defined as the first resource manager and calls
	<code class="function">ax_reg</code> using <em class="parameter"><code>rmid=0</code></em>.
	IBM DB2 is defined as the second resource manager and its
	<code class="function">xa_start</code> function is called
	from the LIXA transaction manager using <em class="parameter"><code>rmid=1</code></em>.
	</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	    The LIXA Transaction Manager skips the first resource manager
	    because it is configured for dynamic registration.
	</p></div><p>
	Using static registration for Oracle and dynamic registration for
	IBM DB2 is easy as well:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ export LIXA_PROFILE=ORA_STA_DB2_DYN
tiian@ubuntu:~/tmp$ echo $LIXA_PROFILE
ORA_STA_DB2_DYN
tiian@ubuntu:~/tmp$ ./example4_ora_db2 iorg icountries idept rollback 2&gt;&amp;1 | grep ax_reg
2011-05-04 22:57:37.235541 [9346/3023226608] ax_reg: rmid=1, xid=0xbfcf8880, flags=0x0
2011-05-04 22:57:37.236410 [9346/3023226608] ax_reg: the application program has started a transaction (TX states S3); this XID '1279875137.1bf330d60c0442e4b61539214a413ecb.79fecb55351db58295ebf99c9bf09a70' will be returned
2011-05-04 22:57:37.236859 [9346/3023226608] ax_reg: sending 153 bytes to the server for step 8
2011-05-04 22:57:37.237581 [9346/3023226608] ax_reg/excp=7/ret_cod=0/errno=2
tiian@ubuntu:~/tmp$ ./example4_ora_db2 iorg icountries idept rollback 2&gt;&amp;1 | grep xa_start
2011-05-04 22:58:10.258562 [9350/3022706416] lixa_xa_start
[...]
2011-05-04 22:58:10.296182 [9350/3022706416] lixa_xa_start: xa_start_entry(xid, 0, 0x0) = 0
2011-05-04 22:58:10.296448 [9350/3022706416] lixa_xa_start: resource manager # 1 registers dynamically, skipping...
2011-05-04 22:58:10.296625 [9350/3022706416] lixa_xa_start: sending 210 bytes to the server for step 24
2011-05-04 22:58:10.296990 [9350/3022706416] lixa_xa_start/excp=10/ret_cod=0/errno=2
	  </pre></td></tr></tbody></table></div><p>
	Now the roles of Oracle and IBM DB2 swapped. As a final example
	you can try the static registration for Oracle and IBM DB2 too:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ export LIXA_PROFILE=ORA_STA_DB2_STA
tiian@ubuntu:~/tmp$ echo $LIXA_PROFILE
ORA_STA_DB2_STA
tiian@ubuntu:~/tmp$ ./example4_ora_db2 iorg icountries idept rollback 2&gt;&amp;1 | grep ax_reg
tiian@ubuntu:~/tmp$ ./example4_ora_db2 iorg icountries idept rollback 2&gt;&amp;1 | grep xa_start
2011-05-04 23:00:27.871131 [9356/3022927600] lixa_xa_start
[...]
2011-05-04 23:00:27.917087 [9356/3022927600] lixa_xa_start: xa_start_entry(xid, 0, 0x0) = 0
2011-05-04 23:00:27.918251 [9356/3022927600] lixa_xa_start: xa_start_entry(xid, 1, 0x0) = 0
2011-05-04 23:00:27.918741 [9356/3022927600] lixa_xa_start: sending 281 bytes to the server for step 24
2011-05-04 23:00:27.919389 [9356/3022927600] lixa_xa_start/excp=10/ret_cod=0/errno=2
	  </pre></td></tr></tbody></table></div><p>
	No resource manager calls <code class="function">ax_reg</code> with this
	configuration: this is exactly what's expected.
      </p><p>
	As a final check, we can verify all the tables have no rows:
	</p><div class="table"><table frame="box"><thead><tr><td>[Oracle terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
SQL&gt; select * from COUNTRIES where COUNTRY_ID = 'RS';

no rows selected
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[IBM DB2 terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
db2 =&gt; select * from DB2INST1.ORG where DEPTNUMB = 150

DEPTNUMB DEPTNAME       MANAGER DIVISION   LOCATION
-------- -------------- ------- ---------- -------------

  0 record(s) selected.

db2 =&gt; select * from DB2INST1.DEPT where DEPTNO='Z99'

DEPTNO DEPTNAME                             MGRNO  ADMRDEPT LOCATION
------ ------------------------------------ ------ -------- ----------------

  0 record(s) selected.
	  </pre></td></tr></tbody></table></div><p>
	Congratulations! You have just completed a full discovery of
	a Distributed Transaction Processing example with a simple
	Application Program, LIXA Transaction Manager and two widespread
	Resource Managers: Oracle Database Server and IBM DB2 DBMS.
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Development_example5_pql"></a>An example with PostgreSQL</h2></div></div></div><div class="figure"><a id="develop5"></a><p class="title"><strong>Figure 5.5. Deploy model of an example with PostgreSQL DBMS</strong></p><div class="figure-contents"><div class="mediaobject"><img src="../images/LIXA_Development_5.png" alt="Deploy model of an example with PostgreSQL DBMS" /></div></div></div><br class="figure-break" /><p>
      This example has been developed using PostgreSQL 9.1.24 (and upper)
      for Linux. Here is a brief list of the tested versions for Ubuntu 12.04,
      14.04, 16.04 and CentOS/RHEL 7.3 and the installed packages:
      </p><pre class="screen">
tiian@ubuntu1204-64:/tmp$ dpkg -l | grep -i -e pq -e postgresql
ii  libpq-dev                        9.1.24-0ubuntu0.12.04               header files for libpq5 (PostgreSQL library)
ii  libpq5                           9.1.24-0ubuntu0.12.04               PostgreSQL C client library
ii  postgresql                       9.1+129ubuntu1                      object-relational SQL database (supported version)
ii  postgresql-9.1                   9.1.24-0ubuntu0.12.04               object-relational SQL database, version 9.1 server
ii  postgresql-client-9.1            9.1.24-0ubuntu0.12.04               front-end programs for PostgreSQL 9.1
ii  postgresql-client-common         129ubuntu1                          manager for multiple PostgreSQL client versions
ii  postgresql-common                129ubuntu1                          PostgreSQL database-cluster manager

tiian@ubuntu1404-64:/tmp$ dpkg -l | grep -i -e pq -e postgresql
ii  libpq-dev                           9.3.16-0ubuntu0.14.04               amd64        header files for libpq5 (PostgreSQL library)
ii  libpq5                              9.3.16-0ubuntu0.14.04               amd64        PostgreSQL C client library
ii  postgresql                          9.3+154ubuntu1                      all          object-relational SQL database (supported version)
ii  postgresql-9.3                      9.3.16-0ubuntu0.14.04               amd64        object-relational SQL database, version 9.3 server
ii  postgresql-client-9.3               9.3.16-0ubuntu0.14.04               amd64        front-end programs for PostgreSQL 9.3
ii  postgresql-client-common            154ubuntu1                          all          manager for multiple PostgreSQL client versions
ii  postgresql-common                   154ubuntu1                          all          PostgreSQL database-cluster manager

tiian@ubuntu1604:~$ dpkg -l | grep -i -e pq -e postgresql
ii  libpq-dev                          9.5.6-0ubuntu0.16.04                amd64        header files for libpq5 (PostgreSQL library)
ii  libpq5:amd64                       9.5.6-0ubuntu0.16.04                amd64        PostgreSQL C client library
ii  postgresql                         9.5+173                             all          object-relational SQL database (supported version)
ii  postgresql-9.5                     9.5.6-0ubuntu0.16.04                amd64        object-relational SQL database, version 9.5 server
ii  postgresql-client-9.5              9.5.6-0ubuntu0.16.04                amd64        front-end programs for PostgreSQL 9.5
ii  postgresql-client-common           173                                 all          manager for multiple PostgreSQL client versions
ii  postgresql-common                  173                                 all          PostgreSQL database-cluster manager
ii  postgresql-contrib-9.5             9.5.6-0ubuntu0.16.04                amd64        additional facilities for PostgreSQL

[tiian@centos71-64 tmp]$ rpm -qa | grep -i -e pq -e postgresql
postgresql-libs-9.2.18-1.el7.x86_64
postgresql-devel-9.2.18-1.el7.x86_64
postgresql-9.2.18-1.el7.x86_64
postgresql-server-9.2.18-1.el7.x86_64

[tiian@rhel73 tmp]$ rpm -qa | grep -i -e pq -e postgresql
postgresql-devel-9.2.18-1.el7.x86_64
postgresql-9.2.18-1.el7.x86_64
postgresql-server-9.2.18-1.el7.x86_64
postgresql-libs-9.2.18-1.el7.x86_64
      </pre><p>
      If you were using a different version you would need to adapt some
      commands to your environment.
    </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	If you did not yet installed the software, please refer to the 
	official site for your Linux distribution or to the official site
	of PostgreSQL if your operating system does not distribute the
	software or you want to use a different PostgreSQL version.
	This manual does not give you information related
	to PostgreSQL: it is assumed that you have already installed and
	configured the database.
    </p></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	This example requires you are running the database and the application
	on the same host: this is not a technical limitation, but a way to
	make it easy. Client/server configuration must work as well, but
	it needs some PostgreSQL extra configuration: please refer to the
	database documentation.
    </p></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
	The LIXA software must be configured to support the PostgreSQL
	server resource manager as explained in 
	<a class="xref" href="#Linking_third_party_resource_managers" title="Linking third party resource managers">the section called “Linking third party resource managers”</a>.
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Development_setup_PostgreSQL_environment"></a>Set-up PostgreSQL environment</h3></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp68168816"></a>Start-up the PostgreSQL server</h4></div></div></div><p>
	  If your server didn't start-up automatically at boot time, you
	  could start it with the following commands:
	  </p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1204-64:~$ sudo service postgresql status
Running clusters: 
tiian@ubuntu1204-64:~$ ps -ef|grep postgres|grep -v grep
tiian@ubuntu1204-64:~$ sudo service postgresql start
 * Starting PostgreSQL 9.1 database server                               [ OK ]
tiian@ubuntu1204-64:~$ sudo service postgresql status
Running clusters: 9.1/main 
tiian@ubuntu1204-64:~$ ps -ef|grep postgres|grep -v grep
postgres  1829     1  1 23:00 ?        00:00:00 /usr/lib/postgresql/9.1/bin/postgres -D /var/lib/postgresql/9.1/main -c config_file=/etc/postgresql/9.1/main/postgresql.conf
postgres  1831  1829  0 23:00 ?        00:00:00 postgres: writer process
postgres  1832  1829  0 23:00 ?        00:00:00 postgres: wal writer process
postgres  1833  1829  0 23:00 ?        00:00:00 postgres: autovacuum launcher process
postgres  1834  1829  0 23:00 ?        00:00:00 postgres: stats collector process
	    </pre></td></tr></tbody></table></div><p>
	  Switch to user <code class="systemitem">postgres</code>,
	  associate your user to a matching database user
	  <a href="#ftn.idp68174112" class="footnote" id="idp68174112"><sup class="footnote">[27]</sup></a>
	  ; my personal account is 
	  <code class="systemitem">tiian</code>
	  and I created the same user inside PostgreSQL database:
	  </p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1204-64:~$ sudo su - postgres
[sudo] password for tiian:
postgres@ubuntu1204-64:~$ createuser --createdb tiian
Shall the new role be a superuser? (y/n) n
Shall the new role be allowed to create more new roles? (y/n) n
postgres@ubuntu1204-64:~$ exit
logout
	    </pre></td></tr></tbody></table></div><p>
	  Create a new database and a table necessary to store some data:
	  </p><div class="table"><table frame="box"><thead><tr><td>[PostgreSQL terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1204-64:~$ createdb testdb
tiian@ubuntu1204-64:~$ psql testdb
psql (9.1.24)
Type "help" for help.

testdb=&gt;
testdb=&gt; CREATE TABLE "authors" (
testdb(&gt; "id" integer NOT NULL,
testdb(&gt; "last_name" text,
testdb(&gt; "first_name" text,
testdb(&gt; Constraint "authors_pkey" Primary Key ("id"));
NOTICE:  CREATE TABLE / PRIMARY KEY will create implicit index "authors_pkey" for table "authors"
CREATE TABLE

testdb=&gt; select * from authors;
 id | last_name | first_name
----+-----------+------------
(0 rows)
	    </pre></td></tr></tbody></table></div><p>
	  OK, the <span class="quote">“<span class="quote">authors</span>”</span> table was created. 
	  If something went wrong, you should refer to PostgreSQL
	  documentation to fix the issue before the next step because
	  you would not be able to execute the sample program without a
	  basic running installation.
	</p><p>
	  Change the 
	  <code class="systemitem">max_prepared_transactions</code>
	  parameter in file
	  <code class="filename">postgresql.conf</code>
	  to allow the desired number of prepared transactions (i.e. 10):
	  </p><pre class="screen">
shared_buffers = 24MB                   # min 128kB
                                        # (change requires restart)
#temp_buffers = 8MB                     # min 800kB
max_prepared_transactions = 10          # zero disables the feature
#max_prepared_transactions = 0          # zero disables the feature
                                        # (change requires restart)
# Note:  Increasing max_prepared_transactions costs ~600 bytes of shared memory
# per transaction slot, plus lock space (see max_locks_per_transaction).
# It is not advisable to set max_prepared_transactions nonzero unless you
# actively intend to use prepared transactions.
#work_mem = 1MB                         # min 64kB
#maintenance_work_mem = 16MB            # min 1MB
#max_stack_depth = 2MB                  # min 100kB
	  </pre><p>
	  and restart the PostgreSQL server with something like
	  </p><pre class="screen">service postgresql restart</pre><p> (Ubuntu, CentOS and RHEL) using
	  <code class="systemitem">root</code> user.
	</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp68186576"></a>Start the LIXA state server</h3></div></div></div><p>
	Start the state server as shown below:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1204-64:~$ sudo su - lixa
lixa@ubuntu1204-64:~$ /opt/lixa/sbin/lixad --daemon
lixa@ubuntu1204-64:~$ exit
logout
tiian@ubuntu1204-64:~$ ps -ef|grep lixad|grep -v grep
lixa     12866     1  0 21:35 ?        00:00:00 /opt/lixa/sbin/lixad --daemon
	  </pre></td></tr></tbody></table></div><p>
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp68189872"></a>Build the client program</h3></div></div></div><p>
	Prepare the client (Application Program) using the below commands
	(<span class="command"><strong>gcc</strong></span> command was splitted on several lines 
	using <span class="command"><strong>\</strong></span> to help readability, but you may use
	a single line):
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1204-64:~$ mkdir tmp
tiian@ubuntu1204-64:~$ cd tmp
tiian@ubuntu1204-64:~/tmp$ cp /opt/lixa/share/doc/lixa-X.Y.Z/examples/example5_pql.c .
tiian@ubuntu1204-64:~/tmp$ gcc example5_pql.c $(/opt/lixa/bin/lixa-config -c -f -p -d) \
&gt; -I /usr/include/postgresql -l pq -o example5_pql
	  </pre></td></tr></tbody></table></div><p>
	Verify the executable produced by <span class="command"><strong>gcc</strong></span>:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1204-64:/tmp$ ldd example5_pql
        linux-vdso.so.1 =&gt;  (0x00007fffc57fe000)
	liblixac.so.0 =&gt; /opt/lixa/lib/liblixac.so.0 (0x00007f7402314000)
	liblixapq.so.0 =&gt; /opt/lixa/lib/liblixapq.so.0 (0x00007f740210d000)
	libpq.so.5 =&gt; /usr/lib/libpq.so.5 (0x00007f7401ed8000)
	libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007f7401b1a000)
	libgmodule-2.0.so.0 =&gt; /usr/lib/x86_64-linux-gnu/libgmodule-2.0.so.0 (0x00007f7401916000)
	libglib-2.0.so.0 =&gt; /lib/x86_64-linux-gnu/libglib-2.0.so.0 (0x00007f7401620000)
	libxml2.so.2 =&gt; /usr/lib/x86_64-linux-gnu/libxml2.so.2 (0x00007f74012c4000)
	liblixab.so.0 =&gt; /opt/lixa/lib/liblixab.so.0 (0x00007f74010aa000)
	libpthread.so.0 =&gt; /lib/x86_64-linux-gnu/libpthread.so.0 (0x00007f7400e8c000)
	libssl.so.1.0.0 =&gt; /lib/x86_64-linux-gnu/libssl.so.1.0.0 (0x00007f7400c2d000)
	libcrypto.so.1.0.0 =&gt; /lib/x86_64-linux-gnu/libcrypto.so.1.0.0 (0x00007f7400850000)
	libkrb5.so.3 =&gt; /usr/lib/x86_64-linux-gnu/libkrb5.so.3 (0x00007f7400581000)
	libcom_err.so.2 =&gt; /lib/x86_64-linux-gnu/libcom_err.so.2 (0x00007f740037d000)
	libgssapi_krb5.so.2 =&gt; /usr/lib/x86_64-linux-gnu/libgssapi_krb5.so.2 (0x00007f740013e000)
	libldap_r-2.4.so.2 =&gt; /usr/lib/x86_64-linux-gnu/libldap_r-2.4.so.2 (0x00007f73ffeee000)
	/lib64/ld-linux-x86-64.so.2 (0x00007f7402533000)
	libdl.so.2 =&gt; /lib/x86_64-linux-gnu/libdl.so.2 (0x00007f73ffcea000)
	libpcre.so.3 =&gt; /lib/x86_64-linux-gnu/libpcre.so.3 (0x00007f73ffaad000)
	librt.so.1 =&gt; /lib/x86_64-linux-gnu/librt.so.1 (0x00007f73ff8a4000)
	libz.so.1 =&gt; /lib/x86_64-linux-gnu/libz.so.1 (0x00007f73ff68d000)
	libm.so.6 =&gt; /lib/x86_64-linux-gnu/libm.so.6 (0x00007f73ff391000)
	libuuid.so.1 =&gt; /lib/x86_64-linux-gnu/libuuid.so.1 (0x00007f73ff18b000)
	libk5crypto.so.3 =&gt; /usr/lib/x86_64-linux-gnu/libk5crypto.so.3 (0x00007f73fef63000)
	libkrb5support.so.0 =&gt; /usr/lib/x86_64-linux-gnu/libkrb5support.so.0 (0x00007f73fed5b000)
	libkeyutils.so.1 =&gt; /lib/x86_64-linux-gnu/libkeyutils.so.1 (0x00007f73feb56000)
	libresolv.so.2 =&gt; /lib/x86_64-linux-gnu/libresolv.so.2 (0x00007f73fe93a000)
	liblber-2.4.so.2 =&gt; /usr/lib/x86_64-linux-gnu/liblber-2.4.so.2 (0x00007f73fe72c000)
	libsasl2.so.2 =&gt; /usr/lib/x86_64-linux-gnu/libsasl2.so.2 (0x00007f73fe510000)
	libgssapi.so.3 =&gt; /usr/lib/x86_64-linux-gnu/libgssapi.so.3 (0x00007f73fe2d2000)
	libgnutls.so.26 =&gt; /usr/lib/x86_64-linux-gnu/libgnutls.so.26 (0x00007f73fe016000)
	libgcrypt.so.11 =&gt; /lib/x86_64-linux-gnu/libgcrypt.so.11 (0x00007f73fdd96000)
	libheimntlm.so.0 =&gt; /usr/lib/x86_64-linux-gnu/libheimntlm.so.0 (0x00007f73fdb8f000)
	libkrb5.so.26 =&gt; /usr/lib/x86_64-linux-gnu/libkrb5.so.26 (0x00007f73fd908000)
	libasn1.so.8 =&gt; /usr/lib/x86_64-linux-gnu/libasn1.so.8 (0x00007f73fd668000)
	libhcrypto.so.4 =&gt; /usr/lib/x86_64-linux-gnu/libhcrypto.so.4 (0x00007f73fd434000)
	libroken.so.18 =&gt; /usr/lib/x86_64-linux-gnu/libroken.so.18 (0x00007f73fd21e000)
	libtasn1.so.3 =&gt; /usr/lib/x86_64-linux-gnu/libtasn1.so.3 (0x00007f73fd00d000)
	libp11-kit.so.0 =&gt; /usr/lib/x86_64-linux-gnu/libp11-kit.so.0 (0x00007f73fcdfb000)
	libgpg-error.so.0 =&gt; /lib/x86_64-linux-gnu/libgpg-error.so.0 (0x00007f73fcbf6000)
	libwind.so.0 =&gt; /usr/lib/x86_64-linux-gnu/libwind.so.0 (0x00007f73fc9cd000)
	libheimbase.so.1 =&gt; /usr/lib/x86_64-linux-gnu/libheimbase.so.1 (0x00007f73fc7be000)
	libhx509.so.5 =&gt; /usr/lib/x86_64-linux-gnu/libhx509.so.5 (0x00007f73fc573000)
	libsqlite3.so.0 =&gt; /usr/lib/x86_64-linux-gnu/libsqlite3.so.0 (0x00007f73fc2d0000)
	libcrypt.so.1 =&gt; /lib/x86_64-linux-gnu/libcrypt.so.1 (0x00007f73fc097000)
	  </pre></td></tr></tbody></table></div><p>
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp68197904"></a>Set-up LIXA environment</h3></div></div></div><p>
	Set-up the <code class="varname">LIXA_PROFILE</code> environment variable:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1204-64:~/tmp$ echo $LIXA_PROFILE

tiian@ubuntu1204-64:~/tmp$ export LIXA_PROFILE=PQL_STA
tiian@ubuntu1204-64:~/tmp$ echo $LIXA_PROFILE
PQL_STA
	  </pre></td></tr></tbody></table></div><p>
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp68206208"></a>Some checks before program execution</h3></div></div></div><p>
	We set <code class="varname">LIXA_PROFILE</code> to value
	<span class="quote">“<span class="quote">PQL_STA</span>”</span>, looking at
	<code class="filename">/opt/lixa/etc/lixac_conf.xml</code>:
	</p><pre class="screen">
    &lt;profile name="PQL_STA"&gt;
      &lt;sttsrvs&gt;
        &lt;sttsrv&gt;local_1&lt;/sttsrv&gt;
      &lt;/sttsrvs&gt;
      &lt;rsrmgrs&gt;
        &lt;rsrmgr&gt;PostgreSQL_stareg&lt;/rsrmgr&gt;
      &lt;/rsrmgrs&gt;
    &lt;/profile&gt;
	</pre><p>
	the profile references the Resource Manager named
	<span class="quote">“<span class="quote">PostgreSQL_stareg</span>”</span>, looking again at the config file:
	</p><pre class="screen">
    &lt;rsrmgr name="PostgreSQL_stareg" switch_file="/opt/lixa/lib/switch_postgresql_stareg.so" xa_open_info="dbname=testdb" xa_close_info="" /&gt;
	</pre><p>
	we can discover how the PostgreSQL database is configured for XA
	<a href="#ftn.idp68210048" class="footnote" id="idp68210048"><sup class="footnote">[28]</sup></a>.
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp68212800"></a>Program execution</h3></div></div></div><p>
	It is suggested to open two different terminals: the first one
	connected to <span class="quote">“<span class="quote">testdb</span>”</span> PostgreSQL database and the second
	one pointing to the directory where the compiled program
	<code class="filename">example5_pql</code> lives.
	First teminal session:
	</p><div class="table"><table frame="box"><thead><tr><td>[PostgreSQL terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1204-64:~$ psql testdb
psql (9.1.24)
Type "help" for help.

testdb=&gt;
	  </pre></td></tr></tbody></table></div><p>
	Second teminal session:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1204-64:~/tmp$ ls -la
total 21
drwxr-xr-x   2 tiian tiian  112 2011-09-14 21:14 .
drwxrwx--x 101 tiian tiian 5064 2011-09-14 21:13 ..
-rwxr-xr-x   1 tiian tiian 8293 2011-09-13 21:27 example5_pql
-rw-r--r--   1 tiian tiian 3735 2011-09-13 21:26 example5_pql.c
	  </pre></td></tr></tbody></table></div><p>
	Check the content of <span class="quote">“<span class="quote">AUTHORS</span>”</span> table before
	program execution:
	</p><div class="table"><table frame="box"><thead><tr><td>[PostgreSQL terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
testdb=&gt; select * from AUTHORS;
 id | last_name | first_name 
----+-----------+------------
(0 rows)
	  </pre></td></tr></tbody></table></div><p>
	Execute the program:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1204-64:~/tmp$ ./example5_pql insert
Inserting a row in the table...
	  </pre></td></tr></tbody></table></div><p>
	Check the content of the table again:
	</p><div class="table"><table frame="box"><thead><tr><td>[PostgreSQL terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
testdb=&gt; select * from AUTHORS;
 id | last_name | first_name 
----+-----------+------------
  1 | Foo       | Bar
(1 rows)
	  </pre></td></tr></tbody></table></div><p>
	The example program inserted the row with id=1. You can not insert
	the same row twice because there is a unique constraint on this table,
	but you can remove the row using
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1204-64:~/tmp$ ./example5_pql delete
Deleting a row from the table...
	  </pre></td></tr></tbody></table></div><p>
	Check the table content again:
	</p><div class="table"><table frame="box"><thead><tr><td>[PostgreSQL terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
testdb=&gt; select * from AUTHORS;
 id | last_name | first_name 
----+-----------+------------
(0 rows)
	  </pre></td></tr></tbody></table></div><p>
	you can verify in file
	<code class="filename">/opt/lixa/etc/lixac_conf.xml</code>
	that <span class="quote">“<span class="quote">PQL_STA</span>”</span> is associated to static registration
	<a href="#ftn.idp68233728" class="footnote" id="idp68233728"><sup class="footnote">[29]</sup></a>
	.
	Execute the program:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1204-64:~/tmp$ export LIXA_TRACE_MASK=0x00002000
tiian@ubuntu1204-64:~/tmp$ echo $LIXA_TRACE_MASK
0x00002000
tiian@ubuntu1204-64:~/tmp$ ./example5_pql insert 2&gt;&amp;1 | grep xa_start
2011-09-14 21:53:13.403943 [9766/3069609728] lixa_xa_start
[...]
2011-09-14 21:53:13.448918 [9766/3069609728] lixa_xa_start: xa_start_entry(xid, 0, 0x0) = 0
2011-09-14 21:53:13.448977 [9766/3069609728] lixa_xa_start: sending 210 bytes to the server for step 24
2011-09-14 21:53:13.449104 [9766/3069609728] lixa_xa_start/excp=10/ret_cod=0/errno=0
	  </pre></td></tr></tbody></table></div><p>
	Finally, clean up the table again:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1204-64:~/tmp$ unset LIXA_TRACE_MASK
tiian@ubuntu1204-64:~/tmp$ ./example5_pql delete
Deleting a row from the table...
	  </pre></td></tr></tbody></table></div><p>
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Development_example6_pql_ora"></a>An example with PostgreSQL &amp; Oracle</h2></div></div></div><div class="figure"><a id="develop6"></a><p class="title"><strong>Figure 5.6. Deploy model of an example showing a distributed transaction with PostgreSQL and Oracle</strong></p><div class="figure-contents"><div class="mediaobject"><img src="../images/LIXA_Development_6.png" alt="Deploy model of an example showing a distributed transaction with PostgreSQL and Oracle" /></div></div></div><br class="figure-break" /><p>
      This example shows as
      you can implement DTP (Distributed Transaction Processing) with two
      Resource Managers (PostgreSQL and Oracle Database Server)
      coordinated by the LIXA Transaction Manager.
      It's strongly suggested you have played with the
      examples previously shown in this chapter (see
      <a class="xref" href="#Development" title="Chapter 5. Developing C Application Programs">Chapter 5, <em>Developing C Application Programs</em></a>) before starting this more complex one.
    </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	If you did not yet installed the software provided by PostgreSQL,
	please refer to the official PostgreSQL site to download the
	software and to pick-up the information necessary to install 
	and configure
	the database. This manual does not give you information related
	to PostgreSQL technology: it is assumed you already installed and
	configured the database.
      </p><p>
	If you did not yet installed the software provided by Oracle,
	please refer to the official Oracle site to download the
	software and to pick-up the information necessary to install 
	and configure
	the database. This manual does not give you information related
	to Oracle technology: it is assumed you already installed and
	configured the database.
      </p></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
	The LIXA software must be configured to support the PostgreSQL and
	the Oracle Database Server resource managers as explained in 
	<a class="xref" href="#Linking_third_party_resource_managers" title="Linking third party resource managers">the section called “Linking third party resource managers”</a>.
	As a little hint, you should configure LIXA as below:
	</p><pre class="screen">
./configure --with-postgresql-include=/usr/include/postgresql --with-postgresql-lib=/usr/lib \
&gt; --with-oracle=/usr/lib/oracle/xe/app/oracle/product/10.2.0/server
	</pre><p>
	Please don't forget you must compile and install every time you
	re-configure.
      </p></div><p>
      Please follow the instructions explained 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	    in <a class="xref" href="#Development_setup_PostgreSQL_environment" title="Set-up PostgreSQL environment">the section called “Set-up PostgreSQL environment”</a>
	    to set-up a running environment for PostgreSQL server
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	    in <a class="xref" href="#Development_setup_Oracle_environment" title="Set-up the Oracle environment (server side)">the section called “Set-up the Oracle environment (server side)”</a>
	    to set-up a running environment for Oracle Database Server
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	    in <a class="xref" href="#Development_start_LIXA_server" title="Start the LIXA state server">the section called “Start the LIXA state server”</a>
	    to start up the LIXA state server
	</p></li></ul></div><p>
    </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp68252096"></a>Build the client program</h3></div></div></div><p>
	Prepare the client (Application Program) using the below commands
	(<span class="command"><strong>gcc</strong></span> command was splitted on several lines 
	using <span class="command"><strong>\</strong></span> to help readability, but you may use
	a single line):
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~$ mkdir tmp
tiian@ubuntu:~$ cd tmp
tiian@ubuntu:~/tmp$ cp /opt/lixa/share/doc/lixa-X.Y.Z/examples/example6_pql_ora.c .
tiian@ubuntu:~/tmp$ gcc example6_pql_ora.c $(/opt/lixa/bin/lixa-config -c -f -p -d) \
&gt; -I/usr/lib/oracle/xe/app/oracle/product/10.2.0/server/rdbms/public \
&gt; -L/usr/lib/oracle/xe/app/oracle/product/10.2.0/server/lib -l clntsh -l nnz10 \
&gt; -I/usr/include/postgresql -lpq -o example6_pql_ora
	  </pre></td></tr></tbody></table></div><p>
	or if you are using Oracle 11.2 you will use something like this:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ gcc example6_pql_ora.c $(/opt/lixa/bin/lixa-config -c -f -p -d) \
&gt; -I/u01/app/oracle/product/11.2.0/xe/rdbms/public \
&gt; -L/u01/app/oracle/product/11.2.0/xe/lib -l clntsh -l nnz11 \
&gt; -I/usr/include/postgresql -lpq -o example6_pql_ora
	  </pre></td></tr></tbody></table></div><p>
	Verify the executable produced by <span class="command"><strong>gcc</strong></span>:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ ldd example6_pql_ora
        linux-gate.so.1 =&gt;  (0xb7731000)
        liblixac.so.0 =&gt; /opt/lixa/lib/liblixac.so.0 (0xb7716000)
        liblixapq.so.0 =&gt; /opt/lixa/lib/liblixapq.so.0 (0xb770f000)
        libclntsh.so.10.1 =&gt; not found
        libnnz10.so =&gt; not found
        libpq.so.5 =&gt; /usr/lib/libpq.so.5 (0xb76e1000)
        libc.so.6 =&gt; /lib/tls/i686/cmov/libc.so.6 (0xb7592000)
        libgmodule-2.0.so.0 =&gt; /usr/lib/libgmodule-2.0.so.0 (0xb758e000)
        libdl.so.2 =&gt; /lib/tls/i686/cmov/libdl.so.2 (0xb7589000)
        libgthread-2.0.so.0 =&gt; /usr/lib/libgthread-2.0.so.0 (0xb7584000)
        librt.so.1 =&gt; /lib/tls/i686/cmov/librt.so.1 (0xb757b000)
        libglib-2.0.so.0 =&gt; /usr/lib/libglib-2.0.so.0 (0xb74ca000)
        libxml2.so.2 =&gt; /usr/lib/libxml2.so.2 (0xb73aa000)
        liblixab.so.0 =&gt; /opt/lixa/lib/liblixab.so.0 (0xb7395000)
        libm.so.6 =&gt; /lib/tls/i686/cmov/libm.so.6 (0xb736f000)
        libpthread.so.0 =&gt; /lib/tls/i686/cmov/libpthread.so.0 (0xb7357000)
        libssl.so.0.9.8 =&gt; /usr/lib/i686/cmov/libssl.so.0.9.8 (0xb7311000)
        libcrypto.so.0.9.8 =&gt; /usr/lib/i686/cmov/libcrypto.so.0.9.8 (0xb71cf000)
        libkrb5.so.3 =&gt; /usr/lib/libkrb5.so.3 (0xb7142000)
        libcom_err.so.2 =&gt; /lib/libcom_err.so.2 (0xb713e000)
        libgssapi_krb5.so.2 =&gt; /usr/lib/libgssapi_krb5.so.2 (0xb7115000)
        libcrypt.so.1 =&gt; /lib/tls/i686/cmov/libcrypt.so.1 (0xb70e3000)
        libldap_r-2.4.so.2 =&gt; /usr/lib/libldap_r-2.4.so.2 (0xb70a3000)
        /lib/ld-linux.so.2 (0xb7732000)
        libpcre.so.3 =&gt; /usr/lib/libpcre.so.3 (0xb707c000)
        libz.so.1 =&gt; /usr/lib/libz.so.1 (0xb7066000)
        libuuid.so.1 =&gt; /lib/libuuid.so.1 (0xb7062000)
        libk5crypto.so.3 =&gt; /usr/lib/libk5crypto.so.3 (0xb703f000)
        libkrb5support.so.0 =&gt; /usr/lib/libkrb5support.so.0 (0xb7037000)
        libkeyutils.so.1 =&gt; /lib/libkeyutils.so.1 (0xb7034000)
        libresolv.so.2 =&gt; /lib/tls/i686/cmov/libresolv.so.2 (0xb7020000)
        liblber-2.4.so.2 =&gt; /usr/lib/liblber-2.4.so.2 (0xb7013000)
        libsasl2.so.2 =&gt; /usr/lib/libsasl2.so.2 (0xb6ffc000)
        libgnutls.so.13 =&gt; /usr/lib/libgnutls.so.13 (0xb6f86000)
        libtasn1.so.3 =&gt; /usr/lib/libtasn1.so.3 (0xb6f76000)
        libgcrypt.so.11 =&gt; /lib/libgcrypt.so.11 (0xb6f28000)
        libgpg-error.so.0 =&gt; /lib/libgpg-error.so.0 (0xb6f24000)
	  </pre></td></tr></tbody></table></div><p>
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp68266880"></a>Set-up LIXA environment</h3></div></div></div><p>
	There are four unresolved references that can be fixed setting up
	the environment properly; you can fix the environment manually or
	using this script supplied by Oracle:
	<code class="filename">/usr/lib/oracle/xe/app/oracle/product/10.2.0/server/bin/oracle_env.sh</code>
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ echo $LD_LIBRARY_PATH

tiian@ubuntu:~/tmp$ . /usr/lib/oracle/xe/app/oracle/product/10.2.0/server/bin/oracle_env.sh
tiian@ubuntu:~/tmp$ echo $LD_LIBRARY_PATH
/usr/lib/oracle/xe/app/oracle/product/10.2.0/server/lib:
	  </pre></td></tr></tbody></table></div><p>
	Oracle 11.2 <code class="filename">oracle_env.sh</code> does not set
	environment variable <code class="varname">LD_LIBRARY_PATH</code> and you
	should set-up it manually:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ echo $LD_LIBRARY_PATH

tiian@ubuntu:~/tmp$ export LD_LIBRARY_PATH=/u01/app/oracle/product/11.2.0/xe/lib
tiian@ubuntu:~/tmp$ echo $LD_LIBRARY_PATH
/u01/app/oracle/product/11.2.0/xe/lib
	  </pre></td></tr></tbody></table></div><p>
	Check again the executable:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ ldd example6_pql_ora                                                linux-gate.so.1 =&gt;  (0xb770b000)
        liblixac.so.0 =&gt; /opt/lixa/lib/liblixac.so.0 (0xb76f0000)
        liblixapq.so.0 =&gt; /opt/lixa/lib/liblixapq.so.0 (0xb76e9000)
        libclntsh.so.10.1 =&gt; /usr/lib/oracle/xe/app/oracle/product/10.2.0/server/lib/libclntsh.so.10.1 (0xb6934000)
        libnnz10.so =&gt; /usr/lib/oracle/xe/app/oracle/product/10.2.0/server/lib/libnnz10.so (0xb672f000)
        libpq.so.5 =&gt; /usr/lib/libpq.so.5 (0xb6702000)
        libc.so.6 =&gt; /lib/tls/i686/cmov/libc.so.6 (0xb65b3000)
        libgmodule-2.0.so.0 =&gt; /usr/lib/libgmodule-2.0.so.0 (0xb65af000)
        libdl.so.2 =&gt; /lib/tls/i686/cmov/libdl.so.2 (0xb65aa000)
        libgthread-2.0.so.0 =&gt; /usr/lib/libgthread-2.0.so.0 (0xb65a5000)
        librt.so.1 =&gt; /lib/tls/i686/cmov/librt.so.1 (0xb659c000)
        libglib-2.0.so.0 =&gt; /usr/lib/libglib-2.0.so.0 (0xb64eb000)
        libxml2.so.2 =&gt; /usr/lib/libxml2.so.2 (0xb63cb000)
        liblixab.so.0 =&gt; /opt/lixa/lib/liblixab.so.0 (0xb63b6000)
        libm.so.6 =&gt; /lib/tls/i686/cmov/libm.so.6 (0xb6390000)
        libpthread.so.0 =&gt; /lib/tls/i686/cmov/libpthread.so.0 (0xb6378000)
        libnsl.so.1 =&gt; /lib/tls/i686/cmov/libnsl.so.1 (0xb6360000)
        libssl.so.0.9.8 =&gt; /usr/lib/i686/cmov/libssl.so.0.9.8 (0xb631a000)
        libcrypto.so.0.9.8 =&gt; /usr/lib/i686/cmov/libcrypto.so.0.9.8 (0xb61d8000)
        libkrb5.so.3 =&gt; /usr/lib/libkrb5.so.3 (0xb614a000)
        libcom_err.so.2 =&gt; /lib/libcom_err.so.2 (0xb6147000)
        libgssapi_krb5.so.2 =&gt; /usr/lib/libgssapi_krb5.so.2 (0xb611e000)
        libcrypt.so.1 =&gt; /lib/tls/i686/cmov/libcrypt.so.1 (0xb60ec000)
        libldap_r-2.4.so.2 =&gt; /usr/lib/libldap_r-2.4.so.2 (0xb60ac000)
        /lib/ld-linux.so.2 (0xb770c000)
        libpcre.so.3 =&gt; /usr/lib/libpcre.so.3 (0xb6084000)
        libz.so.1 =&gt; /usr/lib/libz.so.1 (0xb606f000)
        libuuid.so.1 =&gt; /lib/libuuid.so.1 (0xb606b000)
        libk5crypto.so.3 =&gt; /usr/lib/libk5crypto.so.3 (0xb6048000)
        libkrb5support.so.0 =&gt; /usr/lib/libkrb5support.so.0 (0xb6040000)
        libkeyutils.so.1 =&gt; /lib/libkeyutils.so.1 (0xb603c000)
        libresolv.so.2 =&gt; /lib/tls/i686/cmov/libresolv.so.2 (0xb6029000)
        liblber-2.4.so.2 =&gt; /usr/lib/liblber-2.4.so.2 (0xb601c000)
        libsasl2.so.2 =&gt; /usr/lib/libsasl2.so.2 (0xb6005000)
        libgnutls.so.13 =&gt; /usr/lib/libgnutls.so.13 (0xb5f8f000)
        libtasn1.so.3 =&gt; /usr/lib/libtasn1.so.3 (0xb5f7e000)
        libgcrypt.so.11 =&gt; /lib/libgcrypt.so.11 (0xb5f31000)
        libgpg-error.so.0 =&gt; /lib/libgpg-error.so.0 (0xb5f2d000)
	  </pre></td></tr></tbody></table></div><p>
	Set-up the necessary environment variables:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ echo $LIXA_PROFILE

tiian@ubuntu:~/tmp$ export LIXA_PROFILE=PQL_STA_ORA_DYN
tiian@ubuntu:~/tmp$ echo $LIXA_PROFILE
PQL_STA_ORA_DYN
	  </pre></td></tr></tbody></table></div><p>
	The below environment variables were set by the previous sourced
	script; take a look to them:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ echo $ORACLE_HOME
/usr/lib/oracle/xe/app/oracle/product/10.2.0/server
tiian@ubuntu:~/tmp$ echo $PATH
/usr/lib/oracle/xe/app/oracle/product/10.2.0/server/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games
tiian@ubuntu:~/tmp$ echo $ORACLE_SID
XE
	  </pre></td></tr></tbody></table></div><p>
	It is suggested to set the necessary environment variables in your 
	profile if you are going to execute the programs many times.
	This is the list of the suggested variables:
	<code class="varname">LD_LIBRARY_PATH</code>,
	<code class="varname">LIXA_PROFILE</code>,
	<code class="varname">ORACLE_HOME</code>,
	<code class="varname">ORACLE_SID</code>,
	<code class="varname">PATH</code>.
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="example5_some_checks"></a>Some checks before program execution</h3></div></div></div><p>
	We set <code class="varname">LIXA_PROFILE</code> to value
	<span class="quote">“<span class="quote">PQL_STA_ORA_DYN</span>”</span>, looking at
	<code class="filename">/opt/lixa/etc/lixac_conf.xml</code>:
	</p><pre class="screen">
    &lt;profile name="PQL_STA_ORA_DYN"&gt;
      &lt;sttsrvs&gt;
        &lt;sttsrv&gt;local_1&lt;/sttsrv&gt;
      &lt;/sttsrvs&gt;
      &lt;rsrmgrs&gt;
        &lt;rsrmgr&gt;PostgreSQL_stareg&lt;/rsrmgr&gt;
        &lt;rsrmgr&gt;OracleXE_dynreg&lt;/rsrmgr&gt;
      &lt;/rsrmgrs&gt;
    &lt;/profile&gt;
	</pre><p>
	the profile references two Resource Managers:
	<span class="quote">“<span class="quote">PostgreSQL_stareg</span>”</span> and <span class="quote">“<span class="quote">OracleXE_dynreg</span>”</span>, 
	looking again at the config file:
	</p><pre class="screen">
    &lt;rsrmgr name="OracleXE_dynreg" switch_file="/opt/lixa/lib/switch_oracle_dynreg.so" xa_open_info="Oracle_XA+Acc=P/hr/hr+SesTm=30+LogDir=/tmp+threads=true+DbgFl=7+Loose_Coupling=true" xa_close_info="" /&gt;
    &lt;rsrmgr name="PostgreSQL_stareg" switch_file="/opt/lixa/lib/switch_postgresql_stareg.so" xa_open_info="dbname=testdb" xa_close_info="" /&gt;
	</pre><p>
	we can discover how our application will access the resource
	managers
	<a href="#ftn.idp68291664" class="footnote" id="idp68291664"><sup class="footnote">[30]</sup></a>
	<a href="#ftn.idp68295232" class="footnote" id="idp68295232"><sup class="footnote">[31]</sup></a>. 
      </p><p>
	Verify no (Oracle) trace file exists:
	</p><pre class="screen">
tiian@ubuntu:~/tmp$ ls -la /tmp/xa*
ls: cannot access /tmp/xa*: No such file or directory
	</pre><p>
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp68297856"></a>Program execution (dynamic registration for Oracle)</h3></div></div></div><p>
	It is suggested to open three different terminals: 
	the first one connected to <span class="quote">“<span class="quote">testdb</span>”</span> PostgreSQL database,
	the second one connected to Oracle database and the
	third one pointing to the directory where the compiled program 
	example6_pql_ora lives.
	</p><div class="table"><table frame="box"><thead><tr><td>[PostgreSQL terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~$ psql testdb
Welcome to psql 8.3.15, the PostgreSQL interactive terminal.

Type:  \copyright for distribution terms
       \h for help with SQL commands
       \? for help with psql commands
       \g or terminate with semicolon to execute query
       \q to quit

testdb=&gt;
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[Oracle terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~$ . /usr/lib/oracle/xe/app/oracle/product/10.2.0/server/bin/oracle_env.sh
tiian@ubuntu:~$ sqlplus "hr/hr"                                                 
SQL*Plus: Release 10.2.0.1.0 - Production on Tue May 3 21:52:06 2011

Copyright (c) 1982, 2005, Oracle.  All rights reserved.


Connected to:
Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production

SQL&gt;
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ ls -la
total 28
drwxr-xr-x  2 tiian tiian  4096 2011-09-20 21:53 .
drwxr-xr-x 40 tiian tiian  4096 2011-09-19 20:54 ..
-rwxr-xr-x  1 tiian tiian 11219 2011-09-18 21:24 example6_pql_ora
-rw-r--r--  1 tiian tiian  7176 2011-09-18 21:24 example6_pql_ora.c
	  </pre></td></tr></tbody></table></div><p>
	Check the content of the PostgreSQL table (<span class="quote">“<span class="quote">AUTHORS</span>”</span>):
	</p><div class="table"><table frame="box"><thead><tr><td>[PostgreSQL terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
testdb=&gt; select * from AUTHORS;
 id | last_name | first_name
----+-----------+------------
(0 rows)
	  </pre></td></tr></tbody></table></div><p>
	Check the content of the Oracle table (<span class="quote">“<span class="quote">COUNTRIES</span>”</span>):
	</p><div class="table"><table frame="box"><thead><tr><td>[Oracle terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
SQL&gt; select * from COUNTRIES where COUNTRY_ID = 'RS';

no rows selected
	  </pre></td></tr></tbody></table></div><p>
	Insert a row in all the tables and check the contents of the tables
	after the transaction execution:
	</p><div class="table"><table frame="box"><thead><tr><td>[Third terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ ./example6_pql_ora insert
Inserting a row in the tables...
Oracle INSERT statement executed!
	  </pre></td></tr></tbody></table></div><p>
	Now you can verify the content of the tables after the transaction:
	</p><div class="table"><table frame="box"><thead><tr><td>[PostgreSQL terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
testdb=&gt; select * from AUTHORS;
 id | last_name | first_name
----+-----------+------------
  1 | Foo       | Bar
(1 row)
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[Oracle terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
SQL&gt; select * from COUNTRIES where COUNTRY_ID = 'RS';

CO COUNTRY_NAME                              REGION_ID
-- ---------------------------------------- ----------
RS Repubblica San Marino                             1
	  </pre></td></tr></tbody></table></div><p>
	With the opposite command you can remove the rows from the tables:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ ./example6_pql_ora delete
Deleting a row from the tables...
Oracle DELETE statement executed!
	  </pre></td></tr></tbody></table></div><p>
	and check the content of the tables again:
	</p><div class="table"><table frame="box"><thead><tr><td>[PostgreSQL terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
testdb=&gt; select * from AUTHORS;
 id | last_name | first_name
----+-----------+------------
(0 rows)
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[Oracle terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
SQL&gt; select * from COUNTRIES where COUNTRY_ID = 'RS';

no rows selected
	  </pre></td></tr></tbody></table></div><p>
	We can verify the dynamic registration behavior of Oracle:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ export LIXA_TRACE_MASK=0x00002000
tiian@ubuntu:~/tmp$ echo $LIXA_TRACE_MASK
0x00002000
tiian@ubuntu:~/tmp$ ./example6_pql_ora insert 2&gt;&amp;1 | grep ax_reg
2011-09-20 22:11:01.669440 [6844/3052865280] ax_reg: rmid=1, xid=0xbfe4cdcc, flags=0x0
2011-09-20 22:11:01.669537 [6844/3052865280] ax_reg: the application program has started a transaction (TX states S3); this XID '1279875137.ce4993340a46495e94f07dbbdd5d0366.6e8ecf5972a778ab648b5950c0f96dd6' will be returned
2011-09-20 22:11:01.669591 [6844/3052865280] ax_reg: sending 153 bytes to the server for step 8
2011-09-20 22:11:01.669639 [6844/3052865280] ax_reg/excp=7/ret_cod=0/errno=0
	  </pre></td></tr></tbody></table></div><p>
	We can check the static registration behavior of Oracle with a 
	different profile:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ export LIXA_PROFILE=PQL_STA_ORA_STA
tiian@ubuntu:~/tmp$ echo $LIXA_PROFILE
PQL_STA_ORA_STA
tiian@ubuntu:~/tmp$ ./example6_pql_ora delete 2&gt;&amp;1 | grep xa_start
2011-09-20 22:22:22.561677 [22658/3052615424] lixa_xa_start
[...]
2011-09-20 22:22:22.608794 [22658/3052615424] lixa_xa_start: xa_start_entry(xid, 0, 0x0) = 0
2011-09-20 22:22:22.610649 [22658/3052615424] lixa_xa_start: xa_start_entry(xid, 1, 0x0) = 0
2011-09-20 22:22:22.610694 [22658/3052615424] lixa_xa_start: sending 281 bytes to the server for step 24
2011-09-20 22:22:22.610757 [22658/3052615424] lixa_xa_start/excp=10/ret_cod=0/errno=0
	  </pre></td></tr></tbody></table></div><p>
	and check the content of the tables again:
	</p><div class="table"><table frame="box"><thead><tr><td>[PostgreSQL terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
testdb=&gt; select * from AUTHORS;
 id | last_name | first_name
----+-----------+------------
(0 rows)
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[Oracle terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
SQL&gt; select * from COUNTRIES where COUNTRY_ID = 'RS';

no rows selected
	  </pre></td></tr></tbody></table></div><p>
	The activity of the Oracle database can be analyzed in the trace file:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ ls -la /tmp/xa_NULL09202011.trc
-rw-r--r-- 1 tiian tiian 12042 2011-09-20 22:22 /tmp/xa_NULL09202011.trc
	  </pre></td></tr></tbody></table></div><p>
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Development_example7_pql_ora"></a>An example with PostgreSQL &amp; IBM DB2</h2></div></div></div><div class="figure"><a id="develop7"></a><p class="title"><strong>Figure 5.7. Deploy model of an example showing a distributed transaction with PostgreSQL and IBM DB2</strong></p><div class="figure-contents"><div class="mediaobject"><img src="../images/LIXA_Development_7.png" alt="Deploy model of an example showing a distributed transaction with PostgreSQL and IBM DB2" /></div></div></div><br class="figure-break" /><p>
      This example shows as
      you can implement DTP (Distributed Transaction Processing) with two
      Resource Managers (PostgreSQL and IBM DB2)
      coordinated by the LIXA Transaction Manager.
      It's strongly suggested you have played with the
      examples previously shown in this chapter (see
      <a class="xref" href="#Development" title="Chapter 5. Developing C Application Programs">Chapter 5, <em>Developing C Application Programs</em></a>) before starting this more complex one.
    </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	If you did not yet installed the software provided by PostgreSQL,
	please refer to the official PostgreSQL site to download the
	software and to pick-up the information necessary to install 
	and configure
	the database. This manual does not give you information related
	to PostgreSQL technology: it is assumed you already installed and
	configured the database.
      </p><p>
	If you did not yet installed the software provided by IBM,
	please refer to the official IBM site to download the
	software and to pick-up the information necessary to install 
	and configure
	the database. This manual does not give you information related
	to IBM DB2 technology: it is assumed you already installed and
	configured the database.
      </p></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
	The LIXA software must be configured to support the PostgreSQL and
	the IBM DB2 resource managers as explained in 
	<a class="xref" href="#Linking_third_party_resource_managers" title="Linking third party resource managers">the section called “Linking third party resource managers”</a>.
	As a little hint, you should configure LIXA as below:
	</p><pre class="screen">
./configure --with-postgresql-include=/usr/include/postgresql --with-postgresql-lib=/usr/lib \
&gt; --with-ibmdb2=/opt/ibm/db2/V9.7
	</pre><p>
	Please don't forget you must compile and install every time you
	re-configure.
      </p></div><p>
      Please follow the instructions explained 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	    in <a class="xref" href="#Development_setup_PostgreSQL_environment" title="Set-up PostgreSQL environment">the section called “Set-up PostgreSQL environment”</a>
	    to set-up a running environment for PostgreSQL server
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	    in <a class="xref" href="#Development_setup_DB2_environment" title="Set-up DB2 environment">the section called “Set-up DB2 environment”</a>
	    to set-up a running environment for IBM DB2
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	    in <a class="xref" href="#Development_start_LIXA_server" title="Start the LIXA state server">the section called “Start the LIXA state server”</a>
	    to start up the LIXA state server
	</p></li></ul></div><p>
    </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp68355808"></a>Build the client program</h3></div></div></div><p>
	Prepare the client (Application Program) using the below commands
	(<span class="command"><strong>gcc</strong></span> command was splitted on several lines 
	using <span class="command"><strong>\</strong></span> to help readability, but you may use
	a single line):
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~$ mkdir tmp
tiian@ubuntu:~$ cd tmp
tiian@ubuntu:~/tmp$ cp /opt/lixa/share/doc/lixa-X.Y.Z/examples/example7_pql_db2.c .
tiian@ubuntu:~/tmp$ gcc example7_pql_db2.c $(/opt/lixa/bin/lixa-config -c -f -p -d) \
&gt; -I/usr/include/postgresql -lpq \
&gt; -I/opt/ibm/db2/V9.7/include -L/opt/ibm/db2/V9.7/lib32 -ldb2 \
&gt; -o example7_pql_db2
	  </pre></td></tr></tbody></table></div><p>
	Verify the executable produced by <span class="command"><strong>gcc</strong></span>:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ ldd example7_pql_db2
        linux-gate.so.1 =&gt;  (0xb7780000)
        liblixac.so.0 =&gt; /opt/lixa/lib/liblixac.so.0 (0xb7765000)
        liblixapq.so.0 =&gt; /opt/lixa/lib/liblixapq.so.0 (0xb775e000)
        libpq.so.5 =&gt; /usr/lib/libpq.so.5 (0xb7730000)
        libdb2.so.1 =&gt; /usr/lib/libdb2.so.1 (0xb61fe000)
        libc.so.6 =&gt; /lib/tls/i686/cmov/libc.so.6 (0xb60af000)
        libgmodule-2.0.so.0 =&gt; /usr/lib/libgmodule-2.0.so.0 (0xb60ab000)
        libdl.so.2 =&gt; /lib/tls/i686/cmov/libdl.so.2 (0xb60a7000)
        libgthread-2.0.so.0 =&gt; /usr/lib/libgthread-2.0.so.0 (0xb60a2000)
        librt.so.1 =&gt; /lib/tls/i686/cmov/librt.so.1 (0xb6098000)
        libglib-2.0.so.0 =&gt; /usr/lib/libglib-2.0.so.0 (0xb5fe7000)
        libxml2.so.2 =&gt; /usr/lib/libxml2.so.2 (0xb5ec7000)
        liblixab.so.0 =&gt; /opt/lixa/lib/liblixab.so.0 (0xb5eb2000)
        libm.so.6 =&gt; /lib/tls/i686/cmov/libm.so.6 (0xb5e8d000)
        libpthread.so.0 =&gt; /lib/tls/i686/cmov/libpthread.so.0 (0xb5e74000)
        libssl.so.0.9.8 =&gt; /usr/lib/i686/cmov/libssl.so.0.9.8 (0xb5e2e000)
        libcrypto.so.0.9.8 =&gt; /usr/lib/i686/cmov/libcrypto.so.0.9.8 (0xb5cec000)
        libkrb5.so.3 =&gt; /usr/lib/libkrb5.so.3 (0xb5c5f000)
        libcom_err.so.2 =&gt; /lib/libcom_err.so.2 (0xb5c5c000)
        libgssapi_krb5.so.2 =&gt; /usr/lib/libgssapi_krb5.so.2 (0xb5c33000)
        libcrypt.so.1 =&gt; /lib/tls/i686/cmov/libcrypt.so.1 (0xb5c00000)
        libldap_r-2.4.so.2 =&gt; /usr/lib/libldap_r-2.4.so.2 (0xb5bc0000)
        libpam.so.0 =&gt; /lib/libpam.so.0 (0xb5bb6000)
        libdb2dascmn.so.1 =&gt; /opt/ibm/db2/V9.7/lib32/libdb2dascmn.so.1 (0xb5b88000)
        libdb2g11n.so.1 =&gt; /opt/ibm/db2/V9.7/lib32/libdb2g11n.so.1 (0xb551a000)
        libdb2genreg.so.1 =&gt; /opt/ibm/db2/V9.7/lib32/libdb2genreg.so.1 (0xb54da000)
        libdb2install.so.1 =&gt; /opt/ibm/db2/V9.7/lib32/libdb2install.so.1 (0xb54cf000)
        libdb2locale.so.1 =&gt; /opt/ibm/db2/V9.7/lib32/libdb2locale.so.1 (0xb54bc000)
        libdb2osse.so.1 =&gt; /opt/ibm/db2/V9.7/lib32/libdb2osse.so.1 (0xb51b6000)
        libdb2osse_db2.so.1 =&gt; /opt/ibm/db2/V9.7/lib32/libdb2osse_db2.so.1 (0xb5146000)
        libdb2trcapi.so.1 =&gt; /opt/ibm/db2/V9.7/lib32/libdb2trcapi.so.1 (0xb5133000)
        libstdc++.so.6 =&gt; /usr/lib/libstdc++.so.6 (0xb5040000)
        libgcc_s.so.1 =&gt; /lib/libgcc_s.so.1 (0xb5035000)
        /lib/ld-linux.so.2 (0xb7781000)
        libpcre.so.3 =&gt; /usr/lib/libpcre.so.3 (0xb500d000)
        libz.so.1 =&gt; /usr/lib/libz.so.1 (0xb4ff8000)
        libuuid.so.1 =&gt; /lib/libuuid.so.1 (0xb4ff4000)
        libk5crypto.so.3 =&gt; /usr/lib/libk5crypto.so.3 (0xb4fd1000)
        libkrb5support.so.0 =&gt; /usr/lib/libkrb5support.so.0 (0xb4fc9000)
        libkeyutils.so.1 =&gt; /lib/libkeyutils.so.1 (0xb4fc5000)
        libresolv.so.2 =&gt; /lib/tls/i686/cmov/libresolv.so.2 (0xb4fb2000)
        liblber-2.4.so.2 =&gt; /usr/lib/liblber-2.4.so.2 (0xb4fa5000)
        libsasl2.so.2 =&gt; /usr/lib/libsasl2.so.2 (0xb4f8e000)
        libgnutls.so.13 =&gt; /usr/lib/libgnutls.so.13 (0xb4f18000)
        libtasn1.so.3 =&gt; /usr/lib/libtasn1.so.3 (0xb4f07000)
        libgcrypt.so.11 =&gt; /lib/libgcrypt.so.11 (0xb4eba000)
        libgpg-error.so.0 =&gt; /lib/libgpg-error.so.0 (0xb4eb6000)
	  </pre></td></tr></tbody></table></div><p>
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp68366688"></a>Set-up LIXA environment</h3></div></div></div><p>
	Set-up the necessary environment variables:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ echo $LIXA_PROFILE

tiian@ubuntu:~/tmp$ export LIXA_PROFILE=PQL_STA_DB2_DYN
tiian@ubuntu:~/tmp$ echo $LIXA_PROFILE
PQL_STA_DB2_DYN
	  </pre></td></tr></tbody></table></div><p>
	It is suggested to set the necessary environment variables in your 
	profile if you are going to execute the programs many times.
	This is the list of the suggested variables:
	<code class="varname">LIXA_PROFILE</code>,
	<code class="varname">PATH</code>.
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp68371488"></a>Some checks before program execution</h3></div></div></div><p>
	We set <code class="varname">LIXA_PROFILE</code> to value
	<span class="quote">“<span class="quote">PQL_STA_DB2_DYN</span>”</span>, looking at
	<code class="filename">/opt/lixa/etc/lixac_conf.xml</code>:
	</p><pre class="screen">
    &lt;profile name="PQL_STA_DB2_DYN"&gt;
      &lt;sttsrvs&gt;
        &lt;sttsrv&gt;local_1&lt;/sttsrv&gt;
      &lt;/sttsrvs&gt;
      &lt;rsrmgrs&gt;
        &lt;rsrmgr&gt;PostgreSQL_stareg&lt;/rsrmgr&gt;
        &lt;rsrmgr&gt;IBMDB2_dynreg&lt;/rsrmgr&gt;
      &lt;/rsrmgrs&gt;
    &lt;/profile&gt;
	</pre><p>
	the profile references two Resource Managers:
	<span class="quote">“<span class="quote">PostgreSQL_stareg</span>”</span> and <span class="quote">“<span class="quote">IBMDB2_dynreg</span>”</span>, 
	looking again at the config file:
	</p><pre class="screen">
    &lt;rsrmgr name="PostgreSQL_stareg" switch_file="/opt/lixa/lib/switch_postgresql_stareg.so" xa_open_info="dbname=testdb" xa_close_info="" /&gt;
    &lt;rsrmgr name="IBMDB2_dynreg" switch_file="/opt/lixa/lib/switch_ibmdb2_dynreg.so" xa_open_info="axlib=/opt/lixa/lib/liblixac.so,db=sample,tpm=lixa" xa_close_info="" /&gt;
	</pre><p>
	we can discover how our application will access the resource
	managers
	<a href="#ftn.idp68376384" class="footnote" id="idp68376384"><sup class="footnote">[32]</sup></a>
	<a href="#ftn.idp68379168" class="footnote" id="idp68379168"><sup class="footnote">[33]</sup></a>. 
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp68381952"></a>Program execution (dynamic registration)</h3></div></div></div><p>
	It is suggested to open three different terminals: 
	the first one connected to <span class="quote">“<span class="quote">TESTDB</span>”</span> PostgreSQL database,
	the second one connected to <span class="quote">“<span class="quote">SAMPLE</span>”</span> DB2 database
	and the	third one pointing to the directory where the compiled program 
	example7_pql_db2 lives.
	</p><div class="table"><table frame="box"><thead><tr><td>[PostgreSQL terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~$ psql testdb
Welcome to psql 8.3.15, the PostgreSQL interactive terminal.

Type:  \copyright for distribution terms
       \h for help with SQL commands
       \? for help with psql commands
       \g or terminate with semicolon to execute query
       \q to quit

testdb=&gt;
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[IBM DB2 terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~$ . /home/db2inst1/sqllib/db2profile
tiian@ubuntu:~$ db2
(c) Copyright IBM Corporation 1993,2007
Command Line Processor for DB2 Client 9.7.1

You can issue database manager commands and SQL statements from the command
prompt. For example:
    db2 =&gt; connect to sample
    db2 =&gt; bind sample.bnd

For general help, type: ?.
For command help, type: ? command, where command can be
the first few keywords of a database manager command. For example:
 ? CATALOG DATABASE for help on the CATALOG DATABASE command
 ? CATALOG          for help on all of the CATALOG commands.

To exit db2 interactive mode, type QUIT at the command prompt. Outside
interactive mode, all commands must be prefixed with 'db2'.
To list the current command option settings, type LIST COMMAND OPTIONS.

For more detailed help, refer to the Online Reference Manual.

db2 =&gt; connect to SAMPLE

   Database Connection Information

 Database server        = DB2/LINUX 9.7.1
 SQL authorization ID   = TIIAN
 Local database alias   = SAMPLE

db2 =&gt;
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ ls -la
total 32
drwxr-xr-x  2 tiian tiian  4096 2011-09-25 17:11 .
drwxr-xr-x 40 tiian tiian  4096 2011-09-22 22:24 ..
-rwxr-xr-x  1 tiian tiian 12429 2011-09-22 22:47 example7_pql_db2
-rw-r--r--  1 tiian tiian  7541 2011-09-22 22:46 example7_pql_db2.c
	  </pre></td></tr></tbody></table></div><p>
	Check the content of the PostgreSQL table (<span class="quote">“<span class="quote">AUTHORS</span>”</span>):
	</p><div class="table"><table frame="box"><thead><tr><td>[PostgreSQL terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
testdb=&gt; select * from AUTHORS;
 id | last_name | first_name
----+-----------+------------
(0 rows)
	  </pre></td></tr></tbody></table></div><p>
	Check the content of the DB2 tables (<span class="quote">“<span class="quote">DB2INST1.ORG</span>”</span> and
	<span class="quote">“<span class="quote">DB2INST1.DEPT</span>”</span>):
	</p><div class="table"><table frame="box"><thead><tr><td>[IBM DB2 terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
db2 =&gt; select * from DB2INST1.ORG where DEPTNUMB = 150

DEPTNUMB DEPTNAME       MANAGER DIVISION   LOCATION
-------- -------------- ------- ---------- -------------

  0 record(s) selected.

db2 =&gt; select * from DB2INST1.DEPT where DEPTNO='Z99'

DEPTNO DEPTNAME                             MGRNO  ADMRDEPT LOCATION
------ ------------------------------------ ------ -------- ----------------

  0 record(s) selected.
	  </pre></td></tr></tbody></table></div><p>
	Insert a row in PostgreSQL <span class="quote">“<span class="quote">AUTHORS</span>”</span> table and in
	DB2 <span class="quote">“<span class="quote">ORG</span>”</span> table and check the contents of the tables
	after the transaction execution:
	</p><div class="table"><table frame="box"><thead><tr><td>[Third terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ . /home/db2inst1/sqllib/db2profile
tiian@ubuntu:~/tmp$ ./example7_pql_db2 insert org
Executing DB2 statement 'INSERT INTO DB2INST1.ORG(DEPTNUMB, DEPTNAME, MANAGER, DIVISION, LOCATION) VALUES(150, 'Europe', 231, 'R&amp;D', 'Mojan')'...
Executing PostgreSQL statement 'INSERT INTO authors VALUES(1, 'Foo', 'Bar');'...	  </pre></td></tr></tbody></table></div><p>
	Now you can verify the content of the tables after the transaction:
	</p><div class="table"><table frame="box"><thead><tr><td>[PostgreSQL terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
testdb=&gt; select * from authors;
 id | last_name | first_name
----+-----------+------------
  1 | Foo       | Bar
(1 row)
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[IBM DB2 terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
db2 =&gt; select * from DB2INST1.ORG where DEPTNUMB = 150

DEPTNUMB DEPTNAME       MANAGER DIVISION   LOCATION
-------- -------------- ------- ---------- -------------
     150 Europe             231 R&amp;D        Mojan

  1 record(s) selected.
	  </pre></td></tr></tbody></table></div><p>
	If you try to insert the same row again you can verify an automatic
	rollback due to an error thrown by the second resource manager:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ ./example7_pql_db2 insert org
Executing DB2 statement 'INSERT INTO DB2INST1.ORG(DEPTNUMB, DEPTNAME, MANAGER, DIVISION, LOCATION) VALUES(150, 'Europe', 231, 'R&amp;D', 'Mojan')'...
Executing PostgreSQL statement 'INSERT INTO authors VALUES(1, 'Foo', 'Bar');'...
PostgreSQL error: ERROR:  duplicate key value violates unique constraint "authors_pkey"
	  </pre></td></tr></tbody></table></div><p>
	DB2 table (<span class="quote">“<span class="quote">ORG</span>”</span>) allows multiple rows, PostgreSQL table
	(<span class="quote">“<span class="quote">AUTHORS</span>”</span>) does not allow multiple rows: the error stops
	the program execution and the resource managers automatically
	rollback the changes. You can verify there is only one row in the
	tables:
	</p><div class="table"><table frame="box"><thead><tr><td>[PostgreSQL terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
testdb=&gt; select * from authors;
 id | last_name | first_name
----+-----------+------------
  1 | Foo       | Bar
(1 row)
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[IBM DB2 terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
db2 =&gt; select * from DB2INST1.ORG where DEPTNUMB = 150

DEPTNUMB DEPTNAME       MANAGER DIVISION   LOCATION
-------- -------------- ------- ---------- -------------
     150 Europe             231 R&amp;D        Mojan

  1 record(s) selected.
	  </pre></td></tr></tbody></table></div><p>
	You can easily verify there are no prepared transactions inside
	PostgreSQL database:
	</p><div class="table"><table frame="box"><thead><tr><td>[PostgreSQL terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
testdb=&gt; select * from pg_prepared_xacts;
 transaction | gid | prepared | owner | database
-------------+-----+----------+-------+----------
(0 rows)
	  </pre></td></tr></tbody></table></div><p>
	We can verify that DB2 is using dynamic registration:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ export LIXA_TRACE_MASK=0x00002000
tiian@ubuntu:~/tmp$ echo $LIXA_TRACE_MASK
0x00002000
tiian@ubuntu:~/tmp$ ./example7_pql_db2 delete org 2&gt;&amp;1 | grep ax_reg
2011-09-25 18:15:38.499702 [13586/3035527472] ax_reg: rmid=1, xid=0xbf9b2630, flags=0x0
2011-09-25 18:15:38.500405 [13586/3035527472] ax_reg: the application program has started a transaction (TX states S3); this XID '1279875137.0565b518222345ba852b4c4a09a660ae.725d0414e912e62f9ef42209ef693f36' will be returned
2011-09-25 18:15:38.500970 [13586/3035527472] ax_reg: sending 153 bytes to the server for step 8
2011-09-25 18:15:38.501415 [13586/3035527472] ax_reg/excp=7/ret_cod=0/errno=0
	  </pre></td></tr></tbody></table></div><p>
	If you used <span class="quote">“<span class="quote">PQL_STA_DB2_STA</span>”</span> profile instead of 
	<span class="quote">“<span class="quote">PQL_STA_DB2_DYN</span>”</span> you could switch the DB2 to
	static behavior.
      </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	  Combining the previous two examples you can realize a program that
	  access 3 resource managers: PostgreSQL, Oracle and DB2.
	  It is left as an exercise to the reader.
      </p></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Development_example8_mys"></a>An example with MySQL/MariaDB</h2></div></div></div><div class="figure"><a id="develop8"></a><p class="title"><strong>Figure 5.8. Deploy model of an example with MySQL/MariaDB DBMS</strong></p><div class="figure-contents"><div class="mediaobject"><img src="../images/LIXA_Development_8.png" alt="Deploy model of an example with MySQL/MariaDB DBMS" /></div></div></div><br class="figure-break" /><p>
      This example has been developed using MySQL 5.5.54 (or upper) and
      MariaDB 5.5.52 for Linux. 
      Here is a brief list of the tested versions for Ubuntu 12.04,
      14.04, 16.04 and CentOS/RHEL 7.3 and the installed packages:
      </p><pre class="screen">
tiian@ubuntu1204-64:~$ dpkg -l | grep -i mysql
ii  libdbd-mysql-perl                4.020-1ubuntu0.1                    Perl5 database interface to the MySQL database
ii  libmysqlclient-dev               5.5.54-0ubuntu0.12.04.1             MySQL database development files
ii  libmysqlclient18                 5.5.54-0ubuntu0.12.04.1             MySQL database client library
ii  mysql-client-5.5                 5.5.54-0ubuntu0.12.04.1             MySQL database client binaries
ii  mysql-client-core-5.5            5.5.54-0ubuntu0.12.04.1             MySQL database core client binaries
ii  mysql-common                     5.5.54-0ubuntu0.12.04.1             MySQL database common files, e.g. /etc/mysql/my.cnf
ii  mysql-server                     5.5.54-0ubuntu0.12.04.1             MySQL database server (metapackage depending on the latest version)
ii  mysql-server-5.5                 5.5.54-0ubuntu0.12.04.1             MySQL database server binaries and system database setup
ii  mysql-server-core-5.5            5.5.54-0ubuntu0.12.04.1             MySQL database server binaries

tiian@ubuntu1404-64:~$ dpkg -l | grep -i mysql
ii  libdbd-mysql-perl                   4.025-1ubuntu0.1                    amd64        Perl5 database interface to the MySQL database
ii  libmysqlclient-dev                  5.5.54-0ubuntu0.14.04.1             amd64        MySQL database development files
ii  libmysqlclient18:amd64              5.5.54-0ubuntu0.14.04.1             amd64        MySQL database client library
ii  mysql-client-5.5                    5.5.54-0ubuntu0.14.04.1             amd64        MySQL database client binaries
ii  mysql-client-core-5.5               5.5.54-0ubuntu0.14.04.1             amd64        MySQL database core client binaries
ii  mysql-common                        5.5.54-0ubuntu0.14.04.1             all          MySQL database common files, e.g. /etc/mysql/my.cnf
ii  mysql-server                        5.5.54-0ubuntu0.14.04.1             all          MySQL database server (metapackage depending on the latest version)
ii  mysql-server-5.5                    5.5.54-0ubuntu0.14.04.1             amd64        MySQL database server binaries and system database setup
ii  mysql-server-core-5.5               5.5.54-0ubuntu0.14.04.1             amd64        MySQL database server binaries

tiian@ubuntu1604:~$ dpkg -l | grep -i mysql
ii  libmysqlclient-dev                 5.7.17-0ubuntu0.16.04.1             amd64        MySQL database development files
ii  libmysqlclient20:amd64             5.7.17-0ubuntu0.16.04.1             amd64        MySQL database client library
ii  mysql-client-5.7                   5.7.17-0ubuntu0.16.04.1             amd64        MySQL database client binaries
ii  mysql-client-core-5.7              5.7.17-0ubuntu0.16.04.1             amd64        MySQL database core client binaries
ii  mysql-common                       5.7.17-0ubuntu0.16.04.1             all          MySQL database common files, e.g. /etc/mysql/my.cnf
ii  mysql-server                       5.7.17-0ubuntu0.16.04.1             all          MySQL database server (metapackage depending on the latest version)
ii  mysql-server-5.7                   5.7.17-0ubuntu0.16.04.1             amd64        MySQL database server binaries and system database setup
ii  mysql-server-core-5.7              5.7.17-0ubuntu0.16.04.1             amd64        MySQL database server binaries

[tiian@centos71-64 ~]$ rpm -qa | grep -i maria
mariadb-5.5.52-1.el7.x86_64
mariadb-server-5.5.52-1.el7.x86_64
mariadb-libs-5.5.52-1.el7.x86_64
mariadb-devel-5.5.52-1.el7.x86_64

[tiian@rhel73 ~]$ rpm -qa | grep -i maria
mariadb-devel-5.5.52-1.el7.x86_64
mariadb-5.5.52-1.el7.x86_64
mariadb-server-5.5.52-1.el7.x86_64
mariadb-libs-5.5.52-1.el7.x86_64
      </pre><p>
      If you were using a different version you would need to adapt some
      commands to your environment.
    </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	If you did not yet installed the software, please refer to the 
	official site for your Linux distribution or to the official site
	of MySQL/MariaDB if your operating system does not distribute the
	software or you want to use a different MySQL/MariaDB version.
	This manual does not give you information related
	to MySQL/MariaDB: it is assumed that you have already installed and
	configured the database.
    </p></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	This example requires you are running the database and the application
	on the same host: this is not a technical limitation, but a way to
	make it easy. Client/server configuration must work as well, but
	it needs some MySQL/MariaDB extra configuration: please refer to the
	database documentation.
    </p></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
	The LIXA software must be configured to support the MySQL/MariaDB
	server resource manager as explained in 
	<a class="xref" href="#Linking_third_party_resource_managers" title="Linking third party resource managers">the section called “Linking third party resource managers”</a>.
    </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Development_setup_MySQL_environment"></a>Set-up MySQL environment</h3></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp68436608"></a>Start-up the MySQL server</h4></div></div></div><p>
	  If your server didn't start-up automatically at boot time, you
	  could start it with the following commands:
	  </p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1204-64:/tmp$ sudo service mysql start
mysql start/running, process 1607
tiian@ubuntu1204-64:/tmp$ sudo service mysql status
mysql start/running, process 1607
tiian@ubuntu1204-64:/tmp$ ps -ef|grep mysql|grep -v grep
mysql     1607     1  0 22:43 ?        00:00:00 /usr/sbin/mysqld
	    </pre></td></tr></tbody></table></div><p>
	  Create a new user authorization and a new database
	  <a href="#ftn.idp68439328" class="footnote" id="idp68439328"><sup class="footnote">[34]</sup></a>:
	  </p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1204-64:/tmp$ mysql -u root -p
Enter password: 
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 36
Server version: 5.5.54-0ubuntu0.12.04.1 (Ubuntu)

Copyright (c) 2000, 2016, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql&gt; GRANT ALL ON lixa.* TO 'lixa'@'localhost';
Query OK, 0 rows affected (0.00 sec)

mysql&gt; CREATE DATABASE lixa;
Query OK, 1 row affected (0.00 sec)

mysql&gt; quit
Bye
	    </pre></td></tr></tbody></table></div><p>
	  The <code class="systemitem">lixa@localhost</code> user
	  has been created with all privileges on the <span class="quote">“<span class="quote">lixa</span>”</span>
	  database. Now a sample table must be created using this new user:
	  </p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1204-64:/tmp$ mysql -h localhost -u lixa lixa
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 37
Server version: 5.5.54-0ubuntu0.12.04.1 (Ubuntu)

Copyright (c) 2000, 2016, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql&gt; SELECT DATABASE();
+------------+
| DATABASE() |
+------------+
| lixa       |
+------------+
1 row in set (0.01 sec)

mysql&gt; CREATE TABLE authors (id INTEGER NOT NULL PRIMARY KEY, last_name TEXT, first_name TEXT) ENGINE=InnoDB;
Query OK, 0 rows affected (0.02 sec)

mysql&gt; DESCRIBE authors;
+------------+---------+------+-----+---------+-------+
| Field      | Type    | Null | Key | Default | Extra |
+------------+---------+------+-----+---------+-------+
| id         | int(11) | NO   | PRI | NULL    |       |
| last_name  | text    | YES  |     | NULL    |       |
| first_name | text    | YES  |     | NULL    |       |
+------------+---------+------+-----+---------+-------+
3 rows in set (0.00 sec)

mysql&gt; SELECT * FROM authors;
Empty set (0.00 sec)
	    </pre></td></tr></tbody></table></div><p>
	  OK, the <span class="quote">“<span class="quote">authors</span>”</span> table was created using 
	  the <span class="quote">“<span class="quote">InnoDB</span>”</span> engine. 
	  If something went wrong, you should refer to MySQL
	  documentation to fix the issue before the next step because
	  you would not be able to execute the sample program without a
	  basic running installation.
	</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp68450640"></a>Start the LIXA state server</h3></div></div></div><p>
	Start the state server as shown below:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1204-64:/tmp$ sudo su - lixa
lixa@ubuntu1204-64:~$ /opt/lixa/sbin/lixad --daemon
lixa@ubuntu1204-64:~$ exit
logout
tiian@ubuntu1204-64:/tmp$ ps -ef|grep lixad|grep -v grep
lixa      1804     1  0 22:45 ?        00:00:00 /opt/lixa/sbin/lixad --daemon
	  </pre></td></tr></tbody></table></div><p>
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp68453952"></a>Build the client program</h3></div></div></div><p>
	Prepare the client (Application Program) using the below commands
	(<span class="command"><strong>gcc</strong></span> command was splitted on several lines 
	using <span class="command"><strong>\</strong></span> to help readability, but you may use
	a single line):
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1204-64:/tmp$ mkdir tmp
tiian@ubuntu1204-64:/tmp$ cd tmp
tiian@ubuntu1204-64:/tmp/tmp$ cp /opt/lixa/share/doc/lixa-1.3.2-dev/examples/example8_mys.c .
tiian@ubuntu1204-64:/tmp/tmp$ gcc example8_mys.c $(/opt/lixa/bin/lixa-config -c -f -m -d) \
&gt; $(mysql_config --include --libs_r) -o example8_mys
	  </pre></td></tr></tbody></table></div><p>
	Verify the executable produced by <span class="command"><strong>gcc</strong></span>:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1204-64:/tmp/tmp$ ldd example8_mys
        linux-vdso.so.1 =&gt;  (0x00007fff37367000)
	liblixac.so.0 =&gt; /opt/lixa/lib/liblixac.so.0 (0x00007fd64e935000)
	liblixamy.so.0 =&gt; /opt/lixa/lib/liblixamy.so.0 (0x00007fd64e72d000)
	libmysqlclient.so.18 =&gt; /usr/lib/x86_64-linux-gnu/libmysqlclient.so.18 (0x00007fd64e1db000)
	libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007fd64de1d000)
	libgmodule-2.0.so.0 =&gt; /usr/lib/x86_64-linux-gnu/libgmodule-2.0.so.0 (0x00007fd64dc19000)
	libglib-2.0.so.0 =&gt; /lib/x86_64-linux-gnu/libglib-2.0.so.0 (0x00007fd64d923000)
	libxml2.so.2 =&gt; /usr/lib/x86_64-linux-gnu/libxml2.so.2 (0x00007fd64d5c7000)
	liblixab.so.0 =&gt; /opt/lixa/lib/liblixab.so.0 (0x00007fd64d3ad000)
	libpthread.so.0 =&gt; /lib/x86_64-linux-gnu/libpthread.so.0 (0x00007fd64d18f000)
	libz.so.1 =&gt; /lib/x86_64-linux-gnu/libz.so.1 (0x00007fd64cf78000)
	libdl.so.2 =&gt; /lib/x86_64-linux-gnu/libdl.so.2 (0x00007fd64cd74000)
	librt.so.1 =&gt; /lib/x86_64-linux-gnu/librt.so.1 (0x00007fd64cb6b000)
	libm.so.6 =&gt; /lib/x86_64-linux-gnu/libm.so.6 (0x00007fd64c86f000)
	/lib64/ld-linux-x86-64.so.2 (0x00007fd64eb54000)
	libpcre.so.3 =&gt; /lib/x86_64-linux-gnu/libpcre.so.3 (0x00007fd64c632000)
	libuuid.so.1 =&gt; /lib/x86_64-linux-gnu/libuuid.so.1 (0x00007fd64c42c000)
	  </pre></td></tr></tbody></table></div><p>
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp68463552"></a>Set-up LIXA environment</h3></div></div></div><p>
	Set-up the <code class="varname">LIXA_PROFILE</code> environment variable:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1204-64:/tmp/tmp$ echo $LIXA_PROFILE

tiian@ubuntu1204-64:/tmp/tmp$ export LIXA_PROFILE=MYS_STA
tiian@ubuntu1204-64:/tmp/tmp$ echo $LIXA_PROFILE
MYS_STA
	  </pre></td></tr></tbody></table></div><p>
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Development_setup_MySQL_xa_open_info"></a>Some checks before program execution</h3></div></div></div><p>
	We set <code class="varname">LIXA_PROFILE</code> to value
	<span class="quote">“<span class="quote">MYS_STA</span>”</span>, looking at
	<code class="filename">/opt/lixa/etc/lixac_conf.xml</code>:
	</p><pre class="screen">
    &lt;profile name="MYS_STA"&gt;
      &lt;sttsrvs&gt;
        &lt;sttsrv&gt;local_1&lt;/sttsrv&gt;
      &lt;/sttsrvs&gt;
      &lt;rsrmgrs&gt;
        &lt;rsrmgr&gt;MySQL_stareg&lt;/rsrmgr&gt;
      &lt;/rsrmgrs&gt;
    &lt;/profile&gt;
	</pre><p>
	the profile references the Resource Manager named
	<span class="quote">“<span class="quote">MySQL_stareg</span>”</span>, looking again at the config file:
	</p><pre class="screen">
    &lt;rsrmgr name="MySQL_stareg" switch_file="/opt/lixa/lib/switch_mysql_stareg.so" xa_open_info="host=localhost,user=lixa,passwd=,db=lixa,client_flag=0" xa_close_info="" /&gt;
	</pre><p>
	we can discover how LIXA is configured to access the MySQL database.
	The content of <code class="constant">xa_open_info</code> is passed to
	<a class="ulink" href="http://dev.mysql.com/doc/refman/5.0/en/mysql-real-connect.html" target="_top"><code class="function">mysql_real_connect</code></a>
	function after some parsing has occurred.
	This is the prototype of the <code class="function">mysql_real_connect</code>
	function as described in the official manual
	</p><div class="funcsynopsis"><p><code class="funcdef">MYSQL *<strong class="fsfunc">mysql_real_connect</strong>(</code>const char *<var class="pdparam">host</var>, const char *<var class="pdparam">passwd</var>, const char *<var class="pdparam">db</var>, unsigned int <var class="pdparam">port</var>, const char *<var class="pdparam">unix_socket</var>, unsigned long <var class="pdparam">client_flag</var><code>)</code>;</p></div><p>
	and these are the tokens accepted by LIXA inside 
	<code class="constant">xa_open_info</code>:
	</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	      <em class="parameter"><code>host</code></em>: a string of characters
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      <em class="parameter"><code>user</code></em>: a string of characters
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      <em class="parameter"><code>passwd</code></em>: a string of characters
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      <em class="parameter"><code>db</code></em>: a string of characters
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      <em class="parameter"><code>port</code></em>: a number
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      <em class="parameter"><code>unix_socket</code></em>: a string of characters
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      <em class="parameter"><code>client_flag</code></em>: a number
	  </p></li></ul></div><p>
	As shown in the above example, this is the syntax that applies to
	<code class="constant">xa_open_info</code>:
	</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem"><p>
	      an element is composed by
	      <span class="token">&lt;token&gt;</span>=<span class="token">&lt;value&gt;</span> where 
	      <span class="token">&lt;token&gt;</span> is one of the keywords listed above
	  </p></li><li class="listitem"><p>
	      a comma <span class="quote">“<span class="quote">,</span>”</span> separates two elements 
	  </p></li><li class="listitem"><p>
	      <span class="token">&lt;value&gt;</span> may be empty 
	      (like <code class="constant">passwd</code> 
	      in the above example): it will passed as an empty string ("")
	      to <code class="function">mysql_real_connect</code>
	  </p></li><li class="listitem"><p>
	      if a <span class="token">&lt;token&gt;</span> is not specified in 
	      <code class="constant">xa_open_info</code>, LIXA will pass to 
	      <code class="function">mysql_real_connect</code> a NULL pointer if the
	      missing token refers to a character string and 0 value if the
	      missing token refers to a number
	  </p></li><li class="listitem"><p>
	      if you must put an equal symbol ("=") inside 
	      <span class="token">&lt;value&gt;</span>
	      you must put two instead of one: "=="
	  </p></li><li class="listitem"><p>
	      if you must put a comma symbol (",") inside 
	      <span class="token">&lt;value&gt;</span>
	      you must put two instead of one: ",,"
	  </p></li><li class="listitem"><p>
	      all control characters like space, tab, newline and so on, are
	      passed as is without any modification
	  </p></li></ol></div><p>
	Using this configuration:
	<code class="constant">xa_open_info="host=localhost,user=lixa,passwd=,db=lixa,client_flag=0"</code>
	LIXA will call <code class="function">mysql_real_connect</code> as
      </p><p>
	<code class="function">mysql_real_connect</code>(<em class="parameter"><code>conn</code></em>,
	<em class="parameter"><code>"localhost"</code></em>, <em class="parameter"><code>"lixa"</code></em>,
	<em class="parameter"><code>""</code></em>, <em class="parameter"><code>"lixa"</code></em>,
	<em class="parameter"><code>0</code></em>, <em class="parameter"><code>NULL</code></em>,
	<em class="parameter"><code>0</code></em>)
      </p><p>
	You should refer to MySQL official documentation to discover how you
	can configure <code class="constant">xa_open_info</code>.
	</p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>
	    <code class="constant">xa_open_info</code> can contain a maximum of 255
	    characters (plus \0 string terminator); if you need more space,
	    consider to move some parameters to <code class="filename">mycnf</code> file
	    (see MySQL official documentation to pick-up the details).
	</p></div><p>
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp68509904"></a>Program execution</h3></div></div></div><p>
	It is suggested to open two different terminals: the first one
	connected to <span class="quote">“<span class="quote">lixa</span>”</span> MySQL database and the second
	one pointing to the directory where the compiled program
	<code class="filename">example8_mys</code> lives.
	First teminal session:
	</p><div class="table"><table frame="box"><thead><tr><td>[MySQL terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1204-64:/tmp/tmp$ mysql -h localhost -u lixa lixa
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 38
Server version: 5.5.54-0ubuntu0.12.04.1 (Ubuntu)

Copyright (c) 2000, 2016, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql&gt;
	  </pre></td></tr></tbody></table></div><p>
	Second teminal session:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1204-64:/tmp/tmp$ ls -la
total 28
drwxrwxr-x 2 tiian tiian  4096 mar  3 22:47 .
drwxrwxrwt 5 root  root   4096 mar  3 22:47 ..
-rwxrwxr-x 1 tiian tiian 13052 mar  3 22:47 example8_mys
-rw-r--r-- 1 tiian tiian  3374 mar  3 22:46 example8_mys.c
	  </pre></td></tr></tbody></table></div><p>
	Check the content of <span class="quote">“<span class="quote">authors</span>”</span> table before
	program execution:
	</p><div class="table"><table frame="box"><thead><tr><td>[MySQL terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
mysql&gt; SELECT * FROM authors;
Empty set (0.04 sec)
	  </pre></td></tr></tbody></table></div><p>
	Execute the program:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1204-64:/tmp/tmp$ ./example8_mys insert
Inserting a row in the table...
	  </pre></td></tr></tbody></table></div><p>
	Check the content of the table again:
	</p><div class="table"><table frame="box"><thead><tr><td>[MySQL terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
mysql&gt; SELECT * FROM authors;
+----+-----------+------------+
| id | last_name | first_name |
+----+-----------+------------+
|  1 | Foo       | Bar        |
+----+-----------+------------+
1 row in set (0.00 sec)
	  </pre></td></tr></tbody></table></div><p>
	The example program inserted the row with id=1. You can not insert
	the same row twice because there is a unique constraint on this table,
	but you can remove the row using
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1204-64:/tmp/tmp$ ./example8_mys delete
Deleting a row from the table...
	  </pre></td></tr></tbody></table></div><p>
	Check the table content again:
	</p><div class="table"><table frame="box"><thead><tr><td>[MySQL terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
mysql&gt; SELECT * FROM authors;
Empty set (0.00 sec)
	  </pre></td></tr></tbody></table></div><p>
	you can verify in file
	<code class="filename">/opt/lixa/etc/lixac_conf.xml</code>
	that <span class="quote">“<span class="quote">MYS_STA</span>”</span> is associated to static registration
	<a href="#ftn.idp68531440" class="footnote" id="idp68531440"><sup class="footnote">[35]</sup></a>
	.
	Execute the program:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1204-64:/tmp/tmp$ export LIXA_TRACE_MASK=0x00002000
tiian@ubuntu1204-64:/tmp/tmp$ echo $LIXA_TRACE_MASK
0x00002000
tiian@ubuntu1204-64:/tmp/tmp$ ./example8_mys insert 2&gt;&amp;1 | grep xa_start
2017-03-03 22:51:51.988732 [2030/140079512323904] lixa_xa_start
2017-03-03 22:51:51.988757 [2030/140079512323904] lixa_xa_start: sending 213 bytes to the server for step 8
2017-03-03 22:51:52.044451 [2030/140079512323904] lixa_xa_start: receiving 95 bytes from the server |&lt;?xml version="1.0" encoding="UTF-8" ?&gt;&lt;msg level="0" verb="3" step="16"&gt;&lt;answer rc="0"/&gt;&lt;/msg&gt;|
2017-03-03 22:51:52.044627 [2030/140079512323904] lixa_xa_start: xa_start_entry(xid, 0, 0x0) = 0
2017-03-03 22:51:52.044639 [2030/140079512323904] lixa_xa_start: sending 210 bytes to the server for step 24
2017-03-03 22:51:52.044713 [2030/140079512323904] lixa_xa_start/excp=10/ret_cod=0/errno=0
	  </pre></td></tr></tbody></table></div><p>
	Finally, clean up the table again:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1204-64:/tmp/tmp$ unset LIXA_TRACE_MASK
tiian@ubuntu1204-64:/tmp/tmp$ ./example8_mys delete
Deleting a row from the table...
	  </pre></td></tr></tbody></table></div><p>
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Development_example9_mys_pql"></a>An example with MySQL &amp; PostgreSQL</h2></div></div></div><div class="figure"><a id="develop9"></a><p class="title"><strong>Figure 5.9. Deploy model of an example showing a distributed transaction with
	MySQL and PostgreSQL</strong></p><div class="figure-contents"><div class="mediaobject"><img src="../images/LIXA_Development_9.png" alt="Deploy model of an example showing a distributed transaction with MySQL and PostgreSQL" /></div></div></div><br class="figure-break" /><p>
      This example shows as
      you can implement DTP (Distributed Transaction Processing) with two
      Resource Managers (MySQL and PostgreSQL)
      coordinated by the LIXA Transaction Manager.
      It's strongly suggested you have played with the
      examples previously shown in this chapter (see
      <a class="xref" href="#Development" title="Chapter 5. Developing C Application Programs">Chapter 5, <em>Developing C Application Programs</em></a>) before starting this more complex one.
    </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	If you did not yet installed the software provided by PostgreSQL,
	please refer to the official PostgreSQL site to download the
	software and to pick-up the information necessary to install 
	and configure
	the database. This manual does not give you information related
	to PostgreSQL technology: it is assumed you already installed and
	configured the database.
      </p><p>
	If you did not yet installed the software provided by MySQL,
	please refer to the official MySQL site to download the
	software and to pick-up the information necessary to install 
	and configure
	the database. This manual does not give you information related
	to MySQL technology: it is assumed you already installed and
	configured the database.
      </p></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
	The LIXA software must be configured to support the MySQL and 
	PostgreSQL and resource managers as explained in 
	<a class="xref" href="#Linking_third_party_resource_managers" title="Linking third party resource managers">the section called “Linking third party resource managers”</a>.
	As a little hint, you should configure LIXA as below (Ubuntu):
	</p><pre class="screen">
./configure --with-mysql \
&gt; --with-postgresql-include=/usr/include/postgresql --with-postgresql-lib=/usr/lib
	</pre><p>
	or as below (Centos):
	</p><pre class="screen">
./configure --with-mysql \
&gt; --with-postgresql-include=/usr/include/postgresql --with-postgresql-lib=/usr/lib
	</pre><p>
	Please don't forget you must compile and install every time you
	re-configure.
      </p></div><p>
      Please follow the instructions explained 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	    in <a class="xref" href="#Development_setup_MySQL_environment" title="Set-up MySQL environment">the section called “Set-up MySQL environment”</a>
	    to set-up a running environment for MySQL server
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	    in <a class="xref" href="#Development_setup_PostgreSQL_environment" title="Set-up PostgreSQL environment">the section called “Set-up PostgreSQL environment”</a>
	    to set-up a running environment for PostgreSQL server
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	    in <a class="xref" href="#Development_start_LIXA_server" title="Start the LIXA state server">the section called “Start the LIXA state server”</a>
	    to start up the LIXA state server
	</p></li></ul></div><p>
    </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp68552848"></a>Build the client program</h3></div></div></div><p>
	Prepare the client (Application Program) using the below commands
	(<span class="command"><strong>gcc</strong></span> command was splitted on several lines 
	using <span class="command"><strong>\</strong></span> to help readability, but you may use
	a single line):
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~$ mkdir tmp
tiian@ubuntu:~$ cd tmp
tiian@ubuntu:~/tmp$ cp /opt/lixa/share/doc/lixa-X.Y.Z/examples/example9_mys_pql.c .
tiian@ubuntu:~/tmp$ gcc example9_mys_pql.c $(/opt/lixa/bin/lixa-config -c -f -m -p -d) \
&gt; $(mysql_config --include --libs_r) -I/usr/include/postgresql -lpq \
&gt; -o example9_mys_pql
	  </pre></td></tr></tbody></table></div><p>
	Verify the executable produced by <span class="command"><strong>gcc</strong></span>:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ ldd example9_mys_pql
        linux-gate.so.1 =&gt;  (0xb76f6000)
        liblixac.so.0 =&gt; /opt/lixa/lib/liblixac.so.0 (0xb76db000)
        liblixamy.so.0 =&gt; /opt/lixa/lib/liblixamy.so.0 (0xb76d3000)
        liblixapq.so.0 =&gt; /opt/lixa/lib/liblixapq.so.0 (0xb76cb000)
        libmysqlclient_r.so.15 =&gt; /usr/lib/libmysqlclient_r.so.15 (0xb74db000)
        libpq.so.5 =&gt; /usr/lib/libpq.so.5 (0xb74bc000)
        libc.so.6 =&gt; /lib/tls/i686/cmov/libc.so.6 (0xb736d000)
        libgmodule-2.0.so.0 =&gt; /usr/lib/libgmodule-2.0.so.0 (0xb7369000)
        libdl.so.2 =&gt; /lib/tls/i686/cmov/libdl.so.2 (0xb7365000)
        libgthread-2.0.so.0 =&gt; /usr/lib/libgthread-2.0.so.0 (0xb735f000)
        librt.so.1 =&gt; /lib/tls/i686/cmov/librt.so.1 (0xb7356000)
        libglib-2.0.so.0 =&gt; /usr/lib/libglib-2.0.so.0 (0xb72a5000)
        libxml2.so.2 =&gt; /usr/lib/libxml2.so.2 (0xb7185000)
        liblixab.so.0 =&gt; /opt/lixa/lib/liblixab.so.0 (0xb7170000)
        libpthread.so.0 =&gt; /lib/tls/i686/cmov/libpthread.so.0 (0xb7157000)
        libcrypt.so.1 =&gt; /lib/tls/i686/cmov/libcrypt.so.1 (0xb7125000)
        libnsl.so.1 =&gt; /lib/tls/i686/cmov/libnsl.so.1 (0xb710d000)
        libm.so.6 =&gt; /lib/tls/i686/cmov/libm.so.6 (0xb70e8000)
        libz.so.1 =&gt; /usr/lib/libz.so.1 (0xb70d3000)
        libssl.so.0.9.8 =&gt; /usr/lib/i686/cmov/libssl.so.0.9.8 (0xb708e000)
        libcrypto.so.0.9.8 =&gt; /usr/lib/i686/cmov/libcrypto.so.0.9.8 (0xb6f4b000)
        libkrb5.so.3 =&gt; /usr/lib/libkrb5.so.3 (0xb6ebe000)
        libcom_err.so.2 =&gt; /lib/libcom_err.so.2 (0xb6ebb000)
        libgssapi_krb5.so.2 =&gt; /usr/lib/libgssapi_krb5.so.2 (0xb6e92000)
        libldap_r-2.4.so.2 =&gt; /usr/lib/libldap_r-2.4.so.2 (0xb6e52000)
        /lib/ld-linux.so.2 (0xb76f7000)
        libpcre.so.3 =&gt; /usr/lib/libpcre.so.3 (0xb6e2a000)
        libuuid.so.1 =&gt; /lib/libuuid.so.1 (0xb6e26000)
        libk5crypto.so.3 =&gt; /usr/lib/libk5crypto.so.3 (0xb6e03000)
        libkrb5support.so.0 =&gt; /usr/lib/libkrb5support.so.0 (0xb6dfb000)
        libkeyutils.so.1 =&gt; /lib/libkeyutils.so.1 (0xb6df8000)
        libresolv.so.2 =&gt; /lib/tls/i686/cmov/libresolv.so.2 (0xb6de4000)
        liblber-2.4.so.2 =&gt; /usr/lib/liblber-2.4.so.2 (0xb6dd7000)
        libsasl2.so.2 =&gt; /usr/lib/libsasl2.so.2 (0xb6dc0000)
        libgnutls.so.13 =&gt; /usr/lib/libgnutls.so.13 (0xb6d4a000)
        libtasn1.so.3 =&gt; /usr/lib/libtasn1.so.3 (0xb6d3a000)
        libgcrypt.so.11 =&gt; /lib/libgcrypt.so.11 (0xb6cec000)
        libgpg-error.so.0 =&gt; /lib/libgpg-error.so.0 (0xb6ce8000)
	  </pre></td></tr></tbody></table></div><p>
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp68562976"></a>Set-up LIXA environment</h3></div></div></div><p>
	Set-up the necessary environment variables:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ echo $LIXA_PROFILE

tiian@ubuntu:~/tmp$ export LIXA_PROFILE=MYS_STA_PQL_STA
tiian@ubuntu:~/tmp$ echo $LIXA_PROFILE
MYS_STA_PQL_STA
	  </pre></td></tr></tbody></table></div><p>
	It is suggested to set the necessary environment variable
	(<code class="varname">LIXA_PROFILE</code>) in your 
	profile if you are going to execute the programs many times.
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp68567232"></a>Some checks before program execution</h3></div></div></div><p>
	We set <code class="varname">LIXA_PROFILE</code> to value
	<span class="quote">“<span class="quote">MYS_STA_PQL_STA</span>”</span>, looking at
	<code class="filename">/opt/lixa/etc/lixac_conf.xml</code>:
	</p><pre class="screen">
    &lt;profile name="MYS_STA_PQL_STA"&gt;
      &lt;sttsrvs&gt;
        &lt;sttsrv&gt;local_1&lt;/sttsrv&gt;
      &lt;/sttsrvs&gt;
      &lt;rsrmgrs&gt;
        &lt;rsrmgr&gt;MySQL_stareg&lt;/rsrmgr&gt;
        &lt;rsrmgr&gt;PostgreSQL_stareg&lt;/rsrmgr&gt;
      &lt;/rsrmgrs&gt;
    &lt;/profile&gt;
	</pre><p>
	the profile references two Resource Managers:
	<span class="quote">“<span class="quote">MySQL_stareg</span>”</span> and <span class="quote">“<span class="quote">PostgreSQL_stareg</span>”</span>, 
	looking again at the config file:
	</p><pre class="screen">
    &lt;rsrmgr name="MySQL_stareg" switch_file="/opt/lixa/lib/switch_mysql_stareg.so" xa_open_info="host=localhost,user=lixa,passwd=,db=lixa,client_flag=0" xa_close_info="" /&gt;
    &lt;rsrmgr name="PostgreSQL_stareg" switch_file="/opt/lixa/lib/switch_postgresql_stareg.so" xa_open_info="dbname=testdb" xa_close_info="" /&gt;
	</pre><p>
	we can discover how our application will access the resource
	managers
	<a href="#ftn.idp68572000" class="footnote" id="idp68572000"><sup class="footnote">[36]</sup></a>
	<a href="#ftn.idp68574368" class="footnote" id="idp68574368"><sup class="footnote">[37]</sup></a>.
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp68577376"></a>Program execution</h3></div></div></div><p>
	It is suggested to open three different terminals: 
	the first one connected to <span class="quote">“<span class="quote">lixa</span>”</span> MySQL database,
	the second one connected to <span class="quote">“<span class="quote">testdb</span>”</span> PostgreSQL database
	and the
	third one pointing to the directory where the compiled program 
	example9_mys_pql lives.
	</p><div class="table"><table frame="box"><thead><tr><td>[MySQL terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~$ mysql -h localhost -u lixa lixa
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 37
Server version: 5.0.51a-3ubuntu5.8 (Ubuntu)

Type 'help;' or '\h' for help. Type '\c' to clear the buffer.

mysql&gt;
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[PostgreSQL terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~$ psql testdb
Welcome to psql 8.3.15, the PostgreSQL interactive terminal.

Type:  \copyright for distribution terms
       \h for help with SQL commands
       \? for help with psql commands
       \g or terminate with semicolon to execute query
       \q to quit

testdb=&gt;
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ ls -la
total 28
drwxr-xr-x  2 tiian tiian  4096 2011-09-20 21:53 .
drwxr-xr-x 40 tiian tiian  4096 2011-09-19 20:54 ..
-rwxr-xr-x  1 tiian tiian 10096 2011-11-03 20:45 example9_mys_pql
-rw-r--r--  1 tiian tiian  4602 2011-11-03 20:45 example9_mys_pql.c
	  </pre></td></tr></tbody></table></div><p>
	Check the content of the MySQL table (<span class="quote">“<span class="quote">authors</span>”</span>):
	</p><div class="table"><table frame="box"><thead><tr><td>[MySQL terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
mysql&gt; SELECT * FROM authors;
Empty set (0.02 sec)
	  </pre></td></tr></tbody></table></div><p>
	Check the content of the PostgreSQL table (<span class="quote">“<span class="quote">AUTHORS</span>”</span>):
	</p><div class="table"><table frame="box"><thead><tr><td>[PostgreSQL terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
testdb=&gt; select * from AUTHORS;
 id | last_name | first_name
----+-----------+------------
(0 rows)
	  </pre></td></tr></tbody></table></div><p>
	Insert a row in all the tables and check the contents of the tables
	after the transaction execution:
	</p><div class="table"><table frame="box"><thead><tr><td>[Third terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ ./example9_mys_pql insert
Inserting a row in MySQL table...
Inserting a row in PostgreSQL table...
	  </pre></td></tr></tbody></table></div><p>
	Now you can verify the content of the tables after the transaction:
	</p><div class="table"><table frame="box"><thead><tr><td>[MySQL terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
mysql&gt; SELECT * FROM authors;
+----+-----------+------------+
| id | last_name | first_name |
+----+-----------+------------+
|  1 | Foo       | Bar        |
+----+-----------+------------+
1 row in set (0.00 sec)
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[PostgreSQL terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
testdb=&gt; select * from AUTHORS;
 id | last_name | first_name
----+-----------+------------
  1 | Foo       | Bar
(1 row)
	  </pre></td></tr></tbody></table></div><p>
	With the opposite command you can remove the rows from the tables:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ ./example9_mys_pql delete
Deleting a row from MySQL  table...
Deleting a row from PostgreSQL table...
	  </pre></td></tr></tbody></table></div><p>
	and check the content of the tables again:
	</p><div class="table"><table frame="box"><thead><tr><td>[MySQL terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
mysql&gt; SELECT * FROM authors;
Empty set (0.00 sec)
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[PostgreSQL terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
testdb=&gt; select * from AUTHORS;
 id | last_name | first_name
----+-----------+------------
(0 rows)
	  </pre></td></tr></tbody></table></div><p>
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Development_example10_mys_pql_ora"></a>An example with MySQL, PostgreSQL &amp; Oracle</h2></div></div></div><div class="figure"><a id="develop10"></a><p class="title"><strong>Figure 5.10. Deploy model of an example showing a distributed transaction with
	MySQL, PostgreSQL and Oracle</strong></p><div class="figure-contents"><div class="mediaobject"><img src="../images/LIXA_Development_10.png" alt="Deploy model of an example showing a distributed transaction with MySQL, PostgreSQL and Oracle" /></div></div></div><br class="figure-break" /><p>
      This example shows as
      you can implement DTP (Distributed Transaction Processing) with three
      Resource Managers (MySQL, PostgreSQL and Oracle)
      coordinated by the LIXA Transaction Manager.
      It's strongly suggested you have played with the
      examples previously shown in this chapter (see
      <a class="xref" href="#Development" title="Chapter 5. Developing C Application Programs">Chapter 5, <em>Developing C Application Programs</em></a>) before starting this more complex one.
    </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	If you did not yet installed the software provided by MySQL,
	please refer to the official MySQL site to download the
	software and to pick-up the information necessary to install 
	and configure
	the database. This manual does not give you information related
	to MySQL technology: it is assumed you already installed and
	configured the database.
      </p><p>
	If you did not yet installed the software provided by PostgreSQL,
	please refer to the official PostgreSQL site to download the
	software and to pick-up the information necessary to install 
	and configure
	the database. This manual does not give you information related
	to PostgreSQL technology: it is assumed you already installed and
	configured the database.
      </p><p>
	If you did not yet installed the software provided by Oracle,
	please refer to the official Oracle site to download the
	software and to pick-up the information necessary to install 
	and configure
	the database. This manual does not give you information related
	to Oracle technology: it is assumed you already installed and
	configured the database.
      </p></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
	The LIXA software must be configured to support the MySQL, 
	PostgreSQL and Oracle resource managers as explained in 
	<a class="xref" href="#Linking_third_party_resource_managers" title="Linking third party resource managers">the section called “Linking third party resource managers”</a>.
	As a little hint, you should configure LIXA as below:
	</p><pre class="screen">
./configure --with-mysql \
&gt; --with-postgresql-include=/usr/include/postgresql --with-postgresql-lib=/usr/lib \
&gt; --with-oracle=/usr/lib/oracle/xe/app/oracle/product/10.2.0/server
	</pre><p>
	Please don't forget you must compile and install every time you
	re-configure.
      </p></div><p>
      Please follow the instructions explained 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	    in <a class="xref" href="#Development_setup_MySQL_environment" title="Set-up MySQL environment">the section called “Set-up MySQL environment”</a>
	    to set-up a running environment for MySQL server
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	    in <a class="xref" href="#Development_setup_PostgreSQL_environment" title="Set-up PostgreSQL environment">the section called “Set-up PostgreSQL environment”</a>
	    to set-up a running environment for PostgreSQL server
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	    in <a class="xref" href="#Development_setup_Oracle_environment" title="Set-up the Oracle environment (server side)">the section called “Set-up the Oracle environment (server side)”</a>
	    to set-up a running environment for Oracle Database Server
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	    in <a class="xref" href="#Development_start_LIXA_server" title="Start the LIXA state server">the section called “Start the LIXA state server”</a>
	    to start up the LIXA state server
	</p></li></ul></div><p>
    </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp68624320"></a>Build the client program</h3></div></div></div><p>
	Prepare the client (Application Program) using the below commands
	(<span class="command"><strong>gcc</strong></span> command was splitted on several lines 
	using <span class="command"><strong>\</strong></span> to help readability, but you may use
	a single line):
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~$ mkdir tmp
tiian@ubuntu:~$ cd tmp
tiian@ubuntu:~/tmp$ cp /opt/lixa/share/doc/lixa-X.Y.Z/examples/example10_mys_pql_ora.c .
tiian@ubuntu:~/tmp$ gcc example10_mys_pql_ora.c $(/opt/lixa/bin/lixa-config -c -f -m -p -d) \
&gt; $(mysql_config --include --libs_r) -I/usr/include/postgresql -lpq \
&gt; -I/usr/lib/oracle/xe/app/oracle/product/10.2.0/server/rdbms/public \
&gt; -L/usr/lib/oracle/xe/app/oracle/product/10.2.0/server/lib -lclntsh -lnnz10 \  &gt; -o example10_mys_pql_ora
	  </pre></td></tr></tbody></table></div><p>
	Verify the executable produced by <span class="command"><strong>gcc</strong></span>:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ ldd example10_mys_pql_ora
        linux-gate.so.1 =&gt;  (0xb774b000)
        liblixac.so.0 =&gt; /opt/lixa/lib/liblixac.so.0 (0xb7730000)
        liblixapq.so.0 =&gt; /opt/lixa/lib/liblixapq.so.0 (0xb7729000)
        liblixamy.so.0 =&gt; /opt/lixa/lib/liblixamy.so.0 (0xb7720000)
        libmysqlclient_r.so.15 =&gt; /usr/lib/libmysqlclient_r.so.15 (0xb7530000)
        libpq.so.5 =&gt; /usr/lib/libpq.so.5 (0xb7511000)
        libclntsh.so.10.1 =&gt; not found
        libnnz10.so =&gt; not found
        libc.so.6 =&gt; /lib/tls/i686/cmov/libc.so.6 (0xb73c1000)
        libgmodule-2.0.so.0 =&gt; /usr/lib/libgmodule-2.0.so.0 (0xb73bd000)
        libdl.so.2 =&gt; /lib/tls/i686/cmov/libdl.so.2 (0xb73b9000)
        libgthread-2.0.so.0 =&gt; /usr/lib/libgthread-2.0.so.0 (0xb73b4000)
        librt.so.1 =&gt; /lib/tls/i686/cmov/librt.so.1 (0xb73ab000)
        libglib-2.0.so.0 =&gt; /usr/lib/libglib-2.0.so.0 (0xb72fa000)
        libxml2.so.2 =&gt; /usr/lib/libxml2.so.2 (0xb71d9000)
        liblixab.so.0 =&gt; /opt/lixa/lib/liblixab.so.0 (0xb71c4000)
        libm.so.6 =&gt; /lib/tls/i686/cmov/libm.so.6 (0xb719f000)
        libpthread.so.0 =&gt; /lib/tls/i686/cmov/libpthread.so.0 (0xb7187000)
        libcrypt.so.1 =&gt; /lib/tls/i686/cmov/libcrypt.so.1 (0xb7155000)
        libnsl.so.1 =&gt; /lib/tls/i686/cmov/libnsl.so.1 (0xb713c000)
        libz.so.1 =&gt; /usr/lib/libz.so.1 (0xb7127000)
        libssl.so.0.9.8 =&gt; /usr/lib/i686/cmov/libssl.so.0.9.8 (0xb70e1000)
        libcrypto.so.0.9.8 =&gt; /usr/lib/i686/cmov/libcrypto.so.0.9.8 (0xb6f9f000)
        libkrb5.so.3 =&gt; /usr/lib/libkrb5.so.3 (0xb6f12000)
        libcom_err.so.2 =&gt; /lib/libcom_err.so.2 (0xb6f0e000)
        libgssapi_krb5.so.2 =&gt; /usr/lib/libgssapi_krb5.so.2 (0xb6ee5000)
        libldap_r-2.4.so.2 =&gt; /usr/lib/libldap_r-2.4.so.2 (0xb6ea5000)
        /lib/ld-linux.so.2 (0xb774c000)
        libpcre.so.3 =&gt; /usr/lib/libpcre.so.3 (0xb6e7e000)
        libuuid.so.1 =&gt; /lib/libuuid.so.1 (0xb6e7a000)
        libk5crypto.so.3 =&gt; /usr/lib/libk5crypto.so.3 (0xb6e56000)
        libkrb5support.so.0 =&gt; /usr/lib/libkrb5support.so.0 (0xb6e4e000)
        libkeyutils.so.1 =&gt; /lib/libkeyutils.so.1 (0xb6e4b000)
        libresolv.so.2 =&gt; /lib/tls/i686/cmov/libresolv.so.2 (0xb6e38000)
        liblber-2.4.so.2 =&gt; /usr/lib/liblber-2.4.so.2 (0xb6e2b000)
        libsasl2.so.2 =&gt; /usr/lib/libsasl2.so.2 (0xb6e13000)
        libgnutls.so.13 =&gt; /usr/lib/libgnutls.so.13 (0xb6d9d000)
        libtasn1.so.3 =&gt; /usr/lib/libtasn1.so.3 (0xb6d8d000)
        libgcrypt.so.11 =&gt; /lib/libgcrypt.so.11 (0xb6d40000)
        libgpg-error.so.0 =&gt; /lib/libgpg-error.so.0 (0xb6d3c000)
	  </pre></td></tr></tbody></table></div><p>
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp68634560"></a>Set-up LIXA environment</h3></div></div></div><p>
	There are five unresolved references that can be fixed setting up
	the environment properly:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ echo $LD_LIBRARY_PATH

tiian@ubuntu:~/tmp$ . /usr/lib/oracle/xe/app/oracle/product/10.2.0/server/bin/oracle_env.sh
tiian@ubuntu:~/tmp$ echo $LD_LIBRARY_PATH
/usr/lib/oracle/xe/app/oracle/product/10.2.0/server/lib:
	  </pre></td></tr></tbody></table></div><p>
	Check again the executable:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ ldd example10_mys_pql_ora                                           linux-gate.so.1 =&gt;  (0xb77c3000)
        liblixac.so.0 =&gt; /opt/lixa/lib/liblixac.so.0 (0xb77a8000)
        liblixapq.so.0 =&gt; /opt/lixa/lib/liblixapq.so.0 (0xb77a1000)
        liblixamy.so.0 =&gt; /opt/lixa/lib/liblixamy.so.0 (0xb7798000)
        libmysqlclient_r.so.15 =&gt; /usr/lib/libmysqlclient_r.so.15 (0xb75a8000)
        libpq.so.5 =&gt; /usr/lib/libpq.so.5 (0xb7589000)
        libclntsh.so.10.1 =&gt; /usr/lib/oracle/xe/app/oracle/product/10.2.0/server/lib/libclntsh.so.10.1 (0xb67d5000)
        libnnz10.so =&gt; /usr/lib/oracle/xe/app/oracle/product/10.2.0/server/lib/libnnz10.so (0xb65d0000)
        libc.so.6 =&gt; /lib/tls/i686/cmov/libc.so.6 (0xb6480000)
        libgmodule-2.0.so.0 =&gt; /usr/lib/libgmodule-2.0.so.0 (0xb647c000)
        libdl.so.2 =&gt; /lib/tls/i686/cmov/libdl.so.2 (0xb6478000)
        libgthread-2.0.so.0 =&gt; /usr/lib/libgthread-2.0.so.0 (0xb6473000)
        librt.so.1 =&gt; /lib/tls/i686/cmov/librt.so.1 (0xb646a000)
        libglib-2.0.so.0 =&gt; /usr/lib/libglib-2.0.so.0 (0xb63b9000)
        libxml2.so.2 =&gt; /usr/lib/libxml2.so.2 (0xb6298000)
        liblixab.so.0 =&gt; /opt/lixa/lib/liblixab.so.0 (0xb6283000)
        libm.so.6 =&gt; /lib/tls/i686/cmov/libm.so.6 (0xb625e000)
        libpthread.so.0 =&gt; /lib/tls/i686/cmov/libpthread.so.0 (0xb6246000)
        libcrypt.so.1 =&gt; /lib/tls/i686/cmov/libcrypt.so.1 (0xb6214000)
        libnsl.so.1 =&gt; /lib/tls/i686/cmov/libnsl.so.1 (0xb61fb000)
        libz.so.1 =&gt; /usr/lib/libz.so.1 (0xb61e6000)
        libssl.so.0.9.8 =&gt; /usr/lib/i686/cmov/libssl.so.0.9.8 (0xb61a0000)
        libcrypto.so.0.9.8 =&gt; /usr/lib/i686/cmov/libcrypto.so.0.9.8 (0xb605e000)
        libkrb5.so.3 =&gt; /usr/lib/libkrb5.so.3 (0xb5fd1000)
        libcom_err.so.2 =&gt; /lib/libcom_err.so.2 (0xb5fcd000)
        libgssapi_krb5.so.2 =&gt; /usr/lib/libgssapi_krb5.so.2 (0xb5fa4000)
        libldap_r-2.4.so.2 =&gt; /usr/lib/libldap_r-2.4.so.2 (0xb5f64000)
        /lib/ld-linux.so.2 (0xb77c4000)
        libpcre.so.3 =&gt; /usr/lib/libpcre.so.3 (0xb5f3d000)
        libuuid.so.1 =&gt; /lib/libuuid.so.1 (0xb5f39000)
        libk5crypto.so.3 =&gt; /usr/lib/libk5crypto.so.3 (0xb5f15000)
        libkrb5support.so.0 =&gt; /usr/lib/libkrb5support.so.0 (0xb5f0d000)
        libkeyutils.so.1 =&gt; /lib/libkeyutils.so.1 (0xb5f0a000)
        libresolv.so.2 =&gt; /lib/tls/i686/cmov/libresolv.so.2 (0xb5ef7000)
        liblber-2.4.so.2 =&gt; /usr/lib/liblber-2.4.so.2 (0xb5eea000)
        libsasl2.so.2 =&gt; /usr/lib/libsasl2.so.2 (0xb5ed2000)
        libgnutls.so.13 =&gt; /usr/lib/libgnutls.so.13 (0xb5e5c000)
        libtasn1.so.3 =&gt; /usr/lib/libtasn1.so.3 (0xb5e4c000)
        libgcrypt.so.11 =&gt; /lib/libgcrypt.so.11 (0xb5dff000)
        libgpg-error.so.0 =&gt; /lib/libgpg-error.so.0 (0xb5dfb000)
	  </pre></td></tr></tbody></table></div><p>
	Set-up the necessary environment variables:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ echo $LIXA_PROFILE

tiian@ubuntu:~/tmp$ export LIXA_PROFILE=MYS_STA_PQL_STA_ORA_DYN
tiian@ubuntu:~/tmp$ echo $LIXA_PROFILE
MYS_STA_PQL_STA_ORA_DYN
	  </pre></td></tr></tbody></table></div><p>
	It is suggested to set the necessary environment variables in your 
	profile if you are going to execute the programs many times.
	This is the list of the suggested variables:
	<code class="varname">LD_LIBRARY_PATH</code>,
	<code class="varname">LIXA_PROFILE</code>,
	<code class="varname">ORACLE_HOME</code>,
	<code class="varname">ORACLE_SID</code>,
	<code class="varname">PATH</code>.
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp68648192"></a>Some checks before program execution</h3></div></div></div><p>
	We set <code class="varname">LIXA_PROFILE</code> to value
	<span class="quote">“<span class="quote">MYS_STA_PQL_STA_ORA_DYN</span>”</span>, looking at
	<code class="filename">/opt/lixa/etc/lixac_conf.xml</code>:
	</p><pre class="screen">
    &lt;profile name="MYS_STA_PQL_STA_ORA_DYN"&gt;
      &lt;sttsrvs&gt;
        &lt;sttsrv&gt;local_1&lt;/sttsrv&gt;
      &lt;/sttsrvs&gt;
      &lt;rsrmgrs&gt;
        &lt;rsrmgr&gt;MySQL_stareg&lt;/rsrmgr&gt;
        &lt;rsrmgr&gt;PostgreSQL_stareg&lt;/rsrmgr&gt;
        &lt;rsrmgr&gt;OracleXE_dynreg&lt;/rsrmgr&gt;
      &lt;/rsrmgrs&gt;
    &lt;/profile&gt;
	</pre><p>
	the profile references three Resource Managers:
	<span class="quote">“<span class="quote">MySQL_stareg</span>”</span>, <span class="quote">“<span class="quote">PostgreSQL_stareg</span>”</span> 
	and <span class="quote">“<span class="quote">OracleXE_dynreg</span>”</span>,
	looking again at the config file:
	</p><pre class="screen">
    &lt;rsrmgr name="MySQL_stareg" switch_file="/opt/lixa/lib/switch_mysql_stareg.so" xa_open_info="host=localhost,user=lixa,passwd=,db=lixa,client_flag=0" xa_close_info="" /&gt;
    &lt;rsrmgr name="PostgreSQL_stareg" switch_file="/opt/lixa/lib/switch_postgresql_stareg.so" xa_open_info="dbname=testdb" xa_close_info="" /&gt;
    &lt;rsrmgr name="OracleXE_dynreg" switch_file="/opt/lixa/lib/switch_oracle_dynreg.so" xa_open_info="Oracle_XA+Acc=P/hr/hr+SesTm=30+LogDir=/tmp+threads=true+DbgFl=7+Loose_Coupling=true" xa_close_info="" /&gt;
	</pre><p>
	we can discover how our application will access the resource
	managers
	<a href="#ftn.idp68653872" class="footnote" id="idp68653872"><sup class="footnote">[38]</sup></a>
	<a href="#ftn.idp68656240" class="footnote" id="idp68656240"><sup class="footnote">[39]</sup></a>
	<a href="#ftn.idp68658064" class="footnote" id="idp68658064"><sup class="footnote">[40]</sup></a>. 
      </p><p>
	Verify no (Oracle) trace file exists:
	</p><pre class="screen">
tiian@ubuntu:~/tmp$ ls -la /tmp/xa*
ls: cannot access /tmp/xa*: No such file or directory
	</pre><p>
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp68661392"></a>Program execution (dynamic registration for Oracle)</h3></div></div></div><p>
	It is suggested to open four different terminals: 
	the first one connected to <span class="quote">“<span class="quote">lixa</span>”</span> MySQL database,
	the second one connected to <span class="quote">“<span class="quote">testdb</span>”</span> PostgreSQL database,
	the third one connected to Oracle database and the
	fourth one pointing to the directory where the compiled program 
	example10_mys_pql_ora lives.
	</p><div class="table"><table frame="box"><thead><tr><td>[MySQL terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~$ mysql -h localhost -u lixa lixa
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 37
Server version: 5.0.51a-3ubuntu5.8 (Ubuntu)

Type 'help;' or '\h' for help. Type '\c' to clear the buffer.

mysql&gt;
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[PostgreSQL terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~$ psql testdb
Welcome to psql 8.3.15, the PostgreSQL interactive terminal.

Type:  \copyright for distribution terms
       \h for help with SQL commands
       \? for help with psql commands
       \g or terminate with semicolon to execute query
       \q to quit

testdb=&gt;
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[Oracle terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~$ . /usr/lib/oracle/xe/app/oracle/product/10.2.0/server/bin/oracle_env.sh
tiian@ubuntu:~$ sqlplus "hr/hr"                                                 
SQL*Plus: Release 10.2.0.1.0 - Production on Tue May 3 21:52:06 2011

Copyright (c) 1982, 2005, Oracle.  All rights reserved.


Connected to:
Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production

SQL&gt;
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ ls -la
total 152
drwxr-xr-x  2 tiian tiian  4096 2011-11-11 21:06 .
drwxr-xr-x 40 tiian tiian  4096 2011-11-11 15:47 ..
-rwxr-xr-x  1 tiian tiian 12317 2011-11-11 21:06 example10_mys_pql_ora
-rw-r--r--  1 tiian tiian  8422 2011-11-11 21:05 example10_mys_pql_ora.c
	  </pre></td></tr></tbody></table></div><p>
	Check the content of the MySQL table (<span class="quote">“<span class="quote">authors</span>”</span>):
	</p><div class="table"><table frame="box"><thead><tr><td>[MySQL terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
mysql&gt; SELECT * FROM authors;
Empty set (0.02 sec)
	  </pre></td></tr></tbody></table></div><p>
	Check the content of the PostgreSQL table (<span class="quote">“<span class="quote">AUTHORS</span>”</span>):
	</p><div class="table"><table frame="box"><thead><tr><td>[PostgreSQL terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
testdb=&gt; select * from AUTHORS;
 id | last_name | first_name
----+-----------+------------
(0 rows)
	  </pre></td></tr></tbody></table></div><p>
	Check the content of the Oracle table (<span class="quote">“<span class="quote">COUNTRIES</span>”</span>):
	</p><div class="table"><table frame="box"><thead><tr><td>[Oracle terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
SQL&gt; select * from COUNTRIES where COUNTRY_ID = 'RS';

no rows selected
	  </pre></td></tr></tbody></table></div><p>
	Insert a row in all the tables and check the contents of the tables
	after the transaction execution:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ ./example10_mys_pql_ora insert
Inserting a row in MySQL table...
Inserting a row in PostgreSQL table...
Inserting a row in Oracle table...
	  </pre></td></tr></tbody></table></div><p>
	Now you can verify the content of the tables after the transaction:
	</p><div class="table"><table frame="box"><thead><tr><td>[MySQL terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
mysql&gt; SELECT * FROM authors;
+----+-----------+------------+
| id | last_name | first_name |
+----+-----------+------------+
|  1 | Foo       | Bar        |
+----+-----------+------------+
1 row in set (0.00 sec)
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[PostgreSQL terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
testdb=&gt; select * from AUTHORS;
 id | last_name | first_name
----+-----------+------------
  1 | Foo       | Bar
(1 row)
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[Oracle terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
SQL&gt; select * from COUNTRIES where COUNTRY_ID = 'RS';

CO COUNTRY_NAME                              REGION_ID
-- ---------------------------------------- ----------
RS Repubblica San Marino                             1
	  </pre></td></tr></tbody></table></div><p>
	With the opposite command you can remove the rows from the tables:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ ./example10_mys_pql_ora delete
Deleting a row from MySQL  table...
Deleting a row from PostgreSQL table...
Deleting a row from Oracle table...
	  </pre></td></tr></tbody></table></div><p>
	and check the content of the tables again:
	</p><div class="table"><table frame="box"><thead><tr><td>[MySQL terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
mysql&gt; SELECT * FROM authors;
Empty set (0.00 sec)
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[PostgreSQL terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
testdb=&gt; select * from AUTHORS;
 id | last_name | first_name
----+-----------+------------
(0 rows)
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[Oracle terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
SQL&gt; select * from COUNTRIES where COUNTRY_ID = 'RS';

no rows selected
	  </pre></td></tr></tbody></table></div><p>
	We can verify the dynamic registration behavior of Oracle:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ export LIXA_TRACE_MASK=0x00002000
tiian@ubuntu:~/tmp$ echo $LIXA_TRACE_MASK
0x00002000
tiian@ubuntu:~/tmp$ ./example10_mys_pql_ora insert 2&gt;&amp;1 | grep ax_reg
2011-11-11 21:39:40.850356 [23176/3051161344] ax_reg: rmid=2, xid=0xbfecc68c, flags=0x0
2011-11-11 21:39:40.850451 [23176/3051161344] ax_reg: the application program has started a transaction (TX states S3); this XID '1279875137.0600c467d21b42b38f1c89d912fc125d.8be5bdb35ba638bb997258e6bd8b9d88' will be returned
2011-11-11 21:39:40.850565 [23176/3051161344] ax_reg: sending 153 bytes to the server for step 8
2011-11-11 21:39:40.850602 [23176/3051161344] ax_reg/excp=7/ret_cod=0/errno=0
	  </pre></td></tr></tbody></table></div><p>
	We can check the static registration behavior of Oracle with a 
	different profile:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ export LIXA_PROFILE=MYS_STA_PQL_STA_ORA_STA
tiian@ubuntu:~/tmp$ echo $LIXA_PROFILE
MYS_STA_PQL_STA_ORA_STA
tiian@ubuntu:~/tmp$ ./example10_mys_pql_ora delete 2&gt;&amp;1 | grep xa_start
2011-11-11 21:41:52.953050 [23204/3050981120] lixa_xa_start
[...]
2011-11-11 21:41:53.005001 [23204/3050981120] lixa_xa_start: xa_start_entry(xid, 0, 0x0) = 0
2011-11-11 21:41:53.007040 [23204/3050981120] lixa_xa_start: xa_start_entry(xid, 1, 0x0) = 0
2011-11-11 21:41:53.009927 [23204/3050981120] lixa_xa_start: xa_start_entry(xid, 2, 0x0) = 0
2011-11-11 21:41:53.010004 [23204/3050981120] lixa_xa_start: sending 352 bytes to the server for step 24
2011-11-11 21:41:53.010095 [23204/3050981120] lixa_xa_start/excp=10/ret_cod=0/errno=0
	  </pre></td></tr></tbody></table></div><p>
	and check the content of the tables again:
	</p><div class="table"><table frame="box"><thead><tr><td>[MySQL terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
mysql&gt; SELECT * FROM authors;
Empty set (0.00 sec)
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[PostgreSQL terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
testdb=&gt; select * from AUTHORS;
 id | last_name | first_name
----+-----------+------------
(0 rows)
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[Oracle terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
SQL&gt; select * from COUNTRIES where COUNTRY_ID = 'RS';

no rows selected
	  </pre></td></tr></tbody></table></div><p>
	The activity of the Oracle database can be analyzed in the trace file:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ ls -la /tmp/xa_NULL11112011.trc
-rw-r--r-- 1 tiian tiian 22112 2011-11-11 21:47 /tmp/xa_NULL11112011.trc
	  </pre></td></tr></tbody></table></div><p>
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Development_example11_mys_mys"></a>An example with two MySQL servers</h2></div></div></div><div class="figure"><a id="develop11"></a><p class="title"><strong>Figure 5.11. Deploy model of an example showing a distributed transaction with
	two MySQL servers</strong></p><div class="figure-contents"><div class="mediaobject"><img src="../images/LIXA_Development_11.png" alt="Deploy model of an example showing a distributed transaction with two MySQL servers" /></div></div></div><br class="figure-break" /><p>
      This example shows as
      you can implement DTP (Distributed Transaction Processing) with two
      Resource Managers of the same type (MySQL) 
      coordinated by the LIXA Transaction Manager.
      It's strongly suggested you have played with the
      examples previously shown in this chapter (see
      <a class="xref" href="#Development" title="Chapter 5. Developing C Application Programs">Chapter 5, <em>Developing C Application Programs</em></a>) before starting this more complex one.
    </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	If you did not yet installed the software provided by MySQL,
	please refer to the official MySQL site to download the
	software and to pick-up the information necessary to install 
	and configure
	the database. This manual does not give you information related
	to MySQL technology: it is assumed you already installed and
	configured the database.
      </p></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
	The LIXA software must be configured to support the MySQL 
	resource managers as explained in 
	<a class="xref" href="#Linking_third_party_resource_managers" title="Linking third party resource managers">the section called “Linking third party resource managers”</a>.
	As a little hint, you should configure LIXA as below:
	</p><pre class="screen">
./configure --with-mysql
	</pre><p>
	Please don't forget you must compile and install every time you
	re-configure.
      </p></div><p>
      Please follow the instructions explained 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	    in <a class="xref" href="#Development_setup_MySQL_environment" title="Set-up MySQL environment">the section called “Set-up MySQL environment”</a>
	    to set-up a running environment for MySQL server
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	    in <a class="xref" href="#Development_start_LIXA_server" title="Start the LIXA state server">the section called “Start the LIXA state server”</a>
	    to start up the LIXA state server
	</p></li></ul></div><p>
      To address a remote MySQL server some additional steps must be completed.
      The example explained here uses this configuration:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	    IP address of the server running <span class="command"><strong>lixad</strong></span>
	    (LIXA state server), application program and local MySQL
	    server (reached using localhost 
	    <code class="systemitem">127.0.0.1</code> 
	    address): 
	    <code class="systemitem">192.168.1.2</code> 
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	    IP address of the server running the remote MySQL server:
	    <code class="systemitem">192.168.1.3</code> 
	</p></li></ul></div><p>
      Connect to server 
      <code class="systemitem">192.168.1.3</code> 
      and change the parameter
      <em class="parameter"><code>bind-address</code></em> in the file
      <code class="filename">/etc/mysql/my.cnf</code> to allow network reachability:
      </p><div class="table"><table frame="box"><thead><tr><td>[Host:192.168.1.3 /etc/mysql/my.cnf]</td></tr></thead><tbody><tr><td><pre class="screen">
# Instead of skip-networking the default is now to listen only on
# localhost which is more compatible and is not less secure.
#bind-address            = 127.0.0.1
bind-address            = 192.168.1.3
	</pre></td></tr></tbody></table></div><p>
      restart MySQL server:
      </p><div class="table"><table frame="box"><thead><tr><td>[Host:192.168.1.3 terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~$ sudo /etc/init.d/mysql restart
[sudo] password for tiian:
 * Stopping MySQL database server mysqld                                 [ OK ]
 * Starting MySQL database server mysqld                                 [ OK ]
 * Checking for corrupt, not cleanly closed and upgrade needing tables.
	</pre></td></tr></tbody></table></div><p>
      connect to that MySQL server from the remote host and grant access to
      user <code class="systemitem">lixa</code> from the server 
      <code class="systemitem">192.168.1.2</code>:
      </p><div class="table"><table frame="box"><thead><tr><td>[Host:192.168.1.3 terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@mojan:~$ mysql -u root -p
Enter password:
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 11
Server version: 5.0.51a-3ubuntu5.8 (Ubuntu)

Type 'help;' or '\h' for help. Type '\c' to clear the buffer.

mysql&gt; GRANT ALL ON lixa.* TO 'lixa'@'192.168.1.2';
Query OK, 0 rows affected (0.00 sec)
	</pre></td></tr></tbody></table></div><p>
      now you should be able to connect to the server running at
      <code class="systemitem">192.168.1.3</code> 
      from the server 
      <code class="systemitem">192.168.1.2</code>:
      </p><div class="table"><table frame="box"><thead><tr><td>[Host:192.168.1.2 terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~$ mysql -h 192.168.1.3 -u lixa lixa
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 13
Server version: 5.0.51a-3ubuntu5.8 (Ubuntu)

Type 'help;' or '\h' for help. Type '\c' to clear the buffer.
	</pre></td></tr></tbody></table></div><p>
      and you must create the table necessary for the example program:
      </p><div class="table"><table frame="box"><thead><tr><td>[MySQL (remote) terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
mysql&gt; CREATE TABLE authors (id INTEGER NOT NULL PRIMARY KEY, last_name TEXT, first_name TEXT) ENGINE=InnoDB;
Query OK, 0 rows affected (0.01 sec)

mysql&gt; DESCRIBE authors;
+------------+---------+------+-----+---------+-------+
| Field      | Type    | Null | Key | Default | Extra |
+------------+---------+------+-----+---------+-------+
| id         | int(11) | NO   | PRI | NULL    |       |
| last_name  | text    | YES  |     | NULL    |       |
| first_name | text    | YES  |     | NULL    |       |
+------------+---------+------+-----+---------+-------+
3 rows in set (0.01 sec)
	</pre></td></tr></tbody></table></div><p>
    </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp68750880"></a>Build the client program</h3></div></div></div><p>
	Prepare the client (Application Program) using the below commands
	(<span class="command"><strong>gcc</strong></span> command was splitted on several lines 
	using <span class="command"><strong>\</strong></span> to help readability, but you may use
	a single line):
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~$ mkdir tmp
tiian@ubuntu:~$ cd tmp
tiian@ubuntu:~/tmp$ cp /opt/lixa/share/doc/lixa-X.Y.Z/examples/example11_mys_mys.c .
tiian@ubuntu:~/tmp$ gcc example11_mys_mys.c $(/opt/lixa/bin/lixa-config -c -f -m -d) \
&gt; $(mysql_config --include --libs_r) -o example11_mys_mys
	  </pre></td></tr></tbody></table></div><p>
	Verify the executable produced by <span class="command"><strong>gcc</strong></span>:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ ldd example11_mys_mys
        linux-gate.so.1 =&gt;  (0xb777d000)
        liblixac.so.0 =&gt; /opt/lixa/lib/liblixac.so.0 (0xb7762000)
        liblixamy.so.0 =&gt; /opt/lixa/lib/liblixamy.so.0 (0xb775a000)
        libmysqlclient_r.so.15 =&gt; /usr/lib/libmysqlclient_r.so.15 (0xb7569000)
        libc.so.6 =&gt; /lib/tls/i686/cmov/libc.so.6 (0xb741a000)
        libgmodule-2.0.so.0 =&gt; /usr/lib/libgmodule-2.0.so.0 (0xb7416000)
        libdl.so.2 =&gt; /lib/tls/i686/cmov/libdl.so.2 (0xb7412000)
        libgthread-2.0.so.0 =&gt; /usr/lib/libgthread-2.0.so.0 (0xb740d000)
        librt.so.1 =&gt; /lib/tls/i686/cmov/librt.so.1 (0xb7403000)
        libglib-2.0.so.0 =&gt; /usr/lib/libglib-2.0.so.0 (0xb7352000)
        libxml2.so.2 =&gt; /usr/lib/libxml2.so.2 (0xb7232000)
        liblixab.so.0 =&gt; /opt/lixa/lib/liblixab.so.0 (0xb721d000)
        libpthread.so.0 =&gt; /lib/tls/i686/cmov/libpthread.so.0 (0xb7205000)
        libcrypt.so.1 =&gt; /lib/tls/i686/cmov/libcrypt.so.1 (0xb71d3000)
        libnsl.so.1 =&gt; /lib/tls/i686/cmov/libnsl.so.1 (0xb71ba000)
        libm.so.6 =&gt; /lib/tls/i686/cmov/libm.so.6 (0xb7195000)
        libz.so.1 =&gt; /usr/lib/libz.so.1 (0xb7180000)
        /lib/ld-linux.so.2 (0xb777e000)
        libpcre.so.3 =&gt; /usr/lib/libpcre.so.3 (0xb7159000)
        libuuid.so.1 =&gt; /lib/libuuid.so.1 (0xb7155000)
	  </pre></td></tr></tbody></table></div><p>
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp68761904"></a>Set-up LIXA environment</h3></div></div></div><p>
	Set-up the necessary environment variables:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ echo $LIXA_PROFILE

tiian@ubuntu:~/tmp$ export LIXA_PROFILE=MYS_STA_MYS_STA
tiian@ubuntu:~/tmp$ echo $LIXA_PROFILE
MYS_STA_MYS_STA
	  </pre></td></tr></tbody></table></div><p>
	It is suggested to set the necessary environment variable
	(<code class="varname">LIXA_PROFILE</code>) in your 
	profile if you are going to execute the programs many times.
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp68766160"></a>Some checks before program execution</h3></div></div></div><p>
	We set <code class="varname">LIXA_PROFILE</code> to value
	<span class="quote">“<span class="quote">MYS_STA_MYS_STA</span>”</span>, looking at
	<code class="filename">/opt/lixa/etc/lixac_conf.xml</code>:
	</p><pre class="screen">
    &lt;profile name="MYS_STA_MYS_STA"&gt;
      &lt;sttsrvs&gt;
        &lt;sttsrv&gt;local_1&lt;/sttsrv&gt;
      &lt;/sttsrvs&gt;
      &lt;rsrmgrs&gt;
        &lt;rsrmgr&gt;MySQL_stareg&lt;/rsrmgr&gt;
        &lt;rsrmgr&gt;MySQL2_stareg&lt;/rsrmgr&gt;
      &lt;/rsrmgrs&gt;
    &lt;/profile&gt;
	</pre><p>
	the profile references two Resource Managers:
	<span class="quote">“<span class="quote">MySQL_stareg</span>”</span> and <span class="quote">“<span class="quote">MySQL2_stareg</span>”</span> 
	looking again at the config file:
	</p><pre class="screen">
    &lt;rsrmgr name="MySQL_stareg" switch_file="/opt/lixa/lib/switch_mysql_stareg.so" xa_open_info="host=localhost,user=lixa,passwd=,db=lixa,client_flag=0" xa_close_info="" /&gt;
    &lt;rsrmgr name="MySQL2_stareg" switch_file="/opt/lixa/lib/switch_mysql_stareg.so" xa_open_info="host=192.168.1.3,user=lixa,passwd=,db=lixa,client_flag=0" xa_close_info="" /&gt;
	</pre><p>
	we can discover how our application will access the resource
	managers
	<a href="#ftn.idp68770992" class="footnote" id="idp68770992"><sup class="footnote">[41]</sup></a>. 
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp68773376"></a>Program execution</h3></div></div></div><p>
	It is suggested to open three different terminals: 
	the first one connected to <span class="quote">“<span class="quote">lixa</span>”</span> local MySQL database,
	the second one connected to <span class="quote">“<span class="quote">lixa</span>”</span> remote MySQL database
	and the	third one pointing to the directory where the compiled program 
	example11_mys_mys lives.
	</p><div class="table"><table frame="box"><thead><tr><td>[MySQL (local) terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~$ mysql -h localhost -u lixa lixa
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 37
Server version: 5.0.51a-3ubuntu5.8 (Ubuntu)

Type 'help;' or '\h' for help. Type '\c' to clear the buffer.

mysql&gt;
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[MySQL (remote) terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~$ mysql -h 192.168.1.3 -u lixa lixa
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 7
Server version: 5.0.51a-3ubuntu5.8 (Ubuntu)

Type 'help;' or '\h' for help. Type '\c' to clear the buffer.
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ ls -la
total 168
drwxr-xr-x  2 tiian tiian  4096 2011-11-13 21:04 .
drwxr-xr-x 40 tiian tiian  4096 2011-11-13 19:09 ..
-rwxr-xr-x  1 tiian tiian  9201 2011-11-13 21:04 example11_mys_mys
-rw-r--r--  1 tiian tiian  3977 2011-11-13 21:04 example11_mys_mys.c
	  </pre></td></tr></tbody></table></div><p>
	Check the content of the (local) MySQL table (<span class="quote">“<span class="quote">authors</span>”</span>):
	</p><div class="table"><table frame="box"><thead><tr><td>[MySQL (local) terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
mysql&gt; SELECT * FROM authors;
Empty set (0.02 sec)
	  </pre></td></tr></tbody></table></div><p>
	Check the content of the (remote) MySQL table (<span class="quote">“<span class="quote">authors</span>”</span>):
	</p><div class="table"><table frame="box"><thead><tr><td>[MySQL (remote) terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
mysql&gt; SELECT * FROM authors;
Empty set (0.01 sec)
	  </pre></td></tr></tbody></table></div><p>
	Insert a row in all the tables and check the contents of the tables
	after the transaction execution:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ ./example11_mys_mys insert
Inserting a row in MySQL(1) table...
Inserting a row in MySQL(2) table...
	  </pre></td></tr></tbody></table></div><p>
	Now you can verify the content of the tables after the transaction:
	</p><div class="table"><table frame="box"><thead><tr><td>[MySQL (local) terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
mysql&gt; SELECT * FROM authors;
+----+-----------+------------+
| id | last_name | first_name |
+----+-----------+------------+
|  1 | Foo       | Bar        |
+----+-----------+------------+
1 row in set (0.00 sec)
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[MySQL (remote) terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
mysql&gt; SELECT * FROM authors;
+----+-----------+------------+
| id | last_name | first_name |
+----+-----------+------------+
|  1 | Foo       | Bar        |
+----+-----------+------------+
1 row in set (0.01 sec)
	  </pre></td></tr></tbody></table></div><p>
	With the opposite command you can remove the rows from the tables:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ ./example11_mys_mys delete
Deleting a row from MySQL(1) table...
Deleting a row from MySQL(2) table...
	  </pre></td></tr></tbody></table></div><p>
	and check the content of the tables again:
	</p><div class="table"><table frame="box"><thead><tr><td>[MySQL (local) terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
mysql&gt; SELECT * FROM authors;
Empty set (0.00 sec)
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[MySQL (remote) terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
mysql&gt; SELECT * FROM authors;
Empty set (0.00 sec)
	  </pre></td></tr></tbody></table></div><p>
	Finally, you can verify the two phase commit protocol is running as
	expected. Insert a row in all the tables:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ ./example11_mys_mys insert
Inserting a row in MySQL(1) table...
Inserting a row in MySQL(2) table...
	  </pre></td></tr></tbody></table></div><p>
	manually remove the row from the local MySQL server only:
	</p><div class="table"><table frame="box"><thead><tr><td>[MySQL (local) terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
mysql&gt; SELECT * FROM authors;
+----+-----------+------------+
| id | last_name | first_name |
+----+-----------+------------+
|  1 | Foo       | Bar        |
+----+-----------+------------+
1 row in set (0.00 sec)

mysql&gt; DELETE FROM authors;
Query OK, 1 row affected (0.01 sec)

mysql&gt; SELECT * FROM authors;
Empty set (0.00 sec)
	  </pre></td></tr></tbody></table></div><p>
	try to insert the row again in all the tables:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ ./example11_mys_mys insert
Inserting a row in MySQL(1) table...
Inserting a row in MySQL(2) table...
INSERT INTO authors: 1062/Duplicate entry '1' for key 1
	  </pre></td></tr></tbody></table></div><p>
	the first (local) INSERT is ok, while the second one can not be
	performed due to a duplicated key. 
	Check the content of the tables again:
	</p><div class="table"><table frame="box"><thead><tr><td>[MySQL (local) terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
mysql&gt; SELECT * FROM authors;
Empty set (0.00 sec)
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[MySQL (remote) terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
mysql&gt; SELECT * FROM authors;
+----+-----------+------------+
| id | last_name | first_name |
+----+-----------+------------+
|  1 | Foo       | Bar        |
+----+-----------+------------+
1 row in set (0.01 sec)
	  </pre></td></tr></tbody></table></div><p>
	If you inspect the program
	source code you will discover what the program will do:
	</p><div class="table"><table frame="box"><thead><tr><td><code class="filename">example11_mys_mys.c</code></td></tr></thead><tbody><tr><td><pre class="screen">
        [...]

        printf("Inserting a row in MySQL(2) table...\n");
        if (mysql_query(conn2,
                        "INSERT INTO authors VALUES(1, 'Foo', 'Bar')")) {
            fprintf(stderr, "INSERT INTO authors: %u/%s\n",
                    mysql_errno(conn2), mysql_error(conn2));
            exit_nicely(conn1, conn2);
        }

        [...]
	  </pre></td></tr></tbody></table></div><p>
	in case of error the program exits closing the connections...
	XA protocol is a <span class="quote">“<span class="quote">two phase commit with presumed 
	rollback</span>”</span>: if the transaction does not complete 
	<code class="function">xa_prepare</code>, the transaction will be rolled back.
	An alternative way is the usage of <code class="function">tx_rollback()</code>:
	you can rollback the current transaction and start a new one without
	program (and connection) termination.
	Clean up the (remote) table:
	</p><div class="table"><table frame="box"><thead><tr><td>[MySQL (remote) terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
mysql&gt; DELETE FROM authors;
Query OK, 1 row affected (0.04 sec)

mysql&gt; SELECT * FROM authors;
Empty set (0.00 sec)
	  </pre></td></tr></tbody></table></div><p>
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Development_example12_wmq"></a>An example with WebSphere MQ</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp68824320"></a>Introduction</h3></div></div></div><p>
	WebSphere MQ is a proprietary commercial product supplied by
	IBM Corporation: the LIXA project tested its behavior when managed
	by LIXA Transaction Manager using a trial copy. At the time of this
	writing, the author does not know if a reduced 
	<span class="quote">“<span class="quote">express</span>”</span> or <span class="quote">“<span class="quote">community</span>”</span> edition exists.
	If you are interested in LIXA and WebSphere MQ you probably already
	have a valid license to run the software supplied by IBM.
      </p><p>
	WebSphere MQ is a special type of Resource Manager because:
	</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	      it can work as a Transaction Manager as well as a Resource
	      Manager; LIXA does <span class="emphasis"><em>not</em></span> use WebSphere MQ
	      as a Transaction Manager, but only as a Resource Manager.
	      If you were interested in the Transaction Manager feature of
	      WebSphere MQ, you should stop this reading and go to the IBM
	      official documentation
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      the WebSphere MQ Resource Manager can be interfaced by a standard
	      XA Transaction Manager using two different configurations:
	      <span class="emphasis"><em>server (bind)</em></span> and
	      <span class="emphasis"><em>Extended Transactional Client</em></span>
	  </p></li></ul></div><p>
      </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp68831136"></a>WebSphere MQ server/bind (SRV) mode</h4></div></div></div><p>
	  To use this mode, the WebSphere MQ queue manager used by your
	  Application Program <span class="emphasis"><em>must reside</em></span> inside the
	  same host of your Application Program: the communication between
	  your Application Program and the queue manager uses interprocess
	  communication (UNIX System V IPC). The interface is really fast,
	  but you can not travel a network (LAN/MAN/WAN) using it.
	  If your Application Program and the queue manager are hosted
	  by different systems, you will have to use the ETC mode.
	</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp68833200"></a>WebSphere MQ Extended Transactional Client (ETC) mode</h4></div></div></div><p>
	  You can use this mode every time your Application Program can
	  reach the desired queue manager using a network: it's usually an
	  IP network, but WebSphere MQ gives you different choices if you
	  have to deal with some special non IP based environment like a
	  SNA network.
	</p><p>
	  You should pay attention the 
	  <span class="emphasis"><em>Extended Transactional Client (ETC) is not</em></span>
	  a basic client: you must install a specific package and you must
	  pay a specific license to use it. This is not an IBM site, contact
	  your IBM vendor to pick-up all the necessary information.
	</p><p>
	  The basic/standard WebSphere MQ client can
	  <span class="emphasis"><em>not</em></span> be used in conjunction with LIXA because
	  it does <span class="emphasis"><em>not</em></span> support the XA protocol. 
	</p></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
	You must not configure and build LIXA to use WebSphere with 
	server/bind mode and build your Application Program to use
	WebSphere with ETC mode, or vice versa. If you did it, you would
	catch unexpected behaviors.
      </p></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
	The LIXA software must be configured to support the WebSphere MQ
	Resource Manager as explained in 
	<a class="xref" href="#Linking_third_party_resource_managers" title="Linking third party resource managers">the section called “Linking third party resource managers”</a>.
      </p></div><p>
	LIXA project provides <span class="command"><strong>lixa-config</strong></span> to retrieve
	how the LIXA was configured and built:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
[tiian@centos lixa]$ /opt/lixa/bin/lixa-config --rsrc-mngrs
DB2             no
MySQL           yes
Oracle          no
PostgreSQL      yes
WebSphereMQ     yes     (ETC)
	  </pre></td></tr></tbody></table></div><p>
      </p></div><div class="figure"><a id="develop12"></a><p class="title"><strong>Figure 5.12. Deploy model of an example with WebSphere MQ</strong></p><div class="figure-contents"><div class="mediaobject"><img src="../images/LIXA_Development_12.png" alt="Deploy model of an example with WebSphere MQ" /></div></div></div><br class="figure-break" /><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Development_setup_WebSphereMQ_environment"></a>Set-up WebSphere MQ environment</h3></div></div></div><p>
	This example was developed using WebSphere MQ 7.1 for Linux (32 bit)
	and CentOS 6.2 (32 bit).
	</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	    If you did not yet installed the software, please refer to IBM
	    official documentation.
	    You should need at least these packages for server/bind mode:
	    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
		  MQSeriesServer
	      </p></li><li class="listitem" style="list-style-type: disc"><p>
		  MQSeriesSDK
	      </p></li><li class="listitem" style="list-style-type: disc"><p>
		  MQSeriesRuntime
	      </p></li></ul></div><p>
	    You should need at least these packages for ETC mode:
	    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
		  MQSeriesTXClient
	      </p></li><li class="listitem" style="list-style-type: disc"><p>
		  MQSeriesSDK
	      </p></li><li class="listitem" style="list-style-type: disc"><p>
		  MQSeriesRuntime
	      </p></li><li class="listitem" style="list-style-type: disc"><p>
		  MQSeriesJava
	      </p></li></ul></div><p>
	</p></div><p>
	These are the necessary configuration steps to create the environment
	to run the supplied example (<code class="filename">example12_wmq.c</code>).
	First, you must set the correct environment for your shell:
      </p><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
[tiian@centos manuals]$ su -
Password:
[tiian@centos manuals]$ cd
[tiian@centos ~]$ su -
Password:
[root@centos ~]# su - mqm
-bash-4.1$ . /opt/mqm71/bin/setmqenv -s
-bash-4.1$ dspmqver
Name:        WebSphere MQ
Version:     7.1.0.0
Level:       p000-L111024
BuildType:   IKAP - (Production)
Platform:    WebSphere MQ for Linux (x86 platform)
Mode:        32-bit
O/S:         Linux 2.6.32-220.el6.i686
InstName:    Installation1
InstDesc:
InstPath:    /opt/mqm71
DataPath:    /var/mqm
Primary:     No
MaxCmdLevel: 710
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	    I installed the product in <code class="filename">/opt/mqm71</code>:
	    adjust the command to reflect your real installation path.
	</p></div><p>
	Create a queue manager named <span class="quote">“<span class="quote">LIXA</span>”</span> and start it:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
-bash-4.1$ crtmqm LIXA
There are 90 days left in the trial period for this copy of WebSphere MQ.
WebSphere MQ queue manager created.
Directory '/var/mqm/qmgrs/LIXA' created.
The queue manager is associated with installation 'Installation1'.
Creating or replacing default objects for queue manager 'LIXA'.
Default objects statistics : 71 created. 0 replaced. 0 failed.
Completing setup.
Setup completed.

-bash-4.1$ strmqm LIXA
There are 90 days left in the trial period for this copy of WebSphere MQ.
WebSphere MQ queue manager 'LIXA' starting.
The queue manager is associated with installation 'Installation1'.
5 log records accessed on queue manager 'LIXA' during the log replay phase.
Log replay for queue manager 'LIXA' complete.
Transaction manager state recovered for queue manager 'LIXA'.
WebSphere MQ queue manager 'LIXA' started using V7.1.0.0.
	  </pre></td></tr></tbody></table></div><p>
	Create a test queue named <span class="quote">“<span class="quote">LIXA.QLOCAL</span>”</span>
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
-bash-4.1$ runmqsc LIXA
5724-H72 (C) Copyright IBM Corp. 1994, 2011.  ALL RIGHTS RESERVED.
Starting MQSC for queue manager LIXA.


DEFINE QLOCAL(LIXA.QLOCAL)
     1 : DEFINE QLOCAL(LIXA.QLOCAL)
AMQ8006: WebSphere MQ queue created.
end
     2 : end
One MQSC command read.
No commands have a syntax error.
All valid MQSC commands were processed.
	  </pre></td></tr></tbody></table></div><p>
	try to put/get a message into/from it using your own user
	(mine is <code class="systemitem">lixa</code>):
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
[tiian@centos ~]$ . /opt/mqm71/bin/setmqenv -s
[tiian@centos ~]$ cd /opt/mqm71/samp/bin
[tiian@centos bin]$ ./amqsput LIXA.QLOCAL LIXA
Sample AMQSPUT0 start
target queue is LIXA.QLOCAL
This is a test message

Sample AMQSPUT0 end
[tiian@centos bin]$ ./amqsget LIXA.QLOCAL LIXA
Sample AMQSGET0 start
message &lt;This is a test message&gt;
no more messages
Sample AMQSGET0 end
	  </pre></td></tr></tbody></table></div><p>
	Please refer to IBM documentation for 
	<span class="command"><strong>runmqsc, amqsput, amqsget</strong></span> commands.
      </p><p>
	Now you can create the definition necessary for WebSphere MQ client
	mode. First, authorize your user to connect to the queue manager
	using a user <span class="emphasis"><em>not</em></span> connected to
	<code class="systemitem">mqm</code> group
	(change <code class="systemitem">tiian</code> with your
	own user):
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
-bash-4.1$ runmqsc LIXA
5724-H72 (C) Copyright IBM Corp. 1994, 2011.  ALL RIGHTS RESERVED.
Starting MQSC for queue manager LIXA.


DISPLAY QMGR CHLAUTH
     1 : DISPLAY QMGR CHLAUTH
AMQ8408: Display Queue Manager details.
   QMNAME(LIXA)                            CHLAUTH(ENABLED)
SET AUTHREC OBJTYPE(QMGR) PRINCIPAL('tiian') AUTHADD(CONNECT)
     2 : SET AUTHREC OBJTYPE(QMGR) PRINCIPAL('tiian') AUTHADD(CONNECT)
AMQ8862: WebSphere MQ authority record set.
SET AUTHREC PROFILE(LIXA.QLOCAL) OBJTYPE(QUEUE) PRINCIPAL('tiian')
AUTHADD(PUT,GET)
     3 : SET AUTHREC PROFILE(LIXA.QLOCAL) OBJTYPE(QUEUE) PRINCIPAL('tiian')
AUTHADD(PUT,GET)
AMQ8862: WebSphere MQ authority record set.
end
     4 : end
3 MQSC commands read.
No commands have a syntax error.
All valid MQSC commands were processed.
	  </pre></td></tr></tbody></table></div><p>
	Then create a connection channel, authorize it to your user
	(change <code class="systemitem">tiian</code>) and 
	a listener:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
-bash-4.1$ runmqsc LIXA
5724-H72 (C) Copyright IBM Corp. 1994, 2011.  ALL RIGHTS RESERVED.
Starting MQSC for queue manager LIXA.


DEFINE CHANNEL (LIXA.CHANNEL) CHLTYPE (SVRCONN) TRPTYPE (TCP)
     1 : DEFINE CHANNEL (LIXA.CHANNEL) CHLTYPE (SVRCONN) TRPTYPE (TCP)
AMQ8014: WebSphere MQ channel created.
SET CHLAUTH(LIXA.CHANNEL) TYPE(ADDRESSMAP) ADDRESS('127.0.0.1')
MCAUSER('tiian')
     2 : SET CHLAUTH(LIXA.CHANNEL) TYPE(ADDRESSMAP) ADDRESS('127.0.0.1')
MCAUSER('tiian')
AMQ8877: WebSphere MQ channel authentication record set.
DEFINE LISTENER (LIXA.LISTENER) TRPTYPE (TCP) CONTROL (QMGR) PORT(1414)
     3 : DEFINE LISTENER (LIXA.LISTENER) TRPTYPE (TCP) CONTROL (QMGR)
PORT(1414)
AMQ8626: WebSphere MQ listener created.
START LISTENER(LIXA.LISTENER)
     4 : START LISTENER(LIXA.LISTENER)
AMQ8021: Request to start WebSphere MQ listener accepted.
end
     5 : end
4 MQSC commands read.
No commands have a syntax error.
All valid MQSC commands were processed.
	  </pre></td></tr></tbody></table></div><p>
	Now you can try the TCP/IP client connection using 
	<span class="emphasis"><em>your own</em></span> user (mine is
	<code class="systemitem">tiian</code>):
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
[tiian@centos ~]$ export MQSERVER=LIXA.CHANNEL/TCP/'127.0.0.1(1414)'
[tiian@centos ~]$ echo $MQSERVER
LIXA.CHANNEL/TCP/127.0.0.1(1414)

[tiian@centos ~]$ cd /opt/mqm71/samp/bin
[tiian@centos bin]$ . /opt/mqm71/bin/setmqenv -s
[tiian@centos bin]$ ./amqsputc LIXA.QLOCAL LIXA
Sample AMQSPUT0 start
target queue is LIXA.QLOCAL
This is a test message (from client)

Sample AMQSPUT0 end
[tiian@centos bin]$ ./amqsgetc LIXA.QLOCAL LIXA
Sample AMQSGET0 start
message &lt;This is a test message (from client)&gt;
no more messages
Sample AMQSGET0 end
	  </pre></td></tr></tbody></table></div><p>
	Please refer to IBM documentation for 
	<span class="command"><strong>runmqsc, amqsputc, amqsgetc</strong></span> commands.
      </p><p>
	OK, the <span class="quote">“<span class="quote">LIXA.QLOCAL</span>”</span> local queue was created and it's
	usable. If something went wrong, you should refer to WebSphere MQ
	documentation to fix the issue before the next step because you 
	would not be able to execute the sample program without a basic 
	running installation. 
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp68884192"></a>Start the LIXA state server</h3></div></div></div><p>
	Start the state server as shown below:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
[tiian@centos ~]$ su -
Password:
[root@centos ~]# su - lixa
[lixa@centos ~]$ /opt/lixa/sbin/lixad --daemon
[lixa@centos ~]$ exit
logout
[root@centos ~]# exit
logout
[tiian@centos ~]$ ps -ef|grep lixad|grep -v grep
lixa      3589     1  0 12:30 ?        00:00:00 /opt/lixa/sbin/lixad --daemon
	  </pre></td></tr></tbody></table></div><p>
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp68887088"></a>Build the client program (SRV mode)</h3></div></div></div><p>
	Prepare the client (Application Program) using the below commands
	(<span class="command"><strong>gcc</strong></span> command was splitted on 
	several lines using \ to help
	readability, but you may use a single line): 
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
[tiian@centos ~]$ mkdir tmp
[tiian@centos ~]$ cd tmp
[tiian@centos tmp]$ cp /opt/lixa/share/doc/lixa-X.Y.Z/examples/example12_wmq.c .
[tiian@centos tmp]$ /opt/lixa/bin/lixa-config -r|grep WebSphereMQ
WebSphereMQ     yes     (SRV)
[tiian@centos tmp]$ gcc example12_wmq.c $(/opt/lixa/bin/lixa-config -c -f -l -d) \
&gt; -I/opt/mqm71/inc -L/opt/mqm71/lib -Wl,-rpath=/opt/mqm71/lib \
&gt; -lmqm_r -o example12_wmq
	  </pre></td></tr></tbody></table></div><p>
	Verify the executable produced by <span class="command"><strong>gcc</strong></span>:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
[tiian@centos tmp]$ ldd example12_wmq
        linux-gate.so.1 =&gt;  (0x00852000)
        liblixac.so.0 =&gt; /opt/lixa/lib/liblixac.so.0 (0x00cfc000)
        libmqm_r.so =&gt; /opt/mqm71/lib/libmqm_r.so (0x00a7f000)
        libc.so.6 =&gt; /lib/libc.so.6 (0x00110000)
        libgmodule-2.0.so.0 =&gt; /lib/libgmodule-2.0.so.0 (0x00da2000)
        libgthread-2.0.so.0 =&gt; /lib/libgthread-2.0.so.0 (0x00da8000)
        librt.so.1 =&gt; /lib/librt.so.1 (0x00bca000)
        libglib-2.0.so.0 =&gt; /lib/libglib-2.0.so.0 (0x00bd5000)
        libxml2.so.2 =&gt; /usr/lib/libxml2.so.2 (0x02d3c000)
        liblixab.so.0 =&gt; /opt/lixa/lib/liblixab.so.0 (0x00daf000)
        libm.so.6 =&gt; /lib/libm.so.6 (0x00b9e000)
        libpthread.so.0 =&gt; /lib/libpthread.so.0 (0x00b81000)
        libmqe_r.so =&gt; /opt/mqm71/lib/libmqe_r.so (0xb6f70000)
        libdl.so.2 =&gt; /lib/libdl.so.2 (0x00b7a000)
        /lib/ld-linux.so.2 (0x009c2000)
        libz.so.1 =&gt; /lib/libz.so.1 (0x00ce1000)
        libuuid.so.1 =&gt; /lib/libuuid.so.1 (0x0076f000)
	  </pre></td></tr></tbody></table></div><p>
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp68896832"></a>Set-up LIXA environment (SRV mode)</h3></div></div></div><p>
	Set-up the <code class="varname">LIXA_PROFILE</code> environment variable:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
[tiian@centos tmp]$ echo $LIXA_PROFILE

[tiian@centos tmp]$ export LIXA_PROFILE=MQS_DYN
[tiian@centos tmp]$ echo $LIXA_PROFILE
MQS_DYN
	  </pre></td></tr></tbody></table></div><p>
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp68899408"></a>Some checks before program execution (SRV mode)</h3></div></div></div><p>
	We set <code class="varname">LIXA_PROFILE</code> to value
	<span class="quote">“<span class="quote">MQS_DYN</span>”</span>, looking at
	<code class="filename">/opt/lixa/etc/lixac_conf.xml</code>:
	</p><pre class="screen">
    &lt;profile name="MQS_DYN"&gt;
      &lt;sttsrvs&gt;
        &lt;sttsrv&gt;local_1&lt;/sttsrv&gt;
      &lt;/sttsrvs&gt;
      &lt;rsrmgrs&gt;
        &lt;rsrmgr&gt;WSMQ_SRV_dynreg&lt;/rsrmgr&gt;
      &lt;/rsrmgrs&gt;
    &lt;/profile&gt;
	</pre><p>
	the profile references the Resource Manager named
	<span class="quote">“<span class="quote">WSMQ_SRV_dynreg</span>”</span>, looking again at the config file:
	</p><pre class="screen">
    &lt;rsrmgr name="WSMQ_SRV_dynreg" switch_file="/opt/lixa/lib/switch_wsmq_dynreg.so" xa_open_info="axlib=/opt/lixa/lib/liblixac.so,qmname=LIXA,tpm=lixa" xa_close_info="" /&gt;
	</pre><p>
	we can discover how the WebSphere MQ Resource Manager is configured 
	for XA
	<a href="#ftn.idp68904976" class="footnote" id="idp68904976"><sup class="footnote">[42]</sup></a>.
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp68908048"></a>Program execution (SRV mode)</h3></div></div></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
[tiian@centos tmp]$ ls -la
total 116
drwxrwxr-x 2 tiian tiian  4096 Mar 16 17:04 .
drwx------ 8 tiian tiian  4096 Mar 16 13:10 ..
-rwxrwxr-x 1 tiian tiian  9587 Mar 16 17:04 example12_wmq
-rw-r--r-- 1 tiian tiian  5342 Mar 16 13:13 example12_wmq.c
	  </pre></td></tr></tbody></table></div><p>
	Retrieve all the messages from <span class="quote">“<span class="quote">LIXA.QLOCAL</span>”</span> queue before
	program execution:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
[tiian@centos tmp]$ . /opt/mqm71/bin/setmqenv -s
[tiian@centos tmp]$ /opt/mqm71/samp/bin/amqsget LIXA.QLOCAL LIXA
Sample AMQSGET0 start
no more messages
Sample AMQSGET0 end
	  </pre></td></tr></tbody></table></div><p>
	Execute the program:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
[tiian@centos tmp]$ ./example12_wmq insert
target queue is LIXA.QLOCAL
Message inserted in queue LIXA.QLOCAL: 'Test message for LIXA'
	  </pre></td></tr></tbody></table></div><p>
	Check the content of the queue:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
[tiian@centos tmp]$ /opt/mqm71/samp/bin/amqsget LIXA.QLOCAL LIXA
Sample AMQSGET0 start
message &lt;Test message for LIXA&gt;
no more messages
Sample AMQSGET0 end
	  </pre></td></tr></tbody></table></div><p>
	Now you can try to remove a message inserted with the standard
	utility:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
[tiian@centos tmp]$ /opt/mqm71/samp/bin/amqsput LIXA.QLOCAL LIXA
Sample AMQSPUT0 start
target queue is LIXA.QLOCAL
This is a sample message from the keyboard!

Sample AMQSPUT0 end
[tiian@centos tmp]$ ./example12_wmq delete
target queue is LIXA.QLOCAL
Message retrieved from queue LIXA.QLOCAL: 'This is a sample message from the keyboard!'
	  </pre></td></tr></tbody></table></div><p>
	you can verify in file
	<code class="filename">/opt/lixa/etc/lixac_conf.xml</code>
	that <span class="quote">“<span class="quote">MQS_DYN</span>”</span> is associated to dynamic registration.
	Execute the program enabling trace:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
[tiian@centos tmp]$ export LIXA_TRACE_MASK=0x00002000
[tiian@centos tmp]$ echo $LIXA_TRACE_MASK
0x00002000
[tiian@centos tmp]$ ./example12_wmq insert 2&gt;&amp;1 | grep ax_reg
2012-03-16 18:36:23.500382 [14774/3078875408] ax_reg: rmid=0, xid=0xbffaf630, flags=0x0
2012-03-16 18:36:23.500581 [14774/3078875408] ax_reg: the application program has started a transaction (TX states S3); this XID '1279875137.846a8fdfe2204b11ac85586a13fc0348.9a910775bb747f3c157021d6a03a7b31' will be returned
2012-03-16 18:36:23.501290 [14774/3078875408] ax_reg: sending 153 bytes to the server for step 8
2012-03-16 18:36:23.501965 [14774/3078875408] ax_reg/excp=7/ret_cod=0/errno=1
	  </pre></td></tr></tbody></table></div><p>
	Changing <code class="varname">LIXA_PROFILE</code> you can try the static
	registration as well:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
[tiian@centos tmp]$ export LIXA_PROFILE=MQS_STA
[tiian@centos tmp]$ echo $LIXA_PROFILE
MQC_STA
[tiian@centos tmp]$ ./example12_wmq delete 2&gt;&amp;1 | grep xa_start
2012-03-16 18:38:08.942458 [14784/3078269200] lixa_xa_start
2012-03-16 18:38:08.942644 [14784/3078269200] lixa_xa_start: sending 213 bytes to the server for step 8
[...]
2012-03-16 18:38:08.946569 [14784/3078269200] lixa_xa_start: xa_start_entry(xid, 0, 0x0) = 0
2012-03-16 18:38:08.947188 [14784/3078269200] lixa_xa_start: sending 210 bytes to the server for step 24
2012-03-16 18:38:08.947521 [14784/3078269200] lixa_xa_start/excp=10/ret_cod=0/errno=1
	  </pre></td></tr></tbody></table></div><p>
	To try <code class="function">tx_rollback()</code> you have to slightly 
	change the sample program:
	</p><div class="table"><table frame="box"><thead><tr><td>[original example12_wmq.c]</td></tr></thead><tbody><tr><td><pre class="screen">
    [...]
    if (TX_OK != (txrc = tx_commit())) {
        fprintf(stderr, "tx_commit error: %d\n", txrc);
        exit(txrc);
    }

    /*
    if (TX_OK != (txrc = tx_rollback())) {
        fprintf(stderr, "tx_rollback error: %d\n", txrc);
        exit(txrc);
    }
    */
    [...]
	  </pre></td></tr></tbody></table></div><p>
	move the comment from <code class="function">tx_rollback()</code> function
	block to <code class="function">tx_rollback()</code> function block:
	</p><div class="table"><table frame="box"><thead><tr><td>[modified example12_wmq.c]</td></tr></thead><tbody><tr><td><pre class="screen">
    [...]
    /*
    if (TX_OK != (txrc = tx_commit())) {
        fprintf(stderr, "tx_commit error: %d\n", txrc);
        exit(txrc);
    }
    */

    if (TX_OK != (txrc = tx_rollback())) {
        fprintf(stderr, "tx_rollback error: %d\n", txrc);
        exit(txrc);
    }
    [...]
	  </pre></td></tr></tbody></table></div><p>
	Compile it again and try the modified example:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
[tiian@centos tmp]$ gcc example12_wmq.c $(/opt/lixa/bin/lixa-config -c -f -l -d) \
&gt; -I/opt/mqm71/inc -L/opt/mqm71/lib -Wl,-rpath=/opt/mqm71/lib \
&gt; -lmqm_r -o example12_wmq
	  </pre></td></tr></tbody></table></div><p>
	Verify the queue is empty, execute the sample program, verify the
	queue is empty again:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
[tiian@centos tmp]$ unset LIXA_TRACE_MASK
[tiian@centos tmp]$ /opt/mqm71/samp/bin/amqsget LIXA.QLOCAL LIXA
Sample AMQSGET0 start
no more messages
Sample AMQSGET0 end
[tiian@centos tmp]$ ./example12_wmq insert
target queue is LIXA.QLOCAL
Message inserted in queue LIXA.QLOCAL: 'Test message for LIXA'
[tiian@centos tmp]$ /opt/mqm71/samp/bin/amqsget LIXA.QLOCAL LIXA
Sample AMQSGET0 start
no more messages
Sample AMQSGET0 end
	  </pre></td></tr></tbody></table></div><p>
	Restore <code class="filename">example12_wmq.c</code> to the original state.
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp68942048"></a>Build the client program (ETC mode)</h3></div></div></div><p>
	Prepare the client (Application Program) using the below commands
	(<span class="command"><strong>gcc</strong></span> command was splitted on 
	several lines using \ to help
	readability, but you may use a single line): 
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
[tiian@centos ~]$ mkdir tmp
[tiian@centos ~]$ cd tmp
[tiian@centos tmp]$ cp /opt/lixa/share/doc/lixa-X.Y.Z/examples/example12_wmq.c .
[tiian@centos tmp]$ /opt/lixa/bin/lixa-config -r|grep WebSphereMQ
WebSphereMQ     yes     (ETC)
[tiian@centos tmp]$ gcc example12_wmq.c $(/opt/lixa/bin/lixa-config -c -f -l -d) \
&gt; -I/opt/mqm71/inc -L/opt/mqm71/lib -Wl,-rpath=/opt/mqm71/lib \
&gt; -lmqic_r -o example12_wmq
	  </pre></td></tr></tbody></table></div><p>
	Verify the executable produced by <span class="command"><strong>gcc</strong></span>:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
[tiian@centos tmp]$ ldd example12_wmq
        linux-gate.so.1 =&gt;  (0x00d50000)
        liblixac.so.0 =&gt; /opt/lixa/lib/liblixac.so.0 (0x00dfd000)
        libmqic_r.so =&gt; /opt/mqm71/lib/libmqic_r.so (0x0021a000)
        libc.so.6 =&gt; /lib/libc.so.6 (0x009e8000)
        libgmodule-2.0.so.0 =&gt; /lib/libgmodule-2.0.so.0 (0x00da2000)
        libgthread-2.0.so.0 =&gt; /lib/libgthread-2.0.so.0 (0x00da8000)
        librt.so.1 =&gt; /lib/librt.so.1 (0x00bca000)
        libglib-2.0.so.0 =&gt; /lib/libglib-2.0.so.0 (0x00bd5000)
        libxml2.so.2 =&gt; /usr/lib/libxml2.so.2 (0x02d3c000)
        liblixab.so.0 =&gt; /opt/lixa/lib/liblixab.so.0 (0x008f3000)
        libm.so.6 =&gt; /lib/libm.so.6 (0x00b9e000)
        libpthread.so.0 =&gt; /lib/libpthread.so.0 (0x00b81000)
        libmqe_r.so =&gt; /opt/mqm71/lib/libmqe_r.so (0x00e16000)
        libdl.so.2 =&gt; /lib/libdl.so.2 (0x00b7a000)
        /lib/ld-linux.so.2 (0x009c2000)
        libz.so.1 =&gt; /lib/libz.so.1 (0x00ce1000)
        libuuid.so.1 =&gt; /lib/libuuid.so.1 (0x0076f000)
	  </pre></td></tr></tbody></table></div><p>
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp68950416"></a>Set-up LIXA environment (ETC mode)</h3></div></div></div><p>
	Set-up the <code class="varname">LIXA_PROFILE</code> environment variable:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
[tiian@centos tmp]$ echo $LIXA_PROFILE

[tiian@centos tmp]$ export LIXA_PROFILE=MQC_DYN
[tiian@centos tmp]$ echo $LIXA_PROFILE
MQC_DYN
	  </pre></td></tr></tbody></table></div><p>
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp68954608"></a>Some checks before program execution (ETC mode)</h3></div></div></div><p>
	We set <code class="varname">LIXA_PROFILE</code> to value
	<span class="quote">“<span class="quote">MQC_DYN</span>”</span>, looking at
	<code class="filename">/opt/lixa/etc/lixac_conf.xml</code>:
	</p><pre class="screen">
    &lt;profile name="MQC_DYN"&gt;
      &lt;sttsrvs&gt;
        &lt;sttsrv&gt;local_1&lt;/sttsrv&gt;
      &lt;/sttsrvs&gt;
      &lt;rsrmgrs&gt;
        &lt;rsrmgr&gt;WSMQ_ETC_dynreg&lt;/rsrmgr&gt;
      &lt;/rsrmgrs&gt;
    &lt;/profile&gt;
	</pre><p>
	the profile references the Resource Manager named
	<span class="quote">“<span class="quote">WSMQ_ETC_dynreg</span>”</span>, looking again at the config file:
	</p><pre class="screen">
    &lt;rsrmgr name="WSMQ_ETC_dynreg" switch_file="/opt/lixa/lib/switch_wsmq_dynreg.so" xa_open_info="axlib=/opt/lixa/lib/liblixac.so,channel=LIXA.CHANNEL,trptype=tcp,conname=127.0.0.1(1414),qmname=LIXA,tpm=lixa" xa_close_info="" /&gt;
	</pre><p>
	we can discover how the WebSphere MQ Resource Manager is configured 
	for XA
	<a href="#ftn.idp68958608" class="footnote" id="idp68958608"><sup class="footnote">[43]</sup></a>.
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp68959088"></a>Program execution (ETC mode)</h3></div></div></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
[tiian@centos tmp]$ ls -la
total 116
drwxrwxr-x 2 tiian tiian  4096 Mar 16 17:04 .
drwx------ 8 tiian tiian  4096 Mar 16 13:10 ..
-rwxrwxr-x 1 tiian tiian  9587 Mar 16 17:04 example12_wmq
-rw-r--r-- 1 tiian tiian  5342 Mar 16 13:13 example12_wmq.c
	  </pre></td></tr></tbody></table></div><p>
	Retrieve all the messages from <span class="quote">“<span class="quote">LIXA.QLOCAL</span>”</span> queue before
	program execution:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
[tiian@centos tmp]$ . /opt/mqm71/bin/setmqenv -s
[tiian@centos tmp]$ export MQSERVER=LIXA.CHANNEL/TCP/'127.0.0.1(1414)'
[tiian@centos tmp]$ /opt/mqm71/samp/bin/amqsgetc LIXA.QLOCAL LIXA
Sample AMQSGET0 start
no more messages
Sample AMQSGET0 end
	  </pre></td></tr></tbody></table></div><p>
	Execute the program:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
[tiian@centos tmp]$ ./example12_wmq insert
target queue is LIXA.QLOCAL
Message inserted in queue LIXA.QLOCAL: 'Test message for LIXA'
	  </pre></td></tr></tbody></table></div><p>
	Check the content of the queue:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
[tiian@centos tmp]$ /opt/mqm71/samp/bin/amqsgetc LIXA.QLOCAL LIXA
Sample AMQSGET0 start
message &lt;Test message for LIXA&gt;
no more messages
Sample AMQSGET0 end
	  </pre></td></tr></tbody></table></div><p>
	Now you can try to remove a message inserted with the standard
	utility:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
[tiian@centos tmp]$ /opt/mqm71/samp/bin/amqsputc LIXA.QLOCAL LIXA
Sample AMQSPUT0 start
target queue is LIXA.QLOCAL
This is a sample message from the keyboard!

Sample AMQSPUT0 end
[tiian@centos tmp]$ ./example12_wmq delete
target queue is LIXA.QLOCAL
Message retrieved from queue LIXA.QLOCAL: 'This is a sample message from the keyboard!'
	  </pre></td></tr></tbody></table></div><p>
	you can verify in file
	<code class="filename">/opt/lixa/etc/lixac_conf.xml</code>
	that <span class="quote">“<span class="quote">MQC_DYN</span>”</span> is associated to dynamic registration.
	Execute the program:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
[tiian@centos tmp]$ export LIXA_TRACE_MASK=0x00002000
[tiian@centos tmp]$ echo $LIXA_TRACE_MASK
0x00002000
[tiian@centos tmp]$ ./example12_wmq insert 2&gt;&amp;1 | grep ax_reg
2012-03-16 18:17:06.108362 [2793/3077654800] ax_reg: rmid=0, xid=0xbfb4d59c, flags=0x0
2012-03-16 18:17:06.108566 [2793/3077654800] ax_reg: the application program has started a transaction (TX states S3); this XID '1279875137.70797228836149378b6fd6a315481425.80e88a292250da8f8b2ee3a5959e8650' will be returned
2012-03-16 18:17:06.109221 [2793/3077654800] ax_reg: sending 153 bytes to the server for step 8
2012-03-16 18:17:06.109926 [2793/3077654800] ax_reg/excp=7/ret_cod=0/errno=2
	  </pre></td></tr></tbody></table></div><p>
	Changing <code class="varname">LIXA_PROFILE</code> you can try the static
	registration as well:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
[tiian@centos tmp]$ export LIXA_PROFILE=MQC_STA
[tiian@centos tmp]$ echo $LIXA_PROFILE
MQC_STA
[tiian@centos tmp]$ ./example12_wmq delete 2&gt;&amp;1 | grep xa_start
2012-03-16 18:18:59.302555 [2806/3078256912] lixa_xa_start
2012-03-16 18:18:59.302831 [2806/3078256912] lixa_xa_start: sending 213 bytes to the server for step 8
[...]
2012-03-16 18:18:59.307208 [2806/3078256912] lixa_xa_start: xa_start_entry(xid, 0, 0x0) = 0
2012-03-16 18:18:59.307373 [2806/3078256912] lixa_xa_start: sending 210 bytes to the server for step 24
2012-03-16 18:18:59.308103 [2806/3078256912] lixa_xa_start/excp=10/ret_cod=0/errno=2
	  </pre></td></tr></tbody></table></div><p>
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Development_example13_wmq_mys_pql"></a>An example with WebSphere MQ, MySQL and PostgreSQL</h2></div></div></div><p>
      The example of this paragraph is quite complex because it involves
      three distinct
      Resource Managers: WebSphere MQ that's a message
      oriented middleware, MySQL and PostgreSQL thar are database servers.
      The proposed example can be easily adapted for WebSphere MQ and MySQL
      or WebSphere MQ and PostgreSQL removing useless stuff.
    </p><p>
      It is strongly suggested you have yet tryed the examples described in
      <a class="xref" href="#Development_example8_mys" title="An example with MySQL/MariaDB">the section called “An example with MySQL/MariaDB”</a>,
      in <a class="xref" href="#Development_example5_pql" title="An example with PostgreSQL">the section called “An example with PostgreSQL”</a> and
      in <a class="xref" href="#Development_example12_wmq" title="An example with WebSphere MQ">the section called “An example with WebSphere MQ”</a>.
    </p><div class="figure"><a id="develop13"></a><p class="title"><strong>Figure 5.13. Deploy model of an example with WebSphere MQ, MySQL and PostgreSQL</strong></p><div class="figure-contents"><div class="mediaobject"><img src="../images/LIXA_Development_13.png" alt="Deploy model of an example with WebSphere MQ, MySQL and PostgreSQL" /></div></div></div><br class="figure-break" /><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp68990320"></a>Set-up WebSphere MQ, MySQL, PostgreSQL and LIXA environment</h3></div></div></div><p>
	Please follow the instructions explained 
	</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	      in <a class="xref" href="#Development_setup_WebSphereMQ_environment" title="Set-up WebSphere MQ environment">the section called “Set-up WebSphere MQ environment”</a>
	      to set-up a running environment for WebSphere MQ
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      in <a class="xref" href="#Development_setup_MySQL_environment" title="Set-up MySQL environment">the section called “Set-up MySQL environment”</a>
	      to set-up a running environment for MySQL server
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      in <a class="xref" href="#Development_setup_PostgreSQL_environment" title="Set-up PostgreSQL environment">the section called “Set-up PostgreSQL environment”</a>
	      to set-up a running environment for PostgreSQL server
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      in <a class="xref" href="#Development_start_LIXA_server" title="Start the LIXA state server">the section called “Start the LIXA state server”</a>
	      to start up the LIXA state server
	  </p></li></ul></div><p>
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp68997536"></a>Build the client program (SRV mode)</h3></div></div></div><p>
	Prepare the client (Application Program) using the below commands
	(<span class="command"><strong>gcc</strong></span> command was splitted on 
	several lines using \ to help
	readability, but you may use a single line): 
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
[tiian@centos ~]$ mkdir tmp
[tiian@centos ~]$ cd tmp
[tiian@centos tmp]$ cp /opt/lixa/share/doc/lixa-X.Y.Z/examples/example13_wmq_mys_pql.c .
[tiian@centos tmp]$ /opt/lixa/bin/lixa-config -r|grep WebSphereMQ
WebSphereMQ     yes     (SRV)
[tiian@centos tmp]$ gcc example13_wmq_mys_pql.c \
&gt; $(/opt/lixa/bin/lixa-config -c -f -m -p -d) \
&gt; $(mysql_config --include --libs_r) -I/usr/include/postgresql -lpq \
&gt; -I/opt/mqm71/inc -L/opt/mqm71/lib -Wl,-rpath -Wl,/opt/mqm71/lib \
&gt; -lmqm_r -o example13_wmq_mys_pql
	  </pre></td></tr></tbody></table></div><p>
	Verify the executable produced by <span class="command"><strong>gcc</strong></span>:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
[tiian@centos tmp]$ ldd example13_wmq_mys_pql
        linux-gate.so.1 =&gt;  (0x008bc000)
        liblixac.so.0 =&gt; /opt/lixa/lib/liblixac.so.0 (0x00fe3000)
        liblixapq.so.0 =&gt; /opt/lixa/lib/liblixapq.so.0 (0x00163000)
        liblixamy.so.0 =&gt; /opt/lixa/lib/liblixamy.so.0 (0x00684000)
        libmysqlclient_r.so.16 =&gt; /usr/lib/mysql/libmysqlclient_r.so.16 (0x0016a000)
        libz.so.1 =&gt; /lib/libz.so.1 (0x00ce1000)
        libpthread.so.0 =&gt; /lib/libpthread.so.0 (0x00b81000)
        libcrypt.so.1 =&gt; /lib/libcrypt.so.1 (0x05144000)
        libnsl.so.1 =&gt; /lib/libnsl.so.1 (0x0524e000)
        libm.so.6 =&gt; /lib/libm.so.6 (0x00b9e000)
        libssl.so.10 =&gt; /usr/lib/libssl.so.10 (0x053f2000)
        libcrypto.so.10 =&gt; /usr/lib/libcrypto.so.10 (0x06344000)
        libpq.so.5 =&gt; /usr/lib/libpq.so.5 (0x00110000)
        libmqm_r.so =&gt; /opt/mqm71/lib/libmqm_r.so (0x00559000)
        libc.so.6 =&gt; /lib/libc.so.6 (0x009e8000)
        libgmodule-2.0.so.0 =&gt; /lib/libgmodule-2.0.so.0 (0x00da2000)
        libgthread-2.0.so.0 =&gt; /lib/libgthread-2.0.so.0 (0x00da8000)
        librt.so.1 =&gt; /lib/librt.so.1 (0x00bca000)
        libglib-2.0.so.0 =&gt; /lib/libglib-2.0.so.0 (0x00bd5000)
        libxml2.so.2 =&gt; /usr/lib/libxml2.so.2 (0x02d3c000)
        liblixab.so.0 =&gt; /opt/lixa/lib/liblixab.so.0 (0x00137000)
        /lib/ld-linux.so.2 (0x009c2000)
        libfreebl3.so =&gt; /lib/libfreebl3.so (0x051d0000)
        libgssapi_krb5.so.2 =&gt; /lib/libgssapi_krb5.so.2 (0x00950000)
        libkrb5.so.3 =&gt; /lib/libkrb5.so.3 (0x064d3000)
        libcom_err.so.2 =&gt; /lib/libcom_err.so.2 (0x0090e000)
        libk5crypto.so.3 =&gt; /lib/libk5crypto.so.3 (0x00922000)
        libresolv.so.2 =&gt; /lib/libresolv.so.2 (0x00d86000)
        libdl.so.2 =&gt; /lib/libdl.so.2 (0x00b7a000)
        libldap_r-2.4.so.2 =&gt; /lib/libldap_r-2.4.so.2 (0x002e1000)
        libmqe_r.so =&gt; /opt/mqm71/lib/libmqe_r.so (0xb708f000)
        libuuid.so.1 =&gt; /lib/libuuid.so.1 (0x0076f000)
        libkrb5support.so.0 =&gt; /lib/libkrb5support.so.0 (0x00915000)
        libkeyutils.so.1 =&gt; /lib/libkeyutils.so.1 (0x00991000)
        liblber-2.4.so.2 =&gt; /lib/liblber-2.4.so.2 (0x04e6c000)
        libssl3.so =&gt; /usr/lib/libssl3.so (0x055de000)
        libsmime3.so =&gt; /usr/lib/libsmime3.so (0x05616000)
        libnss3.so =&gt; /usr/lib/libnss3.so (0x05469000)
        libnssutil3.so =&gt; /usr/lib/libnssutil3.so (0x055b6000)
        libplds4.so =&gt; /lib/libplds4.so (0x055aa000)
        libplc4.so =&gt; /lib/libplc4.so (0x053a3000)
        libnspr4.so =&gt; /lib/libnspr4.so (0x053b2000)
        libsasl2.so.2 =&gt; /usr/lib/libsasl2.so.2 (0x057d8000)
        libselinux.so.1 =&gt; /lib/libselinux.so.1 (0x00cc0000)
	  </pre></td></tr></tbody></table></div><p>
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp69007408"></a>Set-up LIXA environment (SRV mode)</h3></div></div></div><p>
	Set-up the <code class="varname">LIXA_PROFILE</code> environment variable:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
[tiian@centos tmp]$ echo $LIXA_PROFILE

[tiian@centos tmp]$ export LIXA_PROFILE=MQS_DYN_MYS_STA_PQL_STA
[tiian@centos tmp]$ echo $LIXA_PROFILE
MQS_DYN_MYS_STA_PQL_STA
	  </pre></td></tr></tbody></table></div><p>
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp69009984"></a>Some checks before program execution (SRV mode)</h3></div></div></div><p>
	We set <code class="varname">LIXA_PROFILE</code> to value
	<span class="quote">“<span class="quote">MQS_DYN_MYS_STA_PQL_STA</span>”</span>, looking at
	<code class="filename">/opt/lixa/etc/lixac_conf.xml</code>:
	</p><pre class="screen">
    &lt;profile name="MQS_DYN_MYS_STA_PQL_STA"&gt;
      &lt;sttsrvs&gt;
        &lt;sttsrv&gt;local_1&lt;/sttsrv&gt;
      &lt;/sttsrvs&gt;
      &lt;rsrmgrs&gt;
        &lt;rsrmgr&gt;WSMQ_SRV_dynreg&lt;/rsrmgr&gt;
        &lt;rsrmgr&gt;MySQL_stareg&lt;/rsrmgr&gt;
        &lt;rsrmgr&gt;PostgreSQL_stareg&lt;/rsrmgr&gt;
      &lt;/rsrmgrs&gt;
    &lt;/profile&gt;
	</pre><p>
	the profile references the three Resource Managers named
	<span class="quote">“<span class="quote">WSMQ_SRV_dynreg</span>”</span>,	<span class="quote">“<span class="quote">MySQL_stareg</span>”</span> and 
	<span class="quote">“<span class="quote">PostgreSQL_stareg</span>”</span>;
	looking again at the config file:
	</p><pre class="screen">
    &lt;rsrmgr name="WSMQ_SRV_dynreg" switch_file="/opt/lixa/lib/switch_wsmq_dynreg.so" xa_open_info="axlib=/opt/lixa/lib/liblixac.so,qmname=LIXA,tpm=lixa" xa_close_info="" /&gt;
    &lt;rsrmgr name="MySQL_stareg" switch_file="/opt/lixa/lib/switch_mysql_stareg.so" xa_open_info="host=localhost,user=lixa,passwd=,db=lixa,client_flag=0" xa_close_info="" /&gt;
    &lt;rsrmgr name="PostgreSQL_stareg" switch_file="/opt/lixa/lib/switch_postgresql_stareg.so" xa_open_info="dbname=testdb" xa_close_info="" /&gt;
	</pre><p>
	we can discover how the Resource Managers are configured 
	for XA.
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp69015952"></a>Program execution (SRV mode)</h3></div></div></div><p>
	You should open three terminal sessions: one for the execution shell,
	one to check MySQL content and the last one to check PostgreSQL
	content.
      </p><p>
	Check the program is in place, set-up WebSphere MQ environment
	variables (you have previously set-up LIXA environment) and check
	the queue is empty:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
[tiian@centos tmp]$ ls -la
total 136
drwxrwxr-x 2 tiian tiian  4096 Mar 18 07:00 .
drwx------ 8 tiian tiian  4096 Mar 17 17:58 ..
-rwxrwxr-x 1 tiian tiian 11879 Mar 18 07:00 example13_wmq_mys_pql
-rw-rw-r-- 1 tiian tiian  7843 Mar 18 06:59 example13_wmq_mys_pql.c
[tiian@centos tmp]$ . /opt/mqm71/bin/setmqenv -s
[tiian@centos tmp]$ /opt/mqm71/samp/bin/amqsget LIXA.QLOCAL LIXA
Sample AMQSGET0 start
no more messages
Sample AMQSGET0 end
	  </pre></td></tr></tbody></table></div><p>
	Prepare a terminal session for MySQL and check the table is empty:
	</p><div class="table"><table frame="box"><thead><tr><td>[MySQL terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
[tiian@centos ~]$ mysql -h localhost -u lixa lixa
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 2
Server version: 5.1.61 Source distribution

Copyright (c) 2000, 2011, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql&gt; SELECT * FROM authors;
Empty set (0.00 sec)
	  </pre></td></tr></tbody></table></div><p>
	Prepare a terminal session for PostgreSQL and check the table is empty:
	</p><div class="table"><table frame="box"><thead><tr><td>[PostgreSQL terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
[tiian@centos ~]$ psql testdb
psql (8.4.9)
Type "help" for help.

testdb=&gt; SELECT * FROM authors;
 id | last_name | first_name
----+-----------+------------
(0 rows)
	  </pre></td></tr></tbody></table></div><p>
	OK, now you are ready to produce one message and insert one row in
	each database:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
[tiian@centos tmp]$ ./example13_wmq_mys_pql insert
target queue is LIXA.QLOCAL
Message inserted in queue LIXA.QLOCAL: 'Test message for LIXA'
Inserting a row in MySQL table...
Inserting a row in PostgreSQL table...
	  </pre></td></tr></tbody></table></div><p>
	Check the content of MySQL:
	</p><div class="table"><table frame="box"><thead><tr><td>[MySQL terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
mysql&gt; SELECT * FROM authors;
+----+-----------+------------+
| id | last_name | first_name |
+----+-----------+------------+
|  1 | Foo       | Bar        |
+----+-----------+------------+
1 row in set (0.00 sec)
	  </pre></td></tr></tbody></table></div><p>
	Check the content of PostgreSQL:
	</p><div class="table"><table frame="box"><thead><tr><td>[PostgreSQL terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
testdb=&gt; SELECT * FROM authors;
 id | last_name | first_name
----+-----------+------------
  1 | Foo       | Bar
(1 row)
	  </pre></td></tr></tbody></table></div><p>
	We are leaving the message in the queue and testing the extraction:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
[tiian@centos tmp]$ ./example13_wmq_mys_pql delete
target queue is LIXA.QLOCAL
Message retrieved from queue LIXA.QLOCAL: 'Test message for LIXA'
Deleting a row from MySQL  table...
Deleting a row from PostgreSQL table...
	  </pre></td></tr></tbody></table></div><p>
	There was one message and the sample program picked it up; check the
	content of MySQL:
	</p><div class="table"><table frame="box"><thead><tr><td>[MySQL terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
mysql&gt; SELECT * FROM authors;
Empty set (0.00 sec)
	  </pre></td></tr></tbody></table></div><p>
	check the content of PostgreSQL:
	</p><div class="table"><table frame="box"><thead><tr><td>[PostgreSQL terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
testdb=&gt; SELECT * FROM authors;
 id | last_name | first_name
----+-----------+------------
(0 rows)
	  </pre></td></tr></tbody></table></div><p>
	It's time to verify what's happen with 
	<code class="function">tx_rollback()</code> instead of
	<code class="function">tx_commit()</code>; move the comments in the source
	code from:
	</p><div class="table"><table frame="box"><thead><tr><td>[example13_wmq_mys_pql.c (before)]</td></tr></thead><tbody><tr><td><pre class="screen">
[...]
    if (TX_OK != (txrc = tx_commit())) {
        fprintf(stderr, "tx_commit error: %d\n", txrc);
        exit(txrc);
    }

    /*
    if (TX_OK != (txrc = tx_rollback())) {
        fprintf(stderr, "tx_rollback error: %d\n", txrc);
        exit(txrc);
    }
    */
[...]

	  </pre></td></tr></tbody></table></div><p>
	to:
	</p><div class="table"><table frame="box"><thead><tr><td>[example13_wmq_mys_pql.c (after)]</td></tr></thead><tbody><tr><td><pre class="screen">
[...]
    /*
    if (TX_OK != (txrc = tx_commit())) {
        fprintf(stderr, "tx_commit error: %d\n", txrc);
        exit(txrc);
    }
    */

    if (TX_OK != (txrc = tx_rollback())) {
        fprintf(stderr, "tx_rollback error: %d\n", txrc);
        exit(txrc);
    }
[...]
	  </pre></td></tr></tbody></table></div><p>
	and re-compile the program:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
[tiian@centos tmp]$ gcc example13_wmq_mys_pql.c \
&gt; $(/opt/lixa/bin/lixa-config -c -f -m -p -d) \
&gt; $(mysql_config --include --libs_r) -I/usr/include/postgresql -lpq \
&gt; -I/opt/mqm71/inc -L/opt/mqm71/lib -Wl,-rpath -Wl,/opt/mqm71/lib \
&gt; -lmqm_r -o example13_wmq_mys_pql
	  </pre></td></tr></tbody></table></div><p>
	Now you are ready to insert again message and row, but the rollback
	will discard the operation:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
[tiian@centos tmp]$ ./example13_wmq_mys_pql insert
target queue is LIXA.QLOCAL
Message inserted in queue LIXA.QLOCAL: 'Test message for LIXA'
Inserting a row in MySQL table...
Inserting a row in PostgreSQL table...
	  </pre></td></tr></tbody></table></div><p>
	Check the content of MySQL:
	</p><div class="table"><table frame="box"><thead><tr><td>[MySQL terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
mysql&gt; SELECT * FROM authors;
Empty set (0.00 sec)
	  </pre></td></tr></tbody></table></div><p>
	it's empty; check the content of PostgreSQL:
	</p><div class="table"><table frame="box"><thead><tr><td>[PostgreSQL terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
testdb=&gt; SELECT * FROM authors;
 id | last_name | first_name
----+-----------+------------
(0 rows)
	  </pre></td></tr></tbody></table></div><p>
	it's empty; check the content of WebSphere MQ:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
[tiian@centos tmp]$ /opt/mqm71/samp/bin/amqsget LIXA.QLOCAL LIXA
Sample AMQSGET0 start
no more messages
Sample AMQSGET0 end
	  </pre></td></tr></tbody></table></div><p>
	it's empty. Now you can restore the comment around
	<code class="function">tx_rollback()</code> instead of
	<code class="function">tx_commit()</code>.
      </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp69018800"></a>Static registration</h4></div></div></div><p>
	  If you want to use WebSphere MQ with static registration instead of
	  dynamic registration you will use a different profile:
	  </p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
[tiian@centos tmp]$ echo $LIXA_PROFILE

[tiian@centos tmp]$ export LIXA_PROFILE=MQS_STA_MYS_STA_PQL_STA
[tiian@centos tmp]$ echo $LIXA_PROFILE
MQS_STA_MYS_STA_PQL_STA
	    </pre></td></tr></tbody></table></div><p>
	</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp69064064"></a>Adapting the example to WebSphere MQ Extended Transactional Client (ETC)</h3></div></div></div><p>
	To try this example using Extended Transactional Client (ETC) for
	WebSphere MQ, you must change these steps in the sequence
	previously described:
	</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	      configure LIXA software using
	      <code class="option">--with-wsmq=ETC</code> option; clean the previous 
	      build (<span class="command"><strong>make clean</strong></span>) and install the build
	      (<span class="command"><strong>su -c "make install"</strong></span>)
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      check the output of 
	      <span class="command"><strong>/opt/lixa/bin/lixa-config -r</strong></span>
	      command
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      link library <code class="filename">mqic_r</code> instead of
	      library <code class="filename">mqm_r</code> to program
	      <code class="filename">example13_wmq_mys_pql</code>
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      set variable <code class="varname">LIXA_PROFILE</code> to
	      <code class="varname">MQC_DYN_MYS_STA_PQL_STA</code> (dynamic registration)
	      or to <code class="varname">MQC_STA_MYS_STA_PQL_STA</code> (static 
	      registration)
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      use utilities <span class="command"><strong>amqsgetc, amqsputc</strong></span> instead of
	      <span class="command"><strong>amqsget, amqsput</strong></span>
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      set variable <code class="varname">MQSERVER</code> to
	      <code class="varname">LIXA.CHANNEL/TCP/'127.0.0.1(1414)'</code>
	  </p></li></ul></div><p>
      </p></div></div><div class="footnotes"><br /><hr style="width:100; text-align:left;margin-left: 0" /><div id="ftn.idp67792512" class="footnote"><p><a href="#idp67792512" class="para"><sup class="para">[19] </sup></a>
	      I put this line (Oracle 10.2 32 bit)
	      <code class="computeroutput">. /usr/lib/oracle/xe/app/oracle/product/10.2.0/server/bin/oracle_env.sh</code>
	      or this line (Oracle 11.2 64 bit)
	      <code class="computeroutput">. /u01/app/oracle/product/11.2.0/xe/bin/oracle_env.sh</code>
	      in the file <code class="filename">$HOME/.profile</code> of the
	      <code class="systemitem">oracle</code> user to set-up
	      the default administration environment; it complains about
	      two shell errors, but for the sake of our example it's
	      safe.
	    </p></div><div id="ftn.idp67795536" class="footnote"><p><a href="#idp67795536" class="para"><sup class="para">[20] </sup></a>
	      If you got some errors like these:
	      </p><pre class="screen">
/usr/lib/oracle/xe/app/oracle/product/10.2.0/server/bin/nls_lang.sh: 114: [[: not found
/usr/lib/oracle/xe/app/oracle/product/10.2.0/server/bin/nls_lang.sh: 114: [[: not found
	      </pre><p>
	      you could edit the file <code class="filename">/usr/lib/oracle/xe/app/oracle/product/10.2.0/server/bin/nls_lang.sh</code> and substitute 
	      <code class="computeroutput">#!/bin/sh</code> with
	      <code class="computeroutput">#!/bin/bash</code> in the first row as explained 
	      here:
	      <a class="ulink" href="http://forums.oracle.com/forums/thread.jspa?messageID=1542334" target="_top">http://forums.oracle.com/forums/thread.jspa?messageID=1542334</a>
	      </p></div><div id="ftn.idp67842608" class="footnote"><p><a href="#idp67842608" class="para"><sup class="para">[21] </sup></a>
  use </p><pre class="screen">sqlplus hr/hr@lixa_ora_db</pre><p> in the event that you are 
  using a remote connection as explained above
</p></div><div id="ftn.idp67850960" class="footnote"><p><a href="#idp67850960" class="para"><sup class="para">[22] </sup></a>
	      The content of <code class="constant">xa_open_info</code> string is
	      described in chapter 15 "Developing Applications with Oracle XA"
	      of the "Oracle Database Application Developer's Guide"
	      manual; please refer to the documentation published by
	      Oracle Corporation for further details.
	      </p></div><div id="ftn.idp67893504" class="footnote"><p><a href="#idp67893504" class="para"><sup class="para">[23] </sup></a>
	      LIXA test suite, based on <span class="command"><strong>autotest</strong></span> looks for
	      it: if it's not available, Oracle's tests are skipped.
	    </p></div><div id="ftn.idp67917376" class="footnote"><p><a href="#idp67917376" class="para"><sup class="para">[24] </sup></a>
	      The content of <code class="constant">xa_open_info</code> string is
	      described in chapter "Developing Applications with Oracle XA"
	      of the "Oracle Database Application Developer's Guide"
	      manual; please refer to the documentation published by
	      Oracle Corporation for further details.
	    </p></div><div id="ftn.idp68008224" class="footnote"><p><a href="#idp68008224" class="para"><sup class="para">[25] </sup></a>
	    The content of <code class="constant">xa_open_info</code> string is
	    documented at IBM Infocenter: search the string
	    <span class="quote">“<span class="quote">xa_open string formats</span>”</span> in the documentation
	    relevant to your installed version; this is a link
	    <a class="ulink" href="http://publib.boulder.ibm.com/infocenter/db2luw/v9r7/topic/com.ibm.db2.luw.admin.2pc.doc/doc/r0005080.html" target="_top">
	      http://publib.boulder.ibm.com/infocenter/db2luw/v9r7/topic/com.ibm.db2.luw.admin.2pc.doc/doc/r0005080.html
	    </a>
	    but it may change in the future.
	</p></div><div id="ftn.idp68070480" class="footnote"><p><a href="#idp68070480" class="para"><sup class="para">[26] </sup></a>
	    The content of <code class="constant">xa_open_info</code> string is
	    described in chapter 15 "Developing Applications with Oracle XA"
	    of the "Oracle Database Application Developer's Guide"
	    manual; please refer to the documentation published by
	    Oracle Corporation for further details.
	  </p><p>
	    The content of <code class="constant">xa_open_info</code> string is
	    documented at IBM Infocenter: search the string
	    <span class="quote">“<span class="quote">xa_open string formats</span>”</span> in the documentation
	    relevant to your installed version; this is a link
	    <a class="ulink" href="http://publib.boulder.ibm.com/infocenter/db2luw/v9r7/topic/com.ibm.db2.luw.admin.2pc.doc/doc/r0005080.html" target="_top">
	      http://publib.boulder.ibm.com/infocenter/db2luw/v9r7/topic/com.ibm.db2.luw.admin.2pc.doc/doc/r0005080.html
	    </a>
	    but it may change in the future.
	  </p></div><div id="ftn.idp68174112" class="footnote"><p><a href="#idp68174112" class="para"><sup class="para">[27] </sup></a>
	      If you wanted to use a database user different than your own
	      UNIX user, as it ever happens when the database is hosted on
	      a different system, you should configure
	      <code class="filename">pg_hba.conf</code> as well. Look at the PostgreSQL
	      documentation to pick up all the necessary details.
	  </p></div><div id="ftn.idp68210048" class="footnote"><p><a href="#idp68210048" class="para"><sup class="para">[28] </sup></a>
	    The content of <code class="constant">xa_open_info</code> is passed to
	    <code class="function">PQconnectdb</code> function: you can refer to 
	    PostgreSQL official
	    documentation to discover what you can pass to this function.
	    Please pay attention the <code class="varname">xa_open_info</code> can
	    contain a maximum of 255 characters: this limitation is
	    documented in [<a class="citation" href="#idp70066448"><span class="citation">XAspec</span></a>].
	</p></div><div id="ftn.idp68233728" class="footnote"><p><a href="#idp68233728" class="para"><sup class="para">[29] </sup></a>
	    The current implementation does not support dynamic registration
	    for PostgreSQL.
	</p></div><div id="ftn.idp68291664" class="footnote"><p><a href="#idp68291664" class="para"><sup class="para">[30] </sup></a>
	    The content of <code class="constant">xa_open_info</code> is passed to
	    <code class="function">PQconnectdb</code> function: you can refer to 
	    PostgreSQL official
	    documentation to discover what you can pass to this function.
	    Please pay attention the <code class="varname">xa_open_info</code> can
	    contain a maximum of 255 characters: this limitation is
	    documented in [<a class="citation" href="#idp70066448"><span class="citation">XAspec</span></a>].
	  </p></div><div id="ftn.idp68295232" class="footnote"><p><a href="#idp68295232" class="para"><sup class="para">[31] </sup></a>
	    The content of <code class="constant">xa_open_info</code> string is
	    described in chapter 15 "Developing Applications with Oracle XA"
	    of the "Oracle Database Application Developer's Guide"
	    manual; please refer to the documentation published by
	    Oracle Corporation for further details.
	  </p></div><div id="ftn.idp68376384" class="footnote"><p><a href="#idp68376384" class="para"><sup class="para">[32] </sup></a>
	    The content of <code class="constant">xa_open_info</code> is passed to
	    <code class="function">PQconnectdb</code> function: you can refer to 
	    PostgreSQL official
	    documentation to discover what you can pass to this function.
	    Please pay attention the <code class="varname">xa_open_info</code> can
	    contain a maximum of 255 characters: this limitation is
	    documented in [<a class="citation" href="#idp70066448"><span class="citation">XAspec</span></a>].
	  </p></div><div id="ftn.idp68379168" class="footnote"><p><a href="#idp68379168" class="para"><sup class="para">[33] </sup></a>
	    The content of <code class="constant">xa_open_info</code> string is
	    documented at IBM Infocenter: search the string
	    <span class="quote">“<span class="quote">xa_open string formats</span>”</span> in the documentation
	    relevant to your installed version; this is a link
	    <a class="ulink" href="http://publib.boulder.ibm.com/infocenter/db2luw/v9r7/topic/com.ibm.db2.luw.admin.2pc.doc/doc/r0005080.html" target="_top">
	      http://publib.boulder.ibm.com/infocenter/db2luw/v9r7/topic/com.ibm.db2.luw.admin.2pc.doc/doc/r0005080.html
	    </a>
	    but it may change in the future.
	  </p></div><div id="ftn.idp68439328" class="footnote"><p><a href="#idp68439328" class="para"><sup class="para">[34] </sup></a>
	      You need the password of MySQL root user to execute
	      these commands
	  </p></div><div id="ftn.idp68531440" class="footnote"><p><a href="#idp68531440" class="para"><sup class="para">[35] </sup></a>
	    The current implementation does not support dynamic registration
	    for MySQL.
	</p></div><div id="ftn.idp68572000" class="footnote"><p><a href="#idp68572000" class="para"><sup class="para">[36] </sup></a>
	    The content of <code class="constant">xa_open_info</code> for MySQL is
	    described in 
	    <a class="xref" href="#Development_setup_MySQL_xa_open_info" title="Some checks before program execution">the section called “Some checks before program execution”</a>.
	  </p></div><div id="ftn.idp68574368" class="footnote"><p><a href="#idp68574368" class="para"><sup class="para">[37] </sup></a>
	    The content of <code class="constant">xa_open_info</code> is passed to
	    <code class="function">PQconnectdb</code> function: you can refer to 
	    PostgreSQL official
	    documentation to discover what you can pass to this function.
	    Please pay attention the <code class="varname">xa_open_info</code> can
	    contain a maximum of 255 characters: this limitation is
	    documented in [<a class="citation" href="#idp70066448"><span class="citation">XAspec</span></a>].
	  </p></div><div id="ftn.idp68653872" class="footnote"><p><a href="#idp68653872" class="para"><sup class="para">[38] </sup></a>
	    The content of <code class="constant">xa_open_info</code> for MySQL is
	    described in 
	    <a class="xref" href="#Development_setup_MySQL_xa_open_info" title="Some checks before program execution">the section called “Some checks before program execution”</a>.
	  </p></div><div id="ftn.idp68656240" class="footnote"><p><a href="#idp68656240" class="para"><sup class="para">[39] </sup></a>
	    The content of <code class="constant">xa_open_info</code> is passed to
	    <code class="function">PQconnectdb</code> function: you can refer to 
	    PostgreSQL official
	    documentation to discover what you can pass to this function.
	    Please pay attention the <code class="varname">xa_open_info</code> can
	    contain a maximum of 255 characters: this limitation is
	    documented in [<a class="citation" href="#idp70066448"><span class="citation">XAspec</span></a>].
	  </p></div><div id="ftn.idp68658064" class="footnote"><p><a href="#idp68658064" class="para"><sup class="para">[40] </sup></a>
	    The content of <code class="constant">xa_open_info</code> string is
	    described in chapter 15 "Developing Applications with Oracle XA"
	    of the "Oracle Database Application Developer's Guide"
	    manual; please refer to the documentation published by
	    Oracle Corporation for further details.
	  </p></div><div id="ftn.idp68770992" class="footnote"><p><a href="#idp68770992" class="para"><sup class="para">[41] </sup></a>
	    The content of <code class="constant">xa_open_info</code> for MySQL is
	    described in 
	    <a class="xref" href="#Development_setup_MySQL_xa_open_info" title="Some checks before program execution">the section called “Some checks before program execution”</a>.
	  </p></div><div id="ftn.idp68904976" class="footnote"><p><a href="#idp68904976" class="para"><sup class="para">[42] </sup></a>
	    The content of <code class="constant">xa_open_info</code> is passed to
	    <code class="function">xa_open</code> function: you can refer to 
	    WebSphere MQ official
	    documentation to discover what you can pass to this function.
	    Please pay attention the <code class="varname">xa_open_info</code> can
	    contain a maximum of 255 characters: this limitation is
	    documented in [<a class="citation" href="#idp70066448"><span class="citation">XAspec</span></a>].
	</p></div><div id="ftn.idp68958608" class="footnote"><p><a href="#idp68958608" class="para"><sup class="para">[43] </sup></a>
	    The content of <code class="constant">xa_open_info</code> is passed to
	    <code class="function">xa_open</code> function: you can refer to 
	    WebSphere MQ official
	    documentation to discover what you can pass to this function.
	    Please pay attention the <code class="varname">xa_open_info</code> can
	    contain a maximum of 255 characters: this limitation is
	    documented in [<a class="citation" href="#idp70066448"><span class="citation">XAspec</span></a>].
	</p></div></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="Development_COBOL"></a>Chapter 6. Developing COBOL Application Programs</h1></div></div></div><p>
    This chapter explains how you can develop your own COBOL application
    using the libraries and the tools supplied by LIXA project.
  </p><p>
    LIXA project ships some example COBOL programs you can find in 
    directory
    <code class="filename">/opt/lixa/share/doc/lixa-X.Y.Z/examples/cobol/</code> after
    software installation (see <a class="xref" href="#Installation" title="Chapter 2. Installation">Chapter 2, <em>Installation</em></a>).
  </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
    This chapter is focused on the COBOL programming language. The C 
    programming language is addressed by another dedicated chapter.
  </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp69080112"></a>Supported COBOL environment</h2></div></div></div><p>
      LIXA supports only GnuCOBOL (formerly OpenCOBOL).
      <a class="ulink" href="https://sourceforge.net/projects/open-cobol/" target="_top">
	<em class="citetitle">GnuCOBOL</em>
	</a> can be retrieved from SourceForge.net or can be installed
	using the standard packages available for your Linux distribution.
	The support for GnuCOBOL requires at least version 1.1 that's available
	inside Ubuntu 14.04 and other distributions.
    </p><p>
      It cannot be excluded that LIXA may run using a different COBOL
      environment, but at this time the LIXA project does not have a 
      development and test environment for something else than GnuCOBOL.
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp69085072"></a>The TX (Transaction Demarcation) Specification</h2></div></div></div><p>
      LIXA project adopts the standard described in 
      [<a class="citation" href="#idp70061648"><span class="citation">TXspec</span></a>] as the API you should use when developing
      an Application Program.
    </p><p>
      The API is very easy, it supplies COBOL routines and C functions.
      The following COBOL example can be briefly explained:
      </p><pre class="programlisting">
        IDENTIFICATION DIVISION.
        PROGRAM-ID. EXAMPLE1.
        DATA DIVISION.
        WORKING-STORAGE SECTION.
      * Include TX definitions using the provided copybook
        01 TX-RETURN-STATUS.
           COPY TXSTATUS.
        01 TX-INFO-AREA.
           COPY TXINFDEF.
      * Include LIXA definitions using the provided copybook
           COPY LIXAXID.
        PROCEDURE DIVISION.
        000-MAIN.
            MOVE ZERO TO TX-RETURN-STATUS.
      * Calling TXOPEN (tx_open)
            CALL "TXOPEN" USING TX-RETURN-STATUS.
            DISPLAY 'TXOPEN returned value ' TX-STATUS.
            IF NOT TX-OK THEN
               DISPLAY 'Exiting...'
               STOP RUN RETURNING 1
            END-IF.
      *
      * Put your code OUTSIDE the transaction boundary here
      *
      * Calling TXBEGIN (tx_begin): the transaction starts here
            CALL "TXBEGIN" USING TX-RETURN-STATUS.
            DISPLAY 'TXBEGIN returned value ' TX-STATUS.
            IF NOT TX-OK THEN
               DISPLAY 'Exiting...'
               STOP RUN RETURNING 1
            END-IF.
      *
      * Put yout code INSIDE the transaction boundary here
      *
      * Calling TXCOMMIT (tx_commit): the transaction ends here with a
      * commit
            CALL "TXCOMMIT" USING TX-RETURN-STATUS.
            DISPLAY 'TXCOMMIT returned value ' TX-STATUS.
            IF NOT TX-OK THEN
               DISPLAY 'Exiting...'
               STOP RUN RETURNING 1
            END-IF.
      *
      * You can use TXROLLBACK instead of TXCOMMIT if you decide that the
      * work must be rolled back
      *
      * Put here other transactions if you need them
      *
      * Calling TXCLOSE (tx_close) to close ALL the Resource Managers
      * associated to the current LIXA_PROFILE
      *
            CALL "TXCLOSE" USING TX-RETURN-STATUS.
            DISPLAY 'TXCLOSE returned value ' TX-STATUS.
            IF NOT TX-OK
               STOP RUN RETURNING 1
            STOP RUN.
      </pre><p>
      These are the available COBOL routines (the descriptions come from
      [<a class="citation" href="#idp70061648"><span class="citation">TXspec</span></a>]):
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	    <code class="function">TXBEGIN</code>: begin a global transaction
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	    <code class="function">TXCLOSE</code>: close a set of resource managers
 	</p></li><li class="listitem" style="list-style-type: disc"><p>
	    <code class="function">TXCOMMIT</code>: commit a global transaction
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	    <code class="function">TXINFORM</code>: return global transaction 
	    information
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	    <code class="function">TXOPEN</code>: open a set of resource managers
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	    <code class="function">TXROLLBACK</code>: roll back a global transaction
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	    <code class="function">TXSETCOMMITRET</code>: set 
	    <em class="parameter"><code>commit_return</code></em> 
	    characteristic
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	    <code class="function">TXSETTRANCTL</code>: set
	    <em class="parameter"><code>transaction_control</code></em> 
	    characteristic
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	    <code class="function">TXSETTIMEOUT</code>: set
	    <em class="parameter"><code>transaction_timeout</code></em> 
	    characteristic
	</p></li></ul></div><p>
      Refer to [<a class="citation" href="#idp70061648"><span class="citation">TXspec</span></a>] for the complete description.
    </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp69103504"></a>Access to the resource managers</h3></div></div></div><p>
	A program developed for TX (Transaction Demarcation) Specification
	<span class="emphasis"><em>must</em></span> access the resource managers coordinated by
	the transaction manager using specific functions.
	Unfortunately, the TX Specification does <span class="emphasis"><em>not</em></span>
	specify a standard unified method to access a coordinated resource
	manager. 
      </p><p>
	Tipically, every resource manager provides its own specific
	function(s) to retrieve one or more <span class="emphasis"><em>connection 
	  handler(s)</em></span>. Once you have got the right connection
	handler(s), you can use the resource manager as you use without a
	transaction manager.
      </p><p>
	The supplied examples (see <code class="filename">doc/examples/cobol</code> 
	directory) show the routines that must be used to
	retrieve the connection handler(s) necessary to interact with
	the resource managers.
      </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	  Special attention must be payed to <span class="emphasis"><em>commit</em></span> and
	  <span class="emphasis"><em>rollback</em></span> operations: a well designed program
	  developed for TX (Transaction Demarcation) Specification must not
	  specify the resource manager native version of 
	  <span class="emphasis"><em>commit</em></span> and <span class="emphasis"><em>rollback</em></span> 
	  operations.
	  If your software violates this rule, your environment will
	  generate warning conditions related to euristically completed
	  transaction. If your software forces a resource manager to
	  <span class="emphasis"><em>commit</em></span> or <span class="emphasis"><em>rollback</em></span> 
	  outside the control of the transaction manager, the transaction
	  manager will not be able to perform the opposite operation if
	  asked to do it. These situations tend to generate inconsistencies.
      </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp69108064"></a>Chapter organization</h3></div></div></div><p>
	This chapter focuses on differences between C and COBOL and does not
	repeat all the configuration steps described in the previous C chapter.
	Anyway, when necessary, a pointer to the related section that explains
	how to configure the environment is provided.
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp69113216"></a>LIXA library linkage</h2></div></div></div><p>
      The examples showed in this chapter use these linkage options:
      <code class="option">-Wl,-rpath -Wl,/opt/lixa/lib</code>
      dynamically generated by 
      <span class="command"><strong>/opt/lixa/bin/lixa-config -d</strong></span>
      (<span class="command"><strong>/opt/lixa/bin/lixa-config --ldflags</strong></span>).
      The options are specific to <span class="command"><strong>gcc</strong></span> and 
      <span class="command"><strong>ld</strong></span> Linux linker.
      Alternatively you can avoid these options and set
      <code class="varname">LD_LIBRARY_PATH</code> environment variable.
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp69117392"></a>The first example</h2></div></div></div><div class="figure"><a id="develop1_cobol"></a><p class="title"><strong>Figure 6.1. Deploy model of an example with two dummy resource managers</strong></p><div class="figure-contents"><div class="mediaobject"><img src="../images/LIXA_Development_1.png" alt="Deploy model of an example with two dummy resource managers" /></div></div></div><br class="figure-break" /><p>
      Copy file <code class="filename">EXAMPLE1.cob</code> in your working dir:
      </p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:/tmp$ cp /opt/lixa/share/doc/lixa-X.Y.Z/examples/cobol/EXAMPLE1.cob .
	</pre></td></tr></tbody></table></div><p>
      Substitute <span class="quote">“<span class="quote">lixa-X.Y.Z</span>”</span> with the actual version of
      the software you installed.
    </p><p>
      Set up your shell environment:
      </p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:/tmp$ export PATH=$PATH:/opt/lixa/bin
tiian@ubuntu1404-64:/tmp$ export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/opt/lixa/lib
tiian@ubuntu1404-64:/tmp$ export COB_LDFLAGS=-Wl,--no-as-needed
	</pre></td></tr></tbody></table></div><p>
    </p><p>
      Compile and link the COBOL example program:
      </p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:/tmp$ cobc -x $(lixa-config -f -l) EXAMPLE1.cob
	</pre></td></tr></tbody></table></div><p>
      Check the output of the linker:
      </p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:/tmp$ ldd EXAMPLE1
	linux-vdso.so.1 =&gt;  (0x00007fffbd9fe000)
	libcob.so.1 =&gt; /usr/lib/libcob.so.1 (0x00007fe904068000)
	libm.so.6 =&gt; /lib/x86_64-linux-gnu/libm.so.6 (0x00007fe903d62000)
	libgmp.so.10 =&gt; /usr/lib/x86_64-linux-gnu/libgmp.so.10 (0x00007fe903aed000)
	libncurses.so.5 =&gt; /lib/x86_64-linux-gnu/libncurses.so.5 (0x00007fe9038ca000)
	libtinfo.so.5 =&gt; /lib/x86_64-linux-gnu/libtinfo.so.5 (0x00007fe9036a1000)
	libdb-5.3.so =&gt; /usr/lib/x86_64-linux-gnu/libdb-5.3.so (0x00007fe9032fe000)
	libdl.so.2 =&gt; /lib/x86_64-linux-gnu/libdl.so.2 (0x00007fe9030fa000)
	liblixac.so.0 =&gt; /opt/lixa/lib/liblixac.so.0 (0x00007fe902edf000)
	libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007fe902b19000)
	libpthread.so.0 =&gt; /lib/x86_64-linux-gnu/libpthread.so.0 (0x00007fe9028fb000)
	/lib64/ld-linux-x86-64.so.2 (0x00007fe9042a6000)
	libgmodule-2.0.so.0 =&gt; /usr/lib/x86_64-linux-gnu/libgmodule-2.0.so.0 (0x00007fe9026f6000)
	libglib-2.0.so.0 =&gt; /lib/x86_64-linux-gnu/libglib-2.0.so.0 (0x00007fe9023ee000)
	libxml2.so.2 =&gt; /usr/lib/x86_64-linux-gnu/libxml2.so.2 (0x00007fe902087000)
	liblixab.so.0 =&gt; /opt/lixa/lib/liblixab.so.0 (0x00007fe901e6d000)
	libpcre.so.3 =&gt; /lib/x86_64-linux-gnu/libpcre.so.3 (0x00007fe901c2f000)
	libz.so.1 =&gt; /lib/x86_64-linux-gnu/libz.so.1 (0x00007fe901a16000)
	liblzma.so.5 =&gt; /lib/x86_64-linux-gnu/liblzma.so.5 (0x00007fe9017f3000)
	libuuid.so.1 =&gt; /lib/x86_64-linux-gnu/libuuid.so.1 (0x00007fe9015ee000)
</pre></td></tr></tbody></table></div><p>
      Now you are ready to start your first application:
      </p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:/tmp$ ./EXAMPLE1 
Executing EXAMPLE1
TXOPEN returned value -000000007
Exiting...
	</pre></td></tr></tbody></table></div><p>
      The <code class="function">TXOPEN</code> routine returned the value 
      <span class="quote">“<span class="quote">-7</span>”</span> (<code class="constant">TX-FAIL</code>) 
      because the state server is not running.
      Start the state server (see <a class="xref" href="#Background_execution" title="Background (daemon) execution">the section called “Background (<span class="emphasis"><em>daemon</em></span>) execution”</a>)
      and try again:
      </p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session (Ubuntu)]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ sudo su - lixa
lixa@ubuntu1404-64:~$ /opt/lixa/sbin/lixad --daemon
lixa@ubuntu1404-64:~$ exit
logout
tiian@ubuntu1404-64:~/tmp$ ps -ef|grep lixad|grep -v grep
lixa     12866     1  0 21:35 ?        00:00:00 /opt/lixa/sbin/lixad --daemon
tiian@ubuntu1404-64:/tmp$ ./EXAMPLE1 
Executing EXAMPLE1
TXOPEN returned value +000000000
TXBEGIN returned value +000000000
TXINFORM returned value +000000000
  XID-REC/FORMAT-ID:     +279875137
  XID-REC/GTRID-LENGTH:  +000000016
  XID-REC/BRANCH-LENGTH: +000000016
  XID-REC/XID (SERIAL.): 1279875137.9ce44ddff2274cd99924ae2721b66789.58f1d23a64e7f668c92c624bc096d075                                                                                                         
  TRANSACTION-MODE :     +000000001
    [TX-IN-TRAN]
  COMMIT-RETURN :        +000000000
    [TX-COMMIT-COMPLETED]
  TRANSACTION-CONTROL :  +000000000
    [TX-UNCHAINED]
  TRANSACTION-TIMEOUT :  +000000000
    [NO-TIMEOUT]
  TRANSACTION-STATE :    +000000000
    [TX-ACTIVE]
TXCOMMIT returned value +000000000
TXINFORM returned value +000000000
  XID-REC/FORMAT-ID:     -000000001
  XID-REC/GTRID-LENGTH:  +000000000
  XID-REC/BRANCH-LENGTH: +000000000
  XID-REC/XID (SERIAL.): -1..                                                                                                         
  TRANSACTION-MODE :     +000000000
    [TX-NOT-IN-TRAN]
  COMMIT-RETURN :        +000000000
    [TX-COMMIT-COMPLETED]
  TRANSACTION-CONTROL :  +000000000
    [TX-UNCHAINED]
  TRANSACTION-TIMEOUT :  +000000000
    [NO-TIMEOUT]
  TRANSACTION-STATE :    +000000000
    [TX-ACTIVE]
TXSETCOMMITRET returned value +000000001
TXSETTIMEOUT returned value +000000000
TXSETTRANCTL returned value +000000000
TXINFORM returned value +000000000
  XID-REC/FORMAT-ID:     -000000001
  XID-REC/GTRID-LENGTH:  +000000000
  XID-REC/BRANCH-LENGTH: +000000000
  XID-REC/XID (SERIAL.): -1..                                                                                                         
  TRANSACTION-MODE :     +000000000
    [TX-NOT-IN-TRAN]
  COMMIT-RETURN :        +000000000
    [TX-COMMIT-COMPLETED]
  TRANSACTION-CONTROL :  +000000001
    [TX-CHAINED]
  TRANSACTION-TIMEOUT :  +000000005
  TRANSACTION-STATE :    +000000000
    [TX-ACTIVE]
TXSETTRANCTL returned value +000000000
TXINFORM returned value +000000000
  XID-REC/FORMAT-ID:     -000000001
  XID-REC/GTRID-LENGTH:  +000000000
  XID-REC/BRANCH-LENGTH: +000000000
  XID-REC/XID (SERIAL.): -1..                                                                                                         
  TRANSACTION-MODE :     +000000000
    [TX-NOT-IN-TRAN]
  COMMIT-RETURN :        +000000000
    [TX-COMMIT-COMPLETED]
  TRANSACTION-CONTROL :  +000000000
    [TX-UNCHAINED]
  TRANSACTION-TIMEOUT :  +000000005
  TRANSACTION-STATE :    +000000000
    [TX-ACTIVE]
TXBEGIN returned value +000000000
TXROLLBACK returned value +000000000
TXCLOSE returned value +000000000
	</pre></td></tr></tbody></table></div><p>
      Your first COBOL Application Program has connected to the state server 
      and has performed two dummy distributed transactions: 
      <span class="emphasis"><em>commit</em></span> and <span class="emphasis"><em>rollback</em></span>.
    </p><p>
      Refer to <a class="xref" href="#first_example_details" title="Some details about the example">the section called “Some details about the example”</a> to get some further insights.
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Development_EXAMPLE5_PQL"></a>An example with PostgreSQL</h2></div></div></div><div class="figure"><a id="develop5_cobol"></a><p class="title"><strong>Figure 6.2. Deploy model of an example with PostgreSQL DBMS</strong></p><div class="figure-contents"><div class="mediaobject"><img src="../images/LIXA_Development_5.png" alt="Deploy model of an example with PostgreSQL DBMS" /></div></div></div><br class="figure-break" /><p>
      This example was developed using PostgreSQL 9.3.15 for Linux (Ubuntu).
      If you were using a different version you would need to adapt some
      commands to your environment.
    </p><p>
      Prepare the environment following the following steps:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	  Set-up PostgreSQL environment
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	  Start the LIXA state server
	</p></li></ul></div><p>
      as explained in <a class="xref" href="#Development_example5_pql" title="An example with PostgreSQL">the section called “An example with PostgreSQL”</a>.
    </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp69153808"></a>Build the client program</h3></div></div></div><p>
	Prepare the client (Application Program) using the below commands:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:/tmp$ cp /opt/lixa/share/doc/lixa-X.Y.Z/examples/cobol/EXAMPLE5_PQL.c .
tiian@ubuntu1404-64:/tmp$ export PATH=$PATH:/opt/lixa/bin
tiian@ubuntu1404-64:/tmp$ export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/opt/lixa/lib
tiian@ubuntu1404-64:/tmp$ export COB_LDFLAGS=-Wl,--no-as-needed
tiian@ubuntu1404-64:/tmp$ cobc -x $(lixa-config -f -p) EXAMPLE5_PQL.cob
	  </pre></td></tr></tbody></table></div><p>
	Verify the executable produced by <span class="command"><strong>cobc</strong></span>:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:/tmp$ ldd EXAMPLE5_PQL
	  linux-vdso.so.1 =&gt;  (0x00007ffff21fe000)
	  libcob.so.1 =&gt; /usr/lib/libcob.so.1 (0x00007f1a00df4000)
	  libm.so.6 =&gt; /lib/x86_64-linux-gnu/libm.so.6 (0x00007f1a00aee000)
	  libgmp.so.10 =&gt; /usr/lib/x86_64-linux-gnu/libgmp.so.10 (0x00007f1a00879000)
	  libncurses.so.5 =&gt; /lib/x86_64-linux-gnu/libncurses.so.5 (0x00007f1a00656000)
	  libtinfo.so.5 =&gt; /lib/x86_64-linux-gnu/libtinfo.so.5 (0x00007f1a0042d000)
	  libdb-5.3.so =&gt; /usr/lib/x86_64-linux-gnu/libdb-5.3.so (0x00007f1a0008a000)
	  libdl.so.2 =&gt; /lib/x86_64-linux-gnu/libdl.so.2 (0x00007f19ffe86000)
	  liblixac.so.0 =&gt; /opt/lixa/lib/liblixac.so.0 (0x00007f19ffc6b000)
	  liblixapq.so.0 =&gt; /opt/lixa/lib/liblixapq.so.0 (0x00007f19ffa63000)
	  libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007f19ff69e000)
	  libpthread.so.0 =&gt; /lib/x86_64-linux-gnu/libpthread.so.0 (0x00007f19ff480000)
	  /lib64/ld-linux-x86-64.so.2 (0x00007f1a01032000)
	  libgmodule-2.0.so.0 =&gt; /usr/lib/x86_64-linux-gnu/libgmodule-2.0.so.0 (0x00007f19ff27b000)
	  libglib-2.0.so.0 =&gt; /lib/x86_64-linux-gnu/libglib-2.0.so.0 (0x00007f19fef73000)
	  libxml2.so.2 =&gt; /usr/lib/x86_64-linux-gnu/libxml2.so.2 (0x00007f19fec0c000)
	  liblixab.so.0 =&gt; /opt/lixa/lib/liblixab.so.0 (0x00007f19fe9f2000)
	  libpq.so.5 =&gt; /usr/lib/libpq.so.5 (0x00007f19fe7c3000)
	  libpcre.so.3 =&gt; /lib/x86_64-linux-gnu/libpcre.so.3 (0x00007f19fe584000)
	  libz.so.1 =&gt; /lib/x86_64-linux-gnu/libz.so.1 (0x00007f19fe36b000)
	  liblzma.so.5 =&gt; /lib/x86_64-linux-gnu/liblzma.so.5 (0x00007f19fe149000)
	  libuuid.so.1 =&gt; /lib/x86_64-linux-gnu/libuuid.so.1 (0x00007f19fdf44000)
	  libssl.so.1.0.0 =&gt; /lib/x86_64-linux-gnu/libssl.so.1.0.0 (0x00007f19fdce4000)
	  libcrypto.so.1.0.0 =&gt; /lib/x86_64-linux-gnu/libcrypto.so.1.0.0 (0x00007f19fd908000)
	  libkrb5.so.3 =&gt; /usr/lib/x86_64-linux-gnu/libkrb5.so.3 (0x00007f19fd63d000)
	  libcom_err.so.2 =&gt; /lib/x86_64-linux-gnu/libcom_err.so.2 (0x00007f19fd438000)
	  libgssapi_krb5.so.2 =&gt; /usr/lib/x86_64-linux-gnu/libgssapi_krb5.so.2 (0x00007f19fd1f1000)
	  libldap_r-2.4.so.2 =&gt; /usr/lib/x86_64-linux-gnu/libldap_r-2.4.so.2 (0x00007f19fcfa0000)
	  libk5crypto.so.3 =&gt; /usr/lib/x86_64-linux-gnu/libk5crypto.so.3 (0x00007f19fcd70000)
	  libkrb5support.so.0 =&gt; /usr/lib/x86_64-linux-gnu/libkrb5support.so.0 (0x00007f19fcb65000)
	  libkeyutils.so.1 =&gt; /lib/x86_64-linux-gnu/libkeyutils.so.1 (0x00007f19fc961000)
	  libresolv.so.2 =&gt; /lib/x86_64-linux-gnu/libresolv.so.2 (0x00007f19fc745000)
	  liblber-2.4.so.2 =&gt; /usr/lib/x86_64-linux-gnu/liblber-2.4.so.2 (0x00007f19fc536000)
	  libsasl2.so.2 =&gt; /usr/lib/x86_64-linux-gnu/libsasl2.so.2 (0x00007f19fc31b000)
	  libgssapi.so.3 =&gt; /usr/lib/x86_64-linux-gnu/libgssapi.so.3 (0x00007f19fc0dc000)
	  libgnutls.so.26 =&gt; /usr/lib/x86_64-linux-gnu/libgnutls.so.26 (0x00007f19fbe1e000)
	  libgcrypt.so.11 =&gt; /lib/x86_64-linux-gnu/libgcrypt.so.11 (0x00007f19fbb9e000)
	  libheimntlm.so.0 =&gt; /usr/lib/x86_64-linux-gnu/libheimntlm.so.0 (0x00007f19fb994000)
	  libkrb5.so.26 =&gt; /usr/lib/x86_64-linux-gnu/libkrb5.so.26 (0x00007f19fb70c000)
	  libasn1.so.8 =&gt; /usr/lib/x86_64-linux-gnu/libasn1.so.8 (0x00007f19fb46b000)
	  libhcrypto.so.4 =&gt; /usr/lib/x86_64-linux-gnu/libhcrypto.so.4 (0x00007f19fb237000)
	  libroken.so.18 =&gt; /usr/lib/x86_64-linux-gnu/libroken.so.18 (0x00007f19fb022000)
	  libtasn1.so.6 =&gt; /usr/lib/x86_64-linux-gnu/libtasn1.so.6 (0x00007f19fae0e000)
	  libp11-kit.so.0 =&gt; /usr/lib/x86_64-linux-gnu/libp11-kit.so.0 (0x00007f19fabcb000)
	  libgpg-error.so.0 =&gt; /lib/x86_64-linux-gnu/libgpg-error.so.0 (0x00007f19fa9c6000)
	  libwind.so.0 =&gt; /usr/lib/x86_64-linux-gnu/libwind.so.0 (0x00007f19fa79d000)
	  libheimbase.so.1 =&gt; /usr/lib/x86_64-linux-gnu/libheimbase.so.1 (0x00007f19fa58e000)
	  libhx509.so.5 =&gt; /usr/lib/x86_64-linux-gnu/libhx509.so.5 (0x00007f19fa345000)
	  libsqlite3.so.0 =&gt; /usr/lib/x86_64-linux-gnu/libsqlite3.so.0 (0x00007f19fa08c000)
	  libcrypt.so.1 =&gt; /lib/x86_64-linux-gnu/libcrypt.so.1 (0x00007f19f9e52000)
	  libffi.so.6 =&gt; /usr/lib/x86_64-linux-gnu/libffi.so.6 (0x00007f19f9c4a000)
</pre></td></tr></tbody></table></div><p>
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp69164752"></a>Set-up LIXA environment</h3></div></div></div><p>
	Set-up the <code class="varname">LIXA_PROFILE</code> environment variable:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:/tmp$ echo $LIXA_PROFILE

tiian@ubuntu1404-64:/tmp$ export LIXA_PROFILE=PQL_STA
tiian@ubuntu1404-64:/tmp$ echo $LIXA_PROFILE
PQL_STA
	  </pre></td></tr></tbody></table></div><p>
      </p><p>
	See <a class="xref" href="#example5_some_checks" title="Some checks before program execution">the section called “Some checks before program execution”</a> for additional details on
	the profile.
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp69170048"></a>Program execution</h3></div></div></div><p>
	It is suggested to open two different terminals: the first one
	connected to <span class="quote">“<span class="quote">testdb</span>”</span> PostgreSQL database and the second
	one pointing to the directory where the compiled program
	<code class="filename">EXAMPLE5_PQL</code> lives.
	First teminal session:
	</p><div class="table"><table frame="box"><thead><tr><td>[PostgreSQL terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~$ psql testdb
psql (9.3.15)
Type "help" for help.

testdb=&gt; 
	  </pre></td></tr></tbody></table></div><p>
	Second teminal session:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:/tmp$ ls -la EXAMPLE5_PQL*
-rwxrwxr-x 1 tiian tiian 20170 gen 13 23:51 EXAMPLE5_PQL
-rw-r--r-- 1 tiian tiian  6374 gen 13 23:47 EXAMPLE5_PQL.cob
	  </pre></td></tr></tbody></table></div><p>
	Check the content of <span class="quote">“<span class="quote">AUTHORS</span>”</span> table before
	program execution:
	</p><div class="table"><table frame="box"><thead><tr><td>[PostgreSQL terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
testdb=&gt; select * from AUTHORS;
 id | last_name | first_name 
----+-----------+------------
(0 rows)
	  </pre></td></tr></tbody></table></div><p>
	Execute the program:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:/tmp$ ./EXAMPLE5_PQL INSERT
Executing EXAMPLE5_PQL
Inserting a row in the table...
Status: +0000000000
PQexec INSERT
Status: +0000000001
TXCOMMIT returned value +000000000
TXCLOSE returned value +000000000
	  </pre></td></tr></tbody></table></div><p>
	Check the content of the table again:
	</p><div class="table"><table frame="box"><thead><tr><td>[PostgreSQL terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
testdb=&gt; select * from AUTHORS;
 id | last_name | first_name 
----+-----------+------------
  1 | Foo       | Bar
(1 rows)
	  </pre></td></tr></tbody></table></div><p>
	The example program inserted the row with id=1. You can not insert
	the same row twice because there is a unique constraint on this table,
	but you can remove the row using
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:/tmp$ ./EXAMPLE5_PQL DELETE
Executing EXAMPLE5_PQL
Deleting a row from the table...
Status: +0000000000
PQexec DELETE
Status: +0000000001
TXCOMMIT returned value +000000000
TXCLOSE returned value +000000000
	  </pre></td></tr></tbody></table></div><p>
	Check the table content again:
	</p><div class="table"><table frame="box"><thead><tr><td>[PostgreSQL terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
testdb=&gt; select * from AUTHORS;
 id | last_name | first_name 
----+-----------+------------
(0 rows)
	  </pre></td></tr></tbody></table></div><p>
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Development_EXAMPLE2_ORA"></a>An example with Oracle Pro*COBOL</h2></div></div></div><div class="figure"><a id="develop6_cobol"></a><p class="title"><strong>Figure 6.3. Deploy model of an example with Oracle DBMS</strong></p><div class="figure-contents"><div class="mediaobject"><img src="../images/LIXA_Development_5.png" alt="Deploy model of an example with Oracle DBMS" /></div></div></div><br class="figure-break" /><p>
      This example was developed using the following configuration:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	  Oracle remote configuration with Instant Client 12.1
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	  Oracle Pro*COBOL compiler as supplied by Oracle Instant Client 12.1
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	  GnuCOBOL compiler and runtime as supplied by Ubuntu 14.04
	</p></li></ul></div><p>
      If you were using a different version you would need to adapt some
      commands to your environment.
    </p><p>
      Prepare the environment following the following steps:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	  Set-up the Oracle environment as explained in 
	  <a class="xref" href="#Development_setup_Oracle_environment" title="Set-up the Oracle environment (server side)">the section called “Set-up the Oracle environment (server side)”</a>
	  and adapt the command to your Oracle Database Server version
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	  Configure Oracle listener for remote connection as explained in 
	  <a class="xref" href="#Development_configure_Oracle_listener" title="Configure Oracle Listener">the section called “Configure Oracle Listener”</a>
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	  Install and configure Oracle Instant Client as explained in 
	  <a class="xref" href="#Development_install_Oracle_Instant_Client" title="Install and configure Oracle Instant Client">the section called “Install and configure Oracle Instant Client”</a>
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	  Start the LIXA state server as explained in
	  <a class="xref" href="#Development_start_LIXA_server" title="Start the LIXA state server">the section called “Start the LIXA state server”</a>
	</p></li></ul></div><p>
    </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp69203232"></a>Set environment variables</h3></div></div></div><p>
	Create a shell script file, for example 
	<code class="filename">oracle_env.sh</code>
	with some useful environment variables as below:
	</p><pre class="screen">
tiian@ubuntu1404-64:/tmp$ cat oracle_env.sh 
#!/bin/sh
export LD_LIBRARY_PATH=/opt/oracle/instantclient_12_1:$LD_LIBRARY_PATH
export PATH=/opt/oracle/instantclient_12_1:/opt/oracle/instantclient_12_1/sdk:$PATH
export ORACLE_HOME=/opt/oracle/instantclient_12_1
	</pre><p>
	source it and check the values:
	</p><pre class="screen">
tiian@ubuntu1404-64:/tmp$ . oracle_env.sh 
tiian@ubuntu1404-64:/tmp$ echo $LD_LIBRARY_PATH
/opt/oracle/instantclient_12_1:
tiian@ubuntu1404-64:/tmp$ echo $PATH
/opt/oracle/instantclient_12_1:/opt/oracle/instantclient_12_1/sdk:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games
tiian@ubuntu1404-64:/tmp$ echo $ORACLE_HOME
/opt/oracle/instantclient_12_1
	</pre><p>
	set LIXA environment variables:
	</p><pre class="screen">
tiian@ubuntu1404-64:/tmp$ export PATH=$PATH:/opt/lixa/bin
tiian@ubuntu1404-64:/tmp$ echo $PATH
/opt/oracle/instantclient_12_1:/opt/oracle/instantclient_12_1/sdk:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/opt/lixa/bin
tiian@ubuntu1404-64:/tmp$ export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/opt/lixa/lib
tiian@ubuntu1404-64:/tmp$ echo $LD_LIBRARY_PATH
/opt/oracle/instantclient_12_1::/opt/lixa/lib
	</pre><p>
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp69207168"></a>Build the client program</h3></div></div></div><p>
	Prepare the client (Application Program) using the below commands:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:/tmp$ cp /opt/lixa/share/doc/lixa-X.Y.Z/examples/cobol/EXAMPLE2_ORA.pco .
tiian@ubuntu1404-64:/tmp$ procob EXAMPLE2_ORA.pco

Pro*COBOL: Release 12.1.0.2.0 - Production on Thu Jan 19 23:20:07 2017

Copyright (c) 1982, 2014, Oracle and/or its affiliates.  All rights reserved.

System default option values taken from: /opt/oracle/instantclient_12_1/precomp/admin/pcbcfg.cfg

tiian@ubuntu1404-64:/tmp$ export COB_LDFLAGS=-Wl,--no-as-needed
tiian@ubuntu1404-64:/tmp$ cobc -x $(lixa-config -f -l) \
&gt; -L/opt/oracle/instantclient_12_1 -lclntsh -lnnz12 \
&gt; EXAMPLE2_ORA.cob \
&gt; /opt/oracle/instantclient_12_1/cobsqlintf.o
	  </pre></td></tr></tbody></table></div><p>
	Verify the executable produced by <span class="command"><strong>cobc</strong></span>:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:/tmp$ ldd EXAMPLE2_ORA
    linux-vdso.so.1 =&gt;  (0x00007fff1bb34000)
    libcob.so.1 =&gt; /usr/lib/libcob.so.1 (0x00007f434aaf8000)
    libm.so.6 =&gt; /lib/x86_64-linux-gnu/libm.so.6 (0x00007f434a7f2000)
    libgmp.so.10 =&gt; /usr/lib/x86_64-linux-gnu/libgmp.so.10 (0x00007f434a57d000)
    libncurses.so.5 =&gt; /lib/x86_64-linux-gnu/libncurses.so.5 (0x00007f434a35a000)
    libtinfo.so.5 =&gt; /lib/x86_64-linux-gnu/libtinfo.so.5 (0x00007f434a131000)
    libdb-5.3.so =&gt; /usr/lib/x86_64-linux-gnu/libdb-5.3.so (0x00007f4349d8e000)
    libdl.so.2 =&gt; /lib/x86_64-linux-gnu/libdl.so.2 (0x00007f4349b8a000)
    liblixac.so.0 =&gt; /opt/lixa/lib/liblixac.so.0 (0x00007f434996f000)
    libclntsh.so.12.1 =&gt; /opt/oracle/instantclient_12_1/libclntsh.so.12.1 (0x00007f43469b1000)
    libnnz12.so =&gt; /opt/oracle/instantclient_12_1/libnnz12.so (0x00007f43462a7000)
    libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007f4345ee2000)
    libpthread.so.0 =&gt; /lib/x86_64-linux-gnu/libpthread.so.0 (0x00007f4345cc3000)
    /lib64/ld-linux-x86-64.so.2 (0x00007f434ad36000)
    libgmodule-2.0.so.0 =&gt; /usr/lib/x86_64-linux-gnu/libgmodule-2.0.so.0 (0x00007f4345abf000)
    libglib-2.0.so.0 =&gt; /lib/x86_64-linux-gnu/libglib-2.0.so.0 (0x00007f43457b7000)
    libxml2.so.2 =&gt; /usr/lib/x86_64-linux-gnu/libxml2.so.2 (0x00007f434544f000)
    liblixab.so.0 =&gt; /opt/lixa/lib/liblixab.so.0 (0x00007f4345236000)
    libmql1.so =&gt; /opt/oracle/instantclient_12_1/libmql1.so (0x00007f4344fc0000)
    libipc1.so =&gt; /opt/oracle/instantclient_12_1/libipc1.so (0x00007f4344c41000)
    libons.so =&gt; /opt/oracle/instantclient_12_1/libons.so (0x00007f43449fc000)
    libnsl.so.1 =&gt; /lib/x86_64-linux-gnu/libnsl.so.1 (0x00007f43447e2000)
    librt.so.1 =&gt; /lib/x86_64-linux-gnu/librt.so.1 (0x00007f43445d9000)
    libaio.so.1 =&gt; /lib/x86_64-linux-gnu/libaio.so.1 (0x00007f43443d7000)
    libclntshcore.so.12.1 =&gt; /opt/oracle/instantclient_12_1/libclntshcore.so.12.1 (0x00007f4343e65000)
    libpcre.so.3 =&gt; /lib/x86_64-linux-gnu/libpcre.so.3 (0x00007f4343c26000)
    libz.so.1 =&gt; /lib/x86_64-linux-gnu/libz.so.1 (0x00007f4343a0d000)
    liblzma.so.5 =&gt; /lib/x86_64-linux-gnu/liblzma.so.5 (0x00007f43437eb000)
    libuuid.so.1 =&gt; /lib/x86_64-linux-gnu/libuuid.so.1 (0x00007f43435e5000)
	  </pre></td></tr></tbody></table></div><p>
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp69216784"></a>Set-up LIXA environment</h3></div></div></div><p>
	Set-up the <code class="varname">LIXA_PROFILE</code> environment variable:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:/tmp$ echo $LIXA_PROFILE

tiian@ubuntu1404-64:/tmp$ export LIXA_PROFILE=ORAIC_DYN
tiian@ubuntu1404-64:/tmp$ echo $LIXA_PROFILE
ORAIC_DYN
	  </pre></td></tr></tbody></table></div><p>
      </p><p>
	See <a class="xref" href="#example5_some_checks" title="Some checks before program execution">the section called “Some checks before program execution”</a> for additional details on
	the profile.
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp69222096"></a>Program execution</h3></div></div></div><p>
	It is suggested to open two different terminals: the first one
	connected to Oracle database and the second
	one pointing to the directory where the compiled program
	<code class="filename">EXAMPLE2_ORA</code> lives.
	First teminal session:
	</p><div class="table"><table frame="box"><thead><tr><td>[Sqlplus terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~$ sqlplus hr/hr@lixa_ora_db

SQL*Plus: Release 12.1.0.2.0 Production on Thu Jan 19 23:27:34 2017

Copyright (c) 1982, 2014, Oracle.  All rights reserved.

Last Successful login time: Thu Jan 19 2017 23:26:19 +01:00

Connected to:
Oracle Database 12c Standard Edition Release 12.1.0.2.0 - 64bit Production

SQL&gt; 
	  </pre></td></tr></tbody></table></div><p>
	Second teminal session:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:/tmp$ ls -la EXAMPLE2_ORA*
-rwxrwxr-x 1 tiian tiian 36793 gen 19 23:22 EXAMPLE2_ORA
-rw-rw-r-- 1 tiian tiian 11504 gen 19 23:20 EXAMPLE2_ORA.cob
-rw-rw-r-- 1 tiian tiian 12719 gen 19 23:20 EXAMPLE2_ORA.lis
-rw-rw-r-- 1 tiian tiian  4528 gen 19 23:10 EXAMPLE2_ORA.pco
	  </pre></td></tr></tbody></table></div><p>
	Check the content of <span class="quote">“<span class="quote">COUNTRIES</span>”</span> table before
	program execution:
	</p><div class="table"><table frame="box"><thead><tr><td>[Sqlplus terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
SQL&gt; select * from COUNTRIES where COUNTRY_ID = 'RS';

no rows selected
	  </pre></td></tr></tbody></table></div><p>
	Execute the program:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:/tmp$ ./EXAMPLE2_ORA INSERT
Executing EXAMPLE2_ORA
Inserting a row in the table...
Execution terminated!
	  </pre></td></tr></tbody></table></div><p>
	Check the content of the table again:
	</p><div class="table"><table frame="box"><thead><tr><td>[Sqlplus terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
SQL&gt; select * from COUNTRIES where COUNTRY_ID = 'RS';

CO COUNTRY_NAME      REGION_ID
-- ---------------------------------------- ----------
RS Repubblica San Marino     1
	  </pre></td></tr></tbody></table></div><p>
	The example program inserted the row with REGION_ID=1. You can not 
	insert the same row twice because there is a unique constraint on 
	this table, 
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:/tmp$ ./EXAMPLE2_ORA INSERT
Executing EXAMPLE2_ORA
Inserting a row in the table...
Error reported by Oracle: ORA-00001: unique constraint (HR.COUNTRY_C_ID_PK) violated
	  </pre></td></tr></tbody></table></div><p>
	but you can remove the row using
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:/tmp$ ./EXAMPLE2_ORA DELETE
Executing EXAMPLE2_ORA
Deleting a row from the table...
Execution terminated!
	  </pre></td></tr></tbody></table></div><p>
	Check the table content again:
	</p><div class="table"><table frame="box"><thead><tr><td>[Sqlplus terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
SQL&gt; select * from COUNTRIES where COUNTRY_ID = 'RS';

no rows selected
	  </pre></td></tr></tbody></table></div><p>
	You can check the trace produced by Oracle XA client with 2 completed
	transaction and an interrupted one (unique constraint error):
	</p><pre class="screen">
*** COMPLETED INSERT TRANSACTION ***

ORACLE XA: Version 12.1.0.2.0. RM name = 'Oracle_XA'.

232955.15623.4050298496.0:
xaoopen: xa_info=ORACLE_XA+Acc=P/hr/**+SesTm=30+LogDir=/tmp+threads=true+DbgFl=7+SqlNet=lixa_ora_db+Loose_Coupling=true,rmid=0,flags=0x0

232955.15623.4050298496.0:
xaolgn_help: version#: 185597952 banner: Oracle Database 11g Release 11.1.0.0.0 - Production

232955.15623.4050298496.0:
xaolgn: sqlxrc/sqlxss completed

232955.15623.4050298496.0:
xaolgn2: return XA_OK

232955.15623.4050298496.0:
xaoopen: xaolgn completed

232955.15623.4050298496.0:
xaoopen: return 0

232955.15623.4050298496.0:
ax_reg: xid=0x4c495841-57511f3ca5bd4f70890f31a467c8ff68-54bfbba0e21ccc50c05577130f0b2f6f, rmid=0, flags=0x0

232955.15623.4050298496.0:
OCITransStart: Attempting

232955.15623.4050298496.0:
OCITransStart: Succeeded

232955.15623.4050298496.0:
xaodynpo 2: rmid=0, state=131

232955.15623.4050298496.0:
xaoend: xid=0x4c495841-57511f3ca5bd4f70890f31a467c8ff68-54bfbba0e21ccc50c05577130f0b2f6f, rmid=0, flags=0x4000000

232955.15623.4050298496.0:
OCITransDetach: Attempting

232955.15623.4050298496.0:
OCITransDetach: Succeeded

232955.15623.4050298496.0:
xaoend: return 0

232955.15623.4050298496.0:
xaocommit: xid=0x4c495841-57511f3ca5bd4f70890f31a467c8ff68-54bfbba0e21ccc50c05577130f0b2f6f, rmid=0, flags=0x40000000

232955.15623.4050298496.0:
OCITransCommit: Attempting

232955.15623.4050298496.0:
xaodynpo 2: rmid=0, state=129

232955.15623.4050298496.0:
OCITransCommit: Succeeded

232955.15623.4050298496.0:
xaocommit: rtn 0

232955.15623.4050298496.0:
xaoclose: xa_info=, rmid=0, flags=0x0

232955.15623.4050298496.0:
OCIServerDetach: Attempting

232955.15623.4050298496.0:
OCIServerDetach: Succeeded

232955.15623.4050298496.0:
xaoclose: rtn 0



*** INTERRUPTED INSERT TRANSACTION ***

ORACLE XA: Version 12.1.0.2.0. RM name = 'Oracle_XA'.

233203.15629.223495808.0:
xaoopen: xa_info=ORACLE_XA+Acc=P/hr/**+SesTm=30+LogDir=/tmp+threads=true+DbgFl=7+SqlNet=lixa_ora_db+Loose_Coupling=true,rmid=0,flags=0x0

233203.15629.223495808.0:
xaolgn_help: version#: 185597952 banner: Oracle Database 11g Release 11.1.0.0.0 - Production

233203.15629.223495808.0:
xaolgn: sqlxrc/sqlxss completed

233203.15629.223495808.0:
xaolgn2: return XA_OK

233203.15629.223495808.0:
xaoopen: xaolgn completed

233203.15629.223495808.0:
xaoopen: return 0

233203.15629.223495808.0:
ax_reg: xid=0x4c495841-39f318a6af324a4782d5fe9988e7f7dd-54bfbba0e21ccc50c05577130f0b2f6f, rmid=0, flags=0x0

233203.15629.223495808.0:
OCITransStart: Attempting

233203.15629.223495808.0:
OCITransStart: Succeeded

233203.15629.223495808.0:
xaodynpo 2: rmid=0, state=131



*** COMPLETED DELETE TRANSACTION ***

ORACLE XA: Version 12.1.0.2.0. RM name = 'Oracle_XA'.

233222.15630.4127786624.0:
xaoopen: xa_info=ORACLE_XA+Acc=P/hr/**+SesTm=30+LogDir=/tmp+threads=true+DbgFl=7+SqlNet=lixa_ora_db+Loose_Coupling=true,rmid=0,flags=0x0

233222.15630.4127786624.0:
xaolgn_help: version#: 185597952 banner: Oracle Database 11g Release 11.1.0.0.0 - Production

233222.15630.4127786624.0:
xaolgn: sqlxrc/sqlxss completed

233222.15630.4127786624.0:
xaolgn2: return XA_OK

233222.15630.4127786624.0:
xaoopen: xaolgn completed

233222.15630.4127786624.0:
xaoopen: return 0

233222.15630.4127786624.0:
ax_reg: xid=0x4c495841-3bdca359b8fd4364b425bd6284ec1ceb-54bfbba0e21ccc50c05577130f0b2f6f, rmid=0, flags=0x0

233222.15630.4127786624.0:
OCITransStart: Attempting

233222.15630.4127786624.0:
OCITransStart: Succeeded

233222.15630.4127786624.0:
xaodynpo 2: rmid=0, state=131

233222.15630.4127786624.0:
xaoend: xid=0x4c495841-3bdca359b8fd4364b425bd6284ec1ceb-54bfbba0e21ccc50c05577130f0b2f6f, rmid=0, flags=0x4000000

233222.15630.4127786624.0:
OCITransDetach: Attempting

233222.15630.4127786624.0:
OCITransDetach: Succeeded

233222.15630.4127786624.0:
xaoend: return 0

233222.15630.4127786624.0:
xaocommit: xid=0x4c495841-3bdca359b8fd4364b425bd6284ec1ceb-54bfbba0e21ccc50c05577130f0b2f6f, rmid=0, flags=0x40000000

233222.15630.4127786624.0:
OCITransCommit: Attempting

233222.15630.4127786624.0:
xaodynpo 2: rmid=0, state=129

233222.15630.4127786624.0:
OCITransCommit: Succeeded

233222.15630.4127786624.0:
xaocommit: rtn 0

233222.15630.4127786624.0:
xaoclose: xa_info=, rmid=0, flags=0x0

233222.15630.4127786624.0:
OCIServerDetach: Attempting

233222.15630.4127786624.0:
OCIServerDetach: Succeeded

233222.15630.4127786624.0:
xaoclose: rtn 0
         </pre><p>
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Development_EXAMPLE6_PQL_ORA"></a>An example with PostgreSQL &amp; Oracle</h2></div></div></div><div class="figure"><a id="develop7_cobol"></a><p class="title"><strong>Figure 6.4. Deploy model of an example showing a distributed transaction with PostgreSQL and Oracle</strong></p><div class="figure-contents"><div class="mediaobject"><img src="../images/LIXA_Development_6.png" alt="Deploy model of an example showing a distributed transaction with PostgreSQL and Oracle" /></div></div></div><br class="figure-break" /><p>
      This example shows as
      you can implement DTP (Distributed Transaction Processing) with two
      Resource Managers (PostgreSQL and Oracle Database Server)
      coordinated by the LIXA Transaction Manager.
      It's strongly suggested you have played with the
      examples previously shown in this chapter (see
      <a class="xref" href="#Development_COBOL" title="Chapter 6. Developing COBOL Application Programs">Chapter 6, <em>Developing COBOL Application Programs</em></a>) before starting this more 
      complex one.
    </p><p>
      This example was developed using the following configuration:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	  PostgreSQL 9.3.15 (client and server)
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	  Oracle remote configuration with Instant Client 12.1
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	  Oracle Pro*COBOL compiler as supplied by Oracle Instant Client 12.1
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	  GnuCOBOL compiler and runtime as supplied by Ubuntu 14.04
	</p></li></ul></div><p>
      If you were using a different version you would need to adapt some
      commands to your environment.
    </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	If you did not yet installed the software provided by PostgreSQL,
	please refer to the official PostgreSQL site to download the
	software and to pick-up the information necessary to install 
	and configure
	the database. This manual does not give you information related
	to PostgreSQL technology: it is assumed you already installed and
	configured the database.
      </p><p>
	If you did not yet installed the software provided by Oracle,
	please refer to the official Oracle site to download the
	software and to pick-up the information necessary to install 
	and configure
	the database. This manual does not give you information related
	to Oracle technology: it is assumed you already installed and
	configured the database.
      </p></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
	The LIXA software must be configured to support the PostgreSQL and
	the Oracle Database Server resource managers as explained in 
	<a class="xref" href="#Linking_third_party_resource_managers" title="Linking third party resource managers">the section called “Linking third party resource managers”</a>.
	As a little hint, you should configure LIXA as below:
	</p><pre class="screen">
./configure --with-oracle-lib=/opt/oracle/instantclient_12_1 \
&gt; --with-oracle-include=/opt/oracle/instantclient_12_1/sdk/include \
&gt; --with-postgresql
	</pre><p>
	Please don't forget you must compile and install every time you
	re-configure.
      </p></div><div class="section"><div class="titlepage"></div><p>
	Prepare the environment following the following steps:
	</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	    Set-up PostgreSQL environment
	    as explained in <a class="xref" href="#Development_example5_pql" title="An example with PostgreSQL">the section called “An example with PostgreSQL”</a>
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	    Set-up the Oracle environment as explained in 
	    <a class="xref" href="#Development_setup_Oracle_environment" title="Set-up the Oracle environment (server side)">the section called “Set-up the Oracle environment (server side)”</a>
	    and adapt the command to your Oracle Database Server version
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	    Configure Oracle listener for remote connection as explained in 
	    <a class="xref" href="#Development_configure_Oracle_listener" title="Configure Oracle Listener">the section called “Configure Oracle Listener”</a>
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	    Install and configure Oracle Instant Client as explained in 
	    <a class="xref" href="#Development_install_Oracle_Instant_Client" title="Install and configure Oracle Instant Client">the section called “Install and configure Oracle Instant Client”</a>
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	    Start the LIXA state server
	    as explained in <a class="xref" href="#Development_example5_pql" title="An example with PostgreSQL">the section called “An example with PostgreSQL”</a>
	  </p></li></ul></div><p>
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp69270720"></a>Set environment variables</h3></div></div></div><p>
	Create a shell script file, for example 
	<code class="filename">oracle_env.sh</code>
	with some useful environment variables as below:
	</p><pre class="screen">
tiian@ubuntu1404-64:/tmp$ cat oracle_env.sh 
#!/bin/sh
export LD_LIBRARY_PATH=/opt/oracle/instantclient_12_1:$LD_LIBRARY_PATH
export PATH=/opt/oracle/instantclient_12_1:/opt/oracle/instantclient_12_1/sdk:$PATH
export ORACLE_HOME=/opt/oracle/instantclient_12_1
	</pre><p>
	source it and check the values:
	</p><pre class="screen">
tiian@ubuntu1404-64:/tmp$ . oracle_env.sh 
tiian@ubuntu1404-64:/tmp$ echo $LD_LIBRARY_PATH
/opt/oracle/instantclient_12_1:
tiian@ubuntu1404-64:/tmp$ echo $PATH
/opt/oracle/instantclient_12_1:/opt/oracle/instantclient_12_1/sdk:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games
tiian@ubuntu1404-64:/tmp$ echo $ORACLE_HOME
/opt/oracle/instantclient_12_1
	</pre><p>
	set LIXA environment variables:
	</p><pre class="screen">
tiian@ubuntu1404-64:/tmp$ export PATH=$PATH:/opt/lixa/bin
tiian@ubuntu1404-64:/tmp$ echo $PATH
/opt/oracle/instantclient_12_1:/opt/oracle/instantclient_12_1/sdk:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/opt/lixa/bin
tiian@ubuntu1404-64:/tmp$ export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/opt/lixa/lib
tiian@ubuntu1404-64:/tmp$ echo $LD_LIBRARY_PATH
/opt/oracle/instantclient_12_1::/opt/lixa/lib
	</pre><p>
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp69274608"></a>Build the client program</h3></div></div></div><p>
	Prepare the client (Application Program) using the below commands:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:/tmp$ cp /opt/lixa/share/doc/lixa-X.Y.Z/examples/cobol/EXAMPLE6_PQL_ORA.pco .
tiian@ubuntu1404-64:/tmp$ procob EXAMPLE6_PQL_ORA.pco 
Pro*COBOL: Release 12.1.0.2.0 - Production on Sat Jan 21 20:01:52 2017

Copyright (c) 1982, 2014, Oracle and/or its affiliates.  All rights reserved.

System default option values taken from: /opt/oracle/instantclient_12_1/precomp/admin/pcbcfg.cfg

tiian@ubuntu1404-64:/tmp$ export COB_LDFLAGS=-Wl,--no-as-needed
tiian@ubuntu1404-64:/tmp$ cobc -x $(lixa-config -f -p) \
&gt; -L/opt/oracle/instantclient_12_1 -lclntsh -lnnz12 \
&gt; EXAMPLE6_PQL_ORA.cob /opt/oracle/instantclient_12_1/cobsqlintf.o
	  </pre></td></tr></tbody></table></div><p>
	Verify the executable produced by <span class="command"><strong>cobc</strong></span>:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:/tmp$ ldd EXAMPLE6_PQL_ORA
    linux-vdso.so.1 =&gt;  (0x00007fffdf3fe000)
    libcob.so.1 =&gt; /usr/lib/libcob.so.1 (0x00007eff28bed000)
    libm.so.6 =&gt; /lib/x86_64-linux-gnu/libm.so.6 (0x00007eff288e7000)
    libgmp.so.10 =&gt; /usr/lib/x86_64-linux-gnu/libgmp.so.10 (0x00007eff28672000)
    libncurses.so.5 =&gt; /lib/x86_64-linux-gnu/libncurses.so.5 (0x00007eff2844f000)
    libtinfo.so.5 =&gt; /lib/x86_64-linux-gnu/libtinfo.so.5 (0x00007eff28226000)
    libdb-5.3.so =&gt; /usr/lib/x86_64-linux-gnu/libdb-5.3.so (0x00007eff27e83000)
    libdl.so.2 =&gt; /lib/x86_64-linux-gnu/libdl.so.2 (0x00007eff27c7f000)
    liblixac.so.0 =&gt; /opt/lixa/lib/liblixac.so.0 (0x00007eff27a64000)
    liblixapq.so.0 =&gt; /opt/lixa/lib/liblixapq.so.0 (0x00007eff2785c000)
    libclntsh.so.12.1 =&gt; /opt/oracle/instantclient_12_1/libclntsh.so.12.1 (0x00007eff2489f000)
    libnnz12.so =&gt; /opt/oracle/instantclient_12_1/libnnz12.so (0x00007eff24195000)
    libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007eff23dcf000)
    libpthread.so.0 =&gt; /lib/x86_64-linux-gnu/libpthread.so.0 (0x00007eff23bb1000)
    /lib64/ld-linux-x86-64.so.2 (0x00007eff28e2b000)
    libgmodule-2.0.so.0 =&gt; /usr/lib/x86_64-linux-gnu/libgmodule-2.0.so.0 (0x00007eff239ac000)
    libglib-2.0.so.0 =&gt; /lib/x86_64-linux-gnu/libglib-2.0.so.0 (0x00007eff236a4000)
    libxml2.so.2 =&gt; /usr/lib/x86_64-linux-gnu/libxml2.so.2 (0x00007eff2333d000)
    liblixab.so.0 =&gt; /opt/lixa/lib/liblixab.so.0 (0x00007eff23123000)
    libpq.so.5 =&gt; /usr/lib/libpq.so.5 (0x00007eff22ef4000)
    libmql1.so =&gt; /opt/oracle/instantclient_12_1/libmql1.so (0x00007eff22c7e000)
    libipc1.so =&gt; /opt/oracle/instantclient_12_1/libipc1.so (0x00007eff228ff000)
    libons.so =&gt; /opt/oracle/instantclient_12_1/libons.so (0x00007eff226ba000)
    libnsl.so.1 =&gt; /lib/x86_64-linux-gnu/libnsl.so.1 (0x00007eff224a0000)
    librt.so.1 =&gt; /lib/x86_64-linux-gnu/librt.so.1 (0x00007eff22297000)
    libaio.so.1 =&gt; /lib/x86_64-linux-gnu/libaio.so.1 (0x00007eff22095000)
    libclntshcore.so.12.1 =&gt; /opt/oracle/instantclient_12_1/libclntshcore.so.12.1 (0x00007eff21b23000)
    libpcre.so.3 =&gt; /lib/x86_64-linux-gnu/libpcre.so.3 (0x00007eff218e4000)
    libz.so.1 =&gt; /lib/x86_64-linux-gnu/libz.so.1 (0x00007eff216cb000)
    liblzma.so.5 =&gt; /lib/x86_64-linux-gnu/liblzma.so.5 (0x00007eff214a9000)
    libuuid.so.1 =&gt; /lib/x86_64-linux-gnu/libuuid.so.1 (0x00007eff212a3000)
    libssl.so.1.0.0 =&gt; /lib/x86_64-linux-gnu/libssl.so.1.0.0 (0x00007eff21044000)
    libcrypto.so.1.0.0 =&gt; /lib/x86_64-linux-gnu/libcrypto.so.1.0.0 (0x00007eff20c68000)
    libkrb5.so.3 =&gt; /usr/lib/x86_64-linux-gnu/libkrb5.so.3 (0x00007eff2099c000)
    libcom_err.so.2 =&gt; /lib/x86_64-linux-gnu/libcom_err.so.2 (0x00007eff20798000)
    libgssapi_krb5.so.2 =&gt; /usr/lib/x86_64-linux-gnu/libgssapi_krb5.so.2 (0x00007eff20551000)
    libldap_r-2.4.so.2 =&gt; /usr/lib/x86_64-linux-gnu/libldap_r-2.4.so.2 (0x00007eff202ff000)
    libk5crypto.so.3 =&gt; /usr/lib/x86_64-linux-gnu/libk5crypto.so.3 (0x00007eff200d0000)
    libkrb5support.so.0 =&gt; /usr/lib/x86_64-linux-gnu/libkrb5support.so.0 (0x00007eff1fec4000)
    libkeyutils.so.1 =&gt; /lib/x86_64-linux-gnu/libkeyutils.so.1 (0x00007eff1fcc0000)
    libresolv.so.2 =&gt; /lib/x86_64-linux-gnu/libresolv.so.2 (0x00007eff1faa5000)
    liblber-2.4.so.2 =&gt; /usr/lib/x86_64-linux-gnu/liblber-2.4.so.2 (0x00007eff1f895000)
    libsasl2.so.2 =&gt; /usr/lib/x86_64-linux-gnu/libsasl2.so.2 (0x00007eff1f67a000)
    libgssapi.so.3 =&gt; /usr/lib/x86_64-linux-gnu/libgssapi.so.3 (0x00007eff1f43c000)
    libgnutls.so.26 =&gt; /usr/lib/x86_64-linux-gnu/libgnutls.so.26 (0x00007eff1f17d000)
    libgcrypt.so.11 =&gt; /lib/x86_64-linux-gnu/libgcrypt.so.11 (0x00007eff1eefd000)
    libheimntlm.so.0 =&gt; /usr/lib/x86_64-linux-gnu/libheimntlm.so.0 (0x00007eff1ecf3000)
    libkrb5.so.26 =&gt; /usr/lib/x86_64-linux-gnu/libkrb5.so.26 (0x00007eff1ea6b000)
    libasn1.so.8 =&gt; /usr/lib/x86_64-linux-gnu/libasn1.so.8 (0x00007eff1e7ca000)
    libhcrypto.so.4 =&gt; /usr/lib/x86_64-linux-gnu/libhcrypto.so.4 (0x00007eff1e596000)
    libroken.so.18 =&gt; /usr/lib/x86_64-linux-gnu/libroken.so.18 (0x00007eff1e381000)
    libtasn1.so.6 =&gt; /usr/lib/x86_64-linux-gnu/libtasn1.so.6 (0x00007eff1e16d000)
    libp11-kit.so.0 =&gt; /usr/lib/x86_64-linux-gnu/libp11-kit.so.0 (0x00007eff1df2a000)
    libgpg-error.so.0 =&gt; /lib/x86_64-linux-gnu/libgpg-error.so.0 (0x00007eff1dd25000)
    libwind.so.0 =&gt; /usr/lib/x86_64-linux-gnu/libwind.so.0 (0x00007eff1dafc000)
    libheimbase.so.1 =&gt; /usr/lib/x86_64-linux-gnu/libheimbase.so.1 (0x00007eff1d8ed000)
    libhx509.so.5 =&gt; /usr/lib/x86_64-linux-gnu/libhx509.so.5 (0x00007eff1d6a4000)
    libsqlite3.so.0 =&gt; /usr/lib/x86_64-linux-gnu/libsqlite3.so.0 (0x00007eff1d3eb000)
    libcrypt.so.1 =&gt; /lib/x86_64-linux-gnu/libcrypt.so.1 (0x00007eff1d1b1000)
    libffi.so.6 =&gt; /usr/lib/x86_64-linux-gnu/libffi.so.6 (0x00007eff1cfa9000)
	  </pre></td></tr></tbody></table></div><p>
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp69275504"></a>Set-up LIXA environment</h3></div></div></div><p>
	Set-up the <code class="varname">LIXA_PROFILE</code> environment variable:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:/tmp$ export LIXA_PROFILE=PQL_STA_ORAIC_STA
tiian@ubuntu1404-64:/tmp$ echo $LIXA_PROFILE
PQL_STA_ORAIC_STA
	  </pre></td></tr></tbody></table></div><p>
      </p><p>
	See <a class="xref" href="#example5_some_checks" title="Some checks before program execution">the section called “Some checks before program execution”</a> for additional details on
	the profile.
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp69291840"></a>Program execution</h3></div></div></div><p>
	This example behaves has the sum of 
	<code class="filename">EXAMPLE2_ORA</code> explained in 
	<a class="xref" href="#Development_EXAMPLE2_ORA" title="An example with Oracle Pro*COBOL">the section called “An example with Oracle Pro*COBOL”</a> and of
	<code class="filename">EXAMPLE5_PQL</code> explained in 
	<a class="xref" href="#Development_EXAMPLE5_PQL" title="An example with PostgreSQL">the section called “An example with PostgreSQL”</a>:
	the program tries to insert a row inside the Oracle database and a
	row inside the PostgreSQL database.
	The following paragraphs show the type of behavior that you try.
      </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp69295488"></a>Happy path executions</h4></div></div></div><p>
	  Both databases can insert the row:
	  </p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:/tmp$ ./EXAMPLE6_PQL_ORA INSERT
Executing EXAMPLE6_PQL_ORA
Inserting a row in the table...
Status: +0000000000
PQexec INSERT
Status: +0000000001
Execution terminated!
	    </pre></td></tr></tbody></table></div><p>
	</p><p>
	  Both databases can delete the row:
	  </p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:/tmp$ ./EXAMPLE6_PQL_ORA DELETE
Executing EXAMPLE6_PQL_ORA
Deleting a row from the table...
Status: +0000000000
PQexec DELETE
Status: +0000000001
Execution terminated!
	    </pre></td></tr></tbody></table></div><p>
	</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp69302608"></a>Backed out executions</h4></div></div></div><p>
	  Oracle database can not insert the row:
	  </p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:/tmp$ ./EXAMPLE6_PQL_ORA INSERT
Executing EXAMPLE6_PQL_ORA
Inserting a row in the table...
Status: +0000000000
Error reported by Oracle: ORA-00001: unique constraint (HR.COUNTRY_C_ID_PK) violated
                                                                                                                                                                                                     
Rolling back due to SQL errors...
TXROLLBACK returned value +000000000
TXCLOSE returned value +000000000
	    </pre></td></tr></tbody></table></div><p>
	  and PostgreSQL has not inserted its row due to TXROLLBACK:
	  </p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~$ psql testdb
psql (9.3.15)
Type "help" for help.

testdb=&gt; select * from AUTHORS;
 id | last_name | first_name 
----+-----------+------------
(0 rows)
	    </pre></td></tr></tbody></table></div><p>
	</p><p>
	  PostgreSQL database can not insert the row:
	  </p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:/tmp$ ./EXAMPLE6_PQL_ORA INSERT
Executing EXAMPLE6_PQL_ORA
Inserting a row in the table...
Status: +0000000000
PQexec INSERT
Error in PQexec statement: 
ERROR:  duplicate key value violates unique constraint "authors_pkey"
DETAIL:  Key (id)=(1) already exists.

Rolling back due to SQL errors...
TXROLLBACK returned value +000000000
TXCLOSE returned value +000000000
	    </pre></td></tr></tbody></table></div><p>
	  and Oracle has not inserted its row due to TXROLLBACK:
	  </p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~$ sqlplus hr/hr@lixa_ora_db

SQL*Plus: Release 12.1.0.2.0 Production on Sat Jan 21 21:44:23 2017

Copyright (c) 1982, 2014, Oracle.  All rights reserved.

Last Successful login time: Sat Jan 21 2017 21:42:12 +01:00

Connected to:
Oracle Database 12c Standard Edition Release 12.1.0.2.0 - 64bit Production

SQL&gt; select * from COUNTRIES where COUNTRY_ID = 'RS';

no rows selected
	    </pre></td></tr></tbody></table></div><p>
	</p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp69313616"></a>Conclusion</h4></div></div></div><p>
	  This example shows a real two phase commit transaction using a
	  COBOL program (GnuCOBOL) that accesses an Oracle database
	  (Pro*COBOL) and a PostgreSQL database (direct COBOL calls).
	</p></div></div></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="Development_TC"></a>Chapter 7. Developing C Application Programs with the Transaction Coupling (TC) TX extensions</h1></div></div></div><p>
    This chapter explains how you can develop your own C application using the libraries and tools supplied by the LIXA project.
  </p><p>
    The LIXA project ships with some example C programs that you can find in the <code class="filename">/opt/lixa/share/doc/lixa-X.Y.Z/examples</code> folder after software installation (see <a class="xref" href="#Installation" title="Chapter 2. Installation">Chapter 2, <em>Installation</em></a>).
  </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
    This chapter is focused on the C programming language for the non-standard extensions that has been added to the TX specification to expose some of the XA interface capabilities. All the information supplied in <a class="xref" href="#Development" title="Chapter 5. Developing C Application Programs">Chapter 5, <em>Developing C Application Programs</em></a> still applies.
  </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp69320592"></a>Non-standard TX (Transaction Demarcation) Specification Extensions</h2></div></div></div><p>
      The LIXA project provides extensions to the [<a class="citation" href="#idp70061648"><span class="citation">TXspec</span></a>],
      named Transaction Coupling (TC)
      <a href="#ftn.idp69322192" class="footnote" id="idp69322192"><sup class="footnote">[44]</sup></a>, which can be used in addition to the 
      standard API when developing distributed Application Programs.
    </p><p>
      The API extensions are easy to use and the following C example briefly explains it:
      </p><pre class="programlisting">
#include &lt;tx.h&gt;
        
/* your includes */
        
int main(int argc, char *argv[])
{
    int rc;
        
    if (TX_OK != (rc = tx_open()))
        /* handle error */
        
    if (TX_OK != (rc = tx_begin()))
        /* handle error */
        
    /* do local work against Resource Manager here */
        
    /* suspend the transaction so that work can continue elsewhere */
    if (TX_OK != (rc = tx_end(TX_TMSUSPEND)))
        /* handle error */
        
    /* in another thread or another Application Program work can continue on the same transaction */
    TXINFO txinfo;
    if (TX_OK != (rc = tx_info(&amp;txinfo)))
        /* handle error */
    if (TX_OK != (rc = tx_join(&amp;txinfo.xid)))
        /* handle error */
    if (TX_OK != (rc = tx_end(TX_TMSUCCESS)))
        /* handle error */
        
    /* take up transaction again */
    if (TX_OK != (rc = tx_resume(&amp;txinfo.xid)))
        /* handle error */
        
    /* commit or roll back transaction */
    if (TX_OK != (rc = tx_commit()))
        /* handle errror */
        
    /* shut down */
    tx_close();
}
      </pre><p>
      These are the available C functions:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
          <code class="function">tx_end</code>: manage the global transaction with <em class="parameter"><code>flags</code></em>:
          </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
              <em class="parameter"><code>TX_TMSUSPEND</code></em>: suspend the transaction
            </p></li><li class="listitem" style="list-style-type: disc"><p>
              <em class="parameter"><code>TX_TMSUCCESS</code></em>: mark the portion of work on the global transaction as successful
            </p></li><li class="listitem" style="list-style-type: disc"><p>
              <em class="parameter"><code>TX_TMFAIL</code></em>: mark the portion of work on the global transaction as failed
            </p></li></ul></div><p>
        </p></li><li class="listitem" style="list-style-type: disc"><p>
          <code class="function">tx_join</code>: join a suspended global transaction and continue work
        </p></li><li class="listitem" style="list-style-type: disc"><p>
          <code class="function">tx_resume</code>: resume a suspended global transaction - <span class="emphasis"><em>only from the thread that suspended the original transaction</em></span>
        </p></li></ul></div><p>
    </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp69335584"></a>LIXA library linkage</h3></div></div></div><p>
	See <a class="xref" href="#linkage" title="LIXA library linkage">the section called “LIXA library linkage”</a>.
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp69337520"></a>A TC TX usage example with Oracle</h2></div></div></div><div class="figure"><a id="idp69338704"></a><p class="title"><strong>Figure 7.1. Deployment model of two example applications with Oracle DBMS</strong></p><div class="figure-contents"><div class="mediaobject"><img src="../images/LIXA_Development_15.png" alt="Deployment model of two example applications with Oracle DBMS" /></div></div></div><br class="figure-break" /><p>
      This example shows how two application programs can take part in the same global transaction when using the same Resource Manager coordinated by the LIXA Transaction Manager. Please make sure that you are comfortable with previous sections and examples before setting this up.
    </p><p>
      The following relates to the figure above:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
          <code class="function">Application Program 1</code>: an application developed in C that is able to call functionality exposed by Application Program 2
        </p></li><li class="listitem" style="list-style-type: disc"><p>
          <code class="function">Application Program 2</code>: an application developed in C that is able to fulfil service functionality when called by Application Program 1
        </p></li><li class="listitem" style="list-style-type: disc"><p>
          <code class="function">A1 and B1</code>: includes Resource Manager specific calls during program execution
        </p></li><li class="listitem" style="list-style-type: disc"><p>
          <code class="function">C1</code>: this is any custom protocol developed or used for communication between Application Program 1 and Application Program 2 - <span class="emphasis"><em>it is important to note that to make use of the Transaction Coupling extensions, one would have to share the XID between the programs.</em></span>
        </p></li></ul></div><p>
    </p><p>
      This example was developed using the following configuration:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
          Oracle client and server with Oracle XE 11.2
        </p></li><li class="listitem" style="list-style-type: disc"><p>
          GNU C compiler supplied with CentOS 7.3.1611:
          </p><pre class="screen">
[pieter.jvrensburg@centos-linux tmp]$ cc --version
cc (GCC) 4.8.5 20150623 (Red Hat 4.8.5-11)
          </pre><p>
        </p></li></ul></div><p>
    </p><p>
      The environment should be prepared following these steps:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
          The Oracle environment as explained in <a class="xref" href="#Development_setup_Oracle_environment" title="Set-up the Oracle environment (server side)">the section called “Set-up the Oracle environment (server side)”</a>. Please adapt to your version of Oracle installed.
        </p></li><li class="listitem" style="list-style-type: disc"><p>
          Configuration of the Oracle listener for remote connections as explained in <a class="xref" href="#Development_configure_Oracle_listener" title="Configure Oracle Listener">the section called “Configure Oracle Listener”</a>.
        </p></li><li class="listitem" style="list-style-type: disc"><p>
          Installation and configuration of the Oracle Instance Client (if required) as explained in <a class="xref" href="#Development_install_Oracle_Instant_Client" title="Install and configure Oracle Instant Client">the section called “Install and configure Oracle Instant Client”</a>.
        </p></li></ul></div><p>
    </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
        LIXA must be configured to support the Oracle Resource Manager as explained in <a class="xref" href="#Linking_third_party_resource_managers" title="Linking third party resource managers">the section called “Linking third party resource managers”</a>.
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp69357536"></a>Set the environment variables</h3></div></div></div><p>
        Set up the required environment variables:
        </p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td>
              <pre class="screen">
[pieter.jvrensburg@centos-linux ~]$ export ORACLE_HOME=/u01/app/oracle/product/11.2.0/xe
[pieter.jvrensburg@centos-linux ~]$ export ORACLE_SID=XE
[pieter.jvrensburg@centos-linux ~]$ export NLS_LANG=`$ORACLE_HOME/bin/nls_lang.sh`
[pieter.jvrensburg@centos-linux ~]$ export PATH=$ORACLE_HOME/bin:$PATH
[pieter.jvrensburg@centos-linux ~]$ export LD_LIBRARY_PATH=$ORACLE_HOME/lib:$LD_LIBRARY_PATH
              </pre>
              And for LIXA:
              <pre class="screen">
[pieter.jvrensburg@centos-linux ~]$ export PATH=/opt/lixa/bin:/opt/lixa/sbin:$PATH
[pieter.jvrensburg@centos-linux ~]$ export LD_LIBRARY_PATH=/opt/lixa/lib:$LD_LIBRARY_PATH
              </pre>
            </td></tr></tbody></table></div><p>
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp69363520"></a>Build the client programs</h3></div></div></div><p>
        Prepare the client (Application Program) using the below commands:
        </p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td>
              <pre class="screen">
[pieter.jvrensburg@centos-linux tmp]$ cp /opt/lixa/share/doc/lixa/X.Y.Z/examples/example15_transaction_coupling.c .
[pieter.jvrensburg@centos-linux tmp]$ cc $(lixa-config -c -f -l) -L$ORACLE_HOME/lib -lclntsh -lnnz11 example15_transaction_coupling.c
              </pre>
            </td></tr></tbody></table></div><p>
        Next, verify the executable produced by <span class="command"><strong>cc</strong></span>:
        </p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td>
              <pre class="screen">
[pieter.jvrensburg@centos-linux tmp]$ ldd a.out 
	linux-vdso.so.1 =&gt;  (0x00007ffce4b13000)
	liblixac.so.0 =&gt; /opt/lixa/lib/liblixac.so.0 (0x00007f39938f6000)
	libclntsh.so.11.1 =&gt; /u01/app/oracle/product/11.2.0/xe/lib/libclntsh.so.11.1 (0x00007f39910aa000)
	libnnz11.so =&gt; /u01/app/oracle/product/11.2.0/xe/lib/libnnz11.so (0x00007f3990ce2000)
	libc.so.6 =&gt; /lib64/libc.so.6 (0x00007f3990919000)
	libgmodule-2.0.so.0 =&gt; /lib64/libgmodule-2.0.so.0 (0x00007f3990714000)
	libgthread-2.0.so.0 =&gt; /lib64/libgthread-2.0.so.0 (0x00007f3990512000)
	libxml2.so.2 =&gt; /lib64/libxml2.so.2 (0x00007f39901a8000)
	liblixab.so.0 =&gt; /opt/lixa/lib/liblixab.so.0 (0x00007f398ff8a000)
	libglib-2.0.so.0 =&gt; /lib64/libglib-2.0.so.0 (0x00007f398fc53000)
	libpthread.so.0 =&gt; /lib64/libpthread.so.0 (0x00007f398fa37000)
	libuuid.so.1 =&gt; /lib64/libuuid.so.1 (0x00007f398f831000)
	libm.so.6 =&gt; /lib64/libm.so.6 (0x00007f398f52f000)
	libdl.so.2 =&gt; /lib64/libdl.so.2 (0x00007f398f32b000)
	libnsl.so.1 =&gt; /lib64/libnsl.so.1 (0x00007f398f111000)
	libaio.so.1 =&gt; /lib64/libaio.so.1 (0x00007f398ef0f000)
	/lib64/ld-linux-x86-64.so.2 (0x00007f3993b17000)
	libz.so.1 =&gt; /lib64/libz.so.1 (0x00007f398ecf9000)
	liblzma.so.5 =&gt; /lib64/liblzma.so.5 (0x00007f398ead2000)
              </pre>
            </td></tr></tbody></table></div><p>
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp69373088"></a>Configure the LIXA environment</h3></div></div></div><p>
        Set up the <code class="varname">LIXA_PROFILE</code> environment variable:
        </p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td>
              <pre class="screen">
[pieter.jvrensburg@centos-linux ~]$ export LIXA_PROFILE=ORA_STA
[pieter.jvrensburg@centos-linux ~]$ echo $LIXA_PROFILE 
ORA_STA
              </pre>
            </td></tr></tbody></table></div><p>
      </p><p>
        See <a class="xref" href="#example5_some_checks" title="Some checks before program execution">the section called “Some checks before program execution”</a> for additional information on creating the profile configuration file.
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp69379264"></a>Test program execution</h3></div></div></div><p>
        This shows how a transaction was suspended and resumed within the same thread of control. The example in <code class="filename">example15_transaction_coupling.c</code> does not interact with the actual Oracle database, but loads the switch file.
      </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
          Make sure that the LIXA state server (<code class="filename">lixad</code>) is 
	  running before executing the example application, as explained in 
	  <a class="xref" href="#Development_start_LIXA_server" title="Start the LIXA state server">the section called “Start the LIXA state server”</a>.
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp69383312"></a>Successful execution</h4></div></div></div><p>
          The transaction is suspended, resumed and then rolled back:
          </p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td>
              <pre class="screen">
[pieter.jvrensburg@centos-linux tmp]$ LIXA_CONFIG_FILE=./lixac_conf.xml LIXA_PROFILE=ORA_STA ./a.out 
tx_open(): 0
tx_begin(): 0
tx_end(TMSUSPEND): 0
tx_info(): 1
tx_resume(): 0
tx_commit(): 0
tx_begin(): 0
tx_end(TMSUSPEND): 0
tx_info(): 1
tx_resume(): 0
tx_rollback(): 0
tx_close(): 0
              </pre>
            </td></tr></tbody></table></div><p>
        </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp69388592"></a>Conclusion</h4></div></div></div><p>
          This example shows a basic usage of the extended TX interface API calls. A more elaborate use case will include developing two application programs that communicate with each other and share the XID obtained from <code class="function">tx_info</code> so that the second application program can join the existing transaction.
        </p></div></div></div><div class="footnotes"><br /><hr style="width:100; text-align:left;margin-left: 0" /><div id="ftn.idp69322192" class="footnote"><p><a href="#idp69322192" class="para"><sup class="para">[44] </sup></a>
	  This extension to the TX specification was designed and has been
	  provided to the LIXA project by 
	  <a class="ulink" href="http://www.globetom.com/" target="_top">Globetom</a>
	</p></div></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="Recovery"></a>Chapter 8. Recovery</h1></div></div></div><p>
    This chapter explains some advanced concepts that the LIXA system
    administrator should know to solve some complex issues the XA 
    technology could generate.
    LIXA technology provide two type of recovery:
    </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	  <span class="emphasis"><em>Automatic Recovery</em></span>: 
	  it happens silently and rolls back or commits
	  the transactions that crashed before a consistent point had been
	  reached
      </p></li><li class="listitem" style="list-style-type: disc"><p>
	  <span class="emphasis"><em>Manual Recovery</em></span>:
	  it is invoked by <span class="command"><strong>lixar</strong></span> utility
	  to solve the transactions that cannot be automatically recovered
      </p></li></ul></div><p>	
  </p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp69395680"></a>Automatic (warm) recovery</h2></div></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp69396320"></a>Scenario 1: autonoumos rollback</h3></div></div></div><p>
	If your environment is configured and runs as designed, when an
	Application Program fails an automatic recovery operation fix the
	problem as soon as possible. Below there is a first trivial
	scenarios:
	</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>the Application Program crashes before it reaches the
	      <code class="function">xa_prepare()</code> function
	      (called by <code class="function">tx_commit()</code>)
	    </p></li><li class="listitem" style="list-style-type: disc"><p>the Resource Managers 
	      <span class="emphasis"><em>autonoumosly</em></span> roll back the
	      work in progress and the environment is cleaned up</p></li></ul></div><p>	
	the distributed transaction started but it did not initiated the
	two phase commit protocol: there is no relevant difference between
	this scenario and a single Resource Manager (one phase commit)
	scenario. The LIXA Transaction Manager does <span class="emphasis"><em>not</em></span>
	manage a recovery phase.
	</p><div class="figure"><a id="recover1"></a><p class="title"><strong>Figure 8.1. The Application Program crashes before <code class="function">xa_prepare()</code></strong></p><div class="figure-contents"><div class="mediaobject"><img src="../images/LIXA_Recovery_01.png" alt="The Application Program crashes before xa_prepare()" /></div></div></div><p><br class="figure-break" />
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp69405728"></a>Scenario 2: a second Application Program triggers the recovery action</h3></div></div></div><p>
	The following scenario is slightly different:
	</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>the Application Program crashes after it has passed the
	      <code class="function">xa_prepare()</code> function but before it
	      reaches the <code class="function">xa_commit()</code> function
	    </p></li><li class="listitem" style="list-style-type: disc"><p>the Resource Managers keep the <span class="emphasis"><em>prepared</em></span>
	    transaction <span class="quote">“<span class="quote">in flight</span>”</span> until the Transaction
	    Manager decides the proper recovery action</p></li><li class="listitem" style="list-style-type: disc"><p>an <span class="quote">“<span class="quote">equivalent</span>”</span> Application Program starts 
	      and activates
	      the LIXA Transaction Manager with <code class="function">tx_open()</code>
	    </p></li><li class="listitem" style="list-style-type: disc"><p>the LIXA Transaction Manager discovers there is a
	      <span class="emphasis"><em>prepared</em></span> transaction and establishes that
	      it must commit the transaction
	    </p></li><li class="listitem" style="list-style-type: disc"><p>the second Application Program implicitly and inconsciously
	    started the recovery process of a previously crashed
	    Application Program</p></li></ul></div><p>	
	</p><div class="figure"><a id="recover2"></a><p class="title"><strong>Figure 8.2. The Application Program crashes after <code class="function">xa_prepare()</code></strong></p><div class="figure-contents"><div class="mediaobject"><img src="../images/LIXA_Recovery_02.png" alt="The Application Program crashes after xa_prepare()" /></div></div></div><p><br class="figure-break" />
	The above pattern is the result of the LIXA design: the Transaction
	Manager is not an active component, but it's a passive one and
	is embedded in the Application Program when it links the
	<code class="systemitem">lixac</code> library 
	and activates it with the
	<code class="function">tx_open()</code> function.
      </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	  Depending on the crash time: slightly before the 
	  <span class="emphasis"><em>prepare phase</em></span>,
	  in the middle of the <span class="emphasis"><em>prepare phase</em></span>,
	  after the completion of the <span class="emphasis"><em>prepare phase</em></span>, 
	  the LIXA Transaction Manager chooses a different recovery 
	  operation between
	  <code class="function">xa_commit()</code> and 
	  <code class="function">xa_rollback()</code>.
      </p></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Automatic_recovery_concepts"></a>Automatic recovery concepts</h2></div></div></div><p>
      Automatic (warm) recovery uses the information stored inside the
      LIXA state server to decide which transaction must be recovered and
      how it should be completed (committed or rolled back).
    </p><p>
      The above paragraphs explain what's happen when automatic recovery
      starts and completes (rolls back or commits) the transaction marked
      as <span class="quote">“<span class="quote">recovery pending</span>”</span>.
    </p><p>
      <span class="foreignphrase"><em class="foreignphrase">
	An <span class="quote">“<span class="quote">equivalent</span>”</span> Application Program starts and activates
	the LIXA Transaction Manager with <code class="function">tx_open()</code>.
	The LIXA Transaction Manager autonoumosly coordinates the transaction
	completion and the Application Program is not aware of this
	<span class="quote">“<span class="quote">under the covers</span>”</span> operation.
      </em></span>
    </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Application_Program_equivalence"></a>Application Program equivalence</h3></div></div></div><p>
	From the LIXA Transaction Manager point of view,
	two Application Programs are
	equivalent when they are associated to the same 
	<span class="emphasis"><em>job</em></span>.
      </p><p>
	The job associated to an Application Program can be:
	</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	      the content of the environment variable 
	      <code class="varname">LIXA_JOB</code> if it is set
	    </p></li><li class="listitem" style="list-style-type: disc"><p>
	      a string computed in this way if the environment variable 
	      <code class="varname">LIXA_JOB</code> is <span class="emphasis"><em>not</em></span> set:
	      </p><p>
		<code class="varname">branch qualifier</code> + 
		<span class="quote">“<span class="quote">/</span>”</span> + 
		<code class="systemitem">IP address</code>
	      </p><p>
	      where <code class="varname">branch qualifier</code> is computed as:
	      </p><p>
		<code class="function">MD5</code>(<code class="filename">lixac_conf.xml</code> + 
		$(<code class="varname">LIXA_PROFILE</code>) +
		<code class="function">gethostid()</code>)
	      </p><p>
	    </p></li></ul></div><p>
	An example of <code class="varname">branch qualifier</code> is
	<span class="quote">“<span class="quote">0fc29445b1d4c3f4ed6be2fea20f918b</span>”</span>, while an example of
	job automatically associated to an Application Program is
	<span class="quote">“<span class="quote">0fc29445b1d4c3f4ed6be2fea20f918b/127.0.0.1</span>”</span>
      </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	  If you don't set the environment variable 
	  <code class="varname">LIXA_JOB</code> all the Application Programs that
	  meet this requirements:
	  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
		they use a config file (<code class="filename">lixac_conf.xml</code>)
		with the same content
	    </p></li><li class="listitem" style="list-style-type: disc"><p>
		they use a <code class="varname">LIXA_PROFILE</code> environment variable
		with the same content
	    </p></li><li class="listitem" style="list-style-type: disc"><p>
		they run in a host that returns the same value to
		<code class="function">gethostid()</code> function		
	    </p></li><li class="listitem" style="list-style-type: disc"><p>
		they are calling the LIXA state server from the same 
		IP address	
	    </p></li></ul></div><p>
	  <span class="emphasis"><em>are associated to the same job</em></span>.
      </p></div><p>
	To pick-up the job associated to an Application Program you can
	activate the trace using the bit associated to the label
	<span class="quote">“<span class="quote">LIXA_TRACE_MOD_CLIENT_CONFIG</span>”</span>. Take a look to
	<a class="xref" href="#Tracing_modules" title="Tracing modules">the section called “Tracing modules”</a> for more information.
	This is an excerpt from the trace:
	</p><pre class="screen">
[...]	  
2011-12-03 17:00:59.746036 [6021/1078050640] client_config_job
2011-12-03 17:00:59.746073 [6021/1078050640] client_config_job: acquiring exclusive mutex
2011-12-03 17:00:59.746120 [6021/1078050640] client_config_job: 'LIXA_JOB' environment variable not found, computing job string...
2011-12-03 17:00:59.746175 [6021/1078050640] lixa_job_set_source_ip
2011-12-03 17:00:59.746275 [6021/1078050640] lixa_job_set_source_ip/excp=1/ret_cod=0/errno=0
2011-12-03 17:00:59.746339 [6021/1078050640] client_config_job: job value for this process is '0fc29445b1d4c3f4ed6be2fea20f918b/127.0.0.1      '
2011-12-03 17:00:59.746379 [6021/1078050640] client_config_job: releasing exclusive mutex
2011-12-03 17:00:59.746514 [6021/1078050640] client_config_job/excp=3/ret_cod=0/errno=0
[...]
	</pre><p>
	</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
	    Setting the environment variable <code class="varname">LIXA_JOB</code>
	    allows you to associate any Application Program to a custom
	    user defined job: this may be interesting if you are using a
	    workload balanced environment, this may be dangerous if you
	    associate Application Programs using a different set of
	    Resource Managers to the same job.
	</p></div><p>
      </p><p>
	If you don't set <code class="varname">LIXA_JOB</code> environment variable,
	the default behavior should be strong enought to avoid issues when
	LIXA is used under <span class="quote">“<span class="quote">standard</span>”</span> conditions.
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp69452928"></a>Automatic Recovery in a distributed environment</h3></div></div></div><p>
	The previous section (see 
	<a class="xref" href="#Application_Program_equivalence" title="Application Program equivalence">the section called “Application Program equivalence”</a>) explains the
	conditions that must be met to enable automatic recovery.
	A tipical scenario that needs tuning is a workload balanced
	Application Server environment as is in the below picture:
	</p><div class="figure"><a id="recover3"></a><p class="title"><strong>Figure 8.3. Workload balanced Application Server</strong></p><div class="figure-contents"><div class="mediaobject"><img src="../images/LIXA_Recovery_03.png" alt="Workload balanced Application Server" /></div></div></div><p><br class="figure-break" />
	The same program (<span class="quote">“<span class="quote">Application Program 1</span>”</span>) is
	executed by two different Application Servers: this is a typical
	configuration used to improve service availability and scalability.
	If the Application Server 1 is running in a different host than
	Application Server 2 (this is a de facto standard), by default 
	LIXA will
	associate <span class="emphasis"><em>two different jobs.</em></span>
      </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
	  The LIXA default behavior is not the optimal one when you are
	  using a workload balanced environment.
	</p><p>
	  If the host of Application Server 1 crashed, the Application Program
	  running inside Application Server 2
	  could not automatically recover the transactions in 
	  <span class="quote">“<span class="quote">prepared/in-doubt/recovery pending</span>”</span> of the
	  Application Server 1 because they are associated to a different
	  <span class="emphasis"><em>job</em></span>.
	</p><p>
	  This is a scenario when setting <code class="varname">LIXA_JOB</code> is
	  <span class="emphasis"><em>strongly</em></span> suggested.
      </p></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>
	  When you set the <code class="varname">LIXA_JOB</code> environment variable
	  to control LIXA automatic recovery feature you 
	  <span class="emphasis"><em>must not</em></span> associate the same job to 
	  Application Programs that use different sets of Resource Managers
	  or use the same set of Resource Managers but with different
	  options for any Resource Manager.
	  If you broke this rule, you would probably face difficult to 
	  troubleshoot issues: automatic recovery could fail and you
	  would have to understand why.
      </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Forcing_automatic_recovery"></a>Forcing automatic recovery</h3></div></div></div><p>
	Sometimes you need to force the automatic recovery to happen because
	the crashed Applicaton Program is a <span class="quote">“<span class="quote">one shot</span>”</span> program
	and you can not execute it a second time due to some functional
	constrain.
      </p><p>
	Any application program meeting the requirements described above can
	be used, <span class="command"><strong>lixat</strong></span> utility command too. The following
	example will show you how it works using PostgreSQL and Oracle
	Resource Managers.
      </p><p>
	First of all, you must configure, build and install the LIXA project
	software enabling PostgreSQL, Oracle and crash simulation features:
	</p><pre class="screen">
tiian@ubuntu:~/lixa$ ./configure --with-oracle=/usr/lib/oracle/xe/app/oracle/product/10.2.0/server \
&gt; --with-postgresql-include=/usr/include/postgresql --with-postgresql-lib=/usr/lib \
&gt; --enable-crash
	</pre><p>
	then you must follow the steps described in 
	<a class="xref" href="#Development_example6_pql_ora" title="An example with PostgreSQL &amp; Oracle">the section called “An example with PostgreSQL &amp; Oracle”</a>
	to prepare the scenario environment.
	Open three different terminal sessions as explained in the above
	example, and try to insert/delete a row:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ echo $LIXA_PROFILE
PQL_STA_ORA_DYN
tiian@ubuntu:~/tmp$ echo $ORACLE_HOME
/usr/lib/oracle/xe/app/oracle/product/10.2.0/server
tiian@ubuntu:~/tmp$ echo $ORACLE_SID
XE
tiian@ubuntu:~/tmp$ echo $LD_LIBRARY_PATH
/usr/lib/oracle/xe/app/oracle/product/10.2.0/server/lib:
tiian@ubuntu:~/tmp$ ./example6_pql_ora insert
Inserting a row in the tables...
Oracle INSERT statement executed!
tiian@ubuntu:~/tmp$ ./example6_pql_ora delete
Deleting a row from the tables...
Oracle DELETE statement executed!
	  </pre></td></tr></tbody></table></div><p>
	To simulate a crash after the <code class="function">xa_prepare()</code>
	completed successfully, you can set the environment variable
	<code class="varname">LIXA_CRASH_POINT</code> to the value
	<code class="constant">LIXA_CRASH_POINT_PREPARE_2</code>
	(see <code class="filename">src/common/lixa_crash.h</code>:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ export LIXA_CRASH_POINT=15
tiian@ubuntu:~/tmp$ echo $LIXA_CRASH_POINT
15
tiian@ubuntu:~/tmp$ ./example6_pql_ora insert
Inserting a row in the tables...
Oracle INSERT statement executed!
Aborted
	  </pre></td></tr></tbody></table></div><p>
	You can check there is a prepared (in-doubt) transaction inside Oracle:
	</p><div class="table"><table frame="box"><thead><tr><td>[Oracle terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
SQL&gt; select * from dba_pending_transactions;

  FORMATID
----------
GLOBALID
--------------------------------------------------------------------------------
BRANCHID
--------------------------------------------------------------------------------
1279875137
97DD30A150604AFDBFA5FDC94B611FD5
9BAC7BE1C129EA6EE31F2D71B318120C
	  </pre></td></tr></tbody></table></div><p>
	And the same transaction inside PostgreSQL:
	</p><div class="table"><table frame="box"><thead><tr><td>[PostgreSQL terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
testdb=&gt; select * from pg_prepared_xacts;
 transaction |                                    gid                                       |           prepared            | owner | database 
-------------+------------------------------------------------------------------------------+-------------------------------+-------+----------
         874 | 1279875137.97dd30a150604afdbfa5fdc94b611fd5.9bac7be1c129ea6ee31f2d71b318120c | 2011-12-14 22:02:50.462682+01 | tiian | testdb
	  </pre></td></tr></tbody></table></div><p>
	It is suggested to activate the trace related to the 
	<span class="quote">“<span class="quote">client recovery</span>”</span>
	module (see <a class="xref" href="#Tracing_modules" title="Tracing modules">the section called “Tracing modules”</a>)
	before running <span class="command"><strong>lixat</strong></span> program:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ export LIXA_TRACE_MASK=0x00040000
tiian@ubuntu:~/tmp$ /opt/lixa/bin/lixat 
2011-12-14 22:22:01.740634 [27735/3073944240] client_recovery
2011-12-14 22:22:01.740771 [27735/3073944240] client_recovery: sending 197 bytes ('000191&lt;?xml version="1.0" encoding="UTF-8" ?&gt;&lt;msg level="0" verb="8" step="8"&gt;&lt;client job="9bac7be1c129ea6ee31f2d71b318120c/127.0.0.1      " config_digest="9bac7be1c129ea6ee31f2d71b318120c"/&gt;&lt;/msg&gt;') to the server for step 8
2011-12-14 22:22:01.759352 [27735/3073944240] client_recovery: receiving 561 bytes from the server |&lt;?xml version="1.0" encoding="UTF-8" ?&gt;&lt;msg level="0" verb="8" step="16"&gt;&lt;answer rc="0"/&gt;&lt;client job="9bac7be1c129ea6ee31f2d71b318120c/127.0.0.1      " config_digest="9bac7be1c129ea6ee31f2d71b318120c"&gt;&lt;last_verb_step verb="5" step="16"/&gt;&lt;state finished="0" txstate="3" will_commit="1" will_rollback="0" xid="1279875137.97dd30a150604afdbfa5fdc94b611fd5.9bac7be1c129ea6ee31f2d71b318120c"/&gt;&lt;/client&gt;&lt;rsrmgrs&gt;&lt;rsrmgr rmid="0" next_verb="0" r_state="1" s_state="33" td_state="10"/&gt;&lt;rsrmgr rmid="1" next_verb="0" r_state="1" s_state="33" td_state="20"/&gt;&lt;/rsrmgrs&gt;&lt;/msg&gt;|
2011-12-14 22:22:01.759776 [27735/3073944240] client_recovery_analyze
2011-12-14 22:22:01.759857 [27735/3073944240] client_recovery_analyze: the TX was committing
2011-12-14 22:22:01.759873 [27735/3073944240] client_recovery_analyze: rmid=0, r_state=1, s_state=33, td_state=10
2011-12-14 22:22:01.759884 [27735/3073944240] client_recovery_analyze: rmid=1, r_state=1, s_state=33, td_state=20
2011-12-14 22:22:01.759902 [27735/3073944240] client_recovery_analyze/excp=1/ret_cod=0/errno=0
2011-12-14 22:22:01.759921 [27735/3073944240] client_recovery: transaction '1279875137.97dd30a150604afdbfa5fdc94b611fd5.9bac7be1c129ea6ee31f2d71b318120c' must be committed
2011-12-14 22:22:01.759937 [27735/3073944240] client_recovery_commit
2011-12-14 22:22:01.759971 [27735/3073944240] client_recovery_commit: committing transaction '1279875137.97dd30a150604afdbfa5fdc94b611fd5.9bac7be1c129ea6ee31f2d71b318120c'
2011-12-14 22:22:01.759998 [27735/3073944240] client_recovery_commit: xa_commit for rmid=0, name='PostgreSQL_stareg', xa_name='PostgreSQL[LIXA]'...
2011-12-14 22:22:02.143764 [27735/3073944240] client_recovery_commit: rc=0
2011-12-14 22:22:02.143866 [27735/3073944240] client_recovery_commit: xa_commit for rmid=1, name='OracleXE_dynreg', xa_name='Oracle_XA'...
2011-12-14 22:22:03.188211 [27735/3073944240] client_recovery_commit: rc=0
2011-12-14 22:22:03.188272 [27735/3073944240] client_recovery_commit/excp=1/ret_cod=0/errno=0
2011-12-14 22:22:03.188318 [27735/3073944240] client_recovery: sending 187 bytes ('000181&lt;?xml version="1.0" encoding="UTF-8" ?&gt;&lt;msg level="0" verb="8" step="24"&gt;&lt;recovery failed="0" commit="1"/&gt;&lt;rsrmgrs&gt;&lt;rsrmgr rmid="0" rc="0"/&gt;&lt;rsrmgr rmid="1" rc="0"/&gt;&lt;/rsrmgrs&gt;&lt;/msg&gt;') to the server for step 24
2011-12-14 22:22:03.188496 [27735/3073944240] client_recovery: sending 197 bytes ('000191&lt;?xml version="1.0" encoding="UTF-8" ?&gt;&lt;msg level="0" verb="8" step="8"&gt;&lt;client job="9bac7be1c129ea6ee31f2d71b318120c/127.0.0.1      " config_digest="9bac7be1c129ea6ee31f2d71b318120c"/&gt;&lt;/msg&gt;') to the server for step 8
2011-12-14 22:22:03.228361 [27735/3073944240] client_recovery: receiving 95 bytes from the server |&lt;?xml version="1.0" encoding="UTF-8" ?&gt;&lt;msg level="0" verb="8" step="16"&gt;&lt;answer rc="1"/&gt;&lt;/msg&gt;|
2011-12-14 22:22:03.228544 [27735/3073944240] client_recovery: the server answered LIXA_RC_OBJ_NOT_FOUND; there are no more transactions to recover
2011-12-14 22:22:03.228589 [27735/3073944240] client_recovery/excp=12/ret_cod=0/errno=0
tx_open(): 0
tx_close(): 0
	  </pre></td></tr></tbody></table></div><p>
	You can now verify there are no more 
	<span class="emphasis"><em>prepared/in-doubt</em></span> transactions inside the
	Resource Managers:
	</p><div class="table"><table frame="box"><thead><tr><td>[Oracle terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
SQL&gt; select * from dba_pending_transactions;

no rows selected
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[PostgreSQL terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
testdb=&gt; select * from pg_prepared_xacts;
 transaction | gid | prepared | owner | database 
-------------+-----+----------+-------+----------
(0 rows)
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
	    The automatic (warm) recovery process completed successfully
	    because <span class="command"><strong>./example6_pql_ora</strong></span> and
	    <span class="command"><strong>/opt/lixa/bin/lixat</strong></span> were associated to 
	    <span class="emphasis"><em>the same job</em></span> and the LIXA state server
	    (<span class="command"><strong>lixad</strong></span>) kept the state of the transaction in
	    the meanwhile.
	</p></div><p>
	In the next paragraphs you can explore what happens if the previous
	conditions are not satisfied.
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Manual_cold_recovery"></a>Manual (cold) recovery</h2></div></div></div><p>
      Manual (cold) recovery uses the information provided by the
      Resource Managers querying them using 
      <code class="function">xa_recover()</code>.
      This type of recovery should be used to resolve some unusual
      situations.
    </p><p>
      If, for any reason, the LIXA state server (<span class="command"><strong>lixad</strong></span>)
      forgot the state of a transaction
      <a href="#ftn.idp69500496" class="footnote" id="idp69500496"><sup class="footnote">[45]</sup></a>
      or the transaction is in state <span class="quote">“<span class="quote">recovery failed</span>”</span> because
      a previous automatic (warm) recovery failed, you have to manually
      recover the transaction.
      The procedure to recover a <span class="quote">“<span class="quote">forgotten</span>”</span> transaction is 
      the same you use to recover a <span class="quote">“<span class="quote">recovery failed</span>”</span> one, 
      but additional server side clean-up is suggested for 
      <span class="quote">“<span class="quote">recovery failed</span>”</span> transactions.
    </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Recoverying_forgotten_transactions"></a>Recoverying forgotten transactions</h3></div></div></div><p>
	This example necessitates of the same environment set-up in
	<a class="xref" href="#Forcing_automatic_recovery" title="Forcing automatic recovery">the section called “Forcing automatic recovery”</a>; you must start running
	the example program after you enabled the 
	<code class="varname">LIXA_CRASH_POINT</code> environment variable:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ export LIXA_CRASH_POINT=15
tiian@ubuntu:~/tmp$ echo $LIXA_CRASH_POINT
15
tiian@ubuntu:~/tmp$ ./example6_pql_ora insert
Deleting a row from the tables...
Oracle DELETE statement executed!
Aborted
	  </pre></td></tr></tbody></table></div><p>
	and check there is a recovery pending transaction inside PostgreSQL
	and Oracle Resource Managers:
	</p><div class="table"><table frame="box"><thead><tr><td>[Oracle terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
SQL&gt; select * from dba_pending_transactions;

  FORMATID
----------
GLOBALID
--------------------------------------------------------------------------------
BRANCHID
--------------------------------------------------------------------------------
1279875137
957747F7F37B439EBCEA4146076AD322
9BAC7BE1C129EA6EE31F2D71B318120C
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[PostgreSQL terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
testdb=&gt; select * from pg_prepared_xacts;
 transaction |                                    gid                                       |           prepared            | owner | database 
-------------+------------------------------------------------------------------------------+-------------------------------+-------+----------
         877 | 1279875137.957747f7f37b439ebcea4146076ad322.9bac7be1c129ea6ee31f2d71b318120c | 2011-12-14 22:55:14.973443+01 | tiian | testdb
	  </pre></td></tr></tbody></table></div><p>
	Then you should stop and cold start the <span class="command"><strong>lixad</strong></span> 
	state server:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ sudo su - lixa
lixa@ubuntu:~$ ps -ef|grep lixad|grep -v grep
lixa     24437     1  0 21:19 ?        00:00:00 /opt/lixa/sbin/lixad --daemon
lixa@ubuntu:~$ pkill lixad
lixa@ubuntu:~$ ps -ef|grep lixad|grep -v grep
lixa@ubuntu:~$ ls /opt/lixa/var/
lixad_status1_1  lixad_status2_1  lixad_status3_1  README
lixad_status1_2  lixad_status2_2  lixad_status3_2
lixa@ubuntu:~$ rm /opt/lixa/var/lixad_status*
lixa@ubuntu:~$ ls /opt/lixa/var/
README
lixa@ubuntu:~$ /opt/lixa/sbin/lixad --daemon
lixa@ubuntu:~$ ps -ef|grep lixad|grep -v grep
lixa     28594     1  0 23:00 ?        00:00:00 /opt/lixa/sbin/lixad --daemon
lixa@ubuntu:~$ ls /opt/lixa/var/
lixad_status1_1  lixad_status2_1  lixad_status3_1  README
lixad_status1_2  lixad_status2_2  lixad_status3_2  run.pid
lixa@ubuntu:~$ exit
logout
	  </pre></td></tr></tbody></table></div><p>
	These are the operations you just performed:
	</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	      changed the user from your own to 
	      <code class="systemitem">lixa</code> user
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      checked the <span class="command"><strong>lixad</strong></span> daemon was running
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      stopped the <span class="command"><strong>lixad</strong></span> daemon
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      checked the <span class="command"><strong>lixad</strong></span> daemon was not running
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      checked the <span class="command"><strong>lixad</strong></span>'s state files
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      removed the <span class="command"><strong>lixad</strong></span>'s state files
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      started the <span class="command"><strong>lixad</strong></span> daemon
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      checked the new <span class="command"><strong>lixad</strong></span>'s state files
	  </p></li></ul></div><p>
	Running <span class="command"><strong>lixat</strong></span> does <span class="emphasis"><em>not</em></span>
	automatically recover the transaction:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ export LIXA_TRACE_MASK=0x00040000
tiian@ubuntu:~/tmp$ /opt/lixa/bin/lixat 
tx_open(): 0
tx_close(): 0
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	    The program does not produce trace because
	    <span class="quote">“<span class="quote">client recovery</span>”</span> module is not called (the 
	    state server does not pass information about recovery 
	    pending transactions to the LIXA client library).
	</p></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[Oracle terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
SQL&gt; select * from dba_pending_transactions;

  FORMATID
----------
GLOBALID
--------------------------------------------------------------------------------
BRANCHID
--------------------------------------------------------------------------------
1279875137
957747F7F37B439EBCEA4146076AD322
9BAC7BE1C129EA6EE31F2D71B318120C
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[PostgreSQL terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
testdb=&gt; select * from pg_prepared_xacts;
 transaction |                                    gid                                       |           prepared            | owner | database 
-------------+------------------------------------------------------------------------------+-------------------------------+-------+----------
         877 | 1279875137.957747f7f37b439ebcea4146076ad322.9bac7be1c129ea6ee31f2d71b318120c | 2011-12-14 22:55:14.973443+01 | tiian | testdb
	  </pre></td></tr></tbody></table></div><p>
	The <span class="command"><strong>lixar</strong></span> utility program with <code class="option">-p</code>
	option can be used to list the prepared transactions that can not be
	automatically recovered:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ /opt/lixa/bin/lixar -p
Execution options:
	- print report = yes
	- transaction(s) will be committed = no
	- transaction(s) will be rolled back = no
	- bypass xid branch qualifier check = no
	- bypass xid format id check = no
	- use TMENDRSCAN flag for last xa_recover call = no

Recovery environment:
LIXA_CONFIG_FILE_ENV_VAR = '(null)'
LIXA_PROFILE_ENV_VAR = 'PQL_STA_ORA_DYN'
LIXA_JOB_ENV_VAR = '(null)'

Resource manager list:
rmid=0, lixa_name='PostgreSQL_stareg', xa_name='PostgreSQL[LIXA]'
rmid=1, lixa_name='OracleXE_dynreg', xa_name='Oracle_XA'

Prepared and in-doubt transaction list:
xid='1279875137.957747f7f37b439ebcea4146076ad322.9bac7be1c129ea6ee31f2d71b318120c': rmid=0 rmid=1 
	  </pre></td></tr></tbody></table></div><p>
	it reports some useful information and at the bottom there is the
	list of in-doubt transactions. 
	The transaction is prepared/in-doubt for both Resource Managers;
	sometimes it may be only for a subset of the Resource Managers
	defined by <code class="varname">LIXA_PROFILE</code>.
	You can manually recover the transaction using
	the <code class="option">-x</code> and <code class="option">-r</code> (rollback) or
	<code class="option">-c</code> (commit):
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ /opt/lixa/bin/lixar -p -x 1279875137.957747f7f37b439ebcea4146076ad322.9bac7be1c129ea6ee31f2d71b318120c -r
Execution options:
	- print report = yes
	- transaction to commit/rollback = 1279875137.957747f7f37b439ebcea4146076ad322.9bac7be1c129ea6ee31f2d71b318120c
	- transaction(s) will be committed = no
	- transaction(s) will be rolled back = yes
	- bypass xid branch qualifier check = no
	- bypass xid format id check = no
	- use TMENDRSCAN flag for last xa_recover call = no

Recovery environment:
LIXA_CONFIG_FILE_ENV_VAR = '(null)'
LIXA_PROFILE_ENV_VAR = 'PQL_STA_ORA_DYN'
LIXA_JOB_ENV_VAR = '(null)'

Resource manager list:
rmid=0, lixa_name='PostgreSQL_stareg', xa_name='PostgreSQL[LIXA]'
rmid=1, lixa_name='OracleXE_dynreg', xa_name='Oracle_XA'

Prepared and in-doubt transaction list:
xid='1279875137.957747f7f37b439ebcea4146076ad322.9bac7be1c129ea6ee31f2d71b318120c': rmid=0 rmid=1 

Analizing transaction '1279875137.957747f7f37b439ebcea4146076ad322.9bac7be1c129ea6ee31f2d71b318120c':
xa_rollback --&gt; rmid=0, lixa_name='PostgreSQL_stareg', xa_name='PostgreSQL[LIXA]', rc=0
xa_rollback --&gt; rmid=1, lixa_name='OracleXE_dynreg', xa_name='Oracle_XA', rc=0
	  </pre></td></tr></tbody></table></div><p>
	You can now verify there are no prepared/in-doubt transactions 
	inside the Resource Managers:
	</p><div class="table"><table frame="box"><thead><tr><td>[Oracle terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
SQL&gt; select * from dba_pending_transactions;

no rows selected
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[PostgreSQL terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
testdb=&gt; select * from pg_prepared_xacts;
 transaction | gid | prepared | owner | database 
-------------+-----+----------+-------+----------
(0 rows)
	  </pre></td></tr></tbody></table></div><p>
	We rolled back the deletion so the rows must be in place:
	</p><div class="table"><table frame="box"><thead><tr><td>[Oracle terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
SQL&gt; select * from COUNTRIES where COUNTRY_ID = 'RS';

COUNTR
------
COUNTRY_NAME
--------------------------------------------------------------------------------
 REGION_ID
----------
RS
Repubblica San Marino
	 1
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[PostgreSQL terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
testdb=&gt; select * from AUTHORS;
 id | last_name | first_name 
----+-----------+------------
  1 | Foo       | Bar
	  </pre></td></tr></tbody></table></div><p>
	You can retrieve some help from <span class="command"><strong>lixar</strong></span> with
	<code class="option">-?</code> option:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ /opt/lixa/bin/lixar -?
Usage:
  lixar [OPTION...] - LIXA recovery utility

Help Options:
  -?, --help                      Show help options

Application Options:
  -p, --print                     Print a report of all the prepared and in-doubt transactions compatible with current configuration and profile
  -x, --xid                       Select specified transaction for rollback/commit
  -X, --xid-file                  Select specified file as a list of transaction to rollback/commit
  -c, --commit                    Commit prepared &amp; in-doubt transactions
  -r, --rollback                  Rollback prepared &amp; in-doubt transactions
  -v, --version                   Print package info and exit
  -b, --bypass-bqual-check        Bypass xid branch qualifier check
  -B, --bypass-formatid-check     Bypass xid format id check
  -e, --use-tmendrscan-flag       Use TMENDRSCAN flag for last xa_recover call
	  </pre></td></tr></tbody></table></div><p>
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Recoverying_recovery_failed_transaction"></a>Recoverying a <span class="quote">“<span class="quote">recovery failed</span>”</span> transaction</h3></div></div></div><p>
	This example is quite complex because a 
	<span class="quote">“<span class="quote">recovery failed</span>”</span> transaction is unlikely.
	To create a <span class="quote">“<span class="quote">recovery failed</span>”</span> transaction we 
	will use a special
	Resource Manager, the <span class="quote">“<span class="quote">LIXA monkey</span>”</span> one: it's a
	R.M. we can <span class="quote">“<span class="quote">program</span>”</span> to answer the Transaction Manager
	as we desire. We will emulate an heuristically completed transaction
	to force the LIXA Transaction Manager marking it as
	<span class="quote">“<span class="quote">recovery failed</span>”</span>.
      </p><p>
	Before we can start, you must set-up the same environment already 
	explained in <a class="xref" href="#Recoverying_forgotten_transactions" title="Recoverying forgotten transactions">the section called “Recoverying forgotten transactions”</a>.
	Open three terminals session and prepare the sessions as shown
	below:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ . /usr/lib/oracle/xe/app/oracle/product/10.2.0/server/bin/oracle_env.sh
tiian@ubuntu:~/tmp$ echo $ORACLE_HOME
/usr/lib/oracle/xe/app/oracle/product/10.2.0/server
tiian@ubuntu:~/tmp$ echo $ORACLE_SID
XE
tiian@ubuntu:~/tmp$ export LIXA_PROFILE=MON_STA_PQL_STA_ORA_DYN
tiian@ubuntu:~/tmp$ echo $LIXA_PROFILE
MON_STA_PQL_STA_ORA_DYN
tiian@ubuntu:~/tmp$ echo $LD_LIBRARY_PATH
/usr/lib/oracle/xe/app/oracle/product/10.2.0/server/lib:
	  </pre></td></tr></tbody></table></div><p>
	The specified <code class="varname">LIXA_PROFILE</code> points to a
	configuration with three Resource Managers: LIXA Monkey (a fake
	R.M.), PostgreSQL (static registration) and Oracle DBMS (dynamic
	registration).
	</p><div class="table"><table frame="box"><thead><tr><td>[Oracle terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~$ . /usr/lib/oracle/xe/app/oracle/product/10.2.0/server/bin/oracle_env.sh
tiian@ubuntu:~$ sqlplus "hr/hr"

SQL*Plus: Release 10.2.0.1.0 - Production on Ven Dic 16 16:15:23 2011

Copyright (c) 1982, 2005, Oracle.  All rights reserved.


Connesso a:
Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production

SQL&gt; select * from COUNTRIES where COUNTRY_ID = 'RS';

no rows selected
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[PostgreSQL terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~$ psql testdb
Welcome to psql 8.3.16, the PostgreSQL interactive terminal.

Type:  \copyright for distribution terms
       \h for help with SQL commands
       \? for help with psql commands
       \g or terminate with semicolon to execute query
       \q to quit

testdb=&gt; SELECT * FROM authors;
 id | last_name | first_name 
----+-----------+------------
(0 rows)
	  </pre></td></tr></tbody></table></div><p>
	Start the LIXA state server if it's not active:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ sudo su - lixa
lixa@ubuntu:~$ /opt/lixa/sbin/lixad --daemon
lixa@ubuntu:~$ ps -ef|grep lixad|grep -v grep
lixa      7127     1  0 22:13 ?        00:00:00 /opt/lixa/sbin/lixad --daemon
lixa@ubuntu:~$ exit
logout
	  </pre></td></tr></tbody></table></div><p>
	Before we can start the program execution, we must create a file
	named <code class="filename">monkeyrm.conf</code> in the current directory
	and put the following content inside it:
	</p><div class="table"><table frame="box"><thead><tr><td>[Content of file monkeyrm.conf]</td></tr></thead><tbody><tr><td><pre class="screen">
xa_open/0
xa_start/0
xa_end/0
xa_prepare/0
xa_commit/0
xa_close/0
	  </pre></td></tr></tbody></table></div><p>
	Now you can execute the program to verify it's running as expected;
	we are tracing the module <span class="quote">“<span class="quote">client XA switch</span>”</span>
	(see <a class="xref" href="#Tracing_modules" title="Tracing modules">the section called “Tracing modules”</a>) to verify the 
	LIXA Monkey Resource Manager is properly configured:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ export LIXA_TRACE_MASK=0x00010000
tiian@ubuntu:~/tmp$ ./example6_pql_ora insert 2&gt;&amp;1 | grep monkey
2011-12-15 22:42:20.709697 [22490/3052672768] lixa_monkeyrm_open: xa_info='monkeyrm.conf', rmid=1, flags=0x0
2011-12-15 22:42:20.710101 [22490/3052672768] lixa_monkeyrm_open: creating new first level hash table...
2011-12-15 22:42:20.713087 [22490/3052672768] lixa_monkeyrm_open/g_hash_table_new_full/monkey_status: 0x804caa0
2011-12-15 22:42:20.713361 [22490/3052672768] lixa_monkeyrm_open: creating new second level hash table for tid=3052672768
2011-12-15 22:42:20.713719 [22490/3052672768] lixa_monkeyrm_open/g_hash_table_new_full/slht: 0x804cac8
2011-12-15 22:42:20.713994 [22490/3052672768] lixa_monkeyrm_open: creating new status block for tid=3052672768, rmid=1
2011-12-15 22:42:20.714248 [22490/3052672768] lixa_monkeyrm_open/g_malloc/mss: 0x804e998
2011-12-15 22:42:20.714521 [22490/3052672768] lixa_monkeyrm_open_init
2011-12-15 22:42:20.714783 [22490/3052672768] lixa_monkeyrm_open_init/g_array_new/mss-&gt;records: 0x804c550 
2011-12-15 22:42:20.715139 [22490/3052672768] lixa_monkeyrm_open_init: verb='xa_open'
2011-12-15 22:42:20.715430 [22490/3052672768] lixa_monkeyrm_open_init: appending record verb=1, rc=0
2011-12-15 22:42:20.715691 [22490/3052672768] lixa_monkeyrm_open_init: verb='xa_start'
2011-12-15 22:42:20.715946 [22490/3052672768] lixa_monkeyrm_open_init: appending record verb=3, rc=0
2011-12-15 22:42:20.716340 [22490/3052672768] lixa_monkeyrm_open_init: verb='xa_end'
2011-12-15 22:42:20.716602 [22490/3052672768] lixa_monkeyrm_open_init: appending record verb=4, rc=0
2011-12-15 22:42:20.716864 [22490/3052672768] lixa_monkeyrm_open_init: verb='xa_prepare'
2011-12-15 22:42:20.717123 [22490/3052672768] lixa_monkeyrm_open_init: appending record verb=5, rc=0
2011-12-15 22:42:20.717377 [22490/3052672768] lixa_monkeyrm_open_init: verb='xa_commit'
2011-12-15 22:42:20.717671 [22490/3052672768] lixa_monkeyrm_open_init: appending record verb=6, rc=0
2011-12-15 22:42:20.717937 [22490/3052672768] lixa_monkeyrm_open_init: verb='xa_close'
2011-12-15 22:42:20.718196 [22490/3052672768] lixa_monkeyrm_open_init: appending record verb=2, rc=0
2011-12-15 22:42:20.718519 [22490/3052672768] lixa_monkeyrm_open_init/excp=3/ret_cod=0/errno=0
2011-12-15 22:42:20.718816 [22490/3052672768] lixa_monkeyrm_get_rc
2011-12-15 22:42:20.726862 [22490/3052672768] lixa_monkeyrm_get_rc: verb is 1, XA return code is 0
2011-12-15 22:42:20.727177 [22490/3052672768] lixa_monkeyrm_get_rc/excp=2/ret_cod=0/errno=0
2011-12-15 22:42:20.727429 [22490/3052672768] lixa_monkeyrm_open/excp=4/ret_cod=0/xa_rc=0/errno=0
2011-12-15 22:42:21.022655 [22490/3052672768] lixa_monkeyrm_start: xid='1279875137.7bdcf6c060e14bdba416302661187411.a100c8728292168b21ba7239bffc137d', rmid=1, flags=0x0
2011-12-15 22:42:21.022695 [22490/3052672768] lixa_monkeyrm_get_rc
2011-12-15 22:42:21.022705 [22490/3052672768] lixa_monkeyrm_get_rc: verb is 3, XA return code is 0
2011-12-15 22:42:21.022712 [22490/3052672768] lixa_monkeyrm_get_rc/excp=2/ret_cod=0/errno=0
2011-12-15 22:42:21.022719 [22490/3052672768] lixa_monkeyrm_start/excp=4/ret_cod=0/xa_rc=0/errno=0
2011-12-15 22:42:21.059688 [22490/3052672768] lixa_monkeyrm_end: xid='1279875137.7bdcf6c060e14bdba416302661187411.a100c8728292168b21ba7239bffc137d', rmid=1, flags=0x4000000
2011-12-15 22:42:21.059701 [22490/3052672768] lixa_monkeyrm_get_rc
2011-12-15 22:42:21.059709 [22490/3052672768] lixa_monkeyrm_get_rc: verb is 4, XA return code is 0
2011-12-15 22:42:21.059716 [22490/3052672768] lixa_monkeyrm_get_rc/excp=2/ret_cod=0/errno=0
2011-12-15 22:42:21.059723 [22490/3052672768] lixa_monkeyrm_end/excp=4/ret_cod=0/xa_rc=0/errno=0
2011-12-15 22:42:21.076478 [22490/3052672768] lixa_monkeyrm_prepare: xid='1279875137.7bdcf6c060e14bdba416302661187411.a100c8728292168b21ba7239bffc137d', rmid=1, flags=0x0
2011-12-15 22:42:21.076498 [22490/3052672768] lixa_monkeyrm_get_rc
2011-12-15 22:42:21.076512 [22490/3052672768] lixa_monkeyrm_get_rc: verb is 5, XA return code is 0
2011-12-15 22:42:21.076520 [22490/3052672768] lixa_monkeyrm_get_rc/excp=2/ret_cod=0/errno=0
2011-12-15 22:42:21.076527 [22490/3052672768] lixa_monkeyrm_prepare/excp=4/ret_cod=0/xa_rc=0/errno=0
2011-12-15 22:42:21.098722 [22490/3052672768] lixa_monkeyrm_commit: xid='1279875137.7bdcf6c060e14bdba416302661187411.a100c8728292168b21ba7239bffc137d', rmid=1, flags=0x0
2011-12-15 22:42:21.098747 [22490/3052672768] lixa_monkeyrm_get_rc
2011-12-15 22:42:21.098756 [22490/3052672768] lixa_monkeyrm_get_rc: verb is 6, XA return code is 0
2011-12-15 22:42:21.098764 [22490/3052672768] lixa_monkeyrm_get_rc/excp=2/ret_cod=0/errno=0
2011-12-15 22:42:21.098770 [22490/3052672768] lixa_monkeyrm_commit/excp=4/ret_cod=0/xa_rc=0/errno=0
2011-12-15 22:42:21.102841 [22490/3052672768] lixa_monkeyrm_close: xa_info='', rmid=1, flags=0x0
2011-12-15 22:42:21.102853 [22490/3052672768] lixa_monkeyrm_get_rc
2011-12-15 22:42:21.102862 [22490/3052672768] lixa_monkeyrm_get_rc: verb is 2, XA return code is 0
2011-12-15 22:42:21.102869 [22490/3052672768] lixa_monkeyrm_get_rc/excp=2/ret_cod=0/errno=0
2011-12-15 22:42:21.102877 [22490/3052672768] lixa_monkeyrm_close/excp=4/ret_cod=0/xa_rc=0/errno=0
tiian@ubuntu:~/tmp$ unset LIXA_TRACE_MASK
tiian@ubuntu:~/tmp$ ./example6_pql_ora delete
Deleting a row from the tables...
Oracle DELETE statement executed!
	  </pre></td></tr></tbody></table></div><p>
	Don't forget the clean-up step (last command) before performing
	the next steps.
      </p><p>
	To create a <span class="quote">“<span class="quote">recovery pending</span>”</span> transaction, we are
	going to forcea crash after <code class="function">xa_prepare()</code>
	functions completed successfully:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ export LIXA_CRASH_POINT=15
tiian@ubuntu:~/tmp$ echo $LIXA_CRASH_POINT
15
tiian@ubuntu:~/tmp$ ./example6_pql_ora insert
Inserting a row in the tables...
Oracle INSERT statement executed!
Aborted
tiian@ubuntu:~/tmp$ unset LIXA_CRASH_POINT
tiian@ubuntu:~/tmp$ echo $LIXA_CRASH_POINT

	  </pre></td></tr></tbody></table></div><p>
	Verify there is a prepared/in-doubt transaction inside Oracle:
	</p><div class="table"><table frame="box"><thead><tr><td>[Oracle terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
SQL&gt; select * from dba_pending_transactions;

  FORMATID
----------
GLOBALID
--------------------------------------------------------------------------------
BRANCHID
--------------------------------------------------------------------------------
1279875137
D2F5F0A5C37E485CB44D9FC16E72A33D
68D0E0CCBC6FC4B7FA616DF9AB122395
	  </pre></td></tr></tbody></table></div><p>
	Verify there is a prepared/in-doubt transaction inside PostgreSQL:
	</p><div class="table"><table frame="box"><thead><tr><td>[PostgreSQL terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
testdb=&gt; select * from pg_prepared_xacts;
 transaction |                                    gid                                       |           prepared            | owner | database 
-------------+------------------------------------------------------------------------------+-------------------------------+-------+----------
         964 | 1279875137.d2f5f0a5c37e485cb44d9fc16e72a33d.68d0e0ccbc6fc4b7fa616df9ab122395 | 2011-12-16 16:38:47.921947+01 | tiian | testdb
	  </pre></td></tr></tbody></table></div><p>
	To move the transaction in <span class="quote">“<span class="quote">recovery failed</span>”</span> status
	we emulate
	an <span class="quote">“<span class="quote">heuristically rolled back</span>”</span> in the automatic recovery
	step.
	Edit the file <code class="filename">monkeyrm.conf</code> to code the
	new behavior of the LIXA Monkey R.M.:
	</p><div class="table"><table frame="box"><thead><tr><td>[Content of file monkeyrm.conf]</td></tr></thead><tbody><tr><td><pre class="screen">
xa_open/0
xa_commit/6
xa_close/0
	  </pre></td></tr></tbody></table></div><p>
	Start the <span class="command"><strong>lixat</strong></span> utility command to start an
	<span class="quote">“<span class="quote">automatic (warm) recovery</span>”</span>; trace the
	<span class="quote">“<span class="quote">client recovery</span>”</span> 
	(see <a class="xref" href="#Tracing_modules" title="Tracing modules">the section called “Tracing modules”</a>) module to understand what
	happens:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ export LIXA_TRACE_MASK=0x00040000
tiian@ubuntu:~/tmp$ /opt/lixa/bin/lixat
2011-12-16 16:44:09.970398 [8385/3073862320] client_recovery
2011-12-16 16:44:09.970575 [8385/3073862320] client_recovery: sending 197 bytes ('000191&lt;?xml version="1.0" encoding="UTF-8" ?&gt;&lt;msg level="0" verb="8" step="8"&gt;&lt;client job="68d0e0ccbc6fc4b7fa616df9ab122395/127.0.0.1      " config_digest="68d0e0ccbc6fc4b7fa616df9ab122395"/&gt;&lt;/msg&gt;') to the server for step 8
2011-12-16 16:44:10.007703 [8385/3073862320] client_recovery: receiving 632 bytes from the server |&lt;?xml version="1.0" encoding="UTF-8" ?&gt;&lt;msg level="0" verb="8" step="16"&gt;&lt;answer rc="0"/&gt;&lt;client job="68d0e0ccbc6fc4b7fa616df9ab122395/127.0.0.1      " config_digest="68d0e0ccbc6fc4b7fa616df9ab122395"&gt;&lt;last_verb_step verb="5" step="16"/&gt;&lt;state finished="0" txstate="3" will_commit="1" will_rollback="0" xid="1279875137.d2f5f0a5c37e485cb44d9fc16e72a33d.68d0e0ccbc6fc4b7fa616df9ab122395"/&gt;&lt;/client&gt;&lt;rsrmgrs&gt;&lt;rsrmgr rmid="0" next_verb="0" r_state="1" s_state="33" td_state="10"/&gt;&lt;rsrmgr rmid="1" next_verb="0" r_state="1" s_state="33" td_state="10"/&gt;&lt;rsrmgr rmid="2" next_verb="0" r_state="1" s_state="33" td_state="20"/&gt;&lt;/rsrmgrs&gt;&lt;/msg&gt;|
2011-12-16 16:44:10.008178 [8385/3073862320] client_recovery_analyze
2011-12-16 16:44:10.008229 [8385/3073862320] client_recovery_analyze: the TX was committing
2011-12-16 16:44:10.008242 [8385/3073862320] client_recovery_analyze: rmid=0, r_state=1, s_state=33, td_state=10
2011-12-16 16:44:10.008261 [8385/3073862320] client_recovery_analyze: rmid=1, r_state=1, s_state=33, td_state=10
2011-12-16 16:44:10.008278 [8385/3073862320] client_recovery_analyze: rmid=2, r_state=1, s_state=33, td_state=20
2011-12-16 16:44:10.008303 [8385/3073862320] client_recovery_analyze/excp=1/ret_cod=0/errno=0
2011-12-16 16:44:10.008327 [8385/3073862320] client_recovery: transaction '1279875137.d2f5f0a5c37e485cb44d9fc16e72a33d.68d0e0ccbc6fc4b7fa616df9ab122395' must be committed
2011-12-16 16:44:10.008353 [8385/3073862320] client_recovery_commit
2011-12-16 16:44:10.008388 [8385/3073862320] client_recovery_commit: committing transaction '1279875137.d2f5f0a5c37e485cb44d9fc16e72a33d.68d0e0ccbc6fc4b7fa616df9ab122395'
2011-12-16 16:44:10.008412 [8385/3073862320] client_recovery_commit: xa_commit for rmid=0, name='LIXAmonkey1staRM', xa_name='LIXA Monkey RM (static)'...
2011-12-16 16:44:10.008464 [8385/3073862320] client_recovery_commit: rc=6
2011-12-16 16:44:10.008613 [8385/3073862320] client_recovery_commit: xa_commit for rmid=1, name='PostgreSQL_stareg', xa_name='PostgreSQL[LIXA]'...
2011-12-16 16:44:10.062892 [8385/3073862320] client_recovery_commit: rc=0
2011-12-16 16:44:10.062962 [8385/3073862320] client_recovery_commit: xa_commit for rmid=2, name='OracleXE_dynreg', xa_name='Oracle_XA'...
2011-12-16 16:44:10.275061 [8385/3073862320] client_recovery_commit: rc=0
2011-12-16 16:44:10.275128 [8385/3073862320] client_recovery_commit/excp=1/ret_cod=0/errno=0
2011-12-16 16:44:10.275286 [8385/3073862320] client_recovery: sending 212 bytes ('000206&lt;?xml version="1.0" encoding="UTF-8" ?&gt;&lt;msg level="0" verb="8" step="24"&gt;&lt;recovery failed="1" commit="1"/&gt;&lt;rsrmgrs&gt;&lt;rsrmgr rmid="0" rc="6"/&gt;&lt;rsrmgr rmid="1" rc="0"/&gt;&lt;rsrmgr rmid="2" rc="0"/&gt;&lt;/rsrmgrs&gt;&lt;/msg&gt;') to the server for step 24
2011-12-16 16:44:10.275483 [8385/3073862320] client_recovery: sending 197 bytes ('000191&lt;?xml version="1.0" encoding="UTF-8" ?&gt;&lt;msg level="0" verb="8" step="8"&gt;&lt;client job="68d0e0ccbc6fc4b7fa616df9ab122395/127.0.0.1      " config_digest="68d0e0ccbc6fc4b7fa616df9ab122395"/&gt;&lt;/msg&gt;') to the server for step 8
2011-12-16 16:44:10.315057 [8385/3073862320] client_recovery: receiving 95 bytes from the server |&lt;?xml version="1.0" encoding="UTF-8" ?&gt;&lt;msg level="0" verb="8" step="16"&gt;&lt;answer rc="1"/&gt;&lt;/msg&gt;|
2011-12-16 16:44:10.315261 [8385/3073862320] client_recovery: the server answered LIXA_RC_OBJ_NOT_FOUND; there are no more transactions to recover
2011-12-16 16:44:10.315315 [8385/3073862320] client_recovery/excp=12/ret_cod=0/errno=0
tx_open(): 0
tx_close(): 0
	  </pre></td></tr></tbody></table></div><p>
	The trace gives us a lot of information:
	</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	      <span class="command"><strong>lixat</strong></span> fires an automatic (warm) recovery
	      for transaction XID='1279875137.d2f5f0a5c37e485cb44d9fc16e72a33d.68d0e0ccbc6fc4b7fa616df9ab122395'
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      the transaction must be committed because the crash followed
	      a successful <span class="quote">“<span class="quote">prepare</span>”</span> phase
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      first Resource Manager returns 6:
	      <code class="constant">XA_HEURRB</code> (<span class="quote">“<span class="quote">the transaction branch 
		has been heuristically rolled back</span>”</span>)
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      second and third Resource Managers return 0: XA_OK
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      the client send a <span class="quote">“<span class="quote">recovery failed</span>”</span>
	      message to the state server
	  </p></li></ul></div><p>
	</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	    You could think the LIXA Transaction Manager should have not
	    performed the second and third 
	    <code class="function">xa_commit</code> after a failure with the
	    first Resource Manager. It seems a good idea, but unfortunately
	    it does not add much value because, if applied, it would
	    introduce a behaviour that depends on the order of the
	    operations. The LIXA Transaction Manager tryes to apply a
	    consistent rule: after a successful <code class="function">xa_prepare</code>
	    all the Resource Managers must receive the same command
	    (<code class="function">xa_commit</code>/<code class="function">xa_rollback</code>).
	</p></div><p>
	You can check the (real) Resource Managers status:
	</p><div class="table"><table frame="box"><thead><tr><td>[Oracle terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
SQL&gt; select * from dba_pending_transactions;

no rows selected

SQL&gt; select * from COUNTRIES where COUNTRY_ID = 'RS';

COUNTR
------
COUNTRY_NAME
--------------------------------------------------------------------------------
 REGION_ID
----------
RS
Repubblica San Marino
	 1
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[PostgreSQL terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
testdb=&gt; select * from pg_prepared_xacts;
 transaction | gid | prepared | owner | database 
-------------+-----+----------+-------+----------
(0 rows)

testdb=&gt; SELECT * FROM authors;
 id | last_name | first_name 
----+-----------+------------
  1 | Foo       | Bar
	  </pre></td></tr></tbody></table></div><p>
	Inspecting the system log you can notify there was a problem:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ sudo tail /var/log/daemon.log
Dec 16 16:44:09 ubuntu lixat[8385]: LXC000I this process is starting a new LIXA transaction manager (lixa package version is 0.5.36)
Dec 16 16:44:10 ubuntu lixat[8385]: LXC003C resource manager 'LIXAmonkey1staRM' returned an error (6) while committing (xa_commit) during recovery phase for transaction '1279875137.d2f5f0a5c37e485cb44d9fc16e72a33d.68d0e0ccbc6fc4b7fa616df9ab122395'
Dec 16 16:44:10 ubuntu lixat[8385]: LXC005W unable to recover transaction id '1279875137.d2f5f0a5c37e485cb44d9fc16e72a33d.68d0e0ccbc6fc4b7fa616df9ab122395'; this transaction must be manually recovered and the correlated record(s) must be manually fixed in lixad server status file
Dec 16 16:44:10 ubuntu lixad[8157]: LXD012W a client notified recovery failed condition for the transaction registered in status file 3 and block 1
	  </pre></td></tr></tbody></table></div><p>
	there is a critical message (LXC003C) and two warning messages
	(LXC005W, LXD012W). Pay attention the server notifies the problem 
	(LXD012W) as well as the client (LXC005W).
	To inspect the content of the <span class="quote">“<span class="quote">recovery failed</span>”</span>
	transaction you may dump the state server:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ sudo su - lixa
lixa@ubuntu:~$ pkill lixad
lixa@ubuntu:~$ /opt/lixa/sbin/lixad --dump=u &gt;/tmp/bar
lixa@ubuntu:~$ exit
logout
	  </pre></td></tr></tbody></table></div><p>
	and inspect the content of file <code class="filename">/tmp/bar</code>
	<a href="#ftn.idp69632512" class="footnote" id="idp69632512"><sup class="footnote">[46]</sup></a>:
	</p><div class="table"><table frame="box"><thead><tr><td>[Content of file /tmp/bar]</td></tr></thead><tbody><tr><td><pre class="screen">
========================================================================
Second file ('/opt/lixa/var/lixad_status1_2') will be dumped
Magic number is: 24848 (24848)
Level is: 1 (1)
Last sync timestamp: 2011-12-16T16:38:23.482854+0100
Size: 17 blocks
Used block chain starts at: 16 
Free block chain starts at: 0 (empty chain)
Dumping records following physical order: 0
Dumping records following free block chain: 0
Dumping records following used block chain: 1
------------------------------------------------------------------------

[...] 

------------------------------------------------------------------------
Block: 9, next block in chain: 8
Block type: transaction manager record (transaction header)
	Trnhdr/number of resource managers: 3
	Trnhdr/resource manager blocks are: 10 11 12 
	Trnhdr/arrival time: 2011-12-16T16:26:04.790526+0100
	Trnhdr/local socket address:port is 127.0.0.1:2345
	Trnhdr/peer socket address:port is 127.0.0.1:52251
	Trnhdr/config digest is '68d0e0ccbc6fc4b7fa616df9ab122395'
	Trnhdr/job is '68d0e0ccbc6fc4b7fa616df9ab122395/127.0.0.1      '
	Trnhdr/last (verb, step) are: [ (9,8) (4,8) (4,16) (5,8) (5,16) ]
	Trnhdr/state/finished: 0
	Trnhdr/state/txstate: 3
	Trnhdr/state/will commit: 1
	Trnhdr/state/will rollback: 0
	Trnhdr/state/xid: '1279875137.592cec793be1433d8ffd18574211e0e2.68d0e0ccbc6fc4b7fa616df9ab122395'
	Trnhdr/recoverying block id: 0
	Trnhdr/recovery failed: 1
	Trnhdr/recovery failed time: 2011-12-16T16:29:15.947057+0100
	Trnhdr/recovery commit: 1
------------------------------------------------------------------------
Block: 8, next block in chain: 7
Block type: resource manager record
	Rsrmgr/rmid: 2
	Rsrmgr/state/next_verb: 0
	Rsrmgr/state/xa_r_state: 1
	Rsrmgr/state/dynamic: 0
	Rsrmgr/state/xa_td_state: 10
	Rsrmgr/state/xa_s_state: 33
	Rsrmgr/lixac_conf.xml name: 'LIXAmonkey1staRM'
	Rsrmgr/xa_name: 'LIXA Monkey RM (static)'
	Rsrmgr/xa_open_info: 'monkeyrm.conf'
	Rsrmgr/xa_open_flags: 0x0
	Rsrmgr/xa_open_rc: 0
	Rsrmgr/xa_start_flags: 0x0
	Rsrmgr/xa_start_rc: 0
	Rsrmgr/xa_end_flags: 0x4000000
	Rsrmgr/xa_end_rc: 0
	Rsrmgr/xa_prepare_flags: 0x0
	Rsrmgr/xa_prepare_rc: 0
	Rsrmgr/xa_commit_flags: 0x0
	Rsrmgr/xa_commit_rc: 0
	Rsrmgr/xa_rollback_flags: 0x0
	Rsrmgr/xa_rollback_rc: 0
	Rsrmgr/xa_forget_flags: 0x0
	Rsrmgr/xa_forget_rc: 0
	Rsrmgr/ax_reg_flags: 0x0
	Rsrmgr/ax_reg_rc: 0
	Rsrmgr/ax_unreg_flags: 0x0
	Rsrmgr/ax_unreg_rc: 0
	Rsrmgr/recovery_rc: 6
------------------------------------------------------------------------
Block: 7, next block in chain: 6
Block type: resource manager record
	Rsrmgr/rmid: 1
	Rsrmgr/state/next_verb: 0
	Rsrmgr/state/xa_r_state: 1
	Rsrmgr/state/dynamic: 1
	Rsrmgr/state/xa_td_state: 20
	Rsrmgr/state/xa_s_state: 33
	Rsrmgr/lixac_conf.xml name: 'OracleXE_dynreg'
	Rsrmgr/xa_name: 'Oracle_XA'
	Rsrmgr/xa_open_info: 'Oracle_XA+Acc=P/hr/hr+SesTm=30+LogDir=/tmp+threads=true+DbgFl=7+Loose_Coupling=true'
	Rsrmgr/xa_open_flags: 0x0
	Rsrmgr/xa_open_rc: 0
	Rsrmgr/xa_start_flags: 0x0
	Rsrmgr/xa_start_rc: 0
	Rsrmgr/xa_end_flags: 0x4000000
	Rsrmgr/xa_end_rc: 0
	Rsrmgr/xa_prepare_flags: 0x0
	Rsrmgr/xa_prepare_rc: 0
	Rsrmgr/xa_commit_flags: 0x0
	Rsrmgr/xa_commit_rc: 0
	Rsrmgr/xa_rollback_flags: 0x0
	Rsrmgr/xa_rollback_rc: 0
	Rsrmgr/xa_forget_flags: 0x0
	Rsrmgr/xa_forget_rc: 0
	Rsrmgr/ax_reg_flags: 0x0
	Rsrmgr/ax_reg_rc: 0
	Rsrmgr/ax_unreg_flags: 0x0
	Rsrmgr/ax_unreg_rc: 0
	Rsrmgr/recovery_rc: 0
------------------------------------------------------------------------
Block: 6, next block in chain: 5
Block type: resource manager record
	Rsrmgr/rmid: 0
	Rsrmgr/state/next_verb: 0
	Rsrmgr/state/xa_r_state: 1
	Rsrmgr/state/dynamic: 0
	Rsrmgr/state/xa_td_state: 10
	Rsrmgr/state/xa_s_state: 33
	Rsrmgr/lixac_conf.xml name: 'PostgreSQL_stareg'
	Rsrmgr/xa_name: 'PostgreSQL[LIXA]'
	Rsrmgr/xa_open_info: 'dbname=testdb'
	Rsrmgr/xa_open_flags: 0x0
	Rsrmgr/xa_open_rc: 0
	Rsrmgr/xa_start_flags: 0x0
	Rsrmgr/xa_start_rc: 0
	Rsrmgr/xa_end_flags: 0x4000000
	Rsrmgr/xa_end_rc: 0
	Rsrmgr/xa_prepare_flags: 0x0
	Rsrmgr/xa_prepare_rc: 0
	Rsrmgr/xa_commit_flags: 0x0
	Rsrmgr/xa_commit_rc: 0
	Rsrmgr/xa_rollback_flags: 0x0
	Rsrmgr/xa_rollback_rc: 0
	Rsrmgr/xa_forget_flags: 0x0
	Rsrmgr/xa_forget_rc: 0
	Rsrmgr/ax_reg_flags: 0x0
	Rsrmgr/ax_reg_rc: 0
	Rsrmgr/ax_unreg_flags: 0x0
	Rsrmgr/ax_unreg_rc: 0
	Rsrmgr/recovery_rc: 0
------------------------------------------------------------------------

[...]

========================================================================
First file ('/opt/lixa/var/lixad_status2_1') will be dumped
Magic number is: 24848 (24848)
Level is: 1 (1)
Last sync timestamp: 2011-12-16T16:23:40.512332+0100
Size: 10 blocks
Used block chain starts at: 0 (empty chain)
Free block chain starts at: 1 
Dumping records following physical order: 0
Dumping records following free block chain: 0
Dumping records following used block chain: 1
========================================================================
First file ('/opt/lixa/var/lixad_status3_1') will be dumped
Magic number is: 24848 (24848)
Level is: 1 (1)
Last sync timestamp: 2011-12-16T16:38:47.933099+0100
Size: 10 blocks
Used block chain starts at: 4 
Free block chain starts at: 5 
Dumping records following physical order: 0
Dumping records following free block chain: 0
Dumping records following used block chain: 1
------------------------------------------------------------------------

[...]
	  </pre></td></tr></tbody></table></div><p>
	The chain composed of blocks 9 (transaction manager record) and
	8, 7, 6 (resource manager records) keeps the state of the 
	<span class="quote">“<span class="quote">recovery failed</span>”</span> transaction: 
	<code class="computeroutput">Trnhdr/recovery failed: 1</code>
      </p><p>
	If <span class="quote">“<span class="quote">LIXA Monkey RM</span>”</span> Resource Manager was a real
	Resource Manager, you could manually recovery the transaction
	used the procedure shown in 
	<a class="xref" href="#Recoverying_forgotten_transactions" title="Recoverying forgotten transactions">the section called “Recoverying forgotten transactions”</a>.
	Unfortunately the LIXA Monkey RM is a fake Resource Manager and it
	does not save the state anywhere: it is not able to correctly
	answer to <code class="function">xa_recover()</code> and there is no way to
	show this last step.
      </p><p>
	As a final step, to clean-up the <span class="quote">“<span class="quote">recovery failed</span>”</span>
	state from LIXA state server, you have to recycle it using a special
	option:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ sudo su - lixa
lixa@ubuntu:~$ pkill lixad
lixa@ubuntu:~$ /opt/lixa/sbin/lixad --daemon --clean-failed
lixa@ubuntu:~$ pkill lixad<a href="#ftn.idp69647952" class="footnote" id="idp69647952"><sup class="footnote">[a]</sup></a>
lixa@ubuntu:~$ exit
logout
	  </pre></td></tr></tbody><tbody class="footnotes"><tr><td colspan="50"><div id="ftn.idp69647952" class="footnote"><p><a href="#idp69647952" class="para"><sup class="para">[a] </sup></a>
The LIXA state server is stopped after start-up to guarantee the content
of the state file(s) on the disk are up-to-date before dumping them.
</p></div></td></tr></tbody></table></div><p>
	Dump again the content of the state server:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ sudo su - lixa
lixa@ubuntu:~$ /opt/lixa/sbin/lixad --dump=u &gt;/tmp/bar
lixa@ubuntu:~$ exit
logout
	  </pre></td></tr></tbody></table></div><p>
	and check the content of the dump file again: the blocks 
	10, 9, 8, 7 should not be used or, if re-used, they should be
	related to a different transaction.
      </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
	  <span class="emphasis"><em>Don't use 
	    <code class="option">--clean-failed</code> as a default</em></span>
	  when starting LIXA state server (<span class="command"><strong>lixad</strong></span>):
	  this option should be used only after you inspected the content
	  of the state server and solved any in-doubt transaction.
      </p></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	  Operating this type of recovery can be easier if the LIXA state
	  server is running in <span class="quote">“<span class="quote">maintenance mode</span>”</span>
	  (see <a class="xref" href="#Maintenance_mode_execution" title="Maintenance mode execution">the section called “Maintenance mode execution”</a>): only
	  <span class="command"><strong>lixar</strong></span> can access the online content of the
	  LIXA state server and ordinary clients (Application Program)
	  can not perform transactions. It may be useful using the 
	  state server in <span class="quote">“<span class="quote">maintenance mode</span>”</span>, but only you
	  can decide if your business rules allows it.
      </p></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
	  The LIXA technology <span class="emphasis"><em>does not</em></span> ask you to:
	  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
		recycle the <span class="command"><strong>lixad</strong></span> state server to see
		the current status when dumping the content of the state
		server files (<code class="option">--dump</code> option)
	    </p></li><li class="listitem" style="list-style-type: disc"><p>
		start the <span class="command"><strong>lixad</strong></span> state server in
		<span class="quote">“<span class="quote">maintenance mode</span>”</span> when performing
		<span class="quote">“<span class="quote">manual (cold) recovery</span>”</span>
	    </p></li></ul></div><p>
	  The LIXA technology provides you these functions to simplify the
	  administrative tasks, but deciding which option should be used
	  it's your own responsability. 
      </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Recoverying_transaction_associated_different_job"></a>Recoverying a transaction associated to a different job</h3></div></div></div><p>
	As explained in <a class="xref" href="#Automatic_recovery_concepts" title="Automatic recovery concepts">the section called “Automatic recovery concepts”</a>,
	the <span class="quote">“<span class="quote">automatic (warm) recovery</span>”</span> is automatically
	performed by the LIXA Transaction Manager under the condition of
	<span class="quote">“<span class="quote">Application Program equivalence</span>”</span>
	(see <a class="xref" href="#Application_Program_equivalence" title="Application Program equivalence">the section called “Application Program equivalence”</a>).
      </p><p>
	Sometimes you have to perform a <span class="quote">“<span class="quote">manual (cold) recovery</span>”</span>
	because <span class="quote">“<span class="quote">Application Program equivalence</span>”</span> is no more
	available. This is a typical scenario:
	</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	      an Application Program crashed and its transaction is in
	      <span class="quote">“<span class="quote">in-doubt/prepared (recovery pending) status</span>”</span>
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      the Application Program didn't specify a custom value for
	      the environment variable <code class="varname">LIXA_JOB</code>
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      you changed the content of file
	      <code class="filename">lixac_conf.xml</code>, for example you added a 
	      new profile
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      the MD5 signature of file <code class="filename">lixac_conf.xml</code>
	      changed, the associated <code class="varname">branch qualifier</code>
	      changed, new transactions would be associated to a 
	      different <span class="emphasis"><em>job</em></span>
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      automatic (warm) recovery wouldn't be automatically performed
	      and the transaction becomes a 
	      <span class="quote">“<span class="quote">forgotten</span>”</span> transaction.
	  </p></li></ul></div><p>
	Inspecting the list of recovery pending transaction using
	<span class="command"><strong>lixar -p</strong></span> does not return the desired transaction...
	What's going on?
      </p><p>
	By default, the <span class="command"><strong>lixar</strong></span> utility filters the 
	transactions
	retrieved by the Resource Managers: it keeps only the transactions
	with the same <code class="varname">branch qualifier</code> of the current
	<span class="command"><strong>lixar</strong></span> running instance.
	If you look at <a class="xref" href="#Application_Program_equivalence" title="Application Program equivalence">the section called “Application Program equivalence”</a>,
	you will realize that <span class="command"><strong>lixar</strong></span> 
	retrieves only the transactions started with 
	the same <code class="filename">lixac_conf.xml</code>,
	the same $(<code class="varname">LIXA_PROFILE</code>) and
	the same <code class="function">gethostid()</code>.
	This behaviour helps the system engineer to see only the 
	<span class="quote">“<span class="quote">relevant</span>”</span> subset of the whole
	<span class="quote">“<span class="quote">recovery pending</span>”</span> set.
      </p><p>
	If you are looking for <span class="emphasis"><em>all</em></span> the transactions in
	<span class="quote">“<span class="quote">recovery pending</span>”</span> status currently kept by the
	Resource Managers associated to the current 
	<code class="varname">LIXA_PROFILE</code>, you must specify the
	<code class="option">--bypass-bqual-check</code> (<code class="option">-b</code>) option.
      </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp69682064"></a>Side effect of <code class="filename">lixac_conf.xml</code> changes</h4></div></div></div><p>
	  This paragraph explains a side effect of the behavior explained
	  above.
	</p><p>
	  Suppose the following scenario happens:
	  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
		your LIXA Transaction Manager saved the state of a 
		<span class="quote">“<span class="quote">prepared/recovery pending</span>”</span> transaction inside
		the LIXA state server
	    </p></li><li class="listitem" style="list-style-type: disc"><p>
		you are not aware of the existence of that 
		<span class="quote">“<span class="quote">prepared/recovery pending</span>”</span> transaction
	    </p></li><li class="listitem" style="list-style-type: disc"><p>
		you change the content of <code class="filename">lixac_conf.xml</code>
		file
	    </p></li><li class="listitem" style="list-style-type: disc"><p>
		lately you discover there is a 
		<span class="quote">“<span class="quote">prepared/recovery pending</span>”</span> transaction
		that can not be automatically recovered by LIXA Transaction
		Manager and you perform manual recovery
	    </p></li></ul></div><p>
	  unfortunately, LIXA state server will keep some records related
	  to the manually recovered transaction <span class="quote">“<span class="quote">forever</span>”</span>.
	</p><p>
	  Manual recovery does query LIXA state server to retrieve the list
	  of <span class="quote">“<span class="quote">prepared/recovery pending</span>”</span> transactions because
	  it is designed to solve the issue <span class="quote">“<span class="quote">state server does not
	    have information</span>”</span> related to some transactions.
	  </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	      The <span class="command"><strong>lixad</strong></span> option 
	      <code class="option">--clean-failed</code> explained in 
	      <a class="xref" href="#Recoverying_recovery_failed_transaction" title="Recoverying a “recovery failed” transaction">the section called “Recoverying a <span class="quote">“<span class="quote">recovery failed</span>”</span> transaction”</a>
	      does not help because the transaction was not in
	      <span class="quote">“<span class="quote">recovery failed</span>”</span> state.
	  </p></div><p>
	  </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
	      At the time of this writing <span class="emphasis"><em>there is not</em></span>
	      a specific tool to remove this type of <span class="quote">“<span class="quote">ghosts</span>”</span>
	      from LIXA state server, you can clean-up those records
	      using a cold start as explained in 
	      <a class="xref" href="#Recoverying_forgotten_transactions" title="Recoverying forgotten transactions">the section called “Recoverying forgotten transactions”</a>.
	      You must pay attention to avoid <span class="quote">“<span class="quote">in flight transaction
		purge</span>”</span>.
	  </p></div><p>
	</p><p>
	  In a future release this behavior could be improved if any user
	  asked for it.
	</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp69696112"></a>Recoverying a transaction managed by a different Transaction Manager</h3></div></div></div><p>
	The LIXA project technology can help you dealing with a different
	Transaction Manager 
	(see <a class="xref" href="#Transaction_Manager_and_Transaction_Monitor" title="Transaction Manager and Transaction Monitor">the section called “Transaction Manager and Transaction Monitor”</a>) 
	too: the <span class="command"><strong>lixar</strong></span> utility program can be used to
	inspect (and manually recover) a transaction managed by a different
	Transaction Manager using two command options together:
	</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	      <code class="option">--bypass-bqual-check</code> (<code class="option">-b</code>):
	      to bypass branch qualifier based filtering
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      <code class="option">--bypass-formatid-check</code> (<code class="option">-B</code>):
	      to bypass format ID based filtering
	  </p></li></ul></div><p>
	If you use the above command options together, 
	<span class="command"><strong>lixar</strong></span> utility program will inspect (and eventually
	commit/rollback) any XA transaction known by the Resource Managers
	associated to the current <code class="varname">LIXA_PROFILE</code>.
      </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	  It's <span class="emphasis"><em>your own</em></span> responsability to define a
	  LIXA profile that's compatible with the configuration of the
	  third party Transaction Manager used when managing the transaction:
	  it <span class="emphasis"><em>must</em></span> contain the <span class="emphasis"><em>same</em></span>
	  Resource Managers in the <span class="emphasis"><em>same</em></span> order
	  with the <span class="emphasis"><em>same</em></span> options.
      </p></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>
	  LIXA software is libre/free/open source software and you use it
	  <span class="emphasis"><em>exclusively and consciously without any
	  warranty at your own risk</em></span>.
	  Using LIXA software technology will probably put you in an
	  <span class="emphasis"><em>unsupported</em></span> state regarding to the
	  third party Transaction Manager supplier.
      </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp69709840"></a>Picking up the LIXA format id and branch qualifier</h3></div></div></div><p>
	In the previous sections we have dealt with 
	<span class="quote">“<span class="quote">format id</span>”</span> and <span class="quote">“<span class="quote">branch qualifier</span>”</span>;
	you could ask 
	<span class="quote">“<span class="quote">How can I discover the
	  <span class="quote">‘<span class="quote">format id</span>’</span> and the <span class="quote">‘<span class="quote">branch qualifier</span>’</span>
	  branch qualifier associated to my own Application Program?</span>”</span>
      </p><p>
	The easiest way to pick-up them is to use <span class="command"><strong>lixat</strong></span>
	utility program using the <span class="emphasis"><em>same</em></span>
	<code class="varname">LIXA_PROFILE</code> you use when running your
	Application Program:
	</p><pre class="screen">
tiian@ubuntu:~/src/lixa$ sudo su - lixa
lixa@ubuntu:~$ /opt/lixa/sbin/lixad --daemon
lixa@ubuntu:~$ ps -ef|grep lixad|grep -v grep
lixa      8122     1  0 23:02 ?        00:00:00 /opt/lixa/sbin/lixad --daemon
lixa@ubuntu:~$ exit
logout
tiian@ubuntu:~/src/lixa$ /opt/lixa/bin/lixat -c
tx_open(): 0
tx_begin(): 0
tx_info(): 1
	xid/formatID.gtrid.bqual = 1279875137.56af7a66398f4eca82b8826fe10165ad.9e4c11057107c73366c9fc421eaa85ca
tx_commit(): 0
tx_close(): 0
tiian@ubuntu:~/src/lixa$ /opt/lixa/bin/lixat -c
tx_open(): 0
tx_begin(): 0
tx_info(): 1
	xid/formatID.gtrid.bqual = 1279875137.218f05b733fb4bc1aa3d21eeaf01fbab.9e4c11057107c73366c9fc421eaa85ca
tx_commit(): 0
tx_close(): 0	  
	</pre><p>
	From the above terminal output:
	</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	      <span class="quote">“<span class="quote">formatID</span>”</span> is constant and the LIXA Transaction
	      Manager uses the exadecimal value 1279875137 (that's the 
	      ASCII sequence of string <span class="quote">“<span class="quote">LIXA</span>”</span>)
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      <span class="quote">“<span class="quote">branch qualifier</span>”</span> is computed as explained in
	      <a class="xref" href="#Application_Program_equivalence" title="Application Program equivalence">the section called “Application Program equivalence”</a> and the
	      value in the above example is
	      <span class="quote">“<span class="quote">9e4c11057107c73366c9fc421eaa85ca</span>”</span>
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      <span class="quote">“<span class="quote">global transaction id</span>”</span> must be different for
	      any transaction and you can see two different values in the
	      above examples (it's computed using
	      <code class="function">uuid_generate()</code> function).
	  </p></li></ul></div><p>
      </p><p>
	If you were interested in retrieving them programmatically
	(from your own C language program) you could use the standard
	<code class="function">tx_info()</code> function that returns a 
	<span class="type">TXINFO</span> struct ([<a class="citation" href="#idp70061648"><span class="citation">TXspec</span></a>]).
	Please pay attention the
	<span class="type">XID</span> struct contains <span class="emphasis"><em>binary data</em></span>
	(it does not contain ASCII data).
      </p></div></div><div class="footnotes"><br /><hr style="width:100; text-align:left;margin-left: 0" /><div id="ftn.idp69500496" class="footnote"><p><a href="#idp69500496" class="para"><sup class="para">[45] </sup></a>
	  This should never happen: it could be a bug in LIXA project
	  software or it might be the consequence of a 
	  <span class="quote">“<span class="quote">cold start</span>”</span> (you removed the state files) of
	  <span class="command"><strong>lixad</strong></span>
      </p></div><div id="ftn.idp69632512" class="footnote"><p><a href="#idp69632512" class="para"><sup class="para">[46] </sup></a>
	    The state server can be analyzed without stopping it
	    (<span class="command"><strong>pkill lixad</strong></span>), but it may happen you will
	    not see the current content because the state server 
	    has not yet synchronized
	    the state file(s). If the LIXA state server is processing many
	    transactions per second you will probably see an up-to-date
	    state, but if it was <span class="quote">“<span class="quote">sleeping</span>”</span> you wouldn't.
	</p></div></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="idp69725280"></a>Chapter 9. In Depth</h1></div></div></div><p>
    This chapter explains some internal details you can be interested in
    when you are dealing with complex environments.
  </p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp69726624"></a>Logging</h2></div></div></div><p>
      The LIXA project software uses standard UNIX logging 
      <code class="function">syslog()</code> function but it does not
      set a specific <em class="parameter"><code>facility</code></em>
      using the <code class="function">openlog()</code> function.
      The final destination of the log messages depends on the configuration
      of the standard UNIX logging; Ubuntu 8.04, for examples, sends the
      messages to file <code class="filename">/var/log/daemon.log</code>. This should
      be in accordance with the content of the <code class="function">syslog</code>
      man page <span class="quote">“<span class="quote">LOG_DAEMON
        system daemons without separate facility value</span>”</span>.
    </p><p>
      The messages produced by the LIXA project software are documented in
      the file <code class="filename">src/common/lixa_syslog.h</code>
    </p><p>
      The messages produced by the LIXA project software use two different
      prefixes: <span class="quote">“<span class="quote">LXC</span>”</span> for
      <code class="systemitem">lixac</code> (client library) and
      <span class="quote">“<span class="quote">LXD</span>”</span> for
      <span class="command"><strong>lixad</strong></span> (state server).
      Try the following example:
      </p><pre class="screen">
tiian@ubuntu:~$ ps -ef|grep lixad|grep -v grep
tiian@ubuntu:~$ /opt/lixa/bin/lixat
tx_open(): -7	
      </pre><p>
      inspecting the log file <code class="filename">/var/log/daemon.log</code>
      you should find out something like this:
      </p><pre class="screen">
Dec  4 18:16:10 ubuntu lixat[6538]: LXC000I this process is starting a new LIXA transaction manager (lixa package version is 0.5.36)
Dec  4 18:16:10 ubuntu lixat[6538]: LXC002E unable to connect to LIXA server at address 127.0.0.1, port 2345
      </pre><p>
      the <span class="command"><strong>lixat</strong></span> command is running as expected because
      the state server is not active.
      To see the messages produced by the state server you can try the
      following commands:
      </p><pre class="screen">
tiian@ubuntu:~$ sudo su - lixa
lixa@ubuntu:~$ /opt/lixa/sbin/lixad -d
lixa@ubuntu:~$ pkill lixad
lixa@ubuntu:~$ exit
logout
      </pre><p>
      inspecting the log file <code class="filename">/var/log/daemon.log</code>
      you should find out something like this:
      </p><pre class="screen">
Dec  4 18:22:46 ubuntu lixad[6694]: LXD000N this process is starting a new LIXA server (lixa package version is 0.5.36)
Dec  4 18:22:46 ubuntu lixad[6697]: LXD014N LIXA server entered daemon status
Dec  4 18:22:49 ubuntu lixad[6697]: LXD019N received signal 15, server immediate shutdown in progress...
Dec  4 18:22:49 ubuntu lixad[6697]: LXD006N server terminated activities
      </pre><p>
      The log messages are differentiated by 
      <em class="parameter"><code>priority</code></em>; there is a direct
      link between the letter in the seventh position and the severity of
      the message:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p><span class="emphasis"><em>D</em></span> : <code class="constant">LOG_DEBUG</code></p></li><li class="listitem" style="list-style-type: disc"><p><span class="emphasis"><em>I</em></span> : <code class="constant">LOG_INFO</code></p></li><li class="listitem" style="list-style-type: disc"><p><span class="emphasis"><em>N</em></span> : <code class="constant">LOG_NOTICE</code></p></li><li class="listitem" style="list-style-type: disc"><p><span class="emphasis"><em>W</em></span> : <code class="constant">LOG_WARNING</code></p></li><li class="listitem" style="list-style-type: disc"><p><span class="emphasis"><em>E</em></span> : <code class="constant">LOG_ERR</code></p></li><li class="listitem" style="list-style-type: disc"><p><span class="emphasis"><em>C</em></span> : <code class="constant">LOG_CRIT</code></p></li></ul></div><p>
      If LIXA software was logging too much in your production environment
      you can configure the system log facility
      (<code class="filename">/etc/syslog.conf</code>) to filter some messages, but
      this tuning operation should not be necessary because the LIXA software
      does not use the system log facility as a debugging tool: look at
      <a class="xref" href="#Tracing" title="Tracing">the section called “Tracing”</a> to discover how debug messages are managed.
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Tracing"></a>Tracing</h2></div></div></div><p>
      The LIXA project can produce a lot of traces when the software is 
      running; the tracing functions are included in the code by default but
      you can disable them when you configure the software before the build 
      phase:
      </p><pre class="screen">
	./configure --disable-trace
	make
	...
      </pre><p>
      </p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>
	  Excluding tracing functions can reduce CPU and memory usage when
	  the software is running, but you should disable tracing 
	  <span class="emphasis"><em>only if you are really sure about it:
	  </em></span>without tracing you have no instruments
	  to understand what's happening inside LIXA code when it's running.
      </p></div><p>
      In the case you didn't disable the tracing feature at build time (see
      above), you could activate the message production when you need it.
    </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="Tracing_modules"></a>Tracing modules</h3></div></div></div><p>
	The trace messages produced by LIXA code are divided by 
	<span class="emphasis"><em>modules</em></span>: you can activate the trace messages for
	one or more modules. There is not a concept of <span class="quote">“<span class="quote">severity</span>”</span>
	for the trace messages: if you activate the trace for a module, it
	will print all the trace messages of that module.
      </p><p>
	The table below shows how the LIXA software is partitioned in modules:
	</p><div class="table"><a id="idp69757888"></a><p class="title"><strong>Table 9.1. Tracing module flags</strong></p><div class="table-contents"><table summary="Tracing module flags" border="1"><colgroup><col /><col /><col /><col /></colgroup><thead><tr><th align="center">Module Trace Label</th><th align="center">Hex Flag</th><th align="center">Component</th><th align="center">Function</th></tr></thead><tbody><tr><td align="left">LIXA_TRACE_MOD_SERVER</td><td align="left">0x00000001</td><td align="left"><span class="command"><strong>lixad</strong></span> (state server)</td><td align="left">main program</td></tr><tr><td align="left">LIXA_TRACE_MOD_SERVER_CONFIG</td><td align="left">0x00000002</td><td align="left"><span class="command"><strong>lixad</strong></span> (state server)</td><td align="left">configuration: config file parsing and environment 
		  variable detection</td></tr><tr><td align="left">LIXA_TRACE_MOD_SERVER_LISTENER</td><td align="left">0x00000004</td><td align="left"><span class="command"><strong>lixad</strong></span> (state server)</td><td align="left">network listener and signal handler</td></tr><tr><td align="left">LIXA_TRACE_MOD_SERVER_MANAGER</td><td align="left">0x00000008</td><td align="left"><span class="command"><strong>lixad</strong></span> (state server)</td><td align="left">session client manager, thread manager, 
		  network I/O manager</td></tr><tr><td align="left">LIXA_TRACE_MOD_SERVER_STATUS</td><td align="left">0x00000010</td><td align="left"><span class="command"><strong>lixad</strong></span> (state server)</td><td align="left">persistent state</td></tr><tr><td align="left">LIXA_TRACE_MOD_SERVER_XA</td><td align="left">0x00000040</td><td align="left"><span class="command"><strong>lixad</strong></span> (state server)</td><td align="left">XA logic called by client</td></tr><tr><td align="left">LIXA_TRACE_MOD_SERVER_REPLY</td><td align="left">0x00000080</td><td align="left"><span class="command"><strong>lixad</strong></span> (state server)</td><td align="left">replies to client messages</td></tr><tr><td align="left">LIXA_TRACE_MOD_SERVER_RECOVERY</td><td align="left">0x00000100</td><td align="left"><span class="command"><strong>lixad</strong></span> (state server)</td><td align="left">logic necessary to answer the client recovery 
		  calls</td></tr><tr><td align="left">LIXA_TRACE_MOD_CLIENT_TX</td><td align="left">0x00001000</td><td align="left"><code class="systemitem">lixac</code>
		  (client library)</td><td align="left">transaction demarcation (TX) functions:
		  <code class="function">tx_open()</code>,
		  <code class="function">tx_begin()</code>, ...</td></tr><tr><td align="left">LIXA_TRACE_MOD_CLIENT_XA</td><td align="left">0x00002000</td><td align="left"><code class="systemitem">lixac</code>
		  (client library)</td><td align="left">XA function wrapper:
		  <code class="function">xa_open()</code>,
		  <code class="function">xa_start()</code>, 
		  <code class="function">ax_reg()</code>, ...</td></tr><tr><td align="left">LIXA_TRACE_MOD_CLIENT_CONN</td><td align="left">0x00004000</td><td align="left"><code class="systemitem">lixac</code>
		  (client library)</td><td align="left">function necessary to connect to the state server 
		  (<span class="command"><strong>lixad</strong></span>)</td></tr><tr><td align="left">LIXA_TRACE_MOD_CLIENT_CONFIG</td><td align="left">0x00008000</td><td align="left"><code class="systemitem">lixac</code>
		  (client library)</td><td align="left">configuration: config file parsing and environment 
		  variable detection</td></tr><tr><td align="left">LIXA_TRACE_MOD_CLIENT_XA_SWITCH</td><td align="left">0x00010000</td><td align="left"><code class="systemitem">lixac</code>
		  (client library)</td><td align="left">XA switch file implementation of the dummy resource
		managers provided by LIXA and of the XA wrappers for the
		resource managers without a standard switch file</td></tr><tr><td align="left">LIXA_TRACE_MOD_CLIENT_STATUS</td><td align="left">0x00020000</td><td align="left"><code class="systemitem">lixac</code>
		  (client library)</td><td align="left">client status management</td></tr><tr><td align="left">LIXA_TRACE_MOD_CLIENT_RECOVERY</td><td align="left">0x00040000</td><td align="left"><code class="systemitem">lixac</code>
		  (client library)</td><td align="left">warm and cold recovery of the transaction(s)</td></tr><tr><td align="left">LIXA_TRACE_MOD_CLIENT_GENERIC</td><td align="left">0x00080000</td><td align="left"><code class="systemitem">lixac</code>
		  (client library)</td><td align="left">generic client functions</td></tr><tr><td align="left">LIXA_TRACE_MOD_COMMON_CONFIG</td><td align="left">0x01000000</td><td align="left"><code class="systemitem">lixab</code>
		  (common base library)</td><td align="left">configuration stuff common to all components</td></tr><tr><td align="left">LIXA_TRACE_MOD_COMMON_XML_MSG</td><td align="left">0x02000000</td><td align="left"><code class="systemitem">lixab</code>
		  (common base library)</td><td align="left">functions related to XML messages serialization and
		deserialization</td></tr><tr><td align="left">LIXA_TRACE_MOD_COMMON_STATUS</td><td align="left">0x04000000</td><td align="left"><code class="systemitem">lixab</code>
		  (common base library)</td><td align="left">convenience functions used to manage the status on
		client and server side</td></tr><tr><td align="left">LIXA_TRACE_MOD_COMMON_UTILS</td><td align="left">0x08000000</td><td align="left"><code class="systemitem">lixab</code>
		  (common base library)</td><td align="left">utility functions used by all the components</td></tr><tr><td align="left">LIXA_TRACE_MOD_COMMON_XID</td><td align="left">0x10000000</td><td align="left"><code class="systemitem">lixab</code>
		  (common base library)</td><td align="left">functions specialized for XID (transaction ID)
		management</td></tr></tbody></table></div></div><p><br class="table-break" />
	You can trace any module combination creating any
	<span class="emphasis"><em>trace mask</em></span> ORing the bits; for example:
	</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>0x00000003 will produce all the messages of
	    <code class="constant">LIXA_TRACE_MOD_SERVER</code> and
	    <code class="constant">LIXA_TRACE_MOD_SERVER_CONFIG</code></p></li><li class="listitem" style="list-style-type: disc"><p>0xffffffff will produce all the messages</p></li><li class="listitem" style="list-style-type: disc"><p>0x00000000 will disable all the messages</p></li></ul></div><p>
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp69830432"></a>Improve troubleshooting with trace</h3></div></div></div><p>
	The trace can be activated setting the environment variable
	<code class="varname">LIXA_TRACE_MASK</code> before starting the execution of
	the traced program. Try the following example...
      </p><p>
	Check the state server is not active:
	</p><pre class="screen">
tiian@ubuntu:~$ ps -ef|grep lixad|grep -v grep
	</pre><p>
	try to execute <span class="command"><strong>lixat</strong></span>, the LIXA test program:
	</p><pre class="screen">
tiian@ubuntu:~$ /opt/lixa/bin/lixat
tx_open(): -7
	</pre><p>
	it gives us few information (<code class="constant">TX_FAIL = -7</code>): from
	<code class="filename">/opt/lixa/include/tx.h</code> we can retrieve the
	meaning: <span class="quote">“<span class="quote">fatal error</span>”</span>... Not so much...
	We could try to trace the <span class="quote">“<span class="quote">CLIENT TX</span>”</span> module:
	</p><pre class="screen">
tiian@ubuntu:~$ export LIXA_TRACE_MASK=0x00001000
tiian@ubuntu:~$ /opt/lixa/bin/lixat
2011-12-04 12:19:49.235007 [8899/3073612464] lixa_tx_open
2011-12-04 12:19:49.241544 [8899/3073612464] lixa_tx_open/TX_*=-7/excp=5/ret_cod=-138/errno=111
tx_open(): -7
	</pre><p>
	<span class="quote">“<span class="quote">ret_cod=-138</span>”</span> can be inspected inside
	<code class="filename">src/common/lixa_errors.h</code>:
	</p><pre class="screen">
[...]
/**
 * "connect" function error
 */
#define LIXA_RC_CONNECT_ERROR                  -138
[...]
	</pre><p>
	now we know the errors happens using <code class="function">connect()</code>
	function; <span class="quote">“<span class="quote">errno=111</span>”</span> can be inspected inside
	<code class="filename">/usr/include/asm-generic/errno.h</code>:
	</p><pre class="screen">
[...]
#define ECONNREFUSED    111     /* Connection refused */
[...]
	</pre><p>
	The error happens because the LIXA state server 
	(<span class="command"><strong>lixad</strong></span>) is not running, but we can improve our
	diagnosis with a more detailed tracing adding
	<span class="quote">“<span class="quote">CLIENT CONN</span>”</span> module:
	</p><pre class="screen">
tiian@ubuntu:~$ export LIXA_TRACE_MASK=0x00005000
tiian@ubuntu:~$ /opt/lixa/bin/lixat
2011-12-04 17:00:49.447866 [4514/3074067120] lixa_tx_open
2011-12-04 17:00:49.452624 [4514/3074067120] client_connect
2011-12-04 17:00:49.452678 [4514/3074067120] client_connect: connecting socket 4 to server '127.0.0.1' port 2345
2011-12-04 17:00:49.454033 [4514/3074067120] client_connect/excp=2/ret_cod=-138/errno=111
2011-12-04 17:00:49.454872 [4514/3074067120] lixa_tx_open/TX_*=-7/excp=5/ret_cod=-138/errno=111
tx_open(): -7
	</pre><p>
	the client is not able to contact the state server that is configured
	to listen port <code class="systemitem">2345</code> 
	at address 
	<code class="systemitem">127.0.0.1</code>
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp69832736"></a>Activating trace for <span class="command"><strong>lixad</strong></span> in 
	<span class="emphasis"><em>daemon</em></span> mode</h3></div></div></div><p>
	When running the state server (<span class="command"><strong>lixad</strong></span>) in
	<span class="emphasis"><em>daemon</em></span>
	mode, you must explicitly ask <span class="command"><strong>lixad</strong></span> to use a
	trace file. Try the following steps...
	</p><pre class="screen">
tiian@ubuntu:~$ sudo su - lixa
lixa@ubuntu:~$ export LIXA_TRACE_MASK=0x00000005
lixa@ubuntu:~$ /opt/lixa/sbin/lixad -d
2011-12-04 17:14:46.976067 [4888/3074164464] lixad/daemonize: fork()
2011-12-04 17:14:46.978399 [4889/3074164464] lixad/daemonize: setsid()
2011-12-04 17:14:46.979740 [4889/3074164464] lixad/daemonize: signal()
2011-12-04 17:14:46.980513 [4889/3074164464] lixad/daemonize: fork()
2011-12-04 17:14:46.982516 [4890/3074164464] lixad/daemonize: chdir()
2011-12-04 17:14:46.984002 [4890/3074164464] lixad/daemonize: umask()
	</pre><p>
	the process is tracing the initial operations and after the
	<span class="emphasis"><em>daemonization</em></span> it does not produce any more
	messages. By default <code class="filename">stderr</code> is used as the
	standard tracing file, but the
	<span class="emphasis"><em>daemon</em></span> disconnects from the terminal
	and closes the <code class="filename">stderr</code> file.
	To avoid this issue you can specify a specific trace file name using
	the <code class="option">-t</code> (<code class="option">--trace-file</code>) dedicated
	option:
	</p><pre class="screen">
lixa@ubuntu:~$ /opt/lixa/sbin/lixad -d -t /tmp/lixad.trace
lixa@ubuntu:~$ ls -la /tmp/lixad.trace
-rw-r--r-- 1 lixa lixa 349 2011-12-04 17:29 /tmp/lixad.trace
lixa@ubuntu:~$ pkill lixad
	</pre><p>
	inspecting the content of <code class="filename">/tmp/lixad.trace</code>
	you can now find messages related to the listener module too:
	</p><pre class="screen">
2011-12-04 17:29:12.435474 [5187/3074373360] lixad/daemonize: fork()
2011-12-04 17:29:12.436593 [5188/3074373360] lixad/daemonize: setsid()
2011-12-04 17:29:12.437187 [5188/3074373360] lixad/daemonize: signal()
2011-12-04 17:29:12.437245 [5188/3074373360] lixad/daemonize: fork()
2011-12-04 17:29:12.435474 [5187/3074373360] lixad/daemonize: fork()
2011-12-04 17:29:12.439878 [5189/3074373360] lixad/daemonize: now daemonized!
2011-12-04 17:29:12.441874 [5189/3074373360] lixad/main: starting
2011-12-04 17:29:12.447862 [5189/3074373360] server_listener
2011-12-04 17:29:12.447940 [5189/3074373360] server_listener: resolving address '127.0.0.1' for listener # 0
2011-12-04 17:29:12.448001 [5189/3074373360] server_listener: creating socket for listener # 0
2011-12-04 17:29:12.448033 [5189/3074373360] server_listener: socket for listener 0 is 10
2011-12-04 17:29:12.448044 [5189/3074373360] server_listener: setting SO_REUSE option for listener # 0
2011-12-04 17:29:12.448142 [5189/3074373360] server_listener: resolving address '0.0.0.0' for listener # 1
2011-12-04 17:29:12.448156 [5189/3074373360] server_listener: creating socket for listener # 1
2011-12-04 17:29:12.448174 [5189/3074373360] server_listener: socket for listener 1 is 11
2011-12-04 17:29:12.448183 [5189/3074373360] server_listener: setting SO_REUSE option for listener # 1
2011-12-04 17:29:12.448213 [5189/3074373360] server_listener_signal
2011-12-04 17:29:12.448262 [5189/3074373360] server_listener_signal/excp=3/ret_cod=0/errno=0
2011-12-04 17:29:12.448275 [5189/3074373360] server_listener_loop
2011-12-04 17:29:12.448284 [5189/3074373360] server_listener_loop: entering poll...
2011-12-04 17:29:23.499666 [5189/3074373360] server_listener_signal_action: signo=15
2011-12-04 17:29:23.499850 [5189/3074373360] server_listener_signal_action: sending message to thread id 0
2011-12-04 17:29:23.499877 [5189/3074373360] server_listener_signal_action: sending message to thread id 1
2011-12-04 17:29:23.499904 [5189/3074373360] server_listener_signal_action: sending message to thread id 2
2011-12-04 17:29:23.499942 [5189/3074373360] server_listener_signal_action: sending message to thread id 3
2011-12-04 17:29:23.499991 [5189/3074373360] server_listener_loop: ready file descriptors = 1
2011-12-04 17:29:23.500003 [5189/3074373360] server_listener_loop: slot=0, fd=2, POLLIN=1, POLLERR=0, POLLHUP=0, POLLNVAL=0
2011-12-04 17:29:23.500025 [5189/3074373360] server_listener_loop: waiting thread (1) id 3074329488 termination...
2011-12-04 17:29:23.521138 [5189/3074373360] server_listener_loop: waiting thread (2) id 3065920400 termination...
2011-12-04 17:29:23.521169 [5189/3074373360] server_listener_loop: waiting thread (3) id 3057511312 termination...
2011-12-04 17:29:23.521180 [5189/3074373360] server_listener_loop/excp=8/ret_cod=0/errno=4
2011-12-04 17:29:23.521190 [5189/3074373360] server_listener/excp=8/ret_cod=0/errno=4
2011-12-04 17:29:23.521558 [5189/3074373360] lixad/main: exiting
	</pre><p>
	</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	    The trace file is written using the 
	    <code class="systemitem">stdio</code>
	    and the output is not flushed after every message: if you look
	    at the trace file of a running <span class="command"><strong>lixad</strong></span> state
	    server, you will not be able to read the last messages due to
	    the buffering of <code class="systemitem">stdio</code>
	    library. After the
	    server termination you are sure every trace message is inside the
	    trace file.
	</p></div><p>
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp69856320"></a>Redirecting the trace messages</h3></div></div></div><p>
	In the previous section you discovered how you can send the trace
	messages of <span class="command"><strong>lixad</strong></span>. The
	<code class="systemitem">lixac</code> library sends the
	trace messages to the <code class="filename">stderr</code> file associated to
	the terminal of the user that's running the process; many times you
	would send the messages to a specific disk hosted file. You can
	obtain this behavior using redirection:
	</p><pre class="screen">
tiian@ubuntu:~$ export LIXA_TRACE_MASK=0x00005000
tiian@ubuntu:~$ /opt/lixa/bin/lixat 2&gt;/tmp/lixat.trace
tx_open(): -7
tiian@ubuntu:~$ ls -la /tmp/lixat.trace
-rw-r--r-- 1 tiian tiian 417 2011-12-04 17:43 /tmp/lixat.trace
	</pre><p>
	You can inspect the content of the file
	<code class="filename">/tmp/lixat.trace</code>:
	</p><pre class="screen">
2011-12-04 17:43:36.078314 [5544/3074013872] lixa_tx_open
2011-12-04 17:43:36.083822 [5544/3074013872] client_connect
2011-12-04 17:43:36.083890 [5544/3074013872] client_connect: connecting socket 4 to server '127.0.0.1' port 2345
2011-12-04 17:43:36.084862 [5544/3074013872] client_connect/excp=2/ret_cod=-138/errno=111
2011-12-04 17:43:36.084906 [5544/3074013872] lixa_tx_open/TX_*=-7/excp=5/ret_cod=-138/errno=111
	</pre><p>
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Non_root_installation"></a>Non root installation</h2></div></div></div><p>
      The standard installation procedure explained in
      <a class="xref" href="#Installation" title="Chapter 2. Installation">Chapter 2, <em>Installation</em></a> uses 
      <code class="systemitem">root</code> account.
      You can install the software in a home directory using a normal user
      account, for instance <code class="systemitem">lixa</code>.
      To specify an alternative installation path you have to use
      <code class="option">--prefix</code> option at configure time.
    </p><p>
      The following steps show how you can install the software in 
      <code class="systemitem">lixa</code> home directory.
      </p><pre class="screen">
lixa@ubuntu:~$ ls -l
total 1520
-rw-r--r-- 1 lixa lixa 1550959 2011-12-18 21:25 lixa-0.5.36.tar.gz
lixa@ubuntu:~$ tar xzf lixa-0.5.36.tar.gz
lixa@ubuntu:~$ cd lixa-0.5.36

lixa@ubuntu:~/lixa-0.5.36$ ./configure --prefix=/home/lixa/prod
[...]
config.status: creating config.h
config.status: executing depfiles commands
config.status: executing tests/atconfig commands

lixa@ubuntu:~/lixa-0.5.36$ make install
[...]
make[2]: Leaving directory `/home/lixa/lixa-0.5.36'
make[1]: Leaving directory `/home/lixa/lixa-0.5.36'

lixa@ubuntu:~/lixa-0.5.36$ ls -la /home/lixa/prod/
total 36
drwxr-xr-x 9 lixa lixa 4096 2011-12-18 21:30 .
drwxr-xr-x 5 lixa lixa 4096 2011-12-18 21:28 ..
drwxr-xr-x 2 lixa lixa 4096 2011-12-18 21:29 bin
drwxr-xr-x 2 lixa lixa 4096 2011-12-18 21:28 etc
drwxr-xr-x 2 lixa lixa 4096 2011-12-18 21:29 include
drwxr-xr-x 2 lixa lixa 4096 2011-12-18 21:29 lib
drwxr-xr-x 2 lixa lixa 4096 2011-12-18 21:29 sbin
drwxr-xr-x 3 lixa lixa 4096 2011-12-18 21:30 share
drwxr-xr-x 2 lixa lixa 4096 2011-12-18 21:29 var

lixa@ubuntu:~/lixa-0.5.36$ export LD_LIBRARY_PATH=/home/lixa/prod/lib
lixa@ubuntu:~/lixa-0.5.36$ /home/lixa/prod/sbin/lixad --daemon
lixa@ubuntu:~/lixa-0.5.36$ ps -ef|grep lixad|grep -v grep
lixa     23493     1  0 21:32 ?        00:00:00 /home/lixa/prod/sbin/lixad --daemon

lixa@ubuntu:~/lixa-0.5.36$ export PATH=$PATH:/home/lixa/prod/bin
lixa@ubuntu:~/lixa-0.5.36$ lixat
tx_open(): 0
tx_close(): 0
      </pre><p>
    </p><p>
      Installing LIXA using a non 
      <code class="systemitem">root</code> 
      account has some advantages:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	    there aren't post install steps to change the ownership of
	    <code class="filename">etc</code> and <code class="filename">var</code>
	    directories
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	    you can install the software without
	    <code class="systemitem">root</code> privileges
	</p></li></ul></div><p>
      and some disadvantages:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	    the software is installed inside a home directory instead of
	    a system path
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	    there is no distinction between the administrative account
	    that must manage the state (<code class="filename">var</code>) and
	    the configuration (<code class="filename">etc</code>) and the
	    system account that must manage the software installation.
	</p></li></ul></div><p>
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Workload_balanced_environments"></a>Workload balanced environments</h2></div></div></div><p>
      The LIXA client (<code class="systemitem">lixac</code>)
      uses only one state server at a time, but different profiles can
      use different state servers and you can statically balance the
      workload.
    </p><p>
      We can not name it <span class="quote">“<span class="quote">workload balancing</span>”</span>, but this is
      an effective way to manage large environments.
      To configure many LIXA state servers you must put many
      <span class="quote">“<span class="quote">sttsrv</span>”</span> tags in <code class="filename">etc/lixac_conf.xml</code>
      as in the example below:
      </p><pre class="screen">
  &lt;sttsrvs&gt;
    &lt;sttsrv name="local_1" domain="AF_INET" address="127.0.0.1" port="2345" /&gt;
    &lt;sttsrv name="local_2" domain="AF_INET" address="127.0.0.1" port="3456" /&gt;
  &lt;/sttsrvs&gt;
      </pre><p>
      then you must specify different <span class="quote">“<span class="quote">sttsrv</span>”</span> tags in the
      profiles as in the example below:
      </p><pre class="screen">
    &lt;profile name="ORA_DYN_DB2_DYN"&gt;
      &lt;sttsrvs&gt;
        &lt;sttsrv&gt;local_1&lt;/sttsrv&gt;
      &lt;/sttsrvs&gt;
      &lt;rsrmgrs&gt;
        &lt;rsrmgr&gt;OracleXE_dynreg&lt;/rsrmgr&gt;
        &lt;rsrmgr&gt;IBMDB2_dynreg&lt;/rsrmgr&gt;
      &lt;/rsrmgrs&gt;
    &lt;/profile&gt;
    &lt;profile name="ORA_DYN_DB2_STA"&gt;
      &lt;sttsrvs&gt;
        &lt;sttsrv&gt;local_2&lt;/sttsrv&gt;
      &lt;/sttsrvs&gt;
      &lt;rsrmgrs&gt;
        &lt;rsrmgr&gt;OracleXE_dynreg&lt;/rsrmgr&gt;
        &lt;rsrmgr&gt;IBMDB2_stareg&lt;/rsrmgr&gt;
      &lt;/rsrmgrs&gt;
    &lt;/profile&gt;
      </pre><p>
    </p></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp69885472"></a>High Availability configuration</h2></div></div></div><p>
      If you were using LIXA software project in a mission critical
      environment, you should set-up an high availability configuration.
      If you take a look to <a class="xref" href="#config1" title="Figure 3.1. Typical LIXA topology">Figure 3.1, “Typical LIXA topology”</a> you will notice the
      <span class="command"><strong>lixad</strong></span> daemon is a <span class="emphasis"><em>single point of
	failure</em></span>: if the system hosting <span class="command"><strong>lixad</strong></span>
      crashed, the Application Program could not perform distributed
      transaction processing due to the unavailability of
      <span class="command"><strong>lixad</strong></span> daemon.
    </p><p>
      To avoid the issues related to <span class="quote">“<span class="quote">single point of failure
      pathology</span>”</span> the suggested configuration is
      <span class="quote">“<span class="quote">Active/passive</span>”</span> as described in 
      <a class="ulink" href="http://en.wikipedia.org/wiki/High-availability_cluster#Node_configurations" target="_top">
	Wikipedia <span class="quote">“<span class="quote">High-availability cluster</span>”</span> page</a>.
      You can use:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	    any cluster manager, for example
	    <a class="ulink" href="http://www.linux-ha.org/wiki/Main_Page" target="_top">Linux-HA
	      Heartbeat</a>
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	    any shared disk technology like 
	    <a class="ulink" href="http://en.wikipedia.org/wiki/Storage_area_network" target="_top">SAN (Storage Area Network)</a>, 
	    <a class="ulink" href="http://en.wikipedia.org/wiki/Network-attached_storage" target="_top">NAS (Network Attached Storage)</a> or disk replication technology like
	    <a class="ulink" href="http://www.drbd.org/" target="_top">DR:BD</a>
	</p></li></ul></div><p>
      <span class="command"><strong>lixad</strong></span> requires that the filesystem and the
      block device support <code class="function">mmap()</code>, 
      <code class="function">munmap()</code> and <code class="function">msync()</code> functions.
      The faster the filesystem/block device you are using, the better the
      <span class="command"><strong>lixad</strong></span> performance.
    </p><p>
      The easiest high-availability configuration uses:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	    a shared/mirrored disk containing the LIXA file tree
	    (<code class="filename">/opt/lixa</code> if you are using a default
	    installation)
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	    a service dedicated IP address that must be activated on the
	    host servicing LIXA
	</p></li></ul></div><p>
      The following pictures show an high availability configuration in action:
      </p><div class="figure"><a id="high_availability_1"></a><p class="title"><strong>Figure 9.1. HA, step 1: the active node is on the left, 
	  the passive one is on the right</strong></p><div class="figure-contents"><div class="mediaobject"><img src="../images/LIXA_In_Depth_01.png" alt="HA, step 1: the active node is on the left, the passive one is on the right" /></div></div></div><p><br class="figure-break" />
      </p><div class="figure"><a id="high_availability_2"></a><p class="title"><strong>Figure 9.2. HA, step 2: the active node fails</strong></p><div class="figure-contents"><div class="mediaobject"><img src="../images/LIXA_In_Depth_02.png" alt="HA, step 2: the active node fails" /></div></div></div><p><br class="figure-break" />
      </p><div class="figure"><a id="high_availability_3"></a><p class="title"><strong>Figure 9.3. HA, step 3: the passive node takes over the service</strong></p><div class="figure-contents"><div class="mediaobject"><img src="../images/LIXA_In_Depth_03.png" alt="HA, step 3: the passive node takes over the service" /></div></div></div><p><br class="figure-break" />
    </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	If you put all the LIXA installation files 
	(<code class="filename">/opt/lixa</code>) in the shared disk you will not
	be able to run LIXA utility program from the node that's not owning
	the shared disk: this should not be an issue if your active/passive
	cluster hosts only <span class="command"><strong>lixad</strong></span>.
      </p><p>
	If you were using a most complicated configuration, it might be
	preferable to put only <code class="filename">/opt/lixa/var</code> and
	<code class="filename">/opt/lixa/etc</code> in the shared disk. You could
	implement such a configuration using symbolic links or customizing
	the configure procedure with 
	<code class="option">--sysconfdir=DIR</code> and 
	<code class="option">--localstatedir=DIR</code>
	options. Use <span class="command"><strong>./configure</strong></span> <code class="option">--help</code>
	for more details.
      </p></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp69916032"></a>LIXA Very Stupid Robot (lixavsr)</h2></div></div></div><p>
      <span class="command"><strong>lixavsr</strong></span> is a command line utility provided by LIXA
      project and dedicated to people interested in experimenting with the
      XA Specification.
    </p><p>
      The utility is a <span class="emphasis"><em>very stupid</em></span> robot that can be
      <span class="emphasis"><em>programmed</em></span> to execute a sequence of XA instructions.
      Here is a basic example of the type of experiments that can be performed:
      </p><pre class="screen">
0/xa_open("",0,TMNOFLAGS)/0
0/xa_start("231.a256cf41.ff45a3",0,TMNOFLAGS)/0
0/xa_end("231.a256cf41.ff45a3",0,TMSUCCESS)/0
0/xa_prepare("231.a256cf41.ff45a3",0,TMNOFLAGS)/0
0/xa_commit("231.a256cf41.ff45a3",0,TMNOFLAGS)/0
0/xa_start("231.a256cf41.ff45a3",0,TMNOFLAGS)/0
0/xa_end("231.a256cf41.ff45a3",0,TMSUCCESS)/0
0/xa_commit("231.a256cf41.ff45a3",0,TMONEPHASE)/0
0/xa_close("",0,TMNOFLAGS)/0
0/vsr_quit()/0
      </pre><p>
      The robot is a <span class="emphasis"><em>driver</em></span> that:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	  reads commands from a text file (see 
	  <code class="filename">doc/lixavsr.txt</code> for the syntax definition)
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	  activates, if necessary, new threads of control
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	  sends every command to the prescribed thread of control
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	  retrieves command return codes and check it with the desired ones
	</p></li></ul></div><p>      
    </p><p>
      The command line options that are supported by <span class="command"><strong>lixavsr</strong></span>
      can be retrieved with option 
      <em class="parameter"><code>--help</code></em>:
      </p><pre class="screen">
tiian@ubuntu1404-64:~/lixa$ /opt/lixa/bin/lixavsr --help
Usage:
  lixavsr [OPTION...] - LIXA test utility

Help Options:
  -h, --help         Show help options

Application Options:
  -f, --filename     Name of the file with the actions that must be executed
  -t, --threads      Use threads instead of processes
  -v, --version      Print package info and exit
  -s, --sleep        Sleep 1 second before killing children at exit
      </pre><p>
    </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
      XA Specification introduces the concept of 
      <span class="emphasis"><em>thread of control</em></span> but it does not prescribe how to
      implement it: it's an abstract concept that applies to any generic
      operating system. <span class="command"><strong>lixavsr</strong></span> enables you to implement
      the abstract <span class="emphasis"><em>thread of control</em></span> as a standard
      POSIX process (default behavior) or as a standard POSIX thread
      (using <em class="parameter"><code>-t --threads</code></em> command line
      option).
    </p><p>
      Some Resource Managers can behave differently depending of the type of
      <span class="emphasis"><em>thread of control</em></span>.
    </p></div><p>
      Some examples are provided inside directory 
      <code class="filename">etc/lixavsr</code> as shown below:
      </p><pre class="screen">
tiian@ubuntu1404-64:~/lixa$ ls -la etc/lixavsr/
total 132
drwxrwxr-x 2 tiian tiian  4096 mar 18 18:45 .
drwxr-xr-x 3 tiian tiian  4096 mar 18 18:39 ..
-rw-rw-r-- 1 tiian tiian  1051 mar  4 17:29 00_trivial.txt
-rw-rw-r-- 1 tiian tiian   799 mar 15 22:39 01_single_toc.txt
-rw-rw-r-- 1 tiian tiian   780 mar 15 22:08 02_single_toc.txt
-rw-rw-r-- 1 tiian tiian  1287 mar 15 22:09 03_double_toc.txt
-rw-rw-r-- 1 tiian tiian  1214 mar 15 22:13 04_double_toc.txt
-rw-rw-r-- 1 tiian tiian  2993 mar 15 22:14 10_suspend_resume.txt
-rw-rw-r-- 1 tiian tiian  2834 mar 15 22:14 11_end_join.txt
-rw-rw-r-- 1 tiian tiian  2921 mar 15 22:14 12_end_join.txt
-rw-rw-r-- 1 tiian tiian  1568 mar 15 22:15 13_end_join.txt
-rw-rw-r-- 1 tiian tiian  6767 mar 15 22:16 14_branch_ora.txt
-rw-rw-r-- 1 tiian tiian  6276 mar 15 23:34 15_branch_mys.txt
-rw-rw-r-- 1 tiian tiian  6280 mar 15 23:33 16_branch_pql.txt
-rw-rw-r-- 1 tiian tiian  7433 mar 15 23:33 17_branch_pql_ora.txt
-rw-rw-r-- 1 tiian tiian  5026 mar 15 23:32 18_branch_mys_pql.txt
-rw-rw-r-- 1 tiian tiian  5254 mar 15 23:32 19_branch_mys_ora.txt
-rw-rw-r-- 1 tiian tiian 14609 mar 18 18:45 Makefile
-rw-rw-r-- 1 tiian tiian   324 mar 18 18:45 Makefile.am
-rw-rw-r-- 1 tiian tiian 14519 mar 18 18:45 Makefile.in
-rw-rw-r-- 1 tiian tiian   283 mar  5 22:02 README
      </pre><p>
      These files are not installed because they are a development tool, not
      a production tool: they are available only in the source tree.
    </p><p>
      Just as an example, here is a sample execution:
      </p><pre class="screen">
tiian@ubuntu1404-64:~/lixa$ export LIXA_PROFILE=PQL_STA
tiian@ubuntu1404-64:~/lixa$ /opt/lixa/bin/lixavsr -f etc/lixavsr/03_double_toc.txt 
toc=0  xa_open("dbname=testdb",0,0x00000000)=0
toc=1  xa_open("dbname=testdb",0,0x00000000)=0
toc=0  xa_start("231.a256cf41.ff45a3",0,0x00000000)=0
toc=1  xa_start("231.a256cf42.ff45a4",0,0x00000000)=0
toc=0  xa_end("231.a256cf41.ff45a3",0,0x04000000)=0
toc=1  xa_end("231.a256cf42.ff45a4",0,0x04000000)=0
toc=0  xa_prepare("231.a256cf41.ff45a3",0,0x00000000)=0
toc=1  xa_prepare("231.a256cf42.ff45a4",0,0x00000000)=0
toc=0  xa_commit("231.a256cf41.ff45a3",0,0x00000000)=0
toc=1  xa_commit("231.a256cf42.ff45a4",0,0x00000000)=0
toc=0  xa_start("231.a256cf41.ff45a3",0,0x00000000)=0
toc=1  xa_start("231.a256cf42.ff45a4",0,0x00000000)=0
toc=0  xa_end("231.a256cf41.ff45a3",0,0x04000000)=0
toc=1  xa_end("231.a256cf42.ff45a4",0,0x04000000)=0
toc=0  xa_commit("231.a256cf41.ff45a3",0,0x40000000)=0
toc=1  xa_commit("231.a256cf42.ff45a4",0,0x40000000)=0
toc=0  xa_close("",0,0x00000000)=0
toc=1  xa_close("",0,0x00000000)=0
toc=0  exiting...
toc=1  exiting...
      </pre><p>
    </p></div></div><div class="chapter"><div class="titlepage"><div><div><h1 class="title"><a id="Tuning"></a>Chapter 10. Tuning</h1></div></div></div><p>
    This chapter contains some tricks you may use to optimize the performance
    of your LIXA installation.
  </p><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="idp69937264"></a>Overview</h2></div></div></div><p>
      On the LIXA state server side, there are basically 3 elements you can 
      tune in your installation:
      state file disk assignment, number of server threads, 
      min and max elapsed synchronization time.
    </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp69938736"></a>State file disk assignment</h3></div></div></div><p>
	As explained in <a class="xref" href="#Configuring_the_server" title="Configuring the server">the section called “Configuring the server”</a> every
	manager inside the LIXA state server uses a specific path for
	its status files. If you specified path associated to independent
	disks, you should obtain the best I/O performance for the LIXA
	state server.
      </p><p>
	Following the <span class="quote">“<span class="quote">just work</span>”</span> concept the default 
	configuration specifies a path like
	<code class="filename">/opt/lixa/var/...</code>
	but you should change it if your system had indipendent disks.
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp69942448"></a>Number of server threads</h3></div></div></div><p>
	The LIXA state server is a multi-threaded process with one network
	listener and many <span class="quote">“<span class="quote">managers</span>”</span>; every manager runs
	in a dedicated thread. Choosing the optimal number of threads is
	not an easy task: following the <span class="quote">“<span class="quote">just work</span>”</span> concept
	the default configuration specifies 3 threads, but your own 
	installation could necessitate a quite different value for optimal
	performances (in the following paragraphs you could pick-up 
	some information).
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp69945104"></a>Minimum and maximum elapsed synchronization time</h3></div></div></div><p>
	Starting with version 0.7.2 you can configure two parameters:
	<em class="parameter"><code>min_elapsed_sync_time</code></em> and 
	<em class="parameter"><code>max_elapsed_sync_time</code></em>. 
	In the previous versions these parameters was implicitly set to 0.
      </p><p>
	Setting them to <span class="quote">“<span class="quote">0</span>”</span> will dramatically reduce the
	probability a synchronization operation can be shared by two or more
	client sessions (LIXA transaction managers). Setting them to a value
	greater than zero
	will increase the likelihood a synchronization operation
	batches a lot of requests.
      </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
	  The higher the value of these parameters, the higher the chance
	  you will have to perform manual recovery in the case of a server
	  crash (manual recovery is explained in 
	  <a class="xref" href="#Manual_cold_recovery" title="Manual (cold) recovery">the section called “Manual (cold) recovery”</a>).
	</p><p>
	  <span class="emphasis"><em>Do not use too high values:</em></span> you will increase
	  the likelihood of a long and tiring manual recovery phase after
	  a server crash without extra performance benefits.
	</p></div></div></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Tuning_example"></a>A tuning example</h2></div></div></div><p>
      This section explains a tuning example you can use as a starting point
      to develop your own tuning strategy.
    </p><p>
      The utility program <span class="command"><strong>lixat</strong></span>, introduced in
      <a class="xref" href="#Starting_test_utility" title="Starting the test utility (lixat)">the section called “Starting the test utility (<span class="command"><strong>lixat</strong></span>)”</a> can be used as a benchmark tool
      specifying <em class="parameter"><code>-b</code></em> 
      (<em class="parameter"><code>--benchmark</code></em>) option.
      The available command options can be retrieved with
      <em class="parameter"><code>--help</code></em>:
      </p><pre class="screen">
tiian@ubuntu:~$ /opt/lixa/bin/lixat --help
Usage:
  lixat [OPTION...] - LIXA test utility

Help Options:
  -?, --help                  Show help options

Application Options:
  -c, --commit                Perform a commit transaction
  -r, --rollback              Perform a rollback transaction
  -v, --version               Print package info and exit
  -b, --benchmark             Perform benchmark execution
  -o, --open-close            Execute tx_open &amp; tx_close for every transaction [benchmark only]
  -s, --csv                   Send result to stdout using CSV format [benchmark only]
  -l, --clients               Number of clients (threads) will stress the state server [benchmark only]
  -d, --medium-delay          Medium (random) delay between TX functions [benchmark only]
  -D, --delta-delay           Delta (random) delay between TX functions [benchmark only]
  -p, --medium-processing     Medium (random) delay introduced by Resource Managers operations between tx_begin and tx_commit/tx_rollback [benchmark only]
  -P, --delta-processing      Delta (random) delay introduced by Resource Managers operations between tx_begin and tx_commit/tx_rollback [benchmark only]
      </pre><p>
      These are the interesting options in benchmark mode:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	    commit transactions (<em class="parameter"><code>-c</code></em> or
	    <em class="parameter"><code>--commit</code></em>)
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	    rollback transactions (<em class="parameter"><code>-r</code></em> or
	    <em class="parameter"><code>--rollback</code></em>)
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	    one couple of <code class="function">tx_open()/tx_close()</code> for every
	    transaction (<em class="parameter"><code>-o</code></em> or
	    <em class="parameter"><code>--open-close</code></em>); alternatively only one
	    couple of <code class="function">tx_open()/tx_close()</code> will be used
	    for all the transactions (<code class="function">tx_open()/tx_begin()/tx_commit()/tx_begin()/tx_commit()/.../tx_close()</code>)
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	    number of clients connected to the LIXA state server
	    (<em class="parameter"><code>-l</code></em> or <em class="parameter"><code>--clients</code></em>)
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	    delay introduced by Application Program logic between 
	    <code class="function">tx_*</code> functions (
	    <em class="parameter"><code>-d, --medium-delay, -D, --delta-delay</code></em>)
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	    delay introduced by Resource Managers logic between
	    <code class="function">tx_begin</code> and <code class="function">tx_commit</code>
	    (or <code class="function">tx_rollback</code>) functions (
	    <em class="parameter"><code>-p, --medium-processing, -P, --delta-processing</code></em>)
	</p></li></ul></div><p>
    </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp69969888"></a><span class="command"><strong>lixat</strong></span> benchmark behavior</h3></div></div></div><p>
	This is a sketch of <span class="command"><strong>lixat</strong></span> algorithm when
	<em class="parameter"><code>-o</code></em> or <em class="parameter"><code>--open-close</code></em>
	option is specified:
	</p><pre class="screen">
loop (1..100)
    sleep(random[d-D/2, d+D/2])
    tx_open()
    sleep(random[d-D/2, d+D/2])
    tx_begin()
    sleep(random[p-P/2, p+P/2])
    tx_commit()
    sleep(random[d-D/2, d+D/2])
    tx_close()
    sleep(random[d-D/2, d+D/2])
end loop
	</pre><p>
	With default delays the sleeping pauses are the following:
	</p><pre class="screen">
sleep(random[d-D/2, d+D/2]) --&gt; [500, 1500] microseconds
sleep(random[p-P/2, p+P/2]) --&gt;  [50, 150]  milliseconds	  
	</pre><p>
        without <em class="parameter"><code>-o</code></em> or 
	<em class="parameter"><code>--open-close</code></em> option <span class="command"><strong>lixat</strong></span>
	does not
	call <code class="function">tx_open()/tx_close()</code> for every cycle and
	the algorithm becomes the following one:
	</p><pre class="screen">
tx_open()
loop (1..100)
    sleep(random[d-D/2, d+D/2])
    sleep(random[d-D/2, d+D/2])
    tx_begin()
    sleep(random[p-P/2, p+P/2])
    tx_commit()
    sleep(random[d-D/2, d+D/2])
    sleep(random[d-D/2, d+D/2])
end loop
tx_close()
	</pre><p>
      </p><p>
	Using <em class="parameter"><code>--open-close</code></em> parameter you will simulate 
	an Application Program that creates and destroy the transactional
	environment for every transaction.
      </p><p>
	Omitting <em class="parameter"><code>--open-close</code></em> parameter you will 
	simulate an Application Program that reuses the transactional
	environment for 100 transactions.
      </p><p>
	Your Application Program could live in the middle, 
	<span class="command"><strong>lixat</strong></span> can help you to figure out two different 
	theoretical scenarios.
      </p><p>
	A shell command you can use to measure the performance of LIXA for
	10, 20, 30, ... 100 clients is the following one:
	</p><pre class="screen">
for l in 10 20 30 40 50 60 70 80 90 100 ; do /opt/lixa/bin/lixat -b -s -l $l ; done | grep -v '^ ' &gt; /tmp/bench_result.csv
	</pre><p>
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp69980672"></a>Tuning example hardware characteristics</h3></div></div></div><p>
	This is the output of <code class="filename">/proc/cpuinfo</code> executed
	in the system hosting <span class="command"><strong>lixad</strong></span> state server:
	</p><pre class="screen">
	  processor: 0
	  vendor_id: GenuineIntel
	  cpu family: 15
	  model: 2
	  model name: Intel(R) Celeron(R) CPU 2.40GHz
	  stepping: 9
	  cpu MHz: 2405.521
	  cache size: 128 KB
	  fdiv_bug: no
	  hlt_bug: no
	  f00f_bug: no
	  coma_bug: no
	  fpu: yes
	  fpu_exception: yes
	  cpuid level: 2
	  wp: yes
	  flags: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe up pebs bts cid xtpr
	  bogomips: 4811.04
	  clflush size: 64
	</pre><p>
	This is the output of <code class="filename">/proc/cpuinfo</code> executed
	in the system hosting <span class="command"><strong>lixat</strong></span> benchmark process:
	</p><pre class="screen">
	  processor: 0
	  vendor_id: GenuineIntel
	  cpu family: 6
	  model: 23
	  model name: Genuine Intel(R) CPU           U7300  @ 1.30GHz
	  stepping: 10
	  cpu MHz: 800.000
	  cache size: 3072 KB
	  physical id: 0
	  siblings: 2
	  core id: 0
	  cpu cores: 2
	  apicid: 0
	  initial apicid: 0
	  fpu: yes
	  fpu_exception: yes
	  cpuid level: 13
	  wp: yes
	  flags: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx lm constant_tsc arch_perfmon pebs bts rep_good aperfmperf pni dtes64 monitor ds_cpl vmx est tm2 ssse3 cx16 xtpr pdcm sse4_1 xsave lahf_lm tpr_shadow vnmi flexpriority
	  bogomips: 2593.73
	  clflush size: 64
	  cache_alignment: 64
	  address sizes: 36 bits physical, 48 bits virtual
	  power management:

	  processor: 1
	  vendor_id: GenuineIntel
	  cpu family: 6
	  model: 23
	  model name: Genuine Intel(R) CPU           U7300  @ 1.30GHz
	  stepping: 10
	  cpu MHz: 800.000
	  cache size: 3072 KB
	  physical id: 0
	  siblings: 2
	  core id: 1
	  cpu cores: 2
	  apicid: 1
	  initial apicid: 1
	  fpu: yes
	  fpu_exception: yes
	  cpuid level: 13
	  wp: yes
	  flags: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx lm constant_tsc arch_perfmon pebs bts rep_good aperfmperf pni dtes64 monitor ds_cpl vmx est tm2 ssse3 cx16 xtpr pdcm sse4_1 xsave lahf_lm tpr_shadow vnmi flexpriority
	  bogomips: 2593.50
	  clflush size: 64
	  cache_alignment: 64
	  address sizes: 36 bits physical, 48 bits virtual
	  power management:
	</pre><p>
      </p><p>
	From the above specs you can guess these are not powerful 
	<span class="quote">“<span class="quote">server systems</span>”</span>. The systems are connected with a
	100 Mbit/s connection with an average latency of 95 microseconds:
	</p><pre class="screen">
--- 192.168.10.2 ping statistics ---
50 packets transmitted, 50 received, 0% packet loss, time 48997ms
rtt min/avg/max/mdev = 0.133/0.190/0.226/0.024 ms
	</pre><p>
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp69988368"></a>Results obtained with <em class="parameter"><code>--open-close</code></em> parameter</h3></div></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	  All the tests saturated the CPU of the host executing 
	  <span class="command"><strong>lixad</strong></span> state server for the higher values of
	  connected clients.
	</p></div><p>
	The first picture shows the elapsed time associated to
	<code class="function">tx_open()</code> increases quite linearly with the 
	number of connected clients. A <span class="command"><strong>lixad</strong></span> state server 
	configured with 3 managers
	(threads), <em class="parameter"><code>min_elapsed_sync_time=20</code></em> and
	<em class="parameter"><code>max_elapsed_sync_time=100</code></em> exploits the best
	scalability (purple line); a <span class="command"><strong>lixad</strong></span> state server 
	configured with 3 managers,
	<em class="parameter"><code>min_elapsed_sync_time=10</code></em> and
	<em class="parameter"><code>max_elapsed_sync_time=50</code></em> shows a scalability
	very near to the best (light green line).
	<span class="emphasis"><em>The second one is a more robust configuration and should
	  be preferred</em></span>.
      </p><div class="figure"><a id="tuning_01"></a><p class="title"><strong>Figure 10.1. Elapsed time of tx_open() when the Application Program 
	  uses a couple of tx_open()/tx_close() for every 
	  couple of tx_begin()/tx_commit()</strong></p><div class="figure-contents"><div class="mediaobject"><img src="../images/LIXA_Tuning_01.png" alt="Elapsed time of tx_open() when the Application Program uses a couple of tx_open()/tx_close() for every couple of tx_begin()/tx_commit()" /></div></div></div><br class="figure-break" /><p>
	A completely different behavior is shown by
	<code class="function">tx_begin(), tx_commit(), tx_close()</code> functions:
	the best scalability is obtained with 1 manager (thread), 
	<em class="parameter"><code>min_elapsed_sync_time=20</code></em> and
	<em class="parameter"><code>max_elapsed_sync_time=100</code></em>
	(yellow line); a quite optimal
	performance can be obtained with 1 manager (thread), 
	<em class="parameter"><code>min_elapsed_sync_time=10</code></em> and
	<em class="parameter"><code>max_elapsed_sync_time=50</code></em> (orange line). 
	The second 
	configuration should be preferred because it's more robust than the
	first one. Using more threads does not give any benefit for these
	three functions.
      </p><div class="figure"><a id="tuning_02"></a><p class="title"><strong>Figure 10.2. Elapsed time of tx_begin() when the Application Program 
	  uses a couple of tx_open()/tx_close() for every 
	  couple of tx_begin()/tx_commit()</strong></p><div class="figure-contents"><div class="mediaobject"><img src="../images/LIXA_Tuning_02.png" alt="Elapsed time of tx_begin() when the Application Program uses a couple of tx_open()/tx_close() for every couple of tx_begin()/tx_commit()" /></div></div></div><br class="figure-break" /><div class="figure"><a id="tuning_03"></a><p class="title"><strong>Figure 10.3. Elapsed time of tx_commit() when the Application Program 
	  uses a couple of tx_open()/tx_close() for every 
	  couple of tx_begin()/tx_commit()</strong></p><div class="figure-contents"><div class="mediaobject"><img src="../images/LIXA_Tuning_03.png" alt="Elapsed time of tx_commit() when the Application Program uses a couple of tx_open()/tx_close() for every couple of tx_begin()/tx_commit()" /></div></div></div><br class="figure-break" /><div class="figure"><a id="tuning_04"></a><p class="title"><strong>Figure 10.4. Elapsed time of tx_close() when the Application Program 
	  uses a couple of tx_open()/tx_close() for every 
	  couple of tx_begin()/tx_commit()</strong></p><div class="figure-contents"><div class="mediaobject"><img src="../images/LIXA_Tuning_04.png" alt="Elapsed time of tx_close() when the Application Program uses a couple of tx_open()/tx_close() for every couple of tx_begin()/tx_commit()" /></div></div></div><br class="figure-break" /><p>
	In the last chart 
	you may note the aggregated values for all the transactions
	(100 transactions, the elapsed time is now expressed in seconds):
	the purple line (best configuration for <code class="function">tx_open()</code>)
	is the best overall configuration. This time too, there are many
	performance equivalent configurations:
	</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	      3 managers (thread), 
	      <em class="parameter"><code>min_elapsed_sync_time=20</code></em> and
	      <em class="parameter"><code>max_elapsed_sync_time=100</code></em>
	      (purple line)
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      3 managers (thread), 
	      <em class="parameter"><code>min_elapsed_sync_time=10</code></em> and
	      <em class="parameter"><code>max_elapsed_sync_time=50</code></em>	      
	      (light green line)
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      2 managers (thread), 
	      <em class="parameter"><code>min_elapsed_sync_time=10</code></em> and
	      <em class="parameter"><code>max_elapsed_sync_time=50</code></em>	      
	      (red line)
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      1 managers (thread), 
	      <em class="parameter"><code>min_elapsed_sync_time=10</code></em> and
	      <em class="parameter"><code>max_elapsed_sync_time=50</code></em>	      
	      (orange line)
	  </p></li></ul></div><p>
	The second configuration of the above list (light green) could be 
	considered the
	best from an overall performance point of view and from a safety
	point of view: the minimum elapsed synchronization time is 
	10 milliseconds.
      </p><div class="figure"><a id="tuning_05"></a><p class="title"><strong>Figure 10.5. Overall elapsed time when the Application Program 
	  uses a couple of tx_open()/tx_close() for every 
	  couple of tx_begin()/tx_commit()</strong></p><div class="figure-contents"><div class="mediaobject"><img src="../images/LIXA_Tuning_05.png" alt="Overall elapsed time when the Application Program uses a couple of tx_open()/tx_close() for every couple of tx_begin()/tx_commit()" /></div></div></div><br class="figure-break" /></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp69988656"></a>Results obtained without <em class="parameter"><code>--open-close</code></em> parameter</h3></div></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	  All the tests saturated the CPU of the host executing 
	  <span class="command"><strong>lixad</strong></span> state server for the higher values of
	  connected clients.
	</p></div><p>
	Avoiding a lot of <code class="function">tx_open()/tx_close()</code> the
	behavior of the system is quite different. It's interesting to note
	the system has two distinct modes:
	</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	      in the range [10,50] clients the scalability is quite linear 
	      if you adopt a super safe configuration with 
	      <em class="parameter"><code>min_elapsed_sync_time=0</code></em> and
	      <em class="parameter"><code>max_elapsed_sync_time=0</code></em>
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      in the range [10,50] clients the scalability is
	      <span class="quote">“<span class="quote">superlinear</span>”</span>
	      <a href="#ftn.idp70028256" class="footnote" id="idp70028256"><sup class="footnote">[47]</sup></a>
	      if you adopt an asynchronous
	      conifiguration with 
	      <em class="parameter"><code>min_elapsed_sync_time=10</code></em> and
	      <em class="parameter"><code>max_elapsed_sync_time=50</code></em>
	      or higher values
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	      in the range [60,100] clients the system tends to saturate
	      and the <span class="quote">“<span class="quote">superlinear</span>”</span> characteristic is vanishing;
	      neverthless, asynchronous configurations exploit lower
	      response time than synchronous ones
	  </p></li></ul></div><p>
      </p><div class="figure"><a id="tuning_06"></a><p class="title"><strong>Figure 10.6. Elapsed time of tx_open() when the Application Program 
	  uses a couple of tx_open()/tx_close() for a 
	  batch of tx_begin()/tx_commit()</strong></p><div class="figure-contents"><div class="mediaobject"><img src="../images/LIXA_Tuning_06.png" alt="Elapsed time of tx_open() when the Application Program uses a couple of tx_open()/tx_close() for a batch of tx_begin()/tx_commit()" /></div></div></div><br class="figure-break" /><div class="figure"><a id="tuning_07"></a><p class="title"><strong>Figure 10.7. Elapsed time of tx_begin() when the Application Program 
	  uses a couple of tx_open()/tx_close() for a 
	  batch of tx_begin()/tx_commit()</strong></p><div class="figure-contents"><div class="mediaobject"><img src="../images/LIXA_Tuning_07.png" alt="Elapsed time of tx_begin() when the Application Program uses a couple of tx_open()/tx_close() for a batch of tx_begin()/tx_commit()" /></div></div></div><br class="figure-break" /><div class="figure"><a id="tuning_08"></a><p class="title"><strong>Figure 10.8. Elapsed time of tx_commit() when the Application Program 
	  uses a couple of tx_open()/tx_close() for a 
	  batch of tx_begin()/tx_commit()</strong></p><div class="figure-contents"><div class="mediaobject"><img src="../images/LIXA_Tuning_08.png" alt="Elapsed time of tx_commit() when the Application Program uses a couple of tx_open()/tx_close() for a batch of tx_begin()/tx_commit()" /></div></div></div><br class="figure-break" /><div class="figure"><a id="tuning_09"></a><p class="title"><strong>Figure 10.9. Elapsed time of tx_close() when the Application Program 
	  uses a couple of tx_open()/tx_close() for a 
	  batch of tx_begin()/tx_commit()</strong></p><div class="figure-contents"><div class="mediaobject"><img src="../images/LIXA_Tuning_09.png" alt="Elapsed time of tx_close() when the Application Program uses a couple of tx_open()/tx_close() for a batch of tx_begin()/tx_commit()" /></div></div></div><br class="figure-break" /><p>
	The last chart shows the average elapsed time spent for 
	<code class="function">tx_*</code> functions by 100 transactions.
	The best performace is obtained with the less safe configuration:
	<em class="parameter"><code>min_elapsed_sync_time=20</code></em> and
	<em class="parameter"><code>max_elapsed_sync_time=100</code></em>
	(purple, cyan and yellow lines).
	The intermediate performance is obtained with the intermediate
	configuration:
	<em class="parameter"><code>min_elapsed_sync_time=10</code></em> and
	<em class="parameter"><code>max_elapsed_sync_time=50</code></em>
	(dark yellow, red and orange lines).
	The worst performance is obtained with the safest configuration:
	<em class="parameter"><code>min_elapsed_sync_time=0</code></em> and
	<em class="parameter"><code>max_elapsed_sync_time=0</code></em>
	(green, light green and blue lines).
      </p><div class="figure"><a id="tuning_10"></a><p class="title"><strong>Figure 10.10. Overall elapsed time when the Application Program 
	  uses a couple of tx_open()/tx_close() for a 
	  batch of tx_begin()/tx_commit()</strong></p><div class="figure-contents"><div class="mediaobject"><img src="../images/LIXA_Tuning_10.png" alt="Overall elapsed time when the Application Program uses a couple of tx_open()/tx_close() for a batch of tx_begin()/tx_commit()" /></div></div></div><br class="figure-break" /><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp70050240"></a>Conclusions</h4></div></div></div><p>
	  The LIXA project gives you some parameters you can change to tune
	  your installation and get the best performance.
	  There is not a magic recipe you can adopt, but there are some
	  rules of thumb:
	  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
		if possible, avoid the usage of 
		<code class="function">tx_open()/tx_close()</code> for every 
		transaction: if your business logic could batch more than
		one transaction inside the same session, your overall
		response time would be lower
	    </p></li><li class="listitem" style="list-style-type: disc"><p>
		delayed disk synchronization will help you in obtaining
		better performance with the same hardware, but introducing
		too high delays will not give you extra performance
	    </p></li><li class="listitem" style="list-style-type: disc"><p>
		delay disk synchronization introduce the risk to perform
		manual recovery as explained in
		<a class="xref" href="#Delayed_synchronization_effects" title="Delayed synchronization effects">the section called “Delayed synchronization effects”</a>.
	    </p></li></ul></div><p>
	  Write your own test program, with real Resource Managers,
	  and measure it: with a test environment you would be able to
	  fine tune your own installation.
	</p></div></div></div><div class="footnotes"><br /><hr style="width:100; text-align:left;margin-left: 0" /><div id="ftn.idp70028256" class="footnote"><p><a href="#idp70028256" class="para"><sup class="para">[47] </sup></a>
		  <code class="function">tx_begin(), tx_commit(), tx_close()</code>
		  response times change very few when the number of clients
		  rises
		</p></div></div></div><div class="bibliography"><div class="titlepage"><div><div><h1 class="title"><a id="idp70051392"></a>Bibliography</h1></div></div></div><div class="bibliodiv"><h3 class="title"><a id="idp70056352"></a>Books</h3><div class="biblioentry"><a id="idp70056768"></a><p>[<abbr class="abbrev">RefModel</abbr>] <span class="copyright">Copyright © 1996 X/Open Company Limited. </span><span class="biblioid">1-85912-170-5. </span><span class="publisher"><span class="publishername">X/Open Company Ltd., U.K.. </span></span><span class="title"><em>
	<a class="ulink" href="https://www2.opengroup.org/ogsys/catalog/G504" target="_top">Distributed Transaction Processing: Reference Model, Version 3</a>
      </em>. </span></p></div><div class="biblioentry"><a id="idp70061648"></a><p>[<abbr class="abbrev">TXspec</abbr>] <span class="copyright">Copyright © 1995 X/Open Company Limited. </span><span class="biblioid">1-85912-094-6. </span><span class="publisher"><span class="publishername">X/Open Company Ltd., U.K.. </span></span><span class="title"><em>
	<a class="ulink" href="https://www2.opengroup.org/ogsys/catalog/C504" target="_top">Distributed TP: The TX (Transaction Demarcation) Specification</a>
      </em>. </span></p></div><div class="biblioentry"><a id="idp70066448"></a><p>[<abbr class="abbrev">XAspec</abbr>] <span class="copyright">Copyright © 1991 X/Open Company Limited. </span><span class="biblioid">1-872630-24-3. </span><span class="publisher"><span class="publishername">X/Open Company Ltd., U.K.. </span></span><span class="title"><em>
	<a class="ulink" href="https://www2.opengroup.org/ogsys/catalog/C193" target="_top">Distributed TP: The XA Specification</a>
      </em>. </span></p></div><div class="biblioentry"><a id="idp70071168"></a><p>[<abbr class="abbrev">XA+spec</abbr>] <span class="copyright">Copyright © 1994 X/Open Company Limited. </span><span class="biblioid">1-85912-046-6. </span><span class="publisher"><span class="publishername">X/Open Company Ltd., U.K.. </span></span><span class="title"><em>
	<a class="ulink" href="https://www2.opengroup.org/ogsys/catalog/S423" target="_top">Distributed TP: The XA+ Specification Version 2</a>
      </em>. </span></p></div></div></div></div></body></html>