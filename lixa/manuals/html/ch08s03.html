<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>The “Multiple Applications, Consecutive Calls” Pattern</title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="LIXA Reference Guide (version 1.9.5)" /><link rel="up" href="ch08.html" title="Chapter 8. Developing Application Programs using XTA (XA Transaction API) interface" /><link rel="prev" href="ch08s02.html" title="The “Single Application” Pattern" /><link rel="next" href="ch08s04.html" title="The “Multiple Applications, Concurrent Branches/Pseudo Synchronous” Pattern" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">The
    <span class="quote">“<span class="quote">Multiple Applications, Consecutive Calls</span>”</span>
    Pattern</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch08s02.html">Prev</a> </td><th width="60%" align="center">Chapter 8. Developing Application Programs using XTA (XA Transaction API) interface</th><td width="20%" align="right"> <a accesskey="n" href="ch08s04.html">Next</a></td></tr></table><hr /></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="xta_macc"></a>The
    <span class="quote">“<span class="quote">Multiple Applications, Consecutive Calls</span>”</span>
    Pattern</h2></div></div></div><div class="table"><table frame="box"><thead><tr><td>The pattern in brief:</td></tr></thead><tbody><tr>
	  <td>Architecture:</td>
	  <td>see <a class="xref" href="ch08.html#xta_arch03" title="Figure 8.3. Multiple applications layout">Figure 8.3, “Multiple applications layout”</a></td>
	</tr><tr>
	  <td>Number of Application Programs:</td>
	  <td>2 or more</td>
	</tr><tr>
	  <td>Number of Resource Managers:</td>
	  <td>1 or more for every Application Program</td>
	</tr><tr>
	  <td>Number of Branches in the Gloabal Transaction:</td>
	  <td>1 for every Application Program</td>
	</tr><tr>
	  <td>Concurrency among Application Programs:</td>
	  <td>no, strictly consecutive executive</td>
	</tr></tbody></table></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp59680800"></a>Description</h3></div></div></div><p>
	This is a Distributed Transaction Processing pattern introduced by XTA:
	two or more Application Programs use the same Resource Manager(s) and
	perform consecutive operations inside a single XA global transaction.
	The Resource Manager(s) must be able to suspend and resume the
	thread's association with the transaction
	branch: this feature is part of the XA standard, but some resource
	managers don't support it (for example MySQL, MariaDB and PostgreSQL).
      </p><p>
	The following picture shows an example that can be implemented using
	Oracle RDBMS.
	</p><div class="figure"><a id="xta_pattern06"></a><p class="title"><strong>Figure 8.6. Example of <span class="quote">“<span class="quote">Multiple Applications, 
	  Consecutive Calls</span>”</span> with two Application Programs and one
	  Resource Manager</strong></p><div class="figure-contents"><div class="mediaobject"><img src="../images/LIXA_Development_XTA_06.svg" alt="Example of “Multiple Applications, Consecutive Calls” with two Application Programs and one Resource Manager" /></div></div></div><p><br class="figure-break" />
	The pattern can <span class="emphasis"><em>not</em></span> be implemented using the
	standard TX Transaction	Demarcation interface
	<a href="#ftn.idp59684928" class="footnote" id="idp59684928"><sup class="footnote">[50]</sup></a>.
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp59686096"></a>How it works</h3></div></div></div><div class="figure"><a id="xta_pattern07"></a><p class="title"><strong>Figure 8.7. Simplified sequence diagram for the
	<span class="quote">“<span class="quote">Multiple Applications, Consecutive Calls</span>”</span>
	Pattern</strong></p><div class="figure-contents"><div class="mediaobject"><img src="../images/LIXA_Development_XTA_07.svg" alt="Simplified sequence diagram for the “Multiple Applications, Consecutive Calls” Pattern" /></div></div></div><br class="figure-break" /><p>
	The above figure shows the logic necessary to build this type of
	applications; it's <span class="emphasis"><em>not</em></span> a formally correct UML
	sequence diagram (all the XTA objects are in the same lifeline), but
	it should be clear enough to understand the
	proper operations sequence:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	  The first AP creates some XTA objects: a
	  <code class="function">XaResource</code>, a
	  <code class="function">TransactionManager</code>,
	  and one <code class="function">Transaction</code>
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	  The first AP <span class="quote">“<span class="quote">enlists</span>”</span> the XA resource that 
	  <span class="emphasis"><em>must be controlled by the transaction</em></span>
	  using <code class="function">EnlistResource()</code> method
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	  The first AP uses the <code class="function">Open()</code> method
	  to initialize the <code class="function">XaResource</code> objects
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	  The first AP uses the <code class="function">Start()</code> method
	  to start a new XA distributed transaction
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	  The first AP interacts with the Resource Manager using the native
	  objects/connections/handles to operate
	  (<span class="quote">“<span class="quote">doSomething</span>”</span> method in the diagram). The example is
	  based on Oracle DBMS: environment is retrieved with 
	  <code class="function">xaoEnv()</code>, context is retrieved with
	  <code class="function">xaoSvcCtx()</code> and connection handle is retrieved
	  with <code class="function">OCIHandleAlloc</code>
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	  The first AP <span class="emphasis"><em>suspends</em></span> its thread's association
	  with the transaction using <code class="function">Suspend()</code> method
	  and then it retrieves the Transaction Id (XID) using
	  <code class="function">GetXid()</code> method
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	  The first AP is now able to pass the Transaction Id (XID) to the
	  second AP: it can use any type of communication protocol able to
	  send an ASCII string
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	  At this point, first AP terminates its processing and the second AP
	  takes the control of the transaction using
	  <code class="function">Resume()</code> method
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	  The second AP interacts with the Resource Manager using the native
	  objects/connections/handles to operate
	  (<span class="quote">“<span class="quote">doSomething</span>”</span> method in the diagram)
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	  The second AP commit the transaction using
	  <code class="function">Commit()</code> method (alternatively it could rollback
	  the transaction using <code class="function">Rollback()</code> method)
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	  The second AP terminates its processing
	</p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	The dashed red rectangle highlights the XA global transaction.
      </p></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
	These are the relevant elements of this pattern:
	</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	    The first Application Program starts a new Transaction, performs
	    some activities with the Resource Manager(s), suspends its
	    association with the Transaction and passes the XID to the second
	    Application Program
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	    The second Application Program sets up its XTA objects, but it
	    does not start a new Transaction: it must wait the XID from the
	    first Application Program, resumes the Transaction and completes
	    the work
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	    The pattern does <span class="emphasis"><em>not</em></span> allow concurrent access
	    to the same Resource Manager(s): only one Application Program at a
	    time can be associated to the same global transaction
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	    There's basically no limit to the number of different Application
	    Programs that consecutively participate into the Transaction
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	    There's no constraint to the number of different programming
	    languages used: every Application Program can be developed using
	    a different programming language supported by XTA
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	    There's no constraint to communication protocol used by 
	    Application Programs to exchange information: REST API, SOAP based
	    web services, CORBA, RPC, any network protocol, any inter process
	    communication, etc... XTA does <span class="emphasis"><em>not</em></span> force the
	    developer to use a specific communication protocol: any technique
	    suitable to send an ASCII string can be used
	  </p></li></ul></div><p>
      </p></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	The methods listed in the above description must be considered
	<span class="quote">“<span class="quote">pseudo-code</span>”</span>: the real name and signature is language
	dependent. As an example, 
	</p><pre class="screen">tm = new TransactionManager()</pre><p> translates to
	</p><pre class="screen">tm = xta_transaction_manager_new()</pre><p> and
	</p><pre class="screen">tx.Commit()</pre><p> translates to
	</p><pre class="screen">xta_transaction_commit(tx, FALSE)</pre><p> in C.
      </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp59710704"></a>Known limitations</h3></div></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	Not all the Resource Managers have implemented the XA specifications
	in the same way. This section tracks some limitations that have been
	reported by the LIXA project.
      </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp59714144"></a>MariaDB, MySQL and PostgreSQL support for 
	<span class="quote">“<span class="quote">suspend/resume</span>”</span></h4></div></div></div><p>
	  All the three databases do not support the XA specification part that
	  describe as a transaction can be suspended and resumed. This pattern
	  can't be used with those Resource Managers.
	  The limitation currently applies to all the provided APIs: C, Java,
	  etc...
	</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp59715456"></a>An example using the C language</h3></div></div></div><p>
	The supplied example (<code class="filename">example_xta_macc01.c</code>) uses
	Oracle in the role of <span class="quote">“<span class="quote">Resource Manager 1</span>”</span>; please
	refer to the instructions explained:
	</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	    in <a class="xref" href="apas02.html#App_RM_Config_Oracle_Remote" title="Remote configuration (Instant Client) and OCI">the section called “Remote configuration (Instant Client) and OCI”</a> 
	    to set-up the correct client/server configuration for Oracle
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	    in <a class="xref" href="ch04.html#Starting_the_state_server" title="Starting the state server (lixad)">the section called “Starting the state server (<span class="command"><strong>lixad</strong></span>)”</a>
	    to start up the LIXA state server
	  </p></li></ul></div><p>
      </p><p>
	Create a working directory in a place you are comfortable with:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~$ cd
tiian@ubuntu1404-64:~$ mkdir tmp
tiian@ubuntu1404-64:~$ cd tmp
tiian@ubuntu1404-64:~/tmp$ 
	  </pre></td></tr></tbody></table></div><p>
      </p><p>
	Copy file <code class="filename">example_xta_macc01.c</code> in your working
	dir:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
	    tiian@ubuntu:~/tmp$ cp /opt/lixa/share/doc/lixa-X.Y.Z/examples/xta/example_xta_macc01.c .
	  </pre></td></tr></tbody></table></div><p>
	Substitute <span class="quote">“<span class="quote">X.Y.Z</span>”</span> with the actual version of
	the software you installed.
      </p><p>
	Compile and link the C example program:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ . /opt/lixa/bin/lixa_env.sh 
tiian@ubuntu1404-64:~/tmp$ gcc example_xta_macc01.c $(lixa-config -x -c -f -l -d) \
&gt; -I/opt/oracle/instantclient_12_1/sdk/include \
&gt; -L/opt/oracle/instantclient_12_1 \
&gt; -Wl,-rpath -Wl,/opt/oracle/instantclient_12_1 \
&gt; -l clntsh -l nnz12 -o example_xta_macc01
	  </pre></td></tr></tbody></table></div><p>
      </p><p>
	If the previous steps worked for you, you should have an executable file
	of name <code class="filename">example_xta_sa01</code> in your current 
	directory:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ ls -l
total 36
-rwxrwxr-x 1 tiian tiian 18647 mar 27 21:51 example_xta_macc01
-rw-r--r-- 1 tiian tiian 12828 mar 27 21:50 example_xta_macc01.c
	  </pre></td></tr></tbody></table></div><p>
	The example program accepts four arguments:
	</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	    commit (or rollback): use <span class="quote">“<span class="quote">1</span>”</span> if you want to perform
	    a global commit or <span class="quote">“<span class="quote">0</span>”</span> if you want to perform a global
	    rollback
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	    insert (or delete): use <span class="quote">“<span class="quote">1</span>”</span> if you want to insert rows
	    in databases or <span class="quote">“<span class="quote">0</span>”</span> if you want to delete rows from
	    databases
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	    superior (or subordinate): use <span class="quote">“<span class="quote">1</span>”</span> if you want to
	    execute the <span class="quote">“<span class="quote">superior</span>”</span> part depicted in the
	    sequence diagram (<span class="quote">“<span class="quote">Application Program 1</span>”</span>) or
	    <span class="quote">“<span class="quote">0</span>”</span> if you want to execute the
	    <span class="quote">“<span class="quote">subordinate</span>”</span> part depicted in the sequence diagram
	    (<span class="quote">“<span class="quote">Application Program 2</span>”</span>)
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	    XIDfilename: a valid name for a file that must be used to transfer
	    XID (Transaction ID) from <span class="quote">“<span class="quote">Application Program 1</span>”</span> to
	    <span class="quote">“<span class="quote">Application Program 2</span>”</span>; XIDfilename can be the name
	    of a regular file or of a FIFO (named pipe)
	  </p></li></ul></div><p>
      </p><p>
	Open three terminal sessions: one for Application Program 1
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP1]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ ls -la
total 44
drwxrwxr-x  2 tiian tiian  4096 mar 27 22:06 .
drwxr-xr-x 12 tiian tiian  4096 mar 27 21:52 ..
-rwxrwxr-x  1 tiian tiian 18647 mar 27 21:51 example_xta_macc01
-rw-r--r--  1 tiian tiian 12828 mar 27 21:50 example_xta_macc01.c
	  </pre></td></tr></tbody></table></div><p>
	another one for Application Program 2
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP2]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ ls -la
total 44
drwxrwxr-x  2 tiian tiian  4096 mar 27 22:06 .
drwxr-xr-x 12 tiian tiian  4096 mar 27 21:52 ..
-rwxrwxr-x  1 tiian tiian 18647 mar 27 21:51 example_xta_macc01
-rw-r--r--  1 tiian tiian 12828 mar 27 21:50 example_xta_macc01.c
	  </pre></td></tr></tbody></table></div><p>
	and the last one for Oracle <span class="command"><strong>sqlplus</strong></span> client
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - Oracle]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~$ . ./oracle_env.sh 
tiian@ubuntu1404-64:~$ sqlplus hr/hr@lixa_ora_db

SQL*Plus: Release 12.1.0.2.0 Production on Tue Mar 27 22:08:39 2018

Copyright (c) 1982, 2014, Oracle.  All rights reserved.

Last Successful login time: Tue Mar 27 2018 22:00:12 +02:00

Connected to:
Oracle Database 12c Standard Edition Release 12.1.0.2.0 - 64bit Production

SQL&gt;
	  </pre></td></tr></tbody></table></div><p>
	create a FIFO (named pipe) in current directory:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP1]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ mkfifo xid.fifo
tiian@ubuntu1404-64:~/tmp$ ls -la
total 44
drwxrwxr-x  2 tiian tiian  4096 mar 27 22:10 .
drwxr-xr-x 12 tiian tiian  4096 mar 27 21:52 ..
-rwxrwxr-x  1 tiian tiian 18647 mar 27 21:51 example_xta_macc01
-rw-r--r--  1 tiian tiian 12828 mar 27 21:50 example_xta_macc01.c
prw-rw-r--  1 tiian tiian     0 mar 27 22:10 xid.fifo
	  </pre></td></tr></tbody></table></div><p>
	set <code class="varname">LIXA_PROFILE</code> environment variable to
	<code class="constant">XTA_DYN</code> a profile without static 
	Resource Managers defined in
	<code class="filename">lixac_conf.xml</code>:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP1]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ export LIXA_PROFILE=XTA_DYN
tiian@ubuntu1404-64:~/tmp$ echo $LIXA_PROFILE
XTA_DYN
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP2]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ export LIXA_PROFILE=XTA_DYN
tiian@ubuntu1404-64:~/tmp$ echo $LIXA_PROFILE
XTA_DYN
	  </pre></td></tr></tbody></table></div><p>
	in the first terminal session, start
	<span class="command"><strong>example_xta_macc01</strong></span> in the role of AP1 and in the
	second terminal session, start <span class="command"><strong>example_xta_macc01</strong></span>
	in the role of AP2
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP1]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ ./example_xta_macc01 1 1 1 xid.fifo 
OCI statement &gt;INSERT INTO authors (ID, LAST_NAME, FIRST_NAME) VALUES(1930, 'Bonatti', 'Walter')&lt; completed
XID='1279875137.67f9ed180b7f4fe8a9d0f749a0f9e90b.5ed2d6ffa60ad419517220dd5ab2719e' has been written in file 'xid.fifo'
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP2]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ ./example_xta_macc01 1 1 0 xid.fifo 
XID='1279875137.67f9ed180b7f4fe8a9d0f749a0f9e90b.5ed2d6ffa60ad419517220dd5ab2719e' has been read from file 'xid.fifo'
OCI statement &gt;INSERT INTO authors (ID, LAST_NAME, FIRST_NAME) VALUES(1948, 'Casarotto', 'Renato')&lt; completed
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	  Application Program 1 suspends its execution and waits 
	  Application Program 2 start: this is a consequence of the FIFO
	  behavior
	</p></div><p>
	check Oracle table content:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - Oracle]</td></tr></thead><tbody><tr><td><pre class="screen">
SQL&gt; select * from authors;

ID         LAST_NAME            FIRST_NAME
---------- -------------------- --------------------
1930       Bonatti              Walter
1948       Casarotto            Renato

	  </pre></td></tr></tbody></table></div><p>
	if you start the superior and subordinate Application Program in the
	right order you can use even a regular file instead of the named FIFO
	(pipe); try to perform a <span class="command"><strong>SQL DELETE</strong></span> followed
	by a rollback using the name of a temporary file to use:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP1]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ ./example_xta_macc01 0 0 1 xid2.fifo
OCI statement &gt;DELETE FROM authors WHERE ID=1930&lt; completed
XID='1279875137.1f31836dab1a4081b488a9b3565faaa4.7b4180ecb8fee8c12cbc13637ab4eabb' has been written in file 'xid2.fifo'
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP2]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ ./example_xta_macc01 0 0 0 xid2.fifo
XID='1279875137.1f31836dab1a4081b488a9b3565faaa4.7b4180ecb8fee8c12cbc13637ab4eabb' has been read from file 'xid2.fifo'
OCI statement &gt;DELETE FROM authors WHERE ID=1948&lt; completed
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	  Application Program 1 ends its execution without waiting for
	  Application Program 2 start: this is a consequence of the regular
	  file behavior
	</p></div><p>
	check Oracle table content:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - Oracle]</td></tr></thead><tbody><tr><td><pre class="screen">
SQL&gt; select * from authors;

ID         LAST_NAME            FIRST_NAME
---------- -------------------- --------------------
1930       Bonatti              Walter
1948       Casarotto            Renato

	  </pre></td></tr></tbody></table></div><p>
	as expected, the two rows are still in the table because the XA global
	transaction has been rolled back by Application Program 2; XA functions
	executed by Oracle can be inspected in its trace file:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP1]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ tail -n 30 /tmp/xa_NULL03272018.trc 
224024.9416.4016678528.2:
xaorollback: xid=0x4c495841-1f31836dab1a4081b488a9b3565faaa4-7b4180ecb8fee8c12cbc13637ab4eabb, rmid=0, flags=0x0


224024.9416.4016678528.2:
OCITransRollback: Attempting


224024.9416.4016678528.2:
OCITransRollback: Succeeded


224024.9416.4016678528.2:
xaorollback: rtn 0


224024.9416.4016678528.2:
xaoclose: xa_info=, rmid=0, flags=0x0


224024.9416.4016678528.2:
OCIServerDetach: Attempting


224024.9416.4016678528.2:
OCIServerDetach: Succeeded


224024.9416.4016678528.2:
xaoclose: rtn 0
	  </pre></td></tr></tbody></table></div><p>
	to complete the exercise, perform a <span class="command"><strong>SQL DELETE</strong></span>
	followed by a commit:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP1]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ ./example_xta_macc01 1 0 1 xid.fifo
OCI statement &gt;DELETE FROM authors WHERE ID=1930&lt; completed
XID='1279875137.bfd10e4a5fc541f587727304ae34cccf.7b4180ecb8fee8c12cbc13637ab4eabb' has been written in file 'xid.fifo'
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP2]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ ./example_xta_macc01 1 0 0 xid.fifo
XID='1279875137.bfd10e4a5fc541f587727304ae34cccf.7b4180ecb8fee8c12cbc13637ab4eabb' has been read from file 'xid.fifo'
OCI statement &gt;DELETE FROM authors WHERE ID=1948&lt; completed
	  </pre></td></tr></tbody></table></div><p>
	check Oracle table content:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - Oracle]</td></tr></thead><tbody><tr><td><pre class="screen">
SQL&gt; select * from authors;

no rows selected

	  </pre></td></tr></tbody></table></div><p>
	Finally the table is empty; XA functions
	executed by Oracle can be inspected in its trace file:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP1]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ tail -n 50 /tmp/xa_NULL03272018.trc 
225247.14985.1108846208.0:
xaostart: return XA_OK


225247.14985.1108846208.0:
xaoend: xid=0x4c495841-bfd10e4a5fc541f587727304ae34cccf-7b4180ecb8fee8c12cbc13637ab4eabb, rmid=0, flags=0x4000000


225247.14985.1108846208.0:
OCITransDetach: Attempting


225247.14985.1108846208.0:
OCITransDetach: Succeeded


225247.14985.1108846208.0:
xaoend: return 0


225247.14985.1108846208.0:
xaocommit: xid=0x4c495841-bfd10e4a5fc541f587727304ae34cccf-7b4180ecb8fee8c12cbc13637ab4eabb, rmid=0, flags=0x40000000


225247.14985.1108846208.0:
OCITransCommit: Attempting


225247.14985.1108846208.0:
OCITransCommit: Succeeded


225247.14985.1108846208.0:
xaocommit: rtn 0


225247.14985.1108846208.0:
xaoclose: xa_info=, rmid=0, flags=0x0


225247.14985.1108846208.0:
OCIServerDetach: Attempting


225247.14985.1108846208.0:
OCIServerDetach: Succeeded


225247.14985.1108846208.0:
xaoclose: rtn 0
	  </pre></td></tr></tbody></table></div><p>
	The trace shows that XTA performed a <span class="quote">“<span class="quote">one phase commit</span>”</span>
	instead of a <span class="quote">“<span class="quote">two phase commit</span>”</span> because there's only one
	Resource Manager (hint: function <code class="function">xaoprepare</code> has
	not been called by the Transaction Manager).
      </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp59738432"></a>Source Code</h4></div></div></div><p>
	  Source code for program <code class="filename">example_xta_macc01.c</code> is
	  installed in directory
	  <code class="filename">/opt/lixa/share/doc/lixa-X.Y.Z/examples/xta</code>
	  and is available on <a class="link" href="https://github.com/tiian/lixa/blob/master/doc/examples/xta/example_xta_macc01.c" target="_top">GitHub</a>.
	  Source code is fully commented for readability.
	</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp59783520"></a>An example using the C++ language</h3></div></div></div><p>
	The supplied example (<code class="filename">example_xta_macc11.cpp</code>) uses
	Oracle in the role of <span class="quote">“<span class="quote">Resource Manager 1</span>”</span>; please
	refer to the instructions explained:
	</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	    in <a class="xref" href="apas02.html#App_RM_Config_Oracle_Remote" title="Remote configuration (Instant Client) and OCI">the section called “Remote configuration (Instant Client) and OCI”</a> 
	    to set-up the correct client/server configuration for Oracle
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	    in <a class="xref" href="ch04.html#Starting_the_state_server" title="Starting the state server (lixad)">the section called “Starting the state server (<span class="command"><strong>lixad</strong></span>)”</a>
	    to start up the LIXA state server
	  </p></li></ul></div><p>
      </p><p>
	Create a working directory in a place you are comfortable with:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~$ cd
tiian@ubuntu1404-64:~$ mkdir tmp
tiian@ubuntu1404-64:~$ cd tmp
tiian@ubuntu1404-64:~/tmp$ 
	  </pre></td></tr></tbody></table></div><p>
      </p><p>
	Copy file <code class="filename">example_xta_macc11.cpp</code> in your working
	dir:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
	    tiian@ubuntu:~/tmp$ cp /opt/lixa/share/doc/lixa-X.Y.Z/examples/xta/cpp/example_xta_macc11.cpp .
	  </pre></td></tr></tbody></table></div><p>
	Substitute <span class="quote">“<span class="quote">X.Y.Z</span>”</span> with the actual version of
	the software you installed.
      </p><p>
	Compile and link the C++ example program:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ . /opt/lixa/bin/lixa_env.sh 
tiian@ubuntu1404-64:~/tmp$ g++ example_xta_macc11.cpp \
&gt; $(lixa-config -c -f -l -d --xta --language-cpp) \
&gt; -I/opt/oracle/instantclient_12_1/sdk/include \
&gt; -L/opt/oracle/instantclient_12_1 -Wl,-rpath \
&gt; -Wl,/opt/oracle/instantclient_12_1 -l clntsh -l nnz12 -o example_xta_macc11
	  </pre></td></tr></tbody></table></div><p>
      </p><p>
	If the previous steps worked for you, you should have an executable
	file of name <code class="filename">example_xta_macc11</code> in your current 
	directory:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ ls -l
total 40
-rwxrwxr-x 1 tiian tiian 26479 ago 26 11:54 example_xta_macc11
-rw-r--r-- 1 tiian tiian 11440 ago 26 11:43 example_xta_macc11.cpp
	  </pre></td></tr></tbody></table></div><p>
	The example program accepts four arguments:
	</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	    commit (or rollback): use <span class="quote">“<span class="quote">1</span>”</span> if you want to perform
	    a global commit or <span class="quote">“<span class="quote">0</span>”</span> if you want to perform a global
	    rollback
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	    insert (or delete): use <span class="quote">“<span class="quote">1</span>”</span> if you want to insert rows
	    in databases or <span class="quote">“<span class="quote">0</span>”</span> if you want to delete rows from
	    databases
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	    superior (or subordinate): use <span class="quote">“<span class="quote">1</span>”</span> if you want to
	    execute the <span class="quote">“<span class="quote">superior</span>”</span> part depicted in the
	    sequence diagram (<span class="quote">“<span class="quote">Application Program 1</span>”</span>) or
	    <span class="quote">“<span class="quote">0</span>”</span> if you want to execute the
	    <span class="quote">“<span class="quote">subordinate</span>”</span> part depicted in the sequence diagram
	    (<span class="quote">“<span class="quote">Application Program 2</span>”</span>)
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	    XIDfilename: a valid name for a file that must be used to transfer
	    XID (Transaction ID) from <span class="quote">“<span class="quote">Application Program 1</span>”</span> to
	    <span class="quote">“<span class="quote">Application Program 2</span>”</span>; XIDfilename can be the name
	    of a regular file or of a FIFO (named pipe)
	  </p></li></ul></div><p>
      </p><p>
	Open three terminal sessions: one for Application Program 1
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP1]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ ls -la
total 48
drwxrwxr-x  2 tiian tiian  4096 ago 26 11:55 .
drwxr-xr-x 12 tiian tiian  4096 ago 26 11:43 ..
-rwxrwxr-x  1 tiian tiian 26479 ago 26 11:54 example_xta_macc11
-rw-r--r--  1 tiian tiian 11440 ago 26 11:43 example_xta_macc11.cpp
	  </pre></td></tr></tbody></table></div><p>
	another one for Application Program 2
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP2]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ ls -la
total 48
drwxrwxr-x  2 tiian tiian  4096 ago 26 11:55 .
drwxr-xr-x 12 tiian tiian  4096 ago 26 11:43 ..
-rwxrwxr-x  1 tiian tiian 26479 ago 26 11:54 example_xta_macc11
-rw-r--r--  1 tiian tiian 11440 ago 26 11:43 example_xta_macc11.cpp
	  </pre></td></tr></tbody></table></div><p>
	and the last one for Oracle <span class="command"><strong>sqlplus</strong></span> client
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - Oracle]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~$ . ./oracle_env.sh 
tiian@ubuntu1404-64:~$ sqlplus hr/hr@lixa_ora_db

SQL*Plus: Release 12.1.0.2.0 Production on Tue Mar 27 22:08:39 2018

Copyright (c) 1982, 2014, Oracle.  All rights reserved.

Last Successful login time: Sun Aug 26 2018 11:42:15 +02:00

Connected to:
Oracle Database 12c Standard Edition Release 12.1.0.2.0 - 64bit Production

SQL&gt;
	  </pre></td></tr></tbody></table></div><p>
	create a FIFO (named pipe) in current directory:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP1]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ mkfifo xid.fifo
tiian@ubuntu1404-64:~/tmp$ ls -la
total 48
drwxrwxr-x  2 tiian tiian  4096 ago 26 11:58 .
drwxr-xr-x 12 tiian tiian  4096 ago 26 11:57 ..
-rwxrwxr-x  1 tiian tiian 26479 ago 26 11:54 example_xta_macc11
-rw-r--r--  1 tiian tiian 11440 ago 26 11:43 example_xta_macc11.cpp
prw-rw-r--  1 tiian tiian     0 ago 26 11:58 xid.fifo
	  </pre></td></tr></tbody></table></div><p>
	set <code class="varname">LIXA_PROFILE</code> environment variable to
	<code class="constant">XTA_DYN</code> a profile without static 
	Resource Managers defined in
	<code class="filename">lixac_conf.xml</code>:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP1]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ export LIXA_PROFILE=XTA_DYN
tiian@ubuntu1404-64:~/tmp$ echo $LIXA_PROFILE
XTA_DYN
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP2]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ export LIXA_PROFILE=XTA_DYN
tiian@ubuntu1404-64:~/tmp$ echo $LIXA_PROFILE
XTA_DYN
	  </pre></td></tr></tbody></table></div><p>
	in the first terminal session, start
	<span class="command"><strong>example_xta_macc11</strong></span> in the role of AP1 and in the
	second terminal session, start <span class="command"><strong>example_xta_macc11</strong></span>
	in the role of AP2
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP1]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ ./example_xta_macc11 1 1 1 xid.fifo 
OCI statement &gt;INSERT INTO authors (ID, LAST_NAME, FIRST_NAME) VALUES(1930, 'Bonatti', 'Walter')&lt; completed
XID='1279875137.bd729d47f71b408e92c332a64502e068.7b4180ecb8fee8c12cbc13637ab4eabb' has been written to file 'xid.fifo'
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP2]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ ./example_xta_macc11 1 1 0 xid.fifo 
XID='1279875137.bd729d47f71b408e92c332a64502e068.7b4180ecb8fee8c12cbc13637ab4eabb' has been read from file 'xid.fifo'
OCI statement &gt;INSERT INTO authors (ID, LAST_NAME, FIRST_NAME) VALUES(1948, 'Casarotto', 'Renato')&lt; completed
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	  Application Program 1 suspends its execution and waits 
	  Application Program 2 start: this is a consequence of the FIFO
	  behavior
	</p></div><p>
	check Oracle table content:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - Oracle]</td></tr></thead><tbody><tr><td><pre class="screen">
SQL&gt; select * from authors;

ID         LAST_NAME            FIRST_NAME
---------- -------------------- --------------------
1930       Bonatti              Walter
1948       Casarotto            Renato

	  </pre></td></tr></tbody></table></div><p>
	if you start the superior and subordinate Application Program in the
	right order you can use even a regular file instead of the named FIFO
	(pipe); try to perform a <span class="command"><strong>SQL DELETE</strong></span> followed
	by a rollback using the name of a temporary file to use:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP1]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ ./example_xta_macc11 0 0 1 xid2.fifo
OCI statement &gt;DELETE FROM authors WHERE ID=1930&lt; completed
XID='1279875137.f54399449c1d409c999dc8010e7d6e9f.7b4180ecb8fee8c12cbc13637ab4eabb' has been written to file 'xid2.fifo'
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP2]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ ./example_xta_macc11 0 0 0 xid2.fifo
XID='1279875137.f54399449c1d409c999dc8010e7d6e9f.7b4180ecb8fee8c12cbc13637ab4eabb' has been read from file 'xid2.fifo'
OCI statement &gt;DELETE FROM authors WHERE ID=1948&lt; completed
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	  Application Program 1 ends its execution without waiting for
	  Application Program 2 start: this is a consequence of the regular
	  file behavior
	</p></div><p>
	check Oracle table content:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - Oracle]</td></tr></thead><tbody><tr><td><pre class="screen">
SQL&gt; select * from authors;

ID         LAST_NAME            FIRST_NAME
---------- -------------------- --------------------
1930       Bonatti              Walter
1948       Casarotto            Renato

	  </pre></td></tr></tbody></table></div><p>
	as expected, the two rows are still in the table because the XA global
	transaction has been rolled back by Application Program 2; XA functions
	executed by Oracle can be inspected in its trace file:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP1]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ tail -n 30 /tmp/xa_NULL08262018.trc 
120438.18832.1685579456.0:
xaorollback: xid=0x4c495841-f54399449c1d409c999dc8010e7d6e9f-7b4180ecb8fee8c12cbc13637ab4eabb, rmid=0, flags=0x0


120438.18832.1685579456.0:
OCITransRollback: Attempting


120438.18832.1685579456.0:
OCITransRollback: Succeeded


120438.18832.1685579456.0:
xaorollback: rtn 0


120438.18832.1685579456.0:
xaoclose: xa_info=, rmid=0, flags=0x0


120438.18832.1685579456.0:
OCIServerDetach: Attempting


120438.18832.1685579456.0:
OCIServerDetach: Succeeded


120438.18832.1685579456.0:
xaoclose: rtn 0
	  </pre></td></tr></tbody></table></div><p>
	to complete the exercise, perform a <span class="command"><strong>SQL DELETE</strong></span>
	followed by a commit:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP1]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ ./example_xta_macc11 1 0 1 xid.fifo
OCI statement &gt;DELETE FROM authors WHERE ID=1930&lt; completed
XID='1279875137.d1c98d095a64415eb7370fc781af25d9.7b4180ecb8fee8c12cbc13637ab4eabb' has been written to file 'xid.fifo'
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP2]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ ./example_xta_macc11 1 0 0 xid.fifo
XID='1279875137.d1c98d095a64415eb7370fc781af25d9.7b4180ecb8fee8c12cbc13637ab4eabb' has been read from file 'xid.fifo'
OCI statement &gt;DELETE FROM authors WHERE ID=1948&lt; completed
	  </pre></td></tr></tbody></table></div><p>
	check Oracle table content:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - Oracle]</td></tr></thead><tbody><tr><td><pre class="screen">
SQL&gt; select * from authors;

no rows selected

	  </pre></td></tr></tbody></table></div><p>
	Finally the table is empty; XA functions
	executed by Oracle can be inspected in its trace file:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP1]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ tail -n 50 /tmp/xa_NULL08262018.trc 
120832.23393.3240638144.0:
xaoclose: rtn 0


120832.23394.1448613568.0:
xaoend: xid=0x4c495841-d1c98d095a64415eb7370fc781af25d9-7b4180ecb8fee8c12cbc13637ab4eabb, rmid=0, flags=0x4000000


120832.23394.1448613568.0:
OCITransDetach: Attempting


120832.23394.1448613568.0:
OCITransDetach: Succeeded


120832.23394.1448613568.0:
xaoend: return 0


120832.23394.1448613568.0:
xaocommit: xid=0x4c495841-d1c98d095a64415eb7370fc781af25d9-7b4180ecb8fee8c12cbc13637ab4eabb, rmid=0, flags=0x40000000


120832.23394.1448613568.0:
OCITransCommit: Attempting


120832.23394.1448613568.0:
OCITransCommit: Succeeded


120832.23394.1448613568.0:
xaocommit: rtn 0


120832.23394.1448613568.0:
xaoclose: xa_info=, rmid=0, flags=0x0


120832.23394.1448613568.0:
OCIServerDetach: Attempting


120832.23394.1448613568.0:
OCIServerDetach: Succeeded


120832.23394.1448613568.0:
xaoclose: rtn 0
	  </pre></td></tr></tbody></table></div><p>
	The trace shows that XTA performed a <span class="quote">“<span class="quote">one phase commit</span>”</span>
	instead of a <span class="quote">“<span class="quote">two phase commit</span>”</span> because there's only one
	Resource Manager (hint: function <code class="function">xaoprepare</code> has
	not been called by the Transaction Manager).
      </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp59806736"></a>Source Code</h4></div></div></div><p>
	  Source code for program <code class="filename">example_xta_macc11.cpp</code>
	  is installed in directory
	  <code class="filename">/opt/lixa/share/doc/lixa-X.Y.Z/examples/xta/cpp</code>
	  and is available on <a class="link" href="https://github.com/tiian/lixa/blob/master/doc/examples/xta/cpp/example_xta_macc11.cpp" target="_top">GitHub</a>.
	  Source code is fully commented for readability.
	</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp59851872"></a>An example using the Java language</h3></div></div></div><p>
	The supplied example (<code class="filename">ExampleXtaMACC31.java</code>) uses
	Oracle in the role of <span class="quote">“<span class="quote">Resource Manager 1</span>”</span>; please
	refer to the instructions explained:
	</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	    in <a class="xref" href="apas02.html#App_RM_Config_Oracle_Remote" title="Remote configuration (Instant Client) and OCI">the section called “Remote configuration (Instant Client) and OCI”</a> 
	    to set-up the correct client/server configuration for Oracle
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	    in <a class="xref" href="ch04.html#Starting_the_state_server" title="Starting the state server (lixad)">the section called “Starting the state server (<span class="command"><strong>lixad</strong></span>)”</a>
	    to start up the LIXA state server
	  </p></li></ul></div><p>
      </p><p>
	Create a working directory in a place you are comfortable with:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~$ cd
tiian@ubuntu1404-64:~$ mkdir tmp
tiian@ubuntu1404-64:~$ cd tmp
tiian@ubuntu1404-64:~/tmp$ 
	  </pre></td></tr></tbody></table></div><p>
      </p><p>
	Copy file <code class="filename">ExampleXtaMACC31.java</code> in your working
	dir:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ cp /opt/lixa/share/doc/lixa-X.Y.Z/examples/xta/java/ExampleXtaMACC31.java .
	  </pre></td></tr></tbody></table></div><p>
	Substitute <span class="quote">“<span class="quote">X.Y.Z</span>”</span> with the actual version of
	the software you installed.
      </p><p>
	Use the proper path for the Oracle Database jar file, then compile
	the Java example program with something like: 
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ javac -cp /opt/lixa/share/lixa/java/xta.jar:/opt/oracle/OJDBC-Full/ojdbc7.jar ExampleXtaMACC31.java
	  </pre></td></tr></tbody></table></div><p>
      </p><p>
	If the previous steps worked for you, you should have a class file of
	name <code class="filename">ExampleXtaMACC31.class</code> in your current
	directory: 
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ ls -l
total 20
-rw-rw-r-- 1 tiian tiian 4361 gen 15 22:00 ExampleXtaMACC31.class
-rw-r--r-- 1 tiian tiian 9655 gen 15 21:57 ExampleXtaMACC31.java
	  </pre></td></tr></tbody></table></div><p>
	The example program accepts four arguments:
	</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	    commit (or rollback): use <span class="quote">“<span class="quote">1</span>”</span> if you want to perform
	    a global commit or <span class="quote">“<span class="quote">0</span>”</span> if you want to perform a global
	    rollback
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	    insert (or delete): use <span class="quote">“<span class="quote">1</span>”</span> if you want to insert rows
	    in databases or <span class="quote">“<span class="quote">0</span>”</span> if you want to delete rows from
	    databases
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	    superior (or subordinate): use <span class="quote">“<span class="quote">1</span>”</span> if you want to
	    execute the <span class="quote">“<span class="quote">superior</span>”</span> part depicted in the
	    sequence diagram (<span class="quote">“<span class="quote">Application Program 1</span>”</span>) or
	    <span class="quote">“<span class="quote">0</span>”</span> if you want to execute the
	    <span class="quote">“<span class="quote">subordinate</span>”</span> part depicted in the sequence diagram
	    (<span class="quote">“<span class="quote">Application Program 2</span>”</span>)
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	    XIDfilename: a valid name for a file that must be used to transfer
	    XID (Transaction ID) from <span class="quote">“<span class="quote">Application Program 1</span>”</span> to
	    <span class="quote">“<span class="quote">Application Program 2</span>”</span>; XIDfilename can be the name
	    of a regular file or of a FIFO (named pipe)
	  </p></li></ul></div><p>
      </p><p>
	Open three terminal sessions: one for Application Program 1
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP1]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ ls -la
total 28
drwxrwxr-x  2 tiian tiian 4096 gen 15 21:59 .
drwxr-xr-x 17 tiian tiian 4096 gen 15 21:52 ..
-rw-rw-r--  1 tiian tiian 4361 gen 15 22:00 ExampleXtaMACC31.class
-rw-r--r--  1 tiian tiian 9655 gen 15 21:57 ExampleXtaMACC31.java
	  </pre></td></tr></tbody></table></div><p>
	another one for Application Program 2
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP2]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ ls -la
total 28
drwxrwxr-x  2 tiian tiian 4096 gen 15 21:59 .
drwxr-xr-x 17 tiian tiian 4096 gen 15 21:52 ..
-rw-rw-r--  1 tiian tiian 4361 gen 15 22:00 ExampleXtaMACC31.class
-rw-r--r--  1 tiian tiian 9655 gen 15 21:57 ExampleXtaMACC31.java
	  </pre></td></tr></tbody></table></div><p>
	and the last one for Oracle <span class="command"><strong>sqlplus</strong></span> client
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - Oracle]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~$ . ./oracle_env.sh 
tiian@ubuntu1404-64:~$ sqlplus hr/hr@lixa_ora_db

SQL*Plus: Release 12.1.0.2.0 Production on Tue Mar 27 22:08:39 2018

Copyright (c) 1982, 2014, Oracle.  All rights reserved.

Last Successful login time: Sun Aug 26 2018 11:42:15 +02:00

Connected to:
Oracle Database 12c Standard Edition Release 12.1.0.2.0 - 64bit Production

SQL&gt;
	  </pre></td></tr></tbody></table></div><p>
	create a FIFO (named pipe) in current directory:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP1]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ mkfifo xid.fifo
tiian@ubuntu1404-64:~/tmp$ ls -la
total 28
drwxrwxr-x  2 tiian tiian 4096 gen 15 22:06 .
drwxr-xr-x 17 tiian tiian 4096 gen 15 21:52 ..
-rw-rw-r--  1 tiian tiian 4361 gen 15 22:00 ExampleXtaMACC31.class
-rw-r--r--  1 tiian tiian 9655 gen 15 21:57 ExampleXtaMACC31.java
prw-rw-r--  1 tiian tiian    0 gen 15 22:06 xid.fifo
	  </pre></td></tr></tbody></table></div><p>
	set <code class="varname">LIXA_PROFILE</code> environment variable to
	<code class="constant">XTA_DYN</code> a profile without static 
	Resource Managers defined in
	<code class="filename">lixac_conf.xml</code>:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP1]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ export LIXA_PROFILE=XTA_DYN
tiian@ubuntu1404-64:~/tmp$ echo $LIXA_PROFILE
XTA_DYN
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP2]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ export LIXA_PROFILE=XTA_DYN
tiian@ubuntu1404-64:~/tmp$ echo $LIXA_PROFILE
XTA_DYN
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3>
	  Oracle JDBC client requires an entropy generator as explained
	  <a class="link" href="http://www.usn-it.de/index.php/2009/02/20/oracle-11g-jdbc-driver-hangs-blocked-by-devrandom-entropy-pool-empty/" target="_top">here</a>; at
	  least two options are available:
	  <div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	      the parameter
	      <em class="parameter"><code>-Djava.security.egd=file:/dev/./urandom
	      </code></em>
	      can be added to the command line
	    </p></li><li class="listitem" style="list-style-type: disc"><p>
	      an entropy generator, like <span class="command"><strong>rngd</strong></span> has been
	      properly configured and it's up and running
	    </p></li></ul></div></div><p>
	Supposing that <span class="command"><strong>rngs</strong></span> is running,
	in the first terminal session, start
	<span class="command"><strong>ExampleXtaMACC31</strong></span> in the role of AP1 and in the
	second terminal session, start <span class="command"><strong>ExampleXtaMACC31</strong></span>
	in the role of AP2
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP1]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ java -Djava.library.path=/opt/lixa/lib -cp /opt/lixa/share/lixa/java/xta.jar:/opt/oracle/OJDBC-Full/ojdbc7.jar:. ExampleXtaMACC31 1 1 1 xid.fifo
Oracle, executing &gt;INSERT INTO authors VALUES(1930, 'Bonatti', 'Walter')&lt;
XID='1279875137.320838774dc24d13a34a70675c1b4f72.308b817e7df229ddc410d4062b9a99cb' has been written to file 'xid.fifo'
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP2]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ java -Djava.library.path=/opt/lixa/lib -cp /opt/lixa/share/lixa/java/xta.jar:/opt/oracle/OJDBC-Full/ojdbc7.jar:. ExampleXtaMACC31 1 1 0 xid.fifo
XID='1279875137.320838774dc24d13a34a70675c1b4f72.308b817e7df229ddc410d4062b9a99cb' has been read from file 'xid.fifo'
Oracle, executing &gt;INSERT INTO authors VALUES(1948, 'Casarotto', 'Renato')&lt;
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	  Application Program 1 suspends its execution and waits 
	  Application Program 2 start: this is a consequence of the FIFO
	  behavior
	</p></div><p>
	check Oracle table content:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - Oracle]</td></tr></thead><tbody><tr><td><pre class="screen">
SQL&gt; select * from authors;

        ID LAST_NAME            FIRST_NAME
---------- -------------------- --------------------
      1948 Casarotto            Renato
      1930 Bonatti              Walter

	  </pre></td></tr></tbody></table></div><p>
	if you start the superior and subordinate Application Program in the
	right order you can use even a regular file instead of the named FIFO
	(pipe); try to perform a <span class="command"><strong>SQL DELETE</strong></span> followed
	by a rollback using the name of a temporary file to use:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP1]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ java -Djava.library.path=/opt/lixa/lib -cp /opt/lixa/share/lixa/java/xta.jar:/opt/oracle/OJDBC-Full/ojdbc7.jar:. ExampleXtaMACC31 0 0 1 xid2.fifo
Oracle, executing &gt;DELETE FROM authors WHERE id=1930&lt;
XID='1279875137.eab32ba6aecc45e7924ac51b4e970321.308b817e7df229ddc410d4062b9a99cb' has been written to file 'xid2.fifo'
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP2]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ java -Djava.library.path=/opt/lixa/lib -cp /opt/lixa/share/lixa/java/xta.jar:/opt/oracle/OJDBC-Full/ojdbc7.jar:. ExampleXtaMACC31 0 0 0 xid2.fifo
XID='1279875137.eab32ba6aecc45e7924ac51b4e970321.308b817e7df229ddc410d4062b9a99cb' has been read from file 'xid2.fifo'
Oracle, executing &gt;DELETE FROM authors WHERE id=1948&lt;
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	  Application Program 1 ends its execution without waiting for
	  Application Program 2 start: this is a consequence of the regular
	  file behavior
	</p></div><p>
	check Oracle table content:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - Oracle]</td></tr></thead><tbody><tr><td><pre class="screen">
SQL&gt; select * from authors;

        ID LAST_NAME            FIRST_NAME
---------- -------------------- --------------------
      1948 Casarotto            Renato
      1930 Bonatti              Walter

	  </pre></td></tr></tbody></table></div><p>
	as expected, the two rows are still in the table because the XA global
	transaction has been rolled back by Application Program 2.
	To complete the exercise, perform a <span class="command"><strong>SQL DELETE</strong></span>
	followed by a commit:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP1]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ java -Djava.library.path=/opt/lixa/lib -cp /opt/lixa/share/lixa/java/xta.jar:/opt/oracle/OJDBC-Full/ojdbc7.jar:. ExampleXtaMACC31 1 0 1 xid.fifo
Oracle, executing &gt;DELETE FROM authors WHERE id=1930&lt;
XID='1279875137.1015009fb4714fdb9a2545d76b369f48.308b817e7df229ddc410d4062b9a99cb' has been written to file 'xid.fifo'
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP2]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ java -Djava.library.path=/opt/lixa/lib -cp /opt/lixa/share/lixa/java/xta.jar:/opt/oracle/OJDBC-Full/ojdbc7.jar:. ExampleXtaMACC31 1 0 0 xid.fifo
XID='1279875137.1015009fb4714fdb9a2545d76b369f48.308b817e7df229ddc410d4062b9a99cb' has been read from file 'xid.fifo'
Oracle, executing &gt;DELETE FROM authors WHERE id=1948&lt;
	  </pre></td></tr></tbody></table></div><p>
	check Oracle table content:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - Oracle]</td></tr></thead><tbody><tr><td><pre class="screen">
SQL&gt; select * from authors;

no rows selected

	  </pre></td></tr></tbody></table></div><p>
	The table is now empty.
      </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp59874928"></a>Source Code</h4></div></div></div><p>
	  Source code for program <code class="filename">ExampleXtaMACC31.java</code>
	  is installed in directory
	  <code class="filename">/opt/lixa/share/doc/lixa-X.Y.Z/examples/xta/java</code>
	  and is available on <a class="link" href="https://github.com/tiian/lixa/blob/master/doc/examples/xta/java/ExampleXtaMACC31.java" target="_top">GitHub</a>.
	  Source code is fully commented for readability.
	</p></div></div><div class="footnotes"><br /><hr style="width:100; text-align:left;margin-left: 0" /><div id="ftn.idp59684928" class="footnote"><p><a href="#idp59684928" class="para"><sup class="para">[50] </sup></a>
	  Transaction Coupling (TC) TX extensions supports the pattern with
	  a traditional TX like interface
	  (see <a class="xref" href="ch07.html" title="Chapter 7. Developing C Application Programs with the Transaction Coupling (TC) TX extensions">Chapter 7, <em>Developing C Application Programs with the Transaction Coupling (TC) TX extensions</em></a>)
	</p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch08s02.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="ch08.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="ch08s04.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">The <span class="quote">“<span class="quote">Single Application</span>”</span> Pattern </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> The
    <span class="quote">“<span class="quote">Multiple Applications, Concurrent Branches/Pseudo Synchronous</span>”</span>
    Pattern</td></tr></table></div></body></html>