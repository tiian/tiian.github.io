<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>The “Multiple Applications, Concurrent Branches/Pseudo Synchronous” Pattern</title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="LIXA Reference Guide (version 1.9.3)" /><link rel="up" href="ch08.html" title="Chapter 8. Developing Application Programs using XTA (XA Transaction API) interface" /><link rel="prev" href="ch08s03.html" title="The “Multiple Applications, Consecutive Calls” Pattern" /><link rel="next" href="ch08s05.html" title="The “Multiple Applications, Concurrent Branches/Pseudo Asynchronous” Pattern" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">The
    <span class="quote">“<span class="quote">Multiple Applications, Concurrent Branches/Pseudo Synchronous</span>”</span>
    Pattern</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch08s03.html">Prev</a> </td><th width="60%" align="center">Chapter 8. Developing Application Programs using XTA (XA Transaction API) interface</th><td width="20%" align="right"> <a accesskey="n" href="ch08s05.html">Next</a></td></tr></table><hr /></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="xta_macbps"></a>The
    <span class="quote">“<span class="quote">Multiple Applications, Concurrent Branches/Pseudo Synchronous</span>”</span>
    Pattern</h2></div></div></div><div class="table"><table frame="box"><thead><tr><td>The pattern in brief:</td></tr></thead><tbody><tr>
	  <td>Architecture:</td>
	  <td>see <a class="xref" href="ch08.html#xta_arch03" title="Figure 8.3. Multiple applications layout">Figure 8.3, “Multiple applications layout”</a></td>
	</tr><tr>
	  <td>Number of Application Programs:</td>
	  <td>2 or more</td>
	</tr><tr>
	  <td>Number of Resource Managers:</td>
	  <td>1 or more for every Application Program</td>
	</tr><tr>
	  <td>Number of Branches in the Gloabal Transaction:</td>
	  <td>1 for every Application Program</td>
	</tr><tr>
	  <td>Concurrency among Application Programs:</td>
	  <td>yes, subordinate AP prepares the transaction, returns control to superior AP and finally completes commit</td>
	</tr></tbody></table></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp59986624"></a>Description</h3></div></div></div><p>
	This is a Distributed Transaction Processing pattern introduced by
	XTA: two or more Application Programs use any set of Resource
	Manager(s) and perform concurrent operations inside distinct branches
	of a common XA global transaction. The Resource Manager(s) must 
	support concurrent branches of the same global transaction: this is
	part of XA standard, but some resource managers might not support it.
      </p><p>
	The following picture shows an example that can be implemented, for
	example, using MySQL (or MariaDB) and PostgreSQL.
	</p><div class="figure"><a id="xta_pattern08"></a><p class="title"><strong>Figure 8.8. Example of <span class="quote">“<span class="quote">Multiple Applications, 
	  Consecutive Calls/Pseudo Synchronous</span>”</span> with two Application
	  Programs and two Resource Managers</strong></p><div class="figure-contents"><div class="mediaobject"><img src="../images/LIXA_Development_XTA_08.svg" alt="Example of “Multiple Applications, Consecutive Calls/Pseudo Synchronous” with two Application Programs and two Resource Managers" /></div></div></div><p><br class="figure-break" />
	The pattern can <span class="emphasis"><em>not</em></span> be implemented using the
	standard TX Transaction	Demarcation interface.
      </p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp59990848"></a>How it works</h3></div></div></div><div class="figure"><a id="xta_pattern09"></a><p class="title"><strong>Figure 8.9. Simplified sequence diagram for the
	<span class="quote">“<span class="quote">Multiple Applications, Concurrent Branches/Pseudo Synchronous</span>”</span>
	Pattern</strong></p><div class="figure-contents"><div class="mediaobject"><img src="../images/LIXA_Development_XTA_09.svg" alt="Simplified sequence diagram for the “Multiple Applications, Concurrent Branches/Pseudo Synchronous” Pattern" /></div></div></div><br class="figure-break" /><p>
	The above figure shows the logic necessary to build this type of
	applications; it's <span class="emphasis"><em>not</em></span> a formally correct UML
	sequence diagram (all the XTA objects are in the same lifeline), but
	it should be clear enough to understand the
	proper operations sequence:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	  Both the Application Programs perform some some initial steps like:
	  opening a native connection to the Resource Manager, creating a 
	  Transaction Manager object, a XA Resource Manager object, a
	  Transaction object and finally enlisting and opening the Resource
	  Manager
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	  The first AP, named <span class="quote">“<span class="quote">superior</span>”</span> using XA terminology,
	  <span class="emphasis"><em>starts</em></span> the global transaction and possibly
	  updates the state of its Resource Manager
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	  The first AP retrieves the XID associated to the global transaction
	  and starts some sort of <span class="quote">“<span class="quote">remote procedure call</span>”</span>
	  <a href="#ftn.idp59997360" class="footnote" id="idp59997360"><sup class="footnote">[50]</sup></a>
	  to invoke the second AP; it must pass the XID and all the application
	  context necessary to operate (this is not relevant to XTA)
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	  The second AP, named <span class="quote">“<span class="quote">subordinate</span>”</span> using XA terminology,
	  <span class="emphasis"><em>branches</em></span> the global transaction and
	  possibly updates the state of its Resource Manager
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	  The second AP <span class="emphasis"><em>starts</em></span> the first phase of the
	  distributed <span class="emphasis"><em>commit</em></span> specifying 
	  <span class="quote">“<span class="quote">non_block=TRUE</span>”</span> option: this translates in performing
	  <span class="quote">“<span class="quote">XA prepare</span>”</span> without performing <span class="quote">“<span class="quote">XA commit</span>”</span>
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	  At the end of the first phase of the distributed commit, the second
	  AP responds to first AP: typically a return code related to commit
	  operation
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	  Since then now, both the APs can run concurrently to complete the
	  distributed <span class="emphasis"><em>commit</em></span> specifying 
	  <span class="quote">“<span class="quote">non_block=FALSE</span>”</span> option (in the provided example,
	  the first AP performs another update to its Resource Manager before
	  committing)
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	  The last operations are related to clean-up
	</p></li></ul></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	The dashed red rectangle highlights the XA global transaction.
      </p></div><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
	These are the relevant elements of this pattern:
	</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	    it's designed for a typical client/server approach with some sort
	    of request-response communication protocol in place
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	    the Application Programs run concurrently, but synchronize 
	    themselves by mean of the communication protocol and the LIXA
	    state server: the second phase of the two phase commit protocol
	    can be started only after the completion of the first phase by all
	    the participants
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	    the second Application Program can <span class="emphasis"><em>not</em></span> 
	    terminate immediately after returning the response to the caller:
	    it must perform the second phase of the two phase commit protocol
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	    the first Application Program can perform Resource Manager related
	    operations <span class="emphasis"><em>before and after</em></span> the call to the
	    second Application Program
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	    the diagram shows an example with two Application Programs, but
	    the pattern can be applied to any number of Application 
	    Programs: a subordinate AP can become a superior AP of a called
	    subordinate AP and so on
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	    the diagram shows an example with only one Resource Manager for
	    every Application Program, but there's no restriction on
	    LIXA and XTA side, on the number of Resource Managers used by an
	    Application Program
	  </p></li></ul></div><p>
      </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp60011056"></a>Known limitations</h3></div></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	Not all the Resource Managers have implemented the XA specifications
	in the same way. This section tracks some limitations that have been
	reported by the LIXA project.
      </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp60012016"></a>Oracle JDBC thin optimizations</h4></div></div></div><p>
	  As described in Oracle's official documentation
	  <a href="#ftn.idp60012720" class="footnote" id="idp60012720"><sup class="footnote">[51]</sup></a>
	  at paragraph 30-15 <span class="quote">“<span class="quote">Oracle XA Optimizations</span>”</span>, Oracle
	  JDBC implements additional logic, in comparison with the XA
	  specifications, when two ore more branches of the same global
	  transaction are related to the same Oracle Database instance.
	</p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
	  In the event that both AP1 and AP2 use the same Oracle Database
	  instance strange behaviors could be reported. Furthermore, the second
	  call to <code class="function">rm.doSomething()</code> from AP1 could fail as
	  described in this
	  <a class="link" href="https://access.redhat.com/solutions/892813" target="_top">case</a>
	  documented by Red hat, with error 
	  <span class="quote">“<span class="quote">ORA-02051: another session or branch in same transaction failed or finalized</span>”</span>. A relevant hypotesis described in the case is
	  <span class="quote">“<span class="quote">Oracle seems to disallow attempt to execute SQL on a
	  transaction branch when another branch in the same global transaction
	  has already prepared its transaction</span>”</span>.
	</p></div><p>
	  On the other hand, no such limitation has been found in the Oracle
	  OCI interface for C and C++.
	</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp60017968"></a>An example using the C language</h3></div></div></div><p>
	The supplied examples (<code class="filename">example_xta_macbps01.c</code> and
	<code class="filename">example_xta_macbps02.c</code>) use
	PostgreSQL in the role of <span class="quote">“<span class="quote">Resource Manager 2</span>”</span> and MySQL
	(or MariaDB) in the role of <span class="quote">“<span class="quote">Resource Manager 1</span>”</span>; please
	refer to the instructions explained:
	</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	    in <a class="xref" href="apa.html#App_RM_Config_MySQL" title="MySQL/MariaDB Configuration">the section called “MySQL/MariaDB Configuration”</a>
	    to set-up a running environment for MySQL server
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	    in <a class="xref" href="apas03.html" title="PostgreSQL Configuration">the section called “PostgreSQL Configuration”</a>
	    to set-up a running environment for PostgreSQL server
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	    in <a class="xref" href="ch04.html#Starting_the_state_server" title="Starting the state server (lixad)">the section called “Starting the state server (<span class="command"><strong>lixad</strong></span>)”</a>
	    to start up the LIXA state server.
	  </p></li></ul></div><p>
	Both programs must be used to execute the example: 
	<code class="filename">example_xta_macbps01</code> in the role of the superior
	Application Program (first AP) and
	<code class="filename">example_xta_macbps02</code> in the role of the
	subordinate Application Program (second AP).
      </p><p>
	Create a working directory in a place you are comfortable with:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~$ cd
tiian@ubuntu1404-64:~$ mkdir tmp
tiian@ubuntu1404-64:~$ cd tmp
tiian@ubuntu1404-64:~/tmp$ 
	  </pre></td></tr></tbody></table></div><p>
      </p><p>
	Copy files <code class="filename">example_xta_macbps01.c</code> and 
	<code class="filename">example_xta_macbps02.c</code> in your working dir:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ cp /opt/lixa/share/doc/lixa-X.Y.Z/examples/xta/example_xta_macbps01.c .
tiian@ubuntu:~/tmp$ cp /opt/lixa/share/doc/lixa-X.Y.Z/examples/xta/example_xta_macbps02.c .
	  </pre></td></tr></tbody></table></div><p>
	Substitute <span class="quote">“<span class="quote">X.Y.Z</span>”</span> with the actual version of
	the software you installed.
      </p><p>
	Compile and link the C example programs:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ . /opt/lixa/bin/lixa_env.sh
tiian@ubuntu1404-64:~/tmp$ gcc example_xta_macbps01.c $(lixa-config -x -c -f -l -d) $(mysql_config --libs_r) -o example_xta_macbps01
tiian@ubuntu1404-64:~/tmp$ gcc example_xta_macbps02.c $(lixa-config -x -c -f -l -d) -lpq -o example_xta_macbps02
	  </pre></td></tr></tbody></table></div><p>
      </p><p>
	If the previous steps worked for you, you should have two executable
	files of name <code class="filename">example_xta_macbps01</code> and
	<code class="filename">example_xta_macbps02</code> in your current directory:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ ls -l
total 96
-rwxrwxr-x 1 tiian tiian 18499 apr  8 22:08 example_xta_macbps01
-rw-r--r-- 1 tiian tiian 10459 apr  8 11:58 example_xta_macbps01.c
-rwxrwxr-x 1 tiian tiian 18319 apr  8 22:08 example_xta_macbps02
-rw-r--r-- 1 tiian tiian 11095 apr  8 11:58 example_xta_macbps02.c
	  </pre></td></tr></tbody></table></div><p>
	The example programs accept four arguments:
	</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	    commit (or rollback): use <span class="quote">“<span class="quote">1</span>”</span> if you want to perform
	    a global commit or <span class="quote">“<span class="quote">0</span>”</span> if you want to perform a global
	    rollback
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	    insert (or delete): use <span class="quote">“<span class="quote">1</span>”</span> if you want to insert rows
	    in databases or <span class="quote">“<span class="quote">0</span>”</span> if you want to delete rows from
	    databases
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	    name of the FIFO (named pipe) that will be used to send messages
	    from the superior AP to the subordinate AP
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	    name of the FIFO (named pipe) that will be used to return messages
	    from the subordinate AP to the superior AP
	  </p></li></ul></div><p>
      </p><p>
	Open four terminal sessions: two for the example programs execution,
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP1]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ ls -l example_xta_macbps01
-rwxrwxr-x 1 tiian tiian 18499 apr  8 22:08 example_xta_macbps01
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP2]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ ls -l example_xta_macbps02
-rwxrwxr-x 1 tiian tiian 18319 apr  8 22:08 example_xta_macbps02
	  </pre></td></tr></tbody></table></div><p>
	one for MySQL queries,
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - MySQL]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~$ mysql -h localhost -u lixa lixa
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 36
Server version: 5.5.59-0ubuntu0.14.04.1 (Ubuntu)

Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql&gt;
	  </pre></td></tr></tbody></table></div><p>
	and one for PostgreSQL queries
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - PostgreSQL]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~$ psql testdb
psql (9.3.22)
Type "help" for help.

testdb=&gt;
	  </pre></td></tr></tbody></table></div><p>
	Set <code class="varname">LIXA_PROFILE</code> environment variable to
	<code class="constant">XTA_DYN</code>,
	a profile without static Resource Managers defined in
	<code class="filename">lixac_conf.xml</code>:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP1]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ export LIXA_PROFILE=XTA_DYN
tiian@ubuntu1404-64:~/tmp$ echo $LIXA_PROFILE
XTA_DYN
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP2]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ export LIXA_PROFILE=XTA_DYN
tiian@ubuntu1404-64:~/tmp$ echo $LIXA_PROFILE
XTA_DYN
	  </pre></td></tr></tbody></table></div><p>
	create two named pipes (FIFO) to support communication between
	superior and subordinate Application Programs
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP1]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ mkfifo sup2sub
tiian@ubuntu1404-64:~/tmp$ mkfifo sub2sup
tiian@ubuntu1404-64:~/tmp$ ls -l su*
prw-rw-r-- 1 tiian tiian 0 apr  8 22:22 sub2sup
prw-rw-r-- 1 tiian tiian 0 apr  8 22:22 sup2sub
	  </pre></td></tr></tbody></table></div><p>
	execute both the example programs to insert rows in tables and commit:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP1]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ ./example_xta_macbps01 1 1 sup2sub sub2sup
MySQL, executing &gt;INSERT INTO authors VALUES(1919, 'Levi', 'Primo')&lt;
Superior AP has sent XID '1279875137.b6df6743cbf54cb8b8323ca5ab771e6e.e107cfeee0661d23da9322f1ee73faba' to subordinate AP
Superior AP has received 'PREPARED_for_COMMIT' reply from subordinate AP
MySQL, executing &gt;INSERT INTO authors VALUES(1898, 'Remarque', 'Erich Maria')&lt;
tiian@ubuntu1404-64:~/tmp$
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP2]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ ./example_xta_macbps02 1 1 sup2sub sub2sup
Subordinate AP has received XID '1279875137.b6df6743cbf54cb8b8323ca5ab771e6e.e107cfeee0661d23da9322f1ee73faba' from superior AP
Subordinate AP has created a branch with XID '1279875137.b6df6743cbf54cb8b8323ca5ab771e6e.e107cfeee0661d23af7f136da1b84c3b'
PostgreSQL, executing &gt;INSERT INTO authors VALUES(1921, 'Rigoni Stern', 'Mario')&lt;
Subordinate AP has returned 'PREPARED_for_COMMIT' to superior AP
tiian@ubuntu1404-64:~/tmp$
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	    The first (superior) Application Program suspends and waits the
	    return value from the second (subordinate) Application Program.
	  </p><p>
	    The XID generated by the subordinate AP differs from the XID
	    generated by the superior AP in the last 16 hexadecimal symbols
	    of the <span class="quote">“<span class="quote">branch qualifier</span>”</span>; the first 16 hexadecimal
	    symbols are the same: this is not required by XA specification but
	    can be useful for troubleshooting purposes.
	  </p></div><p>
	Check MySQL table content:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - MySQL]</td></tr></thead><tbody><tr><td><pre class="screen">
mysql&gt; select * from authors;
+------+-----------+-------------+
| id   | last_name | first_name  |
+------+-----------+-------------+
| 1898 | Remarque  | Erich Maria |
| 1919 | Levi      | Primo       |
+------+-----------+-------------+
2 rows in set (0.00 sec)

mysql&gt;
	  </pre></td></tr></tbody></table></div><p>
	check PostgreSQL table content:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - PostgreSQL]</td></tr></thead><tbody><tr><td><pre class="screen">
testdb=&gt; select * from authors;
  id  |  last_name   | first_name 
------+--------------+------------
 1921 | Rigoni Stern | Mario
(1 row)

testdb=&gt;
	  </pre></td></tr></tbody></table></div><p>
	delete rows from tables, but rollback:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP1]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ ./example_xta_macbps01 0 0 sup2sub sub2sup 
MySQL, executing &gt;DELETE FROM authors WHERE id=1919&lt;
Superior AP has sent XID '1279875137.1911a9c72cec45eea47ffc74cf95e000.e107cfeee0661d23da9322f1ee73faba' to subordinate AP
Superior AP has received 'ROLLBACK' reply from subordinate AP
MySQL, executing &gt;DELETE FROM authors WHERE id=1898&lt;
tiian@ubuntu1404-64:~/tmp$
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP2]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ ./example_xta_macbps02 0 0 sup2sub sub2sup
Subordinate AP has received XID '1279875137.1911a9c72cec45eea47ffc74cf95e000.e107cfeee0661d23da9322f1ee73faba' from superior AP
Subordinate AP has created a branch with XID '1279875137.1911a9c72cec45eea47ffc74cf95e000.e107cfeee0661d233a125b14214944da'
PostgreSQL, executing &gt;DELETE FROM authors WHERE id=1921&lt;
Subordinate AP has returned 'ROLLBACK' to superior AP
tiian@ubuntu1404-64:~/tmp$
	  </pre></td></tr></tbody></table></div><p>
	check MySQL table content:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - MySQL]</td></tr></thead><tbody><tr><td><pre class="screen">
mysql&gt; select * from authors;
+------+-----------+-------------+
| id   | last_name | first_name  |
+------+-----------+-------------+
| 1898 | Remarque  | Erich Maria |
| 1919 | Levi      | Primo       |
+------+-----------+-------------+
2 rows in set (0.00 sec)

mysql&gt;
	  </pre></td></tr></tbody></table></div><p>
	check PostgreSQL table content:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - PostgreSQL]</td></tr></thead><tbody><tr><td><pre class="screen">
testdb=&gt; select * from authors;
  id  |  last_name   | first_name 
------+--------------+------------
 1921 | Rigoni Stern | Mario
(1 row)

testdb=&gt;
	  </pre></td></tr></tbody></table></div><p>
	delete rows and commit:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP1]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ ./example_xta_macbps01 1 0 sup2sub sub2sup 
MySQL, executing &gt;DELETE FROM authors WHERE id=1919&lt;
Superior AP has sent XID '1279875137.c862b6aa72784c808e6c59388e4263a9.e107cfeee0661d23da9322f1ee73faba' to subordinate AP
Superior AP has received 'PREPARED_for_COMMIT' reply from subordinate AP
MySQL, executing &gt;DELETE FROM authors WHERE id=1898&lt;
tiian@ubuntu1404-64:~/tmp$
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP2]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ ./example_xta_macbps02 1 0 sup2sub sub2sup
Subordinate AP has received XID '1279875137.c862b6aa72784c808e6c59388e4263a9.e107cfeee0661d23da9322f1ee73faba' from superior AP
Subordinate AP has created a branch with XID '1279875137.c862b6aa72784c808e6c59388e4263a9.e107cfeee0661d234acf9ddb30da46f9'
PostgreSQL, executing &gt;DELETE FROM authors WHERE id=1921&lt;
Subordinate AP has returned 'PREPARED_for_COMMIT' to superior AP
tiian@ubuntu1404-64:~/tmp$
	  </pre></td></tr></tbody></table></div><p>
	check MySQL table content:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - MySQL]</td></tr></thead><tbody><tr><td><pre class="screen">
mysql&gt; select * from authors;
Empty set (0.00 sec)

mysql&gt;
	  </pre></td></tr></tbody></table></div><p>
	check PostgreSQL table content:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - PostgreSQL]</td></tr></thead><tbody><tr><td><pre class="screen">
testdb=&gt; select * from authors;
  id  |  last_name   | first_name 
------+--------------+------------
(0 rows)

testdb=&gt;
	  </pre></td></tr></tbody></table></div><p>
      </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp60041648"></a>Source Code</h4></div></div></div><p>
	  Source code for programs <code class="filename">example_xta_macbps01.c</code> 
	  and <code class="filename">example_xta_macbps02.c</code> are
	  installed in directory
	  <code class="filename">/opt/lixa/share/doc/lixa-X.Y.Z/examples/xta</code> and
	  are available on <a class="link" href="https://github.com/tiian/lixa/blob/master/doc/examples/xta/" target="_top">GitHub</a>. Source code is fully
	  commented for readability.
	</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp60087136"></a>An example using the C++ language</h3></div></div></div><p>
	The supplied examples (<code class="filename">example_xta_macbps11.cpp</code>
	and <code class="filename">example_xta_macbps12.cpp</code>) use
	PostgreSQL in the role of <span class="quote">“<span class="quote">Resource Manager 2</span>”</span> and MySQL
	(or MariaDB) in the role of <span class="quote">“<span class="quote">Resource Manager 1</span>”</span>; please
	refer to the instructions explained:
	</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	    in <a class="xref" href="apa.html#App_RM_Config_MySQL" title="MySQL/MariaDB Configuration">the section called “MySQL/MariaDB Configuration”</a>
	    to set-up a running environment for MySQL server
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	    in <a class="xref" href="apas03.html" title="PostgreSQL Configuration">the section called “PostgreSQL Configuration”</a>
	    to set-up a running environment for PostgreSQL server
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	    in <a class="xref" href="ch04.html#Starting_the_state_server" title="Starting the state server (lixad)">the section called “Starting the state server (<span class="command"><strong>lixad</strong></span>)”</a>
	    to start up the LIXA state server.
	  </p></li></ul></div><p>
	Both programs must be used to execute the example: 
	<code class="filename">example_xta_macbps11</code> in the role of the superior
	Application Program (first AP) and
	<code class="filename">example_xta_macbps12</code> in the role of the
	subordinate Application Program (second AP).
      </p><p>
	Create a working directory in a place you are comfortable with:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~$ cd
tiian@ubuntu1404-64:~$ mkdir tmp
tiian@ubuntu1404-64:~$ cd tmp
tiian@ubuntu1404-64:~/tmp$ 
	  </pre></td></tr></tbody></table></div><p>
      </p><p>
	Copy files <code class="filename">example_xta_macbps11.cpp</code> and 
	<code class="filename">example_xta_macbps12.cpp</code> in your working dir:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ cp /opt/lixa/share/doc/lixa-X.Y.Z/examples/xta/cpp/example_xta_macbps11.cpp .
tiian@ubuntu:~/tmp$ cp /opt/lixa/share/doc/lixa-X.Y.Z/examples/xta/cpp/example_xta_macbps12.cpp .
	  </pre></td></tr></tbody></table></div><p>
	Substitute <span class="quote">“<span class="quote">X.Y.Z</span>”</span> with the actual version of
	the software you installed.
      </p><p>
	Compile and link the C++ example programs:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ . /opt/lixa/bin/lixa_env.sh
tiian@ubuntu1404-64:~/tmp$ g++ example_xta_macbps11.cpp $(lixa-config -c -f -l -d --xta --language-cpp) $(mysql_config --libs_r) -o example_xta_macbps11
tiian@ubuntu1404-64:~/tmp$ g++ example_xta_macbps12.cpp $(lixa-config -c -f -l -d --xta --language-cpp) -lpq -o example_xta_macbps12
	  </pre></td></tr></tbody></table></div><p>
      </p><p>
	If the previous steps worked for you, you should have two executable
	files of name <code class="filename">example_xta_macbps11</code> and
	<code class="filename">example_xta_macbps12</code> in your current directory:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ ls -l
total 80
-rwxrwxr-x 1 tiian tiian 26419 ago 26 21:56 example_xta_macbps11
-rw-r--r-- 1 tiian tiian  8779 ago 26 21:54 example_xta_macbps11.cpp
-rwxrwxr-x 1 tiian tiian 26399 ago 26 21:56 example_xta_macbps12
-rw-r--r-- 1 tiian tiian 10028 ago 26 21:54 example_xta_macbps12.cpp
	  </pre></td></tr></tbody></table></div><p>
	The example programs accept four arguments:
	</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	    commit (or rollback): use <span class="quote">“<span class="quote">1</span>”</span> if you want to perform
	    a global commit or <span class="quote">“<span class="quote">0</span>”</span> if you want to perform a global
	    rollback
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	    insert (or delete): use <span class="quote">“<span class="quote">1</span>”</span> if you want to insert rows
	    in databases or <span class="quote">“<span class="quote">0</span>”</span> if you want to delete rows from
	    databases
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	    name of the FIFO (named pipe) that will be used to send messages
	    from the superior AP to the subordinate AP
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	    name of the FIFO (named pipe) that will be used to return messages
	    from the subordinate AP to the superior AP
	  </p></li></ul></div><p>
      </p><p>
	Open four terminal sessions: two for the example programs execution,
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP1]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ ls -l example_xta_macbps11
-rwxrwxr-x 1 tiian tiian 18499 apr  8 22:08 example_xta_macbps11
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP2]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ ls -l example_xta_macbps12
-rwxrwxr-x 1 tiian tiian 18319 apr  8 22:08 example_xta_macbps12
	  </pre></td></tr></tbody></table></div><p>
	one for MySQL queries,
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - MySQL]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~$ mysql -h localhost -u lixa lixa
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 36
Server version: 5.5.61-0ubuntu0.14.04.1 (Ubuntu)

Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql&gt; 
	  </pre></td></tr></tbody></table></div><p>
	and one for PostgreSQL queries
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - PostgreSQL]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~$ psql testdb
psql (9.3.24)
Type "help" for help.

testdb=&gt;
	  </pre></td></tr></tbody></table></div><p>
	Set <code class="varname">LIXA_PROFILE</code> environment variable to
	<code class="constant">XTA_DYN</code>,
	a profile without static Resource Managers defined in
	<code class="filename">lixac_conf.xml</code>:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP1]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ export LIXA_PROFILE=XTA_DYN
tiian@ubuntu1404-64:~/tmp$ echo $LIXA_PROFILE
XTA_DYN
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP2]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ export LIXA_PROFILE=XTA_DYN
tiian@ubuntu1404-64:~/tmp$ echo $LIXA_PROFILE
XTA_DYN
	  </pre></td></tr></tbody></table></div><p>
	create two named pipes (FIFO) to support communication between
	superior and subordinate Application Programs
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP1]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ mkfifo sup2sub
tiian@ubuntu1404-64:~/tmp$ mkfifo sub2sup
tiian@ubuntu1404-64:~/tmp$ ls -l su*
prw-rw-r-- 1 tiian tiian 0 ago 26 22:01 sub2sup
prw-rw-r-- 1 tiian tiian 0 ago 26 22:01 sup2sub
	  </pre></td></tr></tbody></table></div><p>
	execute both the example programs to insert rows in tables and commit:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP1]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ ./example_xta_macbps11 1 1 sup2sub sub2sup
MySQL, executing &gt;INSERT INTO authors VALUES(1919, 'Levi', 'Primo')&lt;
Superior AP has sent XID '1279875137.a65b66b6b0874a948f8f09b7a23dd471.e107cfeee0661d23da9322f1ee73faba' to subordinate AP
Superior AP has received 'PREPARED_for_COMMIT' reply from subordinate AP
MySQL, executing &gt;INSERT INTO authors VALUES(1898, 'Remarque', 'Erich Maria')&lt;
tiian@ubuntu1404-64:~/tmp$
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP2]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ ./example_xta_macbps12 1 1 sup2sub sub2sup
Subordinate AP has received XID '1279875137.a65b66b6b0874a948f8f09b7a23dd471.e107cfeee0661d23da9322f1ee73faba' from superior AP
Subordinate AP has created a branch with XID '1279875137.a65b66b6b0874a948f8f09b7a23dd471.e107cfeee0661d235888e12f34d54013'
PostgreSQL, executing &gt;INSERT INTO authors VALUES(1921, 'Rigoni Stern', 'Mario')&lt;
Subordinate AP has returned 'PREPARED_for_COMMIT' to superior AP
tiian@ubuntu1404-64:~/tmp$
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	    The first (superior) Application Program suspends and waits the
	    return value from the second (subordinate) Application Program.
	  </p><p>
	    The XID generated by the subordinate AP differs from the XID
	    generated by the superior AP in the last 16 hexadecimal symbols
	    of the <span class="quote">“<span class="quote">branch qualifier</span>”</span>; the first 16 hexadecimal
	    symbols are the same: this is not required by XA specification but
	    can be useful for troubleshooting purposes.
	  </p></div><p>
	Check MySQL table content:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - MySQL]</td></tr></thead><tbody><tr><td><pre class="screen">
mysql&gt; select * from authors;
+------+-----------+-------------+
| id   | last_name | first_name  |
+------+-----------+-------------+
| 1898 | Remarque  | Erich Maria |
| 1919 | Levi      | Primo       |
+------+-----------+-------------+
2 rows in set (0.00 sec)

mysql&gt;
	  </pre></td></tr></tbody></table></div><p>
	check PostgreSQL table content:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - PostgreSQL]</td></tr></thead><tbody><tr><td><pre class="screen">
testdb=&gt; select * from authors;
  id  |  last_name   | first_name 
------+--------------+------------
 1921 | Rigoni Stern | Mario
(1 row)

testdb=&gt;
	  </pre></td></tr></tbody></table></div><p>
	delete rows from tables, but rollback:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP1]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ ./example_xta_macbps11 0 0 sup2sub sub2sup
MySQL, executing &gt;DELETE FROM authors WHERE id=1919&lt;
Superior AP has sent XID '1279875137.b154aa98393d44098c8a20ed2ba488cf.e107cfeee0661d23da9322f1ee73faba' to subordinate AP
Superior AP has received 'ROLLBACK' reply from subordinate AP
MySQL, executing &gt;DELETE FROM authors WHERE id=1898&lt;
tiian@ubuntu1404-64:~/tmp$
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP2]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ ./example_xta_macbps12 0 0 sup2sub sub2sup
Subordinate AP has received XID '1279875137.b154aa98393d44098c8a20ed2ba488cf.e107cfeee0661d23da9322f1ee73faba' from superior AP
Subordinate AP has created a branch with XID '1279875137.b154aa98393d44098c8a20ed2ba488cf.e107cfeee0661d237add9066cfc34a81'
PostgreSQL, executing &gt;DELETE FROM authors WHERE id=1921&lt;
Subordinate AP has returned 'ROLLBACK' to superior AP
tiian@ubuntu1404-64:~/tmp$ 
	  </pre></td></tr></tbody></table></div><p>
	check MySQL table content:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - MySQL]</td></tr></thead><tbody><tr><td><pre class="screen">
mysql&gt; select * from authors;
+------+-----------+-------------+
| id   | last_name | first_name  |
+------+-----------+-------------+
| 1898 | Remarque  | Erich Maria |
| 1919 | Levi      | Primo       |
+------+-----------+-------------+
2 rows in set (0.00 sec)

mysql&gt;
	  </pre></td></tr></tbody></table></div><p>
	check PostgreSQL table content:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - PostgreSQL]</td></tr></thead><tbody><tr><td><pre class="screen">
testdb=&gt; select * from authors;
  id  |  last_name   | first_name 
------+--------------+------------
 1921 | Rigoni Stern | Mario
(1 row)

testdb=&gt;
	  </pre></td></tr></tbody></table></div><p>
	delete rows and commit:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP1]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ ./example_xta_macbps11 1 0 sup2sub sub2sup
MySQL, executing &gt;DELETE FROM authors WHERE id=1919&lt;
Superior AP has sent XID '1279875137.06db3e25e74a4a03bdf7ef4924409255.e107cfeee0661d23da9322f1ee73faba' to subordinate AP
Superior AP has received 'PREPARED_for_COMMIT' reply from subordinate AP
MySQL, executing &gt;DELETE FROM authors WHERE id=1898&lt;
tiian@ubuntu1404-64:~/tmp$ 
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP2]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ ./example_xta_macbps12 1 0 sup2sub sub2sup
Subordinate AP has received XID '1279875137.06db3e25e74a4a03bdf7ef4924409255.e107cfeee0661d23da9322f1ee73faba' from superior AP
Subordinate AP has created a branch with XID '1279875137.06db3e25e74a4a03bdf7ef4924409255.e107cfeee0661d23cc258059f852467e'
PostgreSQL, executing &gt;DELETE FROM authors WHERE id=1921&lt;
Subordinate AP has returned 'PREPARED_for_COMMIT' to superior AP
tiian@ubuntu1404-64:~/tmp$ 
	  </pre></td></tr></tbody></table></div><p>
	check MySQL table content:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - MySQL]</td></tr></thead><tbody><tr><td><pre class="screen">
mysql&gt; select * from authors;
Empty set (0.00 sec)

mysql&gt;
	  </pre></td></tr></tbody></table></div><p>
	check PostgreSQL table content:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - PostgreSQL]</td></tr></thead><tbody><tr><td><pre class="screen">
testdb=&gt; select * from authors;
  id  |  last_name   | first_name 
------+--------------+------------
(0 rows)

testdb=&gt;
	  </pre></td></tr></tbody></table></div><p>
      </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp60110784"></a>Source Code</h4></div></div></div><p>
	  Source code for programs <code class="filename">example_xta_macbps11.cpp</code> 
	  and <code class="filename">example_xta_macbps12.cpp</code> are
	  installed in directory
	  <code class="filename">/opt/lixa/share/doc/lixa-X.Y.Z/examples/xta/cpp</code> and
	  are available on <a class="link" href="https://github.com/tiian/lixa/blob/master/doc/examples/xta/cpp" target="_top">GitHub</a>. Source code is fully
	  commented for readability.
	</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp60156304"></a>An example using the Java language</h3></div></div></div><p>
	The supplied examples (<code class="filename">ExampleXtaMACBPS31.java</code>
	and <code class="filename">ExampleXtaMACBPS32.java</code>) use
	PostgreSQL in the role of <span class="quote">“<span class="quote">Resource Manager 2</span>”</span> and MySQL
	(or MariaDB) in the role of <span class="quote">“<span class="quote">Resource Manager 1</span>”</span>; please
	refer to the instructions explained:
	</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	    in <a class="xref" href="apa.html#App_RM_Config_MySQL" title="MySQL/MariaDB Configuration">the section called “MySQL/MariaDB Configuration”</a>
	    to set-up a running environment for MySQL server
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	    in <a class="xref" href="apas03.html" title="PostgreSQL Configuration">the section called “PostgreSQL Configuration”</a>
	    to set-up a running environment for PostgreSQL server
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	    in <a class="xref" href="ch04.html#Starting_the_state_server" title="Starting the state server (lixad)">the section called “Starting the state server (<span class="command"><strong>lixad</strong></span>)”</a>
	    to start up the LIXA state server.
	  </p></li></ul></div><p>
	Both programs must be used to execute the example: 
	<code class="filename">ExampleXtaMACBPS31.class</code> in the role of the
	superior Application Program (first AP) and
	<code class="filename">ExampleXtaMACBPS31.class</code> in the role of the
	subordinate Application Program (second AP).
      </p><p>
	Create a working directory in a place you are comfortable with:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~$ cd
tiian@ubuntu1404-64:~$ mkdir tmp
tiian@ubuntu1404-64:~$ cd tmp
tiian@ubuntu1404-64:~/tmp$ 
	  </pre></td></tr></tbody></table></div><p>
      </p><p>
	Copy files <code class="filename">ExampleXtaMACBPS31.java</code> and 
	<code class="filename">ExampleXtaMACBPS32.java</code> in your working dir:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ cp /opt/lixa/share/doc/lixa-X.Y.Z/examples/xta/java/ExampleXtaMACBPS31.java .
tiian@ubuntu:~/tmp$ cp /opt/lixa/share/doc/lixa-X.Y.Z/examples/xta/java/ExampleXtaMACBPS32.java .
	  </pre></td></tr></tbody></table></div><p>
	Substitute <span class="quote">“<span class="quote">X.Y.Z</span>”</span> with the actual version of
	the software you installed.
      </p><p>
	Use the proper paths for MySQL and PostgreSQL jars, then compile the
	Java example programs with something like: 
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ javac -cp /opt/lixa/share/lixa/java/xta.jar:/usr/share/java/mysql.jar ExampleXtaMACBPS31.java
tiian@ubuntu1404-64:~/tmp$ javac -cp /opt/lixa/share/lixa/java/xta.jar:/opt/postgresql/postgresql.jar ExampleXtaMACBPS32.java
	  </pre></td></tr></tbody></table></div><p>
      </p><p>
	If the previous steps worked for you, you should have two class
	files of name <code class="filename">ExampleXtaMACBPS31.class</code> and
	<code class="filename">ExampleXtaMACBPS32.class</code> in your current
	directory:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ ls -l
total 40
-rw-rw-r-- 1 tiian tiian  4360 gen 16 21:50 ExampleXtaMACBPS31.class
-rw-r--r-- 1 tiian tiian  9006 gen 16 21:50 ExampleXtaMACBPS31.java
-rw-rw-r-- 1 tiian tiian  4436 gen 16 21:51 ExampleXtaMACBPS32.class
-rw-r--r-- 1 tiian tiian 10425 gen 16 21:47 ExampleXtaMACBPS32.java
	  </pre></td></tr></tbody></table></div><p>
	The example programs accept four arguments:
	</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	    commit (or rollback): use <span class="quote">“<span class="quote">1</span>”</span> if you want to perform
	    a global commit or <span class="quote">“<span class="quote">0</span>”</span> if you want to perform a global
	    rollback
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	    insert (or delete): use <span class="quote">“<span class="quote">1</span>”</span> if you want to insert rows
	    in databases or <span class="quote">“<span class="quote">0</span>”</span> if you want to delete rows from
	    databases
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	    name of the FIFO (named pipe) that will be used to send messages
	    from the superior AP to the subordinate AP
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	    name of the FIFO (named pipe) that will be used to return messages
	    from the subordinate AP to the superior AP
	  </p></li></ul></div><p>
      </p><p>
	Open four terminal sessions: two for the example programs execution,
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP1]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ ls -l ExampleXtaMACBPS31.class
-rw-rw-r-- 1 tiian tiian 4360 gen 16 21:50 ExampleXtaMACBPS31.class
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP2]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ ls -l ExampleXtaMACBPS32.class
-rw-rw-r-- 1 tiian tiian 4436 gen 16 21:51 ExampleXtaMACBPS32.class
	  </pre></td></tr></tbody></table></div><p>
	one for MySQL queries,
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - MySQL]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~$ mysql -h localhost -u lixa lixa
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 36
Server version: 5.5.62-0ubuntu0.14.04.1 (Ubuntu)

Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql&gt;
	  </pre></td></tr></tbody></table></div><p>
	and one for PostgreSQL queries
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - PostgreSQL]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~$ psql testdb
psql (9.3.24)
Type "help" for help.

testdb=&gt;
	  </pre></td></tr></tbody></table></div><p>
	Set <code class="varname">LIXA_PROFILE</code> environment variable to
	<code class="constant">XTA_DYN</code>,
	a profile without static Resource Managers defined in
	<code class="filename">lixac_conf.xml</code>:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP1]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ export LIXA_PROFILE=XTA_DYN
tiian@ubuntu1404-64:~/tmp$ echo $LIXA_PROFILE
XTA_DYN
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP2]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ export LIXA_PROFILE=XTA_DYN
tiian@ubuntu1404-64:~/tmp$ echo $LIXA_PROFILE
XTA_DYN
	  </pre></td></tr></tbody></table></div><p>
	create two named pipes (FIFO) to support communication between
	superior and subordinate Application Programs
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP1]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ mkfifo sup2sub
tiian@ubuntu1404-64:~/tmp$ mkfifo sub2sup
tiian@ubuntu1404-64:~/tmp$ ls -l su*
prw-rw-r-- 1 tiian tiian 0 gen 16 21:58 sub2sup
prw-rw-r-- 1 tiian tiian 0 gen 16 21:57 sup2sub
	  </pre></td></tr></tbody></table></div><p>
	execute both the example programs to insert rows in tables and commit:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP1]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ java -Djava.library.path=/opt/lixa/lib -cp /opt/lixa/share/lixa/java/xta.jar:/usr/share/java/mysql.jar:. ExampleXtaMACBPS31 1 1 sup2sub sub2sup
MySQL, executing &gt;INSERT INTO authors VALUES(1919, 'Levi', 'Primo')&lt;
Superior AP has sent XID '1279875137.7f8a0b782a764545934d3052c38c89c0.cd976821ac38611801b6e378a35a3c7a' to subordinate AP
Superior AP has received 'PREPARED_for_COMMIT' reply from subordinate AP
MySQL, executing &gt;INSERT INTO authors VALUES(1898, 'Remarque', 'Erich Maria')&lt;
tiian@ubuntu1404-64:~/tmp$
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP2]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ java -Djava.library.path=/opt/lixa/lib -cp /opt/lixa/share/lixa/java/xta.jar:/opt/postgresql/postgresql.jar:. ExampleXtaMACBPS32 1 1 sup2sub sub2sup
Subordinate AP has received XID '1279875137.7f8a0b782a764545934d3052c38c89c0.cd976821ac38611801b6e378a35a3c7a' from superior AP
Subordinate AP has created a branch with XID '1279875137.7f8a0b782a764545934d3052c38c89c0.cd976821ac386118e3c0422932534d2e'
PostgreSQL, executing &gt;INSERT INTO authors VALUES(1921, 'Rigoni Stern', 'Mario')&lt;
Subordinate AP has returned 'PREPARED_for_COMMIT' to superior AP
tiian@ubuntu1404-64:~/tmp$
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	    The first (superior) Application Program suspends and waits the
	    return value from the second (subordinate) Application Program.
	  </p><p>
	    The XID generated by the subordinate AP differs from the XID
	    generated by the superior AP in the last 16 hexadecimal symbols
	    of the <span class="quote">“<span class="quote">branch qualifier</span>”</span>; the first 16 hexadecimal
	    symbols are the same: this is not required by XA specification but
	    can be useful for troubleshooting purposes.
	  </p></div><p>
	Check MySQL table content:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - MySQL]</td></tr></thead><tbody><tr><td><pre class="screen">
mysql&gt; select * from authors;
+------+-----------+-------------+
| id   | last_name | first_name  |
+------+-----------+-------------+
| 1898 | Remarque  | Erich Maria |
| 1919 | Levi      | Primo       |
+------+-----------+-------------+
2 rows in set (0.00 sec)

mysql&gt;
	  </pre></td></tr></tbody></table></div><p>
	check PostgreSQL table content:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - PostgreSQL]</td></tr></thead><tbody><tr><td><pre class="screen">
testdb=&gt; select * from authors;
  id  |  last_name   | first_name 
------+--------------+------------
 1921 | Rigoni Stern | Mario
(1 row)

testdb=&gt;
	  </pre></td></tr></tbody></table></div><p>
	delete rows from tables, but rollback:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP1]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ java -Djava.library.path=/opt/lixa/lib -cp /opt/lixa/share/lixa/java/xta.jar:/usr/share/java/mysql.jar:. ExampleXtaMACBPS31 0 0 sup2sub sub2sup
MySQL, executing &gt;DELETE FROM authors WHERE id=1919&lt;
Superior AP has sent XID '1279875137.76c07087a5d1433c9c985c8976800060.cd976821ac38611801b6e378a35a3c7a' to subordinate AP
Superior AP has received 'ROLLBACK' reply from subordinate AP
MySQL, executing &gt;DELETE FROM authors WHERE id=1898&lt;
tiian@ubuntu1404-64:~/tmp$
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP2]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ java -Djava.library.path=/opt/lixa/lib -cp /opt/lixa/share/lixa/java/xta.jar:/opt/postgresql/postgresql.jar:. ExampleXtaMACBPS32 0 0 sup2sub sub2sup
Subordinate AP has received XID '1279875137.76c07087a5d1433c9c985c8976800060.cd976821ac38611801b6e378a35a3c7a' from superior AP
Subordinate AP has created a branch with XID '1279875137.76c07087a5d1433c9c985c8976800060.cd976821ac386118d8720d87412a4927'
PostgreSQL, executing &gt;DELETE FROM authors WHERE id=1921&lt;
Subordinate AP has returned 'ROLLBACK' to superior AP
tiian@ubuntu1404-64:~/tmp$ 
	  </pre></td></tr></tbody></table></div><p>
	check MySQL table content:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - MySQL]</td></tr></thead><tbody><tr><td><pre class="screen">
mysql&gt; select * from authors;
+------+-----------+-------------+
| id   | last_name | first_name  |
+------+-----------+-------------+
| 1898 | Remarque  | Erich Maria |
| 1919 | Levi      | Primo       |
+------+-----------+-------------+
2 rows in set (0.00 sec)

mysql&gt;
	  </pre></td></tr></tbody></table></div><p>
	check PostgreSQL table content:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - PostgreSQL]</td></tr></thead><tbody><tr><td><pre class="screen">
testdb=&gt; select * from authors;
  id  |  last_name   | first_name 
------+--------------+------------
 1921 | Rigoni Stern | Mario
(1 row)

testdb=&gt;
	  </pre></td></tr></tbody></table></div><p>
	delete rows and commit:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP1]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ java -Djava.library.path=/opt/lixa/lib -cp /opt/lixa/share/lixa/java/xta.jar:/usr/share/java/mysql.jar:. ExampleXtaMACBPS31 1 0 sup2sub sub2sup
MySQL, executing &gt;DELETE FROM authors WHERE id=1919&lt;
Superior AP has sent XID '1279875137.a31bf2c7780345f98112c613685780bd.cd976821ac38611801b6e378a35a3c7a' to subordinate AP
Superior AP has received 'PREPARED_for_COMMIT' reply from subordinate AP
MySQL, executing &gt;DELETE FROM authors WHERE id=1898&lt;
tiian@ubuntu1404-64:~/tmp$ 
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP2]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ java -Djava.library.path=/opt/lixa/lib -cp /opt/lixa/share/lixa/java/xta.jar:/opt/postgresql/postgresql.jar:. ExampleXtaMACBPS32 1 0 sup2sub sub2sup
Subordinate AP has received XID '1279875137.a31bf2c7780345f98112c613685780bd.cd976821ac38611801b6e378a35a3c7a' from superior AP
Subordinate AP has created a branch with XID '1279875137.a31bf2c7780345f98112c613685780bd.cd976821ac38611837020c0b51914e74'
PostgreSQL, executing &gt;DELETE FROM authors WHERE id=1921&lt;
Subordinate AP has returned 'PREPARED_for_COMMIT' to superior AP
tiian@ubuntu1404-64:~/tmp$ 
	  </pre></td></tr></tbody></table></div><p>
	check MySQL table content:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - MySQL]</td></tr></thead><tbody><tr><td><pre class="screen">
mysql&gt; select * from authors;
Empty set (0.00 sec)

mysql&gt;
	  </pre></td></tr></tbody></table></div><p>
	check PostgreSQL table content:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - PostgreSQL]</td></tr></thead><tbody><tr><td><pre class="screen">
testdb=&gt; select * from authors;
  id  |  last_name   | first_name 
------+--------------+------------
(0 rows)

testdb=&gt;
	  </pre></td></tr></tbody></table></div><p>
      </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp60179920"></a>Source Code</h4></div></div></div><p>
	  Source code for programs
	  <code class="filename">ExampleXtaMACBPS31.java</code> 
	  and <code class="filename">ExampleXtaMACBPS32.java</code> are
	  installed in directory
	  <code class="filename">/opt/lixa/share/doc/lixa-X.Y.Z/examples/xta/java</code>
	  and are available on <a class="link" href="https://github.com/tiian/lixa/blob/master/doc/examples/xta/java" target="_top">GitHub</a>. Source code is fully
	  commented for readability.
	</p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp60226032"></a>An example using the Python language</h3></div></div></div><p>
	The supplied examples (<code class="filename">example_xta_macbps21.py</code>
	and <code class="filename">example_xta_macbps22.py</code>) use
	PostgreSQL in the role of <span class="quote">“<span class="quote">Resource Manager 2</span>”</span> and MySQL
	(or MariaDB) in the role of <span class="quote">“<span class="quote">Resource Manager 1</span>”</span>; please
	refer to the instructions explained:
	</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	    in <a class="xref" href="ch08.html#XTA_Technology_Matrix" title="XTA Technology Matrix">the section called “XTA Technology Matrix”</a>
	    to build and install the Python database drivers that can be used
	    with XTA
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	    in <a class="xref" href="apa.html#App_RM_Config_MySQL" title="MySQL/MariaDB Configuration">the section called “MySQL/MariaDB Configuration”</a>
	    to set-up a running environment for MySQL server
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	    in <a class="xref" href="apas03.html" title="PostgreSQL Configuration">the section called “PostgreSQL Configuration”</a>
	    to set-up a running environment for PostgreSQL server
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	    in <a class="xref" href="ch04.html#Starting_the_state_server" title="Starting the state server (lixad)">the section called “Starting the state server (<span class="command"><strong>lixad</strong></span>)”</a>
	    to start up the LIXA state server.
	  </p></li></ul></div><p>
	Both programs must be used to execute the example: 
	<code class="filename">example_xta_macbps21.py</code> in the role of the
	superior Application Program (first AP) and
	<code class="filename">example_xta_macbps22.py</code> in the role of the
	subordinate Application Program (second AP).
	Python 2 and Python 3 can be used even mixing them: one for the first
	AP and one for the second AP.
      </p><p>
	Create a working directory in a place you are comfortable with:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~$ cd
tiian@ubuntu1404-64:~$ mkdir tmp
tiian@ubuntu1404-64:~$ cd tmp
tiian@ubuntu1404-64:~/tmp$ 
	  </pre></td></tr></tbody></table></div><p>
      </p><p>
	Copy files <code class="filename">example_xta_macbps21.py</code> and 
	<code class="filename">example_xta_macbps22.py</code> in your working dir:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu:~/tmp$ cp /opt/lixa/share/doc/lixa-X.Y.Z/examples/xta/python/example_xta_macbps21.py .
tiian@ubuntu:~/tmp$ cp /opt/lixa/share/doc/lixa-X.Y.Z/examples/xta/python/example_xta_macbps22.py .
	  </pre></td></tr></tbody></table></div><p>
	Substitute <span class="quote">“<span class="quote">X.Y.Z</span>”</span> with the actual version of
	the software you installed.
      </p><p>
	The example programs accept four arguments:
	</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	    commit (or rollback): use <span class="quote">“<span class="quote">1</span>”</span> if you want to perform
	    a global commit or <span class="quote">“<span class="quote">0</span>”</span> if you want to perform a global
	    rollback
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	    insert (or delete): use <span class="quote">“<span class="quote">1</span>”</span> if you want to insert rows
	    in databases or <span class="quote">“<span class="quote">0</span>”</span> if you want to delete rows from
	    databases
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	    name of the FIFO (named pipe) that will be used to send messages
	    from the superior AP to the subordinate AP
	  </p></li><li class="listitem" style="list-style-type: disc"><p>
	    name of the FIFO (named pipe) that will be used to return messages
	    from the subordinate AP to the superior AP
	  </p></li></ul></div><p>
      </p><p>
	Open four terminal sessions: two for the example programs execution,
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP1]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ ls -l example_xta_macbps21.py 
-rw-r--r-- 1 tiian tiian 4701 ott 15 22:28 example_xta_macbps21.py
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP2]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ ls -l example_xta_macbps22.py 
-rw-r--r-- 1 tiian tiian 5266 ott 15 22:28 example_xta_macbps22.py
	  </pre></td></tr></tbody></table></div><p>
	one for MySQL queries,
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - MySQL]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~$ mysql -h localhost -u lixa lixa
Reading table information for completion of table and column names
You can turn off this feature to get a quicker startup with -A

Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 36
Server version: 5.5.61-0ubuntu0.14.04.1 (Ubuntu)

Copyright (c) 2000, 2018, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql&gt; 
	  </pre></td></tr></tbody></table></div><p>
	and one for PostgreSQL queries
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - PostgreSQL]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~$ psql testdb
psql (9.3.24)
Type "help" for help.

testdb=&gt;
	  </pre></td></tr></tbody></table></div><p>
	Set <code class="varname">LIXA_PROFILE</code> environment variable to
	<code class="constant">XTA_DYN</code>,
	a profile without static Resource Managers defined in
	<code class="filename">lixac_conf.xml</code>:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP1]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ export LIXA_PROFILE=XTA_DYN
tiian@ubuntu1404-64:~/tmp$ echo $LIXA_PROFILE
XTA_DYN
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP2]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ export LIXA_PROFILE=XTA_DYN
tiian@ubuntu1404-64:~/tmp$ echo $LIXA_PROFILE
XTA_DYN
	  </pre></td></tr></tbody></table></div><p>
	create two named pipes (FIFO) to support communication between
	superior and subordinate Application Programs
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP1]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ mkfifo sup2sub
tiian@ubuntu1404-64:~/tmp$ mkfifo sub2sup
tiian@ubuntu1404-64:~/tmp$ ls -l su*
prw-rw-r-- 1 tiian tiian 0 ott 15 22:35 sub2sup
prw-rw-r-- 1 tiian tiian 0 ott 15 22:35 sup2sub
	  </pre></td></tr></tbody></table></div><p>
	execute both the example programs to insert rows in tables and commit:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP1]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ python example_xta_macbps21.py 1 1 sup2sub sub2sup
MySQL, executing &gt;INSERT INTO authors VALUES(1919, 'Levi', 'Primo')&lt;
Superior AP has sent XID '1279875137.9d22af42e46f4111b23ba3630479c6b9.e107cfeee0661d23da9322f1ee73faba' to subordinate AP
Superior AP has received 'PREPARED_for_COMMIT' reply from subordinate AP
MySQL, executing &gt;INSERT INTO authors VALUES(1898, 'Remarque', 'Erich Maria')&lt;
Superior AP has committed its branch
tiian@ubuntu1404-64:~/tmp$
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP2]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ python example_xta_macbps22.py 1 1 sup2sub sub2sup 
Subordinate AP has received XID '1279875137.9d22af42e46f4111b23ba3630479c6b9.e107cfeee0661d23da9322f1ee73faba' from superior AP
Subordinate AP has created a branch with XID '1279875137.9d22af42e46f4111b23ba3630479c6b9.e107cfeee0661d23feeb9fdbaca14974'
PostgreSQL, executing &gt;INSERT INTO authors VALUES(1921, 'Rigoni Stern', 'Mario')&lt;
Subordinate AP has returned 'PREPARED_for_COMMIT' to superior AP
tiian@ubuntu1404-64:~/tmp$
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	    The first (superior) Application Program suspends and waits the
	    return value from the second (subordinate) Application Program.
	  </p><p>
	    The XID generated by the subordinate AP differs from the XID
	    generated by the superior AP in the last 16 hexadecimal symbols
	    of the <span class="quote">“<span class="quote">branch qualifier</span>”</span>; the first 16 hexadecimal
	    symbols are the same: this is not required by XA specification but
	    can be useful for troubleshooting purposes.
	  </p></div><p>
	Check MySQL table content:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - MySQL]</td></tr></thead><tbody><tr><td><pre class="screen">
mysql&gt; select * from authors;
+------+-----------+-------------+
| id   | last_name | first_name  |
+------+-----------+-------------+
| 1898 | Remarque  | Erich Maria |
| 1919 | Levi      | Primo       |
+------+-----------+-------------+
2 rows in set (0.00 sec)

mysql&gt;
	  </pre></td></tr></tbody></table></div><p>
	check PostgreSQL table content:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - PostgreSQL]</td></tr></thead><tbody><tr><td><pre class="screen">
testdb=&gt; select * from authors;
  id  |  last_name   | first_name 
------+--------------+------------
 1921 | Rigoni Stern | Mario
(1 row)

testdb=&gt;
	  </pre></td></tr></tbody></table></div><p>
	delete rows from tables, but rollback:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP1]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ python example_xta_macbps21.py 0 0 sup2sub sub2sup 
MySQL, executing &gt;DELETE FROM authors WHERE id=1919&lt;
Superior AP has sent XID '1279875137.84ab3fdb762742a096a8181043938232.e107cfeee0661d23da9322f1ee73faba' to subordinate AP
Superior AP has received 'ROLLBACK' reply from subordinate AP
MySQL, executing &gt;DELETE FROM authors WHERE id=1898&lt;
Superior AP has rolled back its branch
tiian@ubuntu1404-64:~/tmp$
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP2]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ python example_xta_macbps22.py 0 0 sup2sub sub2sup 
Subordinate AP has received XID '1279875137.84ab3fdb762742a096a8181043938232.e107cfeee0661d23da9322f1ee73faba' from superior AP
Subordinate AP has created a branch with XID '1279875137.84ab3fdb762742a096a8181043938232.e107cfeee0661d2397f7336b2f6449f2'
PostgreSQL, executing &gt;DELETE FROM authors WHERE id=1921&lt;
Subordinate AP has returned 'ROLLBACK' to superior AP
tiian@ubuntu1404-64:~/tmp$ 
	  </pre></td></tr></tbody></table></div><p>
	check MySQL table content:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - MySQL]</td></tr></thead><tbody><tr><td><pre class="screen">
mysql&gt; select * from authors;
+------+-----------+-------------+
| id   | last_name | first_name  |
+------+-----------+-------------+
| 1898 | Remarque  | Erich Maria |
| 1919 | Levi      | Primo       |
+------+-----------+-------------+
2 rows in set (0.00 sec)

mysql&gt;
	  </pre></td></tr></tbody></table></div><p>
	check PostgreSQL table content:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - PostgreSQL]</td></tr></thead><tbody><tr><td><pre class="screen">
testdb=&gt; select * from authors;
  id  |  last_name   | first_name 
------+--------------+------------
 1921 | Rigoni Stern | Mario
(1 row)

testdb=&gt;
	  </pre></td></tr></tbody></table></div><p>
	delete rows and commit:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP1]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ python example_xta_macbps21.py 1 0 sup2sub sub2sup 
MySQL, executing &gt;DELETE FROM authors WHERE id=1919&lt;
Superior AP has sent XID '1279875137.284ca606ec594b94a98a26a0e2e6730a.e107cfeee0661d23da9322f1ee73faba' to subordinate AP
Superior AP has received 'PREPARED_for_COMMIT' reply from subordinate AP
MySQL, executing &gt;DELETE FROM authors WHERE id=1898&lt;
Superior AP has committed its branch
tiian@ubuntu1404-64:~/tmp$ 
	  </pre></td></tr></tbody></table></div><p>
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - AP2]</td></tr></thead><tbody><tr><td><pre class="screen">
tiian@ubuntu1404-64:~/tmp$ python example_xta_macbps22.py 1 0 sup2sub sub2sup 
Subordinate AP has received XID '1279875137.284ca606ec594b94a98a26a0e2e6730a.e107cfeee0661d23da9322f1ee73faba' from superior AP
Subordinate AP has created a branch with XID '1279875137.284ca606ec594b94a98a26a0e2e6730a.e107cfeee0661d23759dd6e4f8ad4afc'
PostgreSQL, executing &gt;DELETE FROM authors WHERE id=1921&lt;
Subordinate AP has returned 'PREPARED_for_COMMIT' to superior AP
tiian@ubuntu1404-64:~/tmp$ 
	  </pre></td></tr></tbody></table></div><p>
	check MySQL table content:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - MySQL]</td></tr></thead><tbody><tr><td><pre class="screen">
mysql&gt; select * from authors;
Empty set (0.00 sec)

mysql&gt;
	  </pre></td></tr></tbody></table></div><p>
	check PostgreSQL table content:
	</p><div class="table"><table frame="box"><thead><tr><td>[Shell terminal session - PostgreSQL]</td></tr></thead><tbody><tr><td><pre class="screen">
testdb=&gt; select * from authors;
  id  |  last_name   | first_name 
------+--------------+------------
(0 rows)

testdb=&gt;
	  </pre></td></tr></tbody></table></div><p>
      </p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp60245248"></a>Source Code</h4></div></div></div><p>
	  Source code for programs <code class="filename">example_xta_macbps21.py</code> 
	  and <code class="filename">example_xta_macbps22.py</code> are
	  installed in directory
	  <code class="filename">/opt/lixa/share/doc/lixa-X.Y.Z/examples/xta/python</code> and
	  are available on <a class="link" href="https://github.com/tiian/lixa/blob/master/doc/examples/xta/python" target="_top">GitHub</a>. Source code is fully
	  commented for readability.
	</p></div></div><div class="footnotes"><br /><hr style="width:100; text-align:left;margin-left: 0" /><div id="ftn.idp59997360" class="footnote"><p><a href="#idp59997360" class="para"><sup class="para">[50] </sup></a>
	    This must not be confused with a specific RPC technology: any
	    communication technique that supports a request-response protocol
	    can be used.
	  </p></div><div id="ftn.idp60012720" class="footnote"><p><a href="#idp60012720" class="para"><sup class="para">[51] </sup></a>
	    <a class="link" href="https://docs.oracle.com/database/121/JJDBC/E49300-05.pdf" target="_top">Oracle (R) Database, JDBC Developer's Guide, 12c Release 1 (12.1)</a>;
	    there are analogous documents for different Oracle Database's
	    versions
	  </p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch08s03.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="ch08.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="ch08s05.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">The
    <span class="quote">“<span class="quote">Multiple Applications, Consecutive Calls</span>”</span>
    Pattern </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> The
    <span class="quote">“<span class="quote">Multiple Applications, Concurrent Branches/Pseudo Asynchronous</span>”</span>
    Pattern</td></tr></table></div></body></html>